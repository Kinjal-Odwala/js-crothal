_builtInTemplate_6091cb6c = ['<?xml version="1.0" encoding="utf-8" ?><transmission>  <target id="iiAuthorization" requestId="1">    <authorization id="1">      <authorize id="41" path="\\crothall\\chimes\\fin\\Budgeting"></authorize>      <authorize id="42" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget"></authorize>      <authorize id="16059" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget\\Read"></authorize>      <authorize id="16060" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget\\Write"></authorize>      <authorize id="44" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections"></authorize>      <authorize id="16063" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\ByPeriod"></authorize>      <authorize id="16064" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\ByPeriod\\Read"></authorize>      <authorize id="16065" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\ByPeriod\\Write"></authorize>      <authorize id="16066" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\WORForecast"></authorize>      <authorize id="16067" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\WORForecast\\Read"></authorize>      <authorize id="16068" path="\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\WORForecast\\Write"></authorize>      <authorize id="1213" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration"></authorize>      <authorize id="16069" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\AnnualInformation"></authorize>      <authorize id="16070" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\AnnualInformation\\Read"></authorize>      <authorize id="16071" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\AnnualInformation\\Write"></authorize>      <authorize id="16072" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ApproveBudget"></authorize>      <authorize id="16073" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ApproveBudget\\Approve"></authorize>      <authorize id="16074" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ApproveBudget\\Read"></authorize>      <authorize id="16075" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ApproveBudget\\Reject"></authorize>      <authorize id="16076" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ApproveBudget\\Write"></authorize>      <authorize id="16077" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\DeleteBudget"></authorize>      <authorize id="16078" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\DeleteBudget\\Read"></authorize>      <authorize id="16079" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\DeleteBudget\\Write"></authorize>      <authorize id="16080" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ExportBudget"></authorize>      <authorize id="16081" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ExportBudget\\Read"></authorize>      <authorize id="16082" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetAdministration\\ExportBudget\\Write"></authorize>      <authorize id="43" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetSummary"></authorize>      <authorize id="16061" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetSummary\\Read"></authorize>      <authorize id="16062" path="\\crothall\\chimes\\fin\\Budgeting\\BudgetSummary\\Write"></authorize>    </authorization>  </target></transmission>','<?xml version="1.0" encoding="utf-8"?><transmission>	<target id="iiCache" requestId="5">		<store id="houseCodeJobs" activeId="169" criteria="storeId:houseCodeJobs,houseCodeId:286,userId:RAYMOND-DEV-XP\Raymond Liu,">			<item fscAccount="169" fscAccCode="4005" description="Full Service Billings" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="170" fscAccCode="4010" description="Management Fee Billings" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="174" fscAccCode="4015" description="Client Paid Labor" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="175" fscAccCode="4020" description="Miscellaneous Income" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="176" fscAccCode="4030" description="Reimbursement Start-Up Costs" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="177" fscAccCode="4040" description="Reimbursement Direct Costs" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="180" fscAccCode="4050" description="Reimbursement Equipment" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="181" fscAccCode="4060" description="Quality Incentive Income" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="182" fscAccCode="4070" description="Prepayment Discount" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="183" fscAccCode="4080" description="Financial Incentive Reimb" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="184" fscAccCode="4085" description="Standard Hours Income" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="185" fscAccCode="4090" description="Control Account Income" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item fscAccount="186" fscAccCode="4095" description="Financial Incentive Income" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			</store>	</target></transmission>','<?xml version="1.0" encoding="utf-8" ?><transmission>	<target id="iiCache" requestId="5">		<store id="houseCodeJobs" activeId="1036" criteria="storeId:houseCodeJobs,houseCodeId:286,userId:RAYMOND-DEV-XP\Raymond Liu,">			<item id="126" fscYear="2010" period="1" startDate="2009-09-27 00:00:00" endDate="2009-10-24 00:00:00"/>			<item id="127" fscYear="2010" period="2" startDate="2009-10-25 00:00:00" endDate="2009-11-21 00:00:00"/>			<item id="128" fscYear="2010" period="3" startDate="2009-11-22 00:00:00" endDate="2009-12-19 00:00:00"/>			<item id="129" fscYear="2010" period="4" startDate="2009-12-20 00:00:00" endDate="2010-01-16 00:00:00"/>			<item id="130" fscYear="2010" period="5" startDate="2010-01-17 00:00:00" endDate="2010-02-13 00:00:00"/>			<item id="131" fscYear="2010" period="6" startDate="2010-02-14 00:00:00" endDate="2010-03-13 00:00:00"/>			<item id="132" fscYear="2010" period="7" startDate="2010-03-14 00:00:00" endDate="2010-04-10 00:00:00"/>			<item id="133" fscYear="2010" period="8" startDate="2010-04-11 00:00:00" endDate="2010-05-08 00:00:00"/>			<item id="134" fscYear="2010" period="9" startDate="2010-05-09 00:00:00" endDate="2010-06-05 00:00:00"/>			<item id="135" fscYear="2010" period="10" startDate="2010-06-06 00:00:00" endDate="2010-07-03 00:00:00"/>			<item id="136" fscYear="2010" period="11" startDate="2010-07-04 00:00:00" endDate="2010-07-31 00:00:00"/>			<item id="137" fscYear="2010" period="12" startDate="2010-08-01 00:00:00" endDate="2010-08-28 00:00:00"/>			<item id="138" fscYear="2010" period="13" startDate="2010-08-29 00:00:00" endDate="2010-09-25 23:59:00"/>		</store>	</target></transmission>','<?xml version="1.0" encoding="utf-8"?><transmission>	<target id="iiCache" requestId="5">		<store id="shiftTypes" activeId="169" criteria="storeId:houseCodeJobs,houseCodeId:286,userId:RAYMOND-DEV-XP\Raymond Liu,">			<item id="1" title="Day" />			<item id="2" title="Evening" />			<item id="3" title="Night" />		</store>	</target></transmission>','<?xml version="1.0" encoding="utf-8"?><transmission>	<target id="iiCache" requestId="5">		<store id="houseCodeJobs" activeId="1" criteria="storeId:houseCodeJobs,houseCodeId:286,userId:RAYMOND-DEV-XP\Raymond Liu,">			<item rowId="1" description="Productive Hours" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="2" description="Short Staffing Legal Holidays" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="3" description="Productive Hours Standard" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="4" description="Average Wage Rate" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="5" description="Prod Labor Standard Cost" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="6" description="Average Wage Rate For Paid Leave" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="7" description="Paid Leave Calculation" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="8" description="Sick Pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="9" description="Personal and other pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="10" description="Legal Holiday" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="11" description="Sub-Total Paid Leave" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="12" description="Vacation Pay Accrual" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="13" description="Overtime Hours" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="14" description="Cost associated with overtime" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="99" description="Total Labor Cost" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />		</store>	</target></transmission>','<?xml version="1.0" encoding="utf-8"?><transmission>	<target id="iiCache" requestId="5">		<store id="houseCodeJobs" activeId="1" criteria="storeId:houseCodeJobs,houseCodeId:286,userId:RAYMOND-DEV-XP\Raymond Liu,">			<item rowId="1" description="Productive Hours" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="2" description="Short Staffing Legal Holidays" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="3" description="Productive Hours Standard" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="4" description="Average Wage Rate" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="5" description="Prod Labor Standard Cost" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="6" description="Average Wage Rate For Paid Leave" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="7" description="Paid Leave Calculation" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="8" description="Sick Pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="9" description="Personal and other pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="10" description="Legal Holiday" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="11" description="Sub-Total Paid Leave" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="12" description="Vacation Pay Accrual" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="13" description="Overtime Hours" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />			<item rowId="14" description="Cost associated with overtime" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item rowId="51" description="Project Work Wage Rate" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item rowId="52" description="Non-Chargeable Project Work " period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item rowId="53" description="Non-Chargeable Project Work Subtotal" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item rowId="54" description="Chargeable Project Work" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item rowId="55" description="Chargeable Project Work Subtotal" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item rowId="99" description="Total Labor Cost" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />		</store>	</target></transmission>','<?xml version="1.0" encoding="utf-8"?><transmission>  <target id="iiCache" requestId="5">    <store id="houseCodeJobs" activeId="169" criteria="storeId:houseCodeJobs,houseCodeId:286,userId:RAYMOND-DEV-XP\Raymond Liu,">      <item fscAccount="191" fscAccCode="5210" description="Productive Labor" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="193" fscAccCode="5220" description="Vacation Pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="194" fscAccCode="5230" description="Holiday Pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="195" fscAccCode="5240" description="Sick Pay" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="205" fscAccCode="5405" description="Fringe Benefits" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="206" fscAccCode="5410" description="Health/Dental" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="216" fscAccCode="5610" description="Management Labor" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="228" fscAccCode="5805" description="Fringe Benefits - Management" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="248" fscAccCode="6015" description="Janitorial Supplies" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="249" fscAccCode="6020" description="Paper Supplies" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />      <item fscAccount="250" fscAccCode="6025" description="Plastic Supplies" period1="0" period2="0" period3="0"  period4="0" period5="0" period6="0" period7="0" period8="0" period9="0" period10="0" period11="0" period12="0" period13="0"  period14="0" period15="0" period16="0" />    </store>  </target></transmission>','<h1 class="page-title">Budget Adjustments</h1><p>    Please make adjustments to Acct Codes on this page. They will be reflected in the Budget Details Page.</p><div id="budget-adjustment-grid"></div><h2 class="page-sub-title" style="margin-top:10px;">Notes</h2><div id="budget-adjustment-note-form"></div><table width="100%">    <tbody>        <tr>            <td>&nbsp;</td>            <td style="width:90px"><div id="save-button"></div></td>            <td style="width:90px"><div id="cancel-button"></div></td>            <td style="width:90px"><div id="print-button"></div></td>        </tr>    </tbody></table>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Budget Adjustments</h2>        <p>            Please make adjustments to Acct Codes on this page. They will be reflected in the Budget Details Page.        </p>    <div style="padding:10px 0">        {incomeTypes}    </div>    <div style="padding:10px 0">    <h2>Notes</h2>    <div style="font-size:12px; border:1px dashed #666;padding:10px;">        {notes}    </div>    </div></div>','<h1 class="page-title">    Budget Approval</h1><p style="padding:5px;width:600px;line-height:1.5em;">    When Approving the Fiscal Year Budget, all sections of the budget process will be    locked down. You will still be able to view the data that was entered, but not be    able to change the data. Please ensure that the data is entered correctly before    approving the budget.</p><p style="padding:5px;width:600px">    Please provide Comments before choosing Budget status.</p><div id="budget-approval-form" style="padding:5px;width:600px"></div><div id="budget-approval-grid"></div>','<h1 class="page-title">Budget Details</h1><div id="budget-details-grid"></div><div>    <table width="100%">        <tbody>            <tr>                <td>&nbsp;</td>                <td style="width:250px; vertical-align:middle;">                    <div id="account-combobox"></div>                </td>                <td style="width:130px">                    <div id="add-account-code-button"></div>                </td>                <td style="width:90px">                    <div id="save-button"></div>                </td>                <td style="width:90px">                    <div id="cancel-button"></div>                </td>                <td style="width:90px">                    <div id="print-button"></div>                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Budget Details</h2>    <div style="padding:10px 0">        {incomeTypes}    </div></div>','<h1 class="page-title">Budget Summary</h1><div id="budget-summary-grid"></div><div>    <table width="100%">        <tbody>            <tr>                <td>&nbsp;</td>                <td style="width:90px">                    <div id="save-button"></div>                </td>                <td style="width:90px">                    <div id="cancel-button"></div>                </td>                <td style="width:90px">                    <div id="print-button"></div>                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Budget Summary</h2>    <div style="padding:10px 0">        {incomeTypes}    </div></div>','<h1 class="page-title">Capital Expenditures</h1><div id="capital-expanditurer-tab-panel">    <ul class="main-tab">        <li class="tab-item"><a href="#capital-expanditurer-tab-1"><span>New Capital Equipment</span></a></li>        <li class="tab-item"><a href="#capital-expanditurer-tab-2"><span>Capital Equipment Disposal Worksheet</span></a></li>        <li class="tab-item"><a href="#capital-expanditurer-tab-3"><span>Depreciation Worksheet</span></a></li>        <li class="tab-item"><a href="#capital-expanditurer-tab-4"><span>Depreciation Disposal Worksheet</span></a></li>    </ul>    <div class="clear"></div>    <div id="capital-expanditurer-tab-1">        <h2 class="page-sub-title">New Capital Equipment Worksheet</h2>        <div id="new-capital-equipment-grid"></div>        <div>            <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width: 100px;">                        <div id="nce-addNewRowButton"></div>                    </td>                    <td style="width: 100px;">                        <div id="nce-saveButton"></div>                    </td>                    <td style="width: 100px;">                        <div id="nce-cancelButton"></div>                    </td>                    <td style="width: 100px;">                        <div id="nce-printButton"></div>                    </td>                </tr>            </tbody>            </table>        </div>    </div>    <div id="capital-expanditurer-tab-2">        <h2 class="page-sub-title">Capital Equipment Disposal Worksheet</h2>        <div id="capital-equipment-disposal-grid"></div>        <div>            <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width: 100px;">                        <div id="ced-addNewRowButton"></div>                    </td>                    <td style="width: 100px;">                        <div id="ced-saveButton"></div>                    </td>                    <td style="width: 100px;">                        <div id="ced-cancelButton"></div>                    </td>                    <td style="width: 100px;">                        <div id="ced-printButton"></div>                    </td>                </tr>            </tbody>            </table>        </div>    </div>    <div id="capital-expanditurer-tab-3">        <h2 class="page-sub-title">Depreciation Worksheet</h2>        <div id="depreciation-grid1"></div>        <div id="depreciation-grid2"></div>        <div>            <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width: 100px;">                        <div id="depreciation-printButton"></div>                    </td>                </tr>            </tbody>            </table>        </div>    </div>    <div id="capital-expanditurer-tab-4">        <h2 class="page-sub-title">Depreciation Disposal Worksheet</h2>        <div id="depreciation-disposal-grid"></div>        <div>            <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width: 100px;">                        <div id="dd-printButton"></div>                    </td>                </tr>            </tbody>            </table>        </div>    </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        New Capital Equipment Worksheet</h2>    <div style="padding:10px 0">        {incomeTypes}    </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Capital Equipment Disposal Worksheet</h2>    <div style="padding:10px 0">        {incomeTypes}    </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Depreciation Worksheet</h2>    <div style="padding:10px 0">        {incomeTypes}    </div>    <div style="padding:10px 0">        {incomeTypes2}    </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Depreciation Disposal Worksheet</h2>    <div style="padding:10px 0">        {incomeTypes}    </div></div>','<div class="contract-billing">    <h2 class="page-title">Contract Billing</h2><br/>    <table class="ux-table-2">        <thead>            <tr>                <td style="width: 15%">                    Billing Period                </td>                <td style="width: 25%">                    Current Billing Rate                </td>                <td style="width: 35%">                </td>                <td style="width: 25%">                    New Billing Rate                </td>                </tr>        </thead>        <tbody>            <tr>                <td>                    <table class="ux-table-1">                        <tbody>                            <tr style="background-color: #659A66">                                <td>                                </td>                            </tr>                            <tr>                                <td>                                    <div id="billing-period" ></div>                                </td>                            </tr>                        </tbody>                    </table>                </td>                <td>                    <table class="ux-table-1">                        <tbody>                            <tr>                                <td>                                    Rate                                </td>                                <td>                                    Daily Rate                                </td>                            </tr>                            <tr>                                <td class="right">                                    <div id="current-billing-rate"></div>                                </td>                                <td>                                    <div id="current-billing-daily-rate" ></div>                                </td>                            </tr>                        </tbody>                    </table>                </td>                <td>                    <table class="ux-table-1">                        <tbody>                            <tr>                                <td>                                    Percent Increase(%)                                </td>                                <td>                                    Increase in $                                </td>                                <td>                                    Date Effective                                </td>                            </tr>                            <tr>                                <td class="right">                                     <div id="current-billing-percent-increase" ></div>                                </td>                                <td>                                     <div id="current-billing-amount-increase" ></div>                                </td>                                <td class="date-effective">                                     <div id="current-billing-date-effective" ></div>                                </td>                            </tr>                        </tbody>                    </table>                </td>                <td>                    <table class="ux-table-1">                        <tbody>                            <tr>                                <td>                                    Rate                                </td>                                <td class="left">                                    Daily Rate                                </td>                            </tr>                            <tr>                                <td>                                     <div id="new-billing-rate" ></div>                                </td>                                <td>                                     <div id="new-billing-daily-rate" ></div>                                </td>                            </tr>                        </tbody>                    </table>                </td>            </tr>        </tbody>    </table>    <h3 style="color:#000000;">Billings Per Period</h3>    <div id="period-grid-holder">        </div>    <div id="billing-notes" style="padding:20px 0 10px;">    </div>       <table width="100%">        <tbody>            <tr>                <td>&nbsp;</td>                <td style="width:100px">                     <div id="billing-save-button"></div>                </td>                <td style="width:100px">                    <div id="billing-cancel-button"></div>                </td>                <td style="width:100px">                    <div id="billing-print-button"></div>                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <table>        <thead>            <tr>                <td style="width: 10%">                    Billing Period                </td>                <td style="width: 30%" colspan="3">                    Current Billing Rate                </td>                <td style="width: 30%" colspan="3">                </td>                <td style="width: 30%" colspan="3">                    New Billing Rate                </td>            </tr>        </thead>        <tbody>            <tr>                <td style="background-color: #659A66">                </td>                <td>                    Rate                </td>                <td>                    Daily Rate                </td>                <td>                    Percent Increase(%)                </td>                <td>                    Increase in $                </td>                <td>                    Date Effective                </td>                <td>                    Rate                </td>                <td>                    Daily Rate                </td>            </tr>            <tr>                <td>                    {billing-period}                </td>                <td>                    {current-rate}                </td>                <td>                    {current-daily-rate}                </td>                <td>                    {percent-increase}                </td>                <td>                    {amount-increase}                </td>                <td>                    {date-effective}                </td>                <td>                    {new-rate}                </td>                <td>                    {new-daily-rate}                </td>            </tr>        </tbody>    </table>    <h3 style="color: #000000; padding-top: 10px">        Billings Per Period</h3>    <div style="padding-bottom:10px">        {incomeTypes}    </div>    <table><tr><td>{description}</td></tr></table></div>','<h1 class="page-title">Employee Data</h1><div id="employee-grid"></div><div class="padding-top-bottom-10" id="employee-form"></div><div>    <table width="100%">        <tbody>            <tr>                <td>&nbsp;</td>                <td style="width:110px">                    <div id="employee-save-button"></div>                </td>                <!--<td style="width:110px">                    <div id="employee-update-button"></div>                </td>-->                <td style="width:100px">                    <div id="employee-print-button"></div>                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h3 style="color: #000000; padding-top: 10px">        Employees</h3>    <div style="padding-bottom:10px">        {incomeTypes}    </div>    <table width="100%">        <tbody>            <tr>                <td style="text-align:right;padding-right:10px">Number of Employees:</td>                <td>                    {numberOfEmployees}                </td>                <td style="text-align:right;padding-right:10px">Average Wage Rate:</td>                <td>                    {averageWageRate}                </td>                <td style="text-align:right;padding-right:10px">Base Average Wage Rate Excluding Differential:</td>                <td>                    {averageBaseWageRate}                </td>            </tr>        </tbody>    </table></div>','<h1 class="page-title">    Final Computation Of Labor</h1><div id="period-grid-holder"></div><div style="float: right; padding-right:20px; ">    <table>        <tbody>            <tr>                <td>                    &nbsp;                </td>                <td style="width:100px;">                    <div id="save-button">                    </div>                </td>                <td style="width:100px;">                    <div id="print-button">                    </div>                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h3 style="color: #000000; padding-top: 10px">        Final Computation Of Labor</h3>    <div style="padding-bottom:10px">        {finalLabors}    </div></div>','<div id="container"></div>','<table style="width: 100%" class="ux-table">    <tbody>        <tr class="odd">            <td>                Sick day entitlements earned per year (days per employee)            </td>            <td>                <div id="sickDays"></div>            </td>        </tr>        <tr>            <td>                Average sick days taken over last 52 weeks (days per employee)            </td>            <td>                <div id="sickDaysTaken"></div>            </td>        </tr>        <tr class="odd">            <td>                Proj. number of sick days to be used in budget year (days per employee)            </td>            <td>                 <div id="sickDaysProjected"></div>            </td>        </tr>    </tbody></table>','<table style="width: 100%" class="ux-table">    <tbody>        <tr class="odd">            <td>                Number of Employee Personal Days Granted Per Year            </td>            <td>                <div id="personalDays"></div>            </td>        </tr>        <tr>            <td>                Other Paid Leave            </td>            <td>                <div id="otherPaidLeave" ></div>            </td>        </tr>    </tbody></table>','<p class="table-title">    Table1 - # of Employees</p><table class="ux-table">    <thead>        <tr>            <th>            </th>            <th>                Medical 1            </th>            <th>                Medical 2            </th>               <th>                Medical 3            </th>               <th>                Medical 4            </th>               <th>                Medical 5            </th>            <th>                Liberty Plan            </th>            <th>                Dental Only            </th>            <th>                Total            </th>            <th>                Life            </th>            <th>                Union            </th>        </tr>    </thead>    <tbody>        <tr class="odd">            <td>                Single Coverage            </td>            <td>                <div id="singleHMOCount"></div>            </td>            <td>                <div id="singlePOSCount"></div>            </td>             <td>                <div id="singleMedical3Count"></div>            </td>             <td>                <div id="singleMedical4Count"></div>            </td>             <td>                <div id="singleMedical5Count"></div>            </td>            <td>               <div id="singleLibertyCount"></div>            </td>            <td>                <div id="singleDentalCount"></div>            </td>            <td>                <div id="singleTotalCount"></div>            </td>            <td>               <div id="singleLifeCount"></div>            </td>            <td>               <div id="singleUnionCount"></div>            </td>        </tr>		<tr>            <td>                Single + Spouse            </td>            <td>                <div id="singleSpouseHMOCount"></div>            </td>            <td>                <div id="singleSpousePOSCount"></div>            </td>             <td>                <div id="singleSpouseMedical3Count"></div>            </td>             <td>                <div id="singleSpouseMedical4Count"></div>            </td>             <td>                <div id="singleSpouseMedical5Count"></div>            </td>            <td>               <div id="singleSpouseLibertyCount"></div>            </td>            <td>                <div id="singleSpouseDentalCount"></div>            </td>            <td>                <div id="singleSpouseTotalCount"></div>            </td>            <td>               <div id="singleSpouseLifeCount"></div>            </td>            <td>               <div id="singleSpouseUnionCount"></div>            </td>        </tr>		<tr class="odd">            <td>                Single + Dependant            </td>            <td>                <div id="singleDependantHMOCount"></div>            </td>            <td>                <div id="singleDependantPOSCount"></div>            </td>             <td>                <div id="singleDependantMedical3Count"></div>            </td>             <td>                <div id="singleDependantMedical4Count"></div>            </td>             <td>                <div id="singleDependantMedical5Count"></div>            </td>            <td>               <div id="singleDependantLibertyCount"></div>            </td>            <td>                <div id="singleDependantDentalCount"></div>            </td>            <td>                <div id="singleDependantTotalCount"></div>            </td>            <td>               <div id="singleDependantLifeCount"></div>            </td>            <td>               <div id="singleDependantUnionCount"></div>            </td>        </tr>        <tr>            <td>                Family Coverage            </td>            <td>                <div id="familyHMOCount"></div>            </td>            <td>                <div id="familyPOSCount"></div>            </td>              <td>                <div id="familyMedical3Count"></div>            </td>              <td>                <div id="familyMedical4Count"></div>            </td>              <td>                <div id="familyMedical5Count"></div>            </td>            <td>                <div id="familyLibertyCount"></div>            </td>            <td>                <div id="familyDentalCount"></div>            </td>            <td>                <div id="familyTotalCount"></div>            </td>            <td>                <div id="familyLifeCount"></div>            </td>            <td>                <div id="familyUnionCount"></div>            </td>        </tr>        <tr class="odd">            <td>                Total            </td>            <td>                <div id="totalHMOCount"></div>            </td>            <td>                <div id="totalPOSCount"></div>            </td>             <td>                <div id="totalMedical3Count"></div>            </td>             <td>                <div id="totalMedical4Count"></div>            </td>             <td>                <div id="totalMedical5Count"></div>            </td>            <td>                <div id="totalLibertyCount"></div>            </td>            <td>                <div id="totalDentalCount"></div>            </td>            <td>                <div id="totalCount"></div>            </td>            <td>                <div id="totalLifeCount"></div>            </td>            <td>                <div id="totalUnionCount"></div>            </td>        </tr>    </tbody></table><p class="table-title">    Table2 - BI weekly Cost of Health/Dental/Life Insurance Contributions</p><table class="ux-table">    <thead>        <tr>            <th>            </th>            <th>                Medical 1            </th>            <th>                Medical 2            </th>			 <th>                Medical 3            </th>               <th>                Medical 4            </th>               <th>                Medical 5            </th>            <th>                Liberty Plan            </th>            <th>                Dental Only            </th>            <th>                Total            </th>            <th>                Life            </th>            <th>                Union            </th>        </tr>    </thead>    <tbody>        <tr class="odd">            <td>                Single Coverage            </td>            <td>                <div id="singleHMOCost"></div>            </td>            <td>                <div id="singlePOSCost"></div>            </td>			<td>                <div id="singleMedical3Cost"></div>            </td>			<td>                <div id="singleMedical4Cost"></div>            </td>			<td>                <div id="singleMedical5Cost"></div>            </td>            <td>                <div id="singleLibertyCost"></div>            </td>            <td>                <div id="singleDentalCost"></div>            </td>            <td>                <div id="singleTotalCost"></div>            </td>            <td>                <div id="singleLifeCost"></div>            </td>            <td>                <div id="singleUnionCost"></div>            </td>        </tr>         <tr >            <td>                Single + Spouse            </td>            <td>                <div id="singleSpouseHMOCost"></div>            </td>            <td>                <div id="singleSpousePOSCost"></div>            </td>			<td>                <div id="singleSpouseMedical3Cost"></div>            </td>			<td>                <div id="singleSpouseMedical4Cost"></div>            </td>			<td>                <div id="singleSpouseMedical5Cost"></div>            </td>            <td>                <div id="singleSpouseLibertyCost"></div>            </td>            <td>                <div id="singleSpouseDentalCost"></div>            </td>            <td>                <div id="singleSpouseTotalCost"></div>            </td>            <td>                <div id="singleSpouseLifeCost"></div>            </td>            <td>                <div id="singleSpouseUnionCost"></div>            </td>        </tr>         <tr class="odd">            <td>                Single + Dependant            </td>            <td>                <div id="singleDependantHMOCost"></div>            </td>            <td>                <div id="singleDependantPOSCost"></div>            </td>			<td>                <div id="singleDependantMedical3Cost"></div>            </td>			<td>                <div id="singleDependantMedical4Cost"></div>            </td>			<td>                <div id="singleDependantMedical5Cost"></div>            </td>            <td>                <div id="singleDependantLibertyCost"></div>            </td>            <td>                <div id="singleDependantDentalCost"></div>            </td>            <td>                <div id="singleDependantTotalCost"></div>            </td>            <td>                <div id="singleDependantLifeCost"></div>            </td>            <td>                <div id="singleDependantUnionCost"></div>            </td>        </tr>        <tr>            <td>                Family Coverage            </td>            <td>                <div id="familyHMOCost"></div>            </td>            <td>                <div id="familyPOSCost"></div>            </td>			<td>                <div id="familyMedical3Cost"></div>            </td>			<td>                <div id="familyMedical4Cost"></div>            </td>			<td>                <div id="familyMedical5Cost"></div>            </td>            <td>                <div id="familyLibertyCost"></div>            </td>            <td>                <div id="familyDentalCost"></div>            </td>            <td>                <div id="familyTotalCost"></div>            </td>            <td>                <div id="familyLifeCost"></div>            </td>            <td>                <div id="familyUnionCost"></div>            </td>        </tr>        <tr class="odd">            <td>                Total            </td>            <td>                <div id="totalHMOCost"></div>            </td>            <td>                <div id="totalPOSCost"></div>            </td>			<td>                <div id="totalMedical3Cost"></div>            </td>			<td>                <div id="totalMedical4Cost"></div>            </td>			<td>                <div id="totalMedical5Cost"></div>            </td>            <td>                <div id="totalLibertyCost"></div>            </td>            <td>                <div id="totalDentalCost"></div>            </td>            <td>                <div id="totalCost"></div>            </td>            <td>                <div id="totalLifeCost"></div>            </td>            <td>                <div id="totalUnionCost"></div>            </td>        </tr>    </tbody></table>','<h2 class="page-sub-title">    V. Computation Of Net Productive Days Per Employee</h2><div style="margin:15px 0;">    <div style="font-weight:bold;">Work Days per 52 wks: <span id="ytdBusinessDays"></span></div>    <table style="width:100%; margin:20px 0;" class="ux-table">        <tbody>            <tr class="odd">                <td>Sick days Taken</td>                <td>                    <div id="sickDaysProjected"></div>                </td>                <td>                    <div id="sickDaysTakenPercentage"></div>                </td>            </tr>            <tr>                <td>Legal Holidays</td>                <td>                    <div id="legalHolidays"></div>                </td>                <td>                    <div id="legalHolidaysPercentage"></div>                </td>            </tr>            <tr class="odd">                <td>Personal Days</td>                <td>                    <div id="personalDays"></div>                </td>                <td>                    <div id="personalDaysPercentage"></div>                </td>            </tr>            <tr>                <td>Other Paid Leave</td>                <td>                    <div id="otherPaidLeave"></div>                </td>                <td>                    <div id="otherPaidLeavePercentage"></div>                </td>            </tr>            <tr class="odd">                <td>Vacation Earned</td>                <td>                    <div id="vacationEarned"></div>                </td>                <td>                    <div id="vacationEarnedPercentage"></div>                </td>            </tr>            <tr>                <td style="text-align:right"><span style="font-weight:bold;">Total Paid Leave</span></td>                <td>                    <div id="totalPaidLeave" style="font-weight:bold;"></div>                </td>                <td>                    <div id="totalPaidLeavePercentage" style="font-weight:bold;"></div>                </td>            </tr>            <tr>                <td style="text-align:right"><span style="font-weight:bold;">Net Employee Productive Days Per Year</span></td>                <td>                    <div id="netEmployeeProductiveDaysPerYear" style="font-weight:bold;"></div>                </td>                <td>&nbsp;</td>            </tr>        </tbody>    </table></div><h2 class="page-sub-title">    VI. Estimate of FTEs needed for productive and nonproductive labor</h2><div style="margin:15px 0;">    <table style="width:100%" class="ux-table">        <tbody>            <tr class="odd">                <td>Hours Per Day Per Employee</td>                <td>                    <div id="employeeHoursPerDay"></div>                </td>            </tr>            <tr>                <td style="text-align:right"><span style="font-weight:bold">Approximate Staffing in FTE Required</span></td>                <td>                    <div id="approximateStaffingInFTERequired"></div>                </td>            </tr>        </tbody>    </table></div>','<h2 class="page-sub-title">    VII. Computation Of Labor Standards</h2><div style="margin: 15px 0;">    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">A. Labor standard before short staffing : </span></td>                <td>                    <div id="laborStandardBeforeShortStaffing"></div>                </td>            </tr>            <tr class="odd">                <td>Projected number of new employees </td>                <td>                    <div id="projectedNewEmployees"></div>                </td>            </tr>            <tr>                <td>Projected hours to train each employee while overlapping with existing employee</td>                <td>                    <div id="projectedEmployeeTrainingHours"></div>                </td>            </tr>            <tr class="odd">                <td>Total hours spent training new employees</td>                <td>                    <div id="totalTrainingHours"></div>                </td>            </tr>            <tr>                <td>Sub-Total Productive Labor Standard</td>                <td>                    <div id="productiveLaborStandard"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">B. Adjusted labor standard due to short-staffing</span></td>                <td>                    % Factor                </td>                <td>&nbsp;</td>            </tr>            <tr class="odd">                <td>Non replacement of employees on vacation</td>                <td>                    <span id="nonReplaceVacationPerc"></span>%                </td>                <td>                    <div id="nonReplaceVacationCount"></div>                </td>            </tr>            <tr>                <td>Non replacement of employees on sick pay</td>                <td>                    <span id="nonReplaceSickPayPerc"></span>%                </td>                <td>                    <div id="nonReplaceSickPayCount"></div>                </td>            </tr>            <tr class="odd">                <td>Non replacement for paid time off in lieu of working a legal holiday</td>                <td>                    <span id="nonReplaceHolidayPerc"></span>%                </td>                <td>                    <div id="nonReplaceHolidayCount"></div>                </td>            </tr>            <tr>                <td>Non replacement of employees on personal leave</td>                <td>                    <span id="nonReplacePersonalPerc"></span>%                </td>                <td>                    <div id="nonReplacePersonalCount"></div>                </td>            </tr>            <tr class="odd">                <td style="text-align:right"><span style="font-weight:bold">Sub-Total of Short-Staffing</span></td>                <td>                    &nbsp;                </td>                <td><div id="totalShortStaffing"></div></td>            </tr>            <tr>                <td>Sub-Total Productive Labor Standards</td>                <td>                   &nbsp;                 </td>                <td><div id="productiveLaborStandards"></div></td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">C. Computation of short-staffing on legal holidays</span></td>                <td>                    <div id="shortStaffingOnLegalHolidays"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">D. Net Productive Standard</span></td>                <td>                    <div id="netProductiveStandard"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">E. Computation of Paid Leave Standard</span></td>                <td>                    &nbsp;                </td>            </tr>            <tr class="odd">                <td>Sick Pay Standard</td>                <td>                    <div id="sickPayStandard"></div>                </td>            </tr>            <tr>                <td>Legal Holiday Standard</td>                <td>                    <div id="legalHolidayStandard"></div>                </td>            </tr>            <tr class="odd">                <td>Personal Leave Standard</td>                <td>                    <div id="personalLeaveStandard"></div>                </td>            </tr>            <tr>                <td>Vacation Accrual Standard</td>                <td>                    <div id="vacationAccrualStandard"></div>                </td>            </tr>            <tr class="odd">                <td style="text-align:right;"><span style="font-weight:bold">Paid Leave Standards</span></td>                <td>                    <div id="paidLeaveStandards"></div>                </td>            </tr>            <tr>                <td>Total 52 Week Paid Hours Standard</td>                <td>                    <div id="total52WeekPaidHoursStandard"></div>                </td>            </tr>        </tbody>    </table></div>','<h2 class="page-sub-title">    VIII. Computation of Labor Standards in Dollars</h2><div style="margin: 15px 0;">    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">A. Current Avg Wage Rate(from employee data file):</span></td>                <td>                    <span style="font-weight:bold"><div id="avgWageRate"></div></span>                </td>            </tr>            <tr class="odd">                <td>Avg wage rate excluding differential</td>                <td>                    <div id="avgWageRateExcludingDifferential"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">B. Project Effect of Merit Increase:</span></td>                <td>                    &nbsp;                </td>            </tr>            <tr class="odd">                <td>#Employees to get merit increase</td>                <td>                    <div id="meritIncreaseEmployees"></div>                </td>            </tr>            <tr>                <td>Total # of employees</td>                <td>                    <div id="totalEmployees"></div>                </td>            </tr>            <tr class="odd">                <td>Avg amount of merit increase per hour</td>                <td>                    $<div id="meritIncreasePerHour" style="float:right;"></div>                </td>            </tr>            <tr>                <td>Total increase in wage cost/per pay period</td>                <td>                    <div id="totalIncreaseInWageCost"></div>                </td>            </tr>            <tr class="odd">                <td># of employees who will leave</td>                <td>                    <div id="employeesLeaving"></div>                </td>            </tr>            <tr>                <td>Average reduction in wage rate of their replacement(Avg wage rate minus starting wage rate)</td>                <td>                    <div id="avgWageRateReduction"></div>                </td>            </tr>            <tr class="odd">                <td>Starting wage rate</td>                <td>                    $<div id="startingWageRate" style="float:right;"></div>                </td>            </tr>            <tr>                <td>Decrease in wage rate/per pay period</td>                <td>                    <div id="decreaseInWageRate"></div>                </td>            </tr>            <tr class="odd">                <td>Net effect of Avg wage rate of merit increase</td>                <td>                    <div id="avgWageRateNetEffect"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">C. Projected Avg Wage Rate before cost of living increase including defferential</span></td>                <td>                    <div id="projectedAvgWageRate"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">D. Cost of Living Increase</span></td>                <td>&nbsp;</td>            </tr>            <tr class="odd">                <td>Estimated date of increase(period)</td>                <td>                    <div id="estimatedCOLPeriodOfIncrease"></div>                </td>            </tr>            <tr>                <td>Estimated increase per hour</td>                <td>                    <div id="estimatedCOLIncreasePerHour"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">E. Estimated Avg Wage Rate including COL increase</span></td>                <td>                    <div id="estimatedCOLAvgWageRate"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">F.Paid Leave does not get Evening Shift Differential</span></td>                <td>                    <div id="paidLeaveNoNightDifferential"></div>                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>Average Wage Rate for paid leave after COL increase excluding night differential</td>                <td>                    <div id="avgWageRateCOLNoNightDifferential"></div>                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h3 style="color: #000000; padding-top: 10px">        Vacation</h3>    <div style="padding-bottom:10px">        {incomeTypes}    </div>    <table width="100%">        <tbody>            <tr>                <td>Average Vacation Entitlement:</td>                <td>                    {averageVacation}                    Days                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div></div><h2 class="page-sub-title">    VII. Computation Of Labor Standards</h2><div style="margin: 15px 0;">    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td><span style="font-weight:bold">A. Labor standard before short staffing : </span></td>                <td>                    {laborStandardBeforeShortStaffing}                </td>            </tr>            <tr class="odd">                <td>Projected number of new employees </td>                <td>                    {projectedNewEmployees}                </td>            </tr>            <tr>                <td>Projected hours to train each employee while overlapping with existing employee</td>                <td>                    {projectedEmployeeTrainingHours}                </td>            </tr>            <tr class="odd">                <td>Total hours spent training new employees</td>                <td>                    {totalTrainingHours}                </td>            </tr>            <tr>                <td>Sub-Total Productive Labor Standard</td>                <td>                    {productiveLaborStandard}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>B. Adjusted labor standard due to short-staffing</td>                <td>                    % Factor                </td>                <td>&nbsp;</td>            </tr>            <tr class="odd">                <td>Non replacement of employees on vacation</td>                <td>                    {nonReplaceVacationPerc}%                </td>                <td>                    {nonReplaceVacationCount}                </td>            </tr>            <tr>                <td>Non replacement of employees on sick pay</td>                <td>                    {nonReplaceSickPayPerc}%                </td>                <td>                    {nonReplaceSickPayCount}                </td>            </tr>            <tr class="odd">                <td>Non replacement for paid time off in lieu of working a legal holiday</td>                <td>                    {nonReplaceHolidayPerc}%                </td>                <td>                    {nonReplaceHolidayCount}                </td>            </tr>            <tr>                <td>Non replacement of employees on personal leave</td>                <td>                    {nonReplacePersonalPerc}%                </td>                <td>                    {nonReplacePersonalCount}                </td>            </tr>            <tr class="odd">                <td style="text-align:right"><span style="font-weight:bold">Sub-Total of Short-Staffing</span></td>                <td>                    &nbsp;                </td>                <td>{totalShortStaffing}</td>            </tr>            <tr>                <td>Sub-Total Productive Labor Standards</td>                <td>                   &nbsp;                 </td>                <td>{productiveLaborStandards}</td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>C. Computation of short-staffing on legal holidays</td>                <td>                    {shortStaffingOnLegalHolidays}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>D. Net Productive Standard</td>                <td>                    {netProductiveStandard}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>E. Computation of Paid Leave Standard</td>                <td>                    &nbsp;                </td>            </tr>            <tr class="odd">                <td>Sick Pay Standard</td>                <td>                    {sickPayStandard}                </td>            </tr>            <tr>                <td>Legal Holiday Standard</td>                <td>                    {legalHolidayStandard}                </td>            </tr>            <tr class="odd">                <td>Personal Leave Standard</td>                <td>                    {personalLeaveStandard}                </td>            </tr>            <tr>                <td>Vacation Accrual Standard</td>                <td>                    {vacationAccrualStandard}                </td>            </tr>            <tr class="odd">                <td style="text-align:right;"><span style="font-weight:bold">Paid Leave Standards</span></td>                <td>                    {paidLeaveStandards}                </td>            </tr>            <tr>                <td>Total 52 Week Paid Hours Standard</td>                <td>                    {total52WeekPaidHoursStandard}                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div></div><h2 class="page-sub-title">    VIII. Computation of Labor Standards in Dollars</h2><div style="margin: 15px 0;">    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>A. Current Avg Wage Rate(from employee data file):</td>                <td>                    {avgWageRate}                </td>            </tr>            <tr class="odd">                <td>Avg wage rate excluding differential</td>                <td>                    {avgWageRateExcludingDifferential}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>B. Project Effect of Merit Increase:</td>                <td>                    &nbsp;                </td>            </tr>            <tr class="odd">                <td>#Employees to get merit increase</td>                <td>                    {meritIncreaseEmployees}                </td>            </tr>            <tr>                <td>Total # of employees</td>                <td>                    {totalEmployees}                </td>            </tr>            <tr class="odd">                <td>Avg amount of merit increase per hour</td>                <td>                    ${meritIncreasePerHour}                </td>            </tr>            <tr>                <td>Total increase in wage cost/per pay period</td>                <td>                    {totalIncreaseInWageCost}                </td>            </tr>            <tr class="odd">                <td># of employees who will leave</td>                <td>                    {employeesLeaving}                </td>            </tr>            <tr>                <td>Average reduction in wage rate of their replacement(Avg wage rate minus starting wage rate)</td>                <td>                    {avgWageRateReduction}                </td>            </tr>            <tr class="odd">                <td>Starting wage rate</td>                <td>                    ${startingWageRate}                </td>            </tr>            <tr>                <td>Decrease in wage rate/per pay period</td>                <td>                    {decreaseInWageRate}                </td>            </tr>            <tr class="odd">                <td>Net effect of Avg wage rate of merit increase</td>                <td>                    {avgWageRateNetEffect}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>C. Projected Avg Wage Rate before cost of living increase including defferential</td>                <td>                    {projectedAvgWageRate}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>D. Cost of Living Increase</td>                <td>&nbsp;</td>            </tr>            <tr class="odd">                <td>Estimated date of increase(period)</td>                <td>                    {estimatedCOLPeriodOfIncrease}                </td>            </tr>            <tr>                <td>Estimated increase per hour</td>                <td>                    {estimatedCOLIncreasePerHour}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>E. Estimated Avg Wage Rate including COL increase</td>                <td>                    {estimatedCOLAvgWageRate}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>F.Paid Leave does not get Evening Shift Differential</td>                <td>                    {paidLeaveNoNightDifferential}                </td>            </tr>        </tbody>    </table>    <table style="width:100%; margin:10px 0;" class="ux-table">        <tbody>            <tr>                <td>Average Wage Rate for paid leave after COL increase excluding night differential</td>                <td>                    {avgWageRateCOLNoNightDifferential}                </td>            </tr>        </tbody>    </table></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h3 style="color: #000000; padding-top: 10px">        Productive Employees Health/Dental/Life Insurance BI-Weekly Cost</h3>    <div style="padding-bottom:10px">        {incomeTypes}    </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div></div><h2 class="page-sub-title">    V. Computation Of Net Productive Days Per Employee</h2><div style="margin:15px 0;">    <div style="font-weight:bold;">Work Days per 52 wks: {ytdBusinessDays}</div>    <table style="width:100%; margin:20px 0;" class="ux-table">        <tbody>            <tr class="odd">                <td>Sick days Taken</td>                <td>                    {sickDaysProjected}                </td>                <td>                    {sickDaysTakenPercentage}                </td>            </tr>            <tr>                <td>Legal Holidays</td>                <td>                    {legalHolidays}                </td>                <td>                    {legalHolidaysPercentage}                </td>            </tr>            <tr class="odd">                <td>Personal Days</td>                <td>                    {personalDays}                </td>                <td>                    {personalDaysPercentage}                </td>            </tr>            <tr>                <td>Other Paid Leave</td>                <td>                    {otherPaidLeave}                </td>                <td>                    {otherPaidLeavePercentage}                </td>            </tr>            <tr class="odd">                <td>Vacation Earned</td>                <td>                    {vacationEarned}                </td>                <td>                    {vacationEarnedPercentage}                </td>            </tr>            <tr>                <td style="text-align:right"><span style="font-weight:bold;">Total Paid Leave</span></td>                <td>                    <span style="font-weight:bold;">{totalPaidLeave}</span>                </td>                <td>                    <span style="font-weight:bold;">{totalPaidLeavePercentage}</span>                </td>            </tr>            <tr>                <td style="text-align:right"><span style="font-weight:bold;">Net Employee Productive Days Per Year</span></td>                <td>                    <span style="font-weight:bold;">{netEmployeeProductiveDaysPerYear}</span>                </td>                <td>&nbsp;</td>            </tr>        </tbody>    </table></div><h2 class="page-sub-title">    VI. Estimate of FTEs needed for productive and nonproductive labor</h2><div style="margin:15px 0;">    <table style="width:100%" class="ux-table">        <tbody>            <tr class="odd">                <td>Hours Per Day Per Employee</td>                <td>                    {employeeHoursPerDay}                </td>            </tr>            <tr>                <td style="text-align:right"><span style="font-weight:bold">Approximate Staffing in FTE Required</span></td>                <td>                    {approximateStaffingInFTERequired}                </td>            </tr>        </tbody>    </table></div>','<h1 class="page-title">Management History</h1><div id="management-history-tab-panel">    <ul class="main-tab">        <li class="tab-item"><a href="#management-history-tab-1"><span>Personal Salary Review Worksheet</span></a></li>        <li class="tab-item"><a href="#management-history-tab-2"><span>Management Administration Worksheet</span></a></li>    </ul>    <div id="management-history-tab-1">        <h2 class="page-sub-title">Personal Salary Review</h2>        <div id="personal-salary-review-grid"></div>        <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width:90px">                        <div id="personal-salary-review-add-button"></div>                    </td>                    <td style="width:110px">                        <div id="personal-salary-review-save-button"></div>                    </td>                       <td style="width:90px">                        <div id="personal-salary-review-cancel-button"></div>                    </td>                    <td style="width:90px">                        <div id="personal-salary-review-print-button"></div>                    </td>                </tr>            </tbody>        </table>            </div>    <div id="management-history-tab-2">        <h2 class="page-sub-title">Management History</h2>        <div id="management-admin-worksheet-grid"></div>        <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width:90px">                        <div id="management-admin-worksheet-print-button"></div>                    </td>                </tr>            </tbody>        </table>       </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h3 style="color: #000000; padding-top: 10px">        Personal Salary Review</h3>    <div style="padding-bottom:10px">        {incomeTypes}    </div></div>','<h1 class="page-title">    Staffing Hours</h1><div id="staffing-tab-panel">    <ul class="main-tab">        <li class="tab-item"><a href="#staffing-tab-1"><span>Staffing Hours Detail Worksheet</span></a></li>        <li class="tab-item" id="summayTabLink"><a href="#staffing-tab-2"><span>Staffing Hours            Summary Worksheet</span></a></li>    </ul>    <div class="clear">    </div>    <div id="staffing-tab-1">        <h2 class="page-sub-title">            Staffing Detail</h2>        <div id="general-wrapper">            <div>                <table width="100%">                    <tbody>                        <tr>                            <td style="width: 100px">                                Shift Selected:                            </td>                            <td>                                <div id="staffing-shift-select-box">                                </div>                            </td>                        </tr>                    </tbody>                </table>            </div>            <div>                <table width="100%">                    <tbody>                        <tr>                            <td>                                &nbsp;                            </td>                            <td style="width: 130px">                                <div id="staffing-add-unit-button">                                </div>                            </td>                            <td style="width: 90px">                                <div id="staffing-update-button">                                </div>                            </td>                            <td style="width: 90px">                                <div id="staffing-cancel-button">                                </div>                            </td>                            <td style="width: 90px">                                <div id="staffing-print-button">                                </div>                            </td>                        </tr>                    </tbody>                </table>            </div>            <div id="staffing-detail-worksheet-grid">            </div>        </div>        <div id="education-wrapper">         <div>                <table width="100%">                    <tbody>                        <tr>                            <td>                                &nbsp;                            </td>                            <td style="width: 130px">                                <div id="education-staffing-save-button">                                </div>                            </td>                                                 </tr>                    </tbody>                </table>            </div>            <div id="education-staffing-grid">                        </div>            <div style="text-align:right; padding: 10px 30px; font-size:14px; font-weight:bold;">                Fiscal Year: <span id="educationFiscalYear" />            </div>        </div>    </div>    <div id="staffing-tab-2">        <h2 class="page-sub-title">            Staffing Summary</h2>        <div id="staffing-hours-summary-worksheet-grid">        </div>        <div style="margin-top: 10px;">            <table>                <tbody>                    <tr>                        <td style="width: 400px; text-align: right; padding: 8px;">                            Planned(Reduction) or Increase per Week:                        </td>                        <td>                            <div id="increase-per-week-textbox">                            </div>                        </td>                    </tr>                    <tr>                        <td style="text-align: right; padding: 8px;">                            Short Staffing Reduction or (Increase) on Legal Holidays:                        </td>                        <td>                            <div id="increase-on-legal-holidays-textbox">                            </div>                        </td>                    </tr>                </tbody>            </table>        </div>    </div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>        <h3 style="color: #000000; padding-top: 10px">        Billings Per Period</h3>    <div style="padding-bottom:10px">        {staffingHours}    </div></div>','<h1 class="page-title">Budget Start Page</h1><div id="add-new-budget-button" style="margin-bottom:30px"></div><div>    <table width="100%" class="ux-table">        <tbody>            <tr class="odd">                <td style="text-align: right; width:50%;">Budget Start Time</td>                <td style="text-align: left; width:50%;"><div id="start-date-label"></div></td>            </tr>            <tr>                <td style="text-align: right;">Budget Started By</td>                <td style="text-align: left;"><div id="start-by-label"></div></td>            </tr>            <tr class="odd">                <td>&nbsp;</td>                <td>&nbsp;</td>            </tr>        </tbody>    </table></div><br /><br /><div>    <h2 class="page-sub-title">Announcements</h2>    <div class="startbudget-content" id="start-budget-comment">        2011 Fiscal Year Budget Process        Start:April6, 2010<br />        Prerequisites<br />        <ul>            <li>1.Review/Update Employee Information</li>            <li>2.Review/Update Mgmt Employee Information</li>            <li>3.Review Update House Code Information</li>        </ul>        <br />        Once the budget has been started this information cannot be updated in the Budget Process    </div></div>','<h1 class="page-title">Supply Expenditures</h1><div id="supply-expanditures-tab-panel">    <ul class="main-tab">        <li class="tab-item"><a href="#supply-expanditures-tab-1"><span>Paper Worksheet</span></a></li>        <li class="tab-item"><a href="#supply-expanditures-tab-2"><span>Plastic Worksheet</span></a></li>        <li class="tab-item"><a href="#supply-expanditures-tab-3"><span>Janitorial Worksheet</span></a></li>        <li class="tab-item"><a href="#supply-expanditures-tab-4"><span>Hand Soap Worksheet</span></a></li>    </ul>    <div class="clear"></div>    <div id="supply-expanditures-tab-1">        <h2 class="page-sub-title">Paper Supplies</h2>    </div>    <div id="supply-expanditures-tab-2">        <h2 class="page-sub-title">Plastic Supplies</h2>    </div>    <div id="supply-expanditures-tab-3">        <h2 class="page-sub-title">Janitorial Supplies</h2>    </div>    <div id="supply-expanditures-tab-4">        <h2 class="page-sub-title">Hand Soap Supplies</h2>    </div>    <div>        <table width="100%">            <tbody>                <tr>                    <td>&nbsp;</td>                    <td style="width:100px">                        <div id="supply-expanditures-tab-save-button"></div>                    </td>                    <td style="width:100px">                        <div id="supply-expanditures-tab-add-button"></div>                    </td>                    <td style="width:100px">                        <div id="supply-expanditures-tab-cancel-button"></div>                    </td>                    <td style="width:100px">                        <div id="supply-expanditures-tab-print-button"></div>                    </td>                </tr>            </tbody>        </table>    </div>    <div id="supply-expanditures-tab-grid"></div></div>','<div style="margin: 10px">    <div style="padding-bottom: 5px">        <table>            <tr>                <td>                    Site:                </td>                <td>                    {hcmHouseCodeTitle}                </td>                <td>                    Job:                </td>                <td>                    {hcmJobTitle}                </td>                <td>                    Fiscal Year:                </td>                <td>                    {fscYearTitle}                </td>            </tr>        </table>    </div>    <h2 class="page-sub-title">        Supply Expenditure - {title}</h2>    <div style="padding:10px 0">        {incomeTypes}    </div></div>'];/*!
 * Ext JS Library 3.2.0
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns('Ext.ux.grid');

Ext.ux.grid.ColumnHeaderGroup = Ext.extend(Ext.util.Observable, {

    _grid: null,

    constructor: function (config) {
        this.config = config;
    },

    refreshHeader: function (rows) {
        if (this._grid)
            this._grid.colModel.rows = [rows];
    },

    init: function (grid) {
        Ext.applyIf(grid.colModel, this.config);
        Ext.apply(grid.getView(), this.viewConfig);
        this._grid = grid;
    },

    viewConfig: {
        initTemplates: function () {
            this.constructor.prototype.initTemplates.apply(this, arguments);
            var ts = this.templates || {};
            if (!ts.gcell) {
                ts.gcell = new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">', '<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">', this.grid.enableHdMenu ? '<a class="x-grid3-hd-btn" href="#"></a>' : '', '{value}</div></td>');
            }
            this.templates = ts;
            this.hrowRe = new RegExp("ux-grid-hd-group-row-(\\d+)", "");
        },

        renderHeaders: function () {
            var ts = this.templates, headers = [], cm = this.cm, rows = cm.rows, tstyle = 'width:' + this.getTotalWidth() + ';';

            for (var row = 0, rlen = rows.length; row < rlen; row++) {
                var r = rows[row], cells = [];
                for (var i = 0, gcol = 0, len = r.length; i < len; i++) {
                    var group = r[i];
                    group.colspan = group.colspan || 1;
                    var id = this.getColumnId(group.dataIndex ? cm.findColumnIndex(group.dataIndex) : gcol), gs = Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupStyle.call(this, group, gcol);
                    cells[i] = ts.gcell.apply({
                        cls: 'ux-grid-hd-group-cell',
                        id: id,
                        row: row,
                        style: 'width:' + gs.width + ';' + (gs.hidden ? 'display:none;' : '') + (group.align ? 'text-align:' + group.align + ';' : ''),
                        tooltip: group.tooltip ? (Ext.QuickTips.isEnabled() ? 'ext:qtip' : 'title') + '="' + group.tooltip + '"' : '',
                        istyle: group.align == 'right' ? 'padding-right:16px' : '',
                        btn: this.grid.enableHdMenu && group.header,
                        value: group.header || '&nbsp;'
                    });
                    gcol += group.colspan;
                }
                headers[row] = ts.header.apply({
                    tstyle: tstyle,
                    cells: cells.join('')
                });
            }
            headers.push(this.constructor.prototype.renderHeaders.apply(this, arguments));
            return headers.join('');
        },

        onColumnWidthUpdated: function () {
            this.constructor.prototype.onColumnWidthUpdated.apply(this, arguments);
            Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this);
        },

        onAllColumnWidthsUpdated: function () {
            this.constructor.prototype.onAllColumnWidthsUpdated.apply(this, arguments);
            Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this);
        },

        onColumnHiddenUpdated: function () {
            this.constructor.prototype.onColumnHiddenUpdated.apply(this, arguments);
            Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this);
        },

        getHeaderCell: function (index) {
            return this.mainHd.query(this.cellSelector)[index];
        },

        findHeaderCell: function (el) {
            return el ? this.fly(el).findParent('td.x-grid3-hd', this.cellSelectorDepth) : false;
        },

        findHeaderIndex: function (el) {
            var cell = this.findHeaderCell(el);
            return cell ? this.getCellIndex(cell) : false;
        },

        updateSortIcon: function (col, dir) {
            var sc = this.sortClasses, hds = this.mainHd.select(this.cellSelector).removeClass(sc);
            hds.item(col).addClass(sc[dir == "DESC" ? 1 : 0]);
        },

        handleHdDown: function (e, t) {
            var el = Ext.get(t);
            if (el.hasClass('x-grid3-hd-btn')) {
                e.stopEvent();
                var hd = this.findHeaderCell(t);
                Ext.fly(hd).addClass('x-grid3-hd-menu-open');
                var index = this.getCellIndex(hd);
                this.hdCtxIndex = index;
                var ms = this.hmenu.items, cm = this.cm;
                ms.get('asc').setDisabled(!cm.isSortable(index));
                ms.get('desc').setDisabled(!cm.isSortable(index));
                this.hmenu.on('hide', function () {
                    Ext.fly(hd).removeClass('x-grid3-hd-menu-open');
                }, this, {
                    single: true
                });
                this.hmenu.show(t, 'tl-bl?');
            } else if (el.hasClass('ux-grid-hd-group-cell') || Ext.fly(t).up('.ux-grid-hd-group-cell')) {
                e.stopEvent();
            }
        },

        handleHdMove: function (e, t) {
            var hd = this.findHeaderCell(this.activeHdRef);
            if (hd && !this.headersDisabled && !Ext.fly(hd).hasClass('ux-grid-hd-group-cell')) {
                var hw = this.splitHandleWidth || 5, r = this.activeHdRegion, x = e.getPageX(), ss = hd.style, cur = '';
                if (this.grid.enableColumnResize !== false) {
                    if (x - r.left <= hw && this.cm.isResizable(this.activeHdIndex - 1)) {
                        cur = Ext.isAir ? 'move' : Ext.isWebKit ? 'e-resize' : 'col-resize'; // col-resize
                        // not
                        // always
                        // supported
                    } else if (r.right - x <= (!this.activeHdBtn ? hw : 2) && this.cm.isResizable(this.activeHdIndex)) {
                        cur = Ext.isAir ? 'move' : Ext.isWebKit ? 'w-resize' : 'col-resize';
                    }
                }
                ss.cursor = cur;
            }
        },

        handleHdOver: function (e, t) {
            var hd = this.findHeaderCell(t);
            if (hd && !this.headersDisabled) {
                this.activeHdRef = t;
                this.activeHdIndex = this.getCellIndex(hd);
                var fly = this.fly(hd);
                this.activeHdRegion = fly.getRegion();
                if (!(this.cm.isMenuDisabled(this.activeHdIndex) || fly.hasClass('ux-grid-hd-group-cell'))) {
                    fly.addClass('x-grid3-hd-over');
                    this.activeHdBtn = fly.child('.x-grid3-hd-btn');
                    if (this.activeHdBtn) {
                        this.activeHdBtn.dom.style.height = (hd.firstChild.offsetHeight - 1) + 'px';
                    }
                }
            }
        },

        handleHdOut: function (e, t) {
            var hd = this.findHeaderCell(t);
            if (hd && (!Ext.isIE || !e.within(hd, true))) {
                this.activeHdRef = null;
                this.fly(hd).removeClass('x-grid3-hd-over');
                hd.style.cursor = '';
            }
        },

        handleHdMenuClick: function (item) {
            var index = this.hdCtxIndex, cm = this.cm, ds = this.ds, id = item.getItemId();
            switch (id) {
                case 'asc':
                    ds.sort(cm.getDataIndex(index), 'ASC');
                    break;
                case 'desc':
                    ds.sort(cm.getDataIndex(index), 'DESC');
                    break;
                default:
                    if (id.substr(0, 5) == 'group') {
                        var i = id.split('-'), row = parseInt(i[1], 10), col = parseInt(i[2], 10), r = this.cm.rows[row], group, gcol = 0;
                        for (var i = 0, len = r.length; i < len; i++) {
                            group = r[i];
                            if (col >= gcol && col < gcol + group.colspan) {
                                break;
                            }
                            gcol += group.colspan;
                        }
                        if (item.checked) {
                            var max = cm.getColumnsBy(this.isHideableColumn, this).length;
                            for (var i = gcol, len = gcol + group.colspan; i < len; i++) {
                                if (!cm.isHidden(i)) {
                                    max--;
                                }
                            }
                            if (max < 1) {
                                this.onDenyColumnHide();
                                return false;
                            }
                        }
                        for (var i = gcol, len = gcol + group.colspan; i < len; i++) {
                            if (cm.config[i].fixed !== true && cm.config[i].hideable !== false) {
                                cm.setHidden(i, item.checked);
                            }
                        }
                    } else {
                        index = cm.getIndexById(id.substr(4));
                        if (index != -1) {
                            if (item.checked && cm.getColumnsBy(this.isHideableColumn, this).length <= 1) {
                                this.onDenyColumnHide();
                                return false;
                            }
                            cm.setHidden(index, item.checked);
                        }
                    }
                    item.checked = !item.checked;
                    if (item.menu) {
                        var updateChildren = function (menu) {
                            menu.items.each(function (childItem) {
                                if (!childItem.disabled) {
                                    childItem.setChecked(item.checked, false);
                                    if (childItem.menu) {
                                        updateChildren(childItem.menu);
                                    }
                                }
                            });
                        }
                        updateChildren(item.menu);
                    }
                    var parentMenu = item, parentItem;
                    while (parentMenu = parentMenu.parentMenu) {
                        if (!parentMenu.parentMenu || !(parentItem = parentMenu.parentMenu.items.get(parentMenu.getItemId())) || !parentItem.setChecked) {
                            break;
                        }
                        var checked = parentMenu.items.findIndexBy(function (m) {
                            return m.checked;
                        }) >= 0;
                        parentItem.setChecked(checked, true);
                    }
                    item.checked = !item.checked;
            }
            return true;
        },

        beforeColMenuShow: function () {
            var cm = this.cm, rows = this.cm.rows;
            this.colMenu.removeAll();
            for (var col = 0, clen = cm.getColumnCount(); col < clen; col++) {
                var menu = this.colMenu, title = cm.getColumnHeader(col), text = [];
                if (cm.config[col].fixed !== true && cm.config[col].hideable !== false) {
                    for (var row = 0, rlen = rows.length; row < rlen; row++) {
                        var r = rows[row], group, gcol = 0;
                        for (var i = 0, len = r.length; i < len; i++) {
                            group = r[i];
                            if (col >= gcol && col < gcol + group.colspan) {
                                break;
                            }
                            gcol += group.colspan;
                        }
                        if (group && group.header) {
                            if (cm.hierarchicalColMenu) {
                                var gid = 'group-' + row + '-' + gcol;
                                var item = menu.items.item(gid);
                                var submenu = item ? item.menu : null;
                                if (!submenu) {
                                    submenu = new Ext.menu.Menu({
                                        itemId: gid
                                    });
                                    submenu.on("itemclick", this.handleHdMenuClick, this);
                                    var checked = false, disabled = true;
                                    for (var c = gcol, lc = gcol + group.colspan; c < lc; c++) {
                                        if (!cm.isHidden(c)) {
                                            checked = true;
                                        }
                                        if (cm.config[c].hideable !== false) {
                                            disabled = false;
                                        }
                                    }
                                    menu.add({
                                        itemId: gid,
                                        text: group.header,
                                        menu: submenu,
                                        hideOnClick: false,
                                        checked: checked,
                                        disabled: disabled
                                    });
                                }
                                menu = submenu;
                            } else {
                                text.push(group.header);
                            }
                        }
                    }
                    text.push(title);
                    menu.add(new Ext.menu.CheckItem({
                        itemId: "col-" + cm.getColumnId(col),
                        text: text.join(' '),
                        checked: !cm.isHidden(col),
                        hideOnClick: false,
                        disabled: cm.config[col].hideable === false
                    }));
                }
            }
        },

        renderUI: function () {
            this.constructor.prototype.renderUI.apply(this, arguments);
            Ext.apply(this.columnDrop, Ext.ux.grid.ColumnHeaderGroup.prototype.columnDropConfig);
            Ext.apply(this.splitZone, Ext.ux.grid.ColumnHeaderGroup.prototype.splitZoneConfig);
        }
    },

    splitZoneConfig: {
        allowHeaderDrag: function (e) {
            return !e.getTarget(null, null, true).hasClass('ux-grid-hd-group-cell');
        }
    },

    columnDropConfig: {
        getTargetFromEvent: function (e) {
            var t = Ext.lib.Event.getTarget(e);
            return this.view.findHeaderCell(t);
        },

        positionIndicator: function (h, n, e) {
            var data = Ext.ux.grid.ColumnHeaderGroup.prototype.getDragDropData.call(this, h, n, e);
            if (data === false) {
                return false;
            }
            var px = data.px + this.proxyOffsets[0];
            this.proxyTop.setLeftTop(px, data.r.top + this.proxyOffsets[1]);
            this.proxyTop.show();
            this.proxyBottom.setLeftTop(px, data.r.bottom);
            this.proxyBottom.show();
            return data.pt;
        },

        onNodeDrop: function (n, dd, e, data) {
            var h = data.header;
            if (h != n) {
                var d = Ext.ux.grid.ColumnHeaderGroup.prototype.getDragDropData.call(this, h, n, e);
                if (d === false) {
                    return false;
                }
                var cm = this.grid.colModel, right = d.oldIndex < d.newIndex, rows = cm.rows;
                for (var row = d.row, rlen = rows.length; row < rlen; row++) {
                    var r = rows[row], len = r.length, fromIx = 0, span = 1, toIx = len;
                    for (var i = 0, gcol = 0; i < len; i++) {
                        var group = r[i];
                        if (d.oldIndex >= gcol && d.oldIndex < gcol + group.colspan) {
                            fromIx = i;
                        }
                        if (d.oldIndex + d.colspan - 1 >= gcol && d.oldIndex + d.colspan - 1 < gcol + group.colspan) {
                            span = i - fromIx + 1;
                        }
                        if (d.newIndex >= gcol && d.newIndex < gcol + group.colspan) {
                            toIx = i;
                        }
                        gcol += group.colspan;
                    }
                    var groups = r.splice(fromIx, span);
                    rows[row] = r.splice(0, toIx - (right ? span : 0)).concat(groups).concat(r);
                }
                for (var c = 0; c < d.colspan; c++) {
                    var oldIx = d.oldIndex + (right ? 0 : c), newIx = d.newIndex + (right ? -1 : c);
                    cm.moveColumn(oldIx, newIx);
                    this.grid.fireEvent("columnmove", oldIx, newIx);
                }
                return true;
            }
            return false;
        }
    },

    getGroupStyle: function (group, gcol) {
        var width = 0, hidden = true;
        for (var i = gcol, len = gcol + group.colspan; i < len; i++) {
            if (!this.cm.isHidden(i)) {
                var cw = this.cm.getColumnWidth(i);
                if (typeof cw == 'number') {
                    width += cw;
                }
                hidden = false;
            }
        }
        return {
            width: (Ext.isBorderBox || (Ext.isWebKit && !Ext.isSafari2) ? width : Math.max(width - this.borderWidth, 0)) + 'px',
            hidden: hidden
        };
    },

    updateGroupStyles: function (col) {
        var tables = this.mainHd.query('.x-grid3-header-offset > table'), tw = this.getTotalWidth(), rows = this.cm.rows;
        for (var row = 0; row < tables.length; row++) {
            tables[row].style.width = tw;
            if (row < rows.length) {
                var cells = tables[row].firstChild.firstChild.childNodes;
                for (var i = 0, gcol = 0; i < cells.length; i++) {
                    var group = rows[row][i];
                    if ((typeof col != 'number') || (col >= gcol && col < gcol + group.colspan)) {
                        var gs = Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupStyle.call(this, group, gcol);
                        cells[i].style.width = gs.width;
                        cells[i].style.display = gs.hidden ? 'none' : '';
                    }
                    gcol += group.colspan;
                }
            }
        }
    },

    getGroupRowIndex: function (el) {
        if (el) {
            var m = el.className.match(this.hrowRe);
            if (m && m[1]) {
                return parseInt(m[1], 10);
            }
        }
        return this.cm.rows.length;
    },

    getGroupSpan: function (row, col) {
        if (row < 0) {
            return {
                col: 0,
                colspan: this.cm.getColumnCount()
            };
        }
        var r = this.cm.rows[row];
        if (r) {
            for (var i = 0, gcol = 0, len = r.length; i < len; i++) {
                var group = r[i];
                if (col >= gcol && col < gcol + group.colspan) {
                    return {
                        col: gcol,
                        colspan: group.colspan
                    };
                }
                gcol += group.colspan;
            }
            return {
                col: gcol,
                colspan: 0
            };
        }
        return {
            col: col,
            colspan: 1
        };
    },

    getDragDropData: function (h, n, e) {
        if (h.parentNode != n.parentNode) {
            return false;
        }
        var cm = this.grid.colModel, x = Ext.lib.Event.getPageX(e), r = Ext.lib.Dom.getRegion(n.firstChild), px, pt;
        if ((r.right - x) <= (r.right - r.left) / 2) {
            px = r.right + this.view.borderWidth;
            pt = "after";
        } else {
            px = r.left;
            pt = "before";
        }
        var oldIndex = this.view.getCellIndex(h), newIndex = this.view.getCellIndex(n);
        if (cm.isFixed(newIndex)) {
            return false;
        }
        var row = Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupRowIndex.call(this.view, h),
            oldGroup = Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view, row, oldIndex),
            newGroup = Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view, row, newIndex),
            oldIndex = oldGroup.col;
        newIndex = newGroup.col + (pt == "after" ? newGroup.colspan : 0);
        if (newIndex >= oldGroup.col && newIndex <= oldGroup.col + oldGroup.colspan) {
            return false;
        }
        var parentGroup = Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view, row - 1, oldIndex);
        if (newIndex < parentGroup.col || newIndex > parentGroup.col + parentGroup.colspan) {
            return false;
        }
        return {
            r: r,
            px: px,
            pt: pt,
            row: row,
            oldIndex: oldIndex,
            newIndex: newIndex,
            colspan: oldGroup.colspan
        };
    }
});

/**
 * @class GetIt.GridPrinter
 * @author Ed Spencer (edward@domine.co.uk)
 * Class providing a common way of printing Ext.Components. Ext.ux.Printer.print delegates the printing to a specialised
 * renderer class (each of which subclasses Ext.ux.Printer.BaseRenderer), based on the xtype of the component.
 * Each renderer is registered with an xtype, and is used if the component to print has that xtype.
 * 
 * See the files in the renderers directory to customise or to provide your own renderers.
 * 
 * Usage example:
 * 
 * var grid = new Ext.grid.GridPanel({
 *   colModel: //some column model,
 *   store   : //some store
 * });
 * 
 * Ext.ux.Printer.print(grid);
 * 
 */
Ext.ux.Printer = function () {

    return {
        /**
        * @property renderers
        * @type Object
        * An object in the form {xtype: RendererClass} which is manages the renderers registered by xtype
        */
        renderers: {},

        /**
        * Registers a renderer function to handle components of a given xtype
        * @param {String} xtype The component xtype the renderer will handle
        * @param {Function} renderer The renderer to invoke for components of this xtype
        */
        registerRenderer: function (xtype, renderer) {
            this.renderers[xtype] = new (renderer)();
        },

        /**
        * Returns the registered renderer for a given xtype
        * @param {String} xtype The component xtype to find a renderer for
        * @return {Object/undefined} The renderer instance for this xtype, or null if not found
        */
        getRenderer: function (xtype) {
            return this.renderers[xtype];
        },

        generateHtml: function (title, bodyMaster, cssFile) {
            var snippets = ['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
      '<html>',
        '<head>',
          '<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />',
        (cssFile ? '<link href="' + cssFile + '" rel="stylesheet" type="text/css" media="screen,print" />' : ''),
          '<title>' + title + '</title>',
        '</head>',
        '<body>',
         (bodyMaster || ''),
        '</body>',
      '</html>'];
            return snippets.join('');
        },

        print: function (title, body, components, cssFile) {
            var me = this;
            var html = this.generateHtml(title, body, cssFile);

            if (Ext.isObject(components)) {
                for (var item in components) {
                    var cmpHtml;
                    if (Ext.isString(components[item]) || Ext.isNumber(components[item]))
                        cmpHtml = components[item];
                    else
                        cmpHtml = me.renderCmp(components[item]);
                    reg = new RegExp("\\{" + item + "\\}", "gm");
                    html = html.replace(reg, cmpHtml);
                }
            }

            var win = window.open('', '_new');

            win.document.write(html);
            win.document.close();

            win.print();
            //win.close();
        },

        renderCmp: function (component) {
            var xtypes = component.getXTypes().split('/');

            //iterate backwards over the xtypes of this component, dispatching to the most specific renderer
            for (var i = xtypes.length - 1; i >= 0; i--) {
                var xtype = xtypes[i],
            renderer = this.getRenderer(xtype);

                if (renderer != undefined) {
                    return renderer.generateHTML(component);
                    break;
                }
            }
            return '[component render undefined]';
        },

        /**
        * Prints the passed grid. Reflects on the grid's column model to build a table, and fills it using the store
        * @param {Ext.Component} component The component to print
        */
        print1: function (component) {
            var xtypes = component.getXTypes().split('/');

            //iterate backwards over the xtypes of this component, dispatching to the most specific renderer
            for (var i = xtypes.length - 1; i >= 0; i--) {
                var xtype = xtypes[i],
            renderer = this.getRenderer(xtype);

                if (renderer != undefined) {
                    renderer.print(component);
                    break;
                }
            }
        }
    };
} ();

/**
 * Override how getXTypes works so that it doesn't require that every single class has
 * an xtype registered for it.
 */
Ext.override(Ext.Component, {
  getXTypes : function(){
      var tc = this.constructor;
      if(!tc.xtypes){
          var c = [], sc = this;
          while(sc){ //was: while(sc && sc.constructor.xtype) {
            var xtype = sc.constructor.xtype;
            if (xtype != undefined) c.unshift(xtype);
            
            sc = sc.constructor.superclass;
          }
          tc.xtypeChain = c;
          tc.xtypes = c.join('/');
      }
      return tc.xtypes;
  }
});

/**
 * @class Ext.ux.Printer.BaseRenderer
 * @extends Object
 * @author Ed Spencer
 * Abstract base renderer class. Don't use this directly, use a subclass instead
 */
Ext.ux.Printer.BaseRenderer = Ext.extend(Object, {


    /**
    * Prints the component
    * @param {Ext.Component} component The component to print
    */
    print: function (component) {
        var name = component && component.getXType
             ? String.format("print_{0}_{1}", component.getXType(), component.id)
             : "print";

        var win = window.open('', name);

        win.document.write(this.generateHTML(component));
        win.document.close();

        win.print();
        win.close();
    },

    /**
    * Generates the HTML Markup which wraps whatever this.generateBody produces
    * @param {Ext.Component} component The component to generate HTML for
    * @return {String} An HTML fragment to be placed inside the print window
    */
    generateHTML: function (component) {
        //    return new Ext.XTemplate(
        //      '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
        //      '<html>',
        //        '<head>',
        //          '<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />',
        //          '<link href="' + this.stylesheetPath + '" rel="stylesheet" type="text/css" media="screen,print" />',
        //          '<title>' + this.getTitle(component) + '</title>',
        //        '</head>',
        //        '<body>',
        //          this.generateBody(component),
        //        '</body>',
        //      '</html>'
        //    ).apply(this.prepareData(component));
        return new Ext.XTemplate(this.generateBody(component)).apply(this.prepareData(component));
    },

    /**
    * Returns the HTML that will be placed into the print window. This should produce HTML to go inside the
    * <body> element only, as <head> is generated in the print function
    * @param {Ext.Component} component The component to render
    * @return {String} The HTML fragment to place inside the print window's <body> element
    */
    generateBody: Ext.emptyFn,

    /**
    * Prepares data suitable for use in an XTemplate from the component 
    * @param {Ext.Component} component The component to acquire data from
    * @return {Array} An empty array (override this to prepare your own data)
    */
    prepareData: function (component) {
        return component;
    },

    /**
    * Returns the title to give to the print window
    * @param {Ext.Component} component The component to be printed
    * @return {String} The window title
    */
    getTitle: function (component) {
        return typeof component.getTitle == 'function' ? component.getTitle() : (component.title || "Printing");
    },

    /**
    * @property stylesheetPath
    * @type String
    * The path at which the print stylesheet can be found (defaults to 'stylesheets/print.css')
    */
    stylesheetPath: 'stylesheets/print.css'
});

/**
 * @class Ext.ux.Printer.ColumnTreeRenderer
 * @extends Ext.ux.Printer.BaseRenderer
 * @author Ed Spencer
 * Helper class to easily print the contents of a column tree
 */
Ext.ux.Printer.ColumnTreeRenderer = Ext.extend(Ext.ux.Printer.BaseRenderer, {

  /**
   * Generates the body HTML for the tree
   * @param {Ext.tree.ColumnTree} tree The tree to print
   */
  generateBody: function(tree) {
    var columns = this.getColumns(tree);
    
    //use the headerTpl and bodyTpl XTemplates to create the main XTemplate below
    var headings = this.headerTpl.apply(columns);
    var body     = this.bodyTpl.apply(columns);
    
    return String.format('<table>{0}<tpl for=".">{1}</tpl></table>', headings, body);
  },
    
  /**
   * Returns the array of columns from a tree
   * @param {Ext.tree.ColumnTree} tree The tree to get columns from
   * @return {Array} The array of tree columns
   */
  getColumns: function(tree) {
    return tree.columns;
  },
  
  /**
   * Descends down the tree from the root, creating an array of data suitable for use in an XTemplate
   * @param {Ext.tree.ColumnTree} tree The column tree
   * @return {Array} Data suitable for use in the body XTemplate
   */
  prepareData: function(tree) {
    var root = tree.root,
        data = [],
        cols = this.getColumns(tree),
        padding = this.indentPadding;
        
    var f = function(node) {
      if (node.hidden === true || node.isHiddenRoot() === true) return;
      
      var row = Ext.apply({depth: node.getDepth() * padding}, node.attributes);
      
      Ext.iterate(row, function(key, value) {
        Ext.each(cols, function(column) {
          if (column.dataIndex == key) {
            row[key] = column.renderer ? column.renderer(value) : value;
          }
        }, this);        
      });
      
      //the property used in the first column is renamed to 'text' in node.attributes, so reassign it here
      row[this.getColumns(tree)[0].dataIndex] = node.attributes.text;
      
      data.push(row);
    };
    
    root.cascade(f, this);
    
    return data;
  },
  
  /**
   * @property indentPadding
   * @type Number
   * Number of pixels to indent node by. This is multiplied by the node depth, so a node with node.getDepth() == 3 will
   * be padded by 45 (or 3x your custom indentPadding)
   */
  indentPadding: 15,
  
  /**
   * @property headerTpl
   * @type Ext.XTemplate
   * The XTemplate used to create the headings row. By default this just uses <th> elements, override to provide your own
   */
  headerTpl:  new Ext.XTemplate(
    '<tr>',
      '<tpl for=".">',
        '<th width="{width}">{header}</th>',
      '</tpl>',
    '</tr>'
  ),
 
  /**
   * @property bodyTpl
   * @type Ext.XTemplate
   * The XTemplate used to create each row. This is used inside the 'print' function to build another XTemplate, to which the data
   * are then applied (see the escaped dataIndex attribute here - this ends up as "{dataIndex}")
   */
  bodyTpl:  new Ext.XTemplate(
    '<tr>',
      '<tpl for=".">',
        '<td style="padding-left: {[xindex == 1 ? "\\{depth\\}" : "0"]}px">\{{dataIndex}\}</td>',
      '</tpl>',
    '</tr>'
  )
});

Ext.ux.Printer.registerRenderer('columntree', Ext.ux.Printer.ColumnTreeRenderer);

/**
 * @class Ext.ux.Printer.GridPanelRenderer
 * @extends Ext.ux.Printer.BaseRenderer
 * @author Ed Spencer
 * Helper class to easily print the contents of a grid. Will open a new window with a table where the first row
 * contains the headings from your column model, and with a row for each item in your grid's store. When formatted
 * with appropriate CSS it should look very similar to a default grid. If renderers are specified in your column
 * model, they will be used in creating the table. Override headerTpl and bodyTpl to change how the markup is generated
 */
Ext.ux.Printer.GridPanelRenderer = Ext.extend(Ext.ux.Printer.BaseRenderer, {
  
  /**
   * Generates the body HTML for the grid
   * @param {Ext.grid.GridPanel} grid The grid to print
   */
  generateBody: function(grid) {
    var columns = this.getColumns(grid);
    
    //use the headerTpl and bodyTpl XTemplates to create the main XTemplate below
    var headings = this.headerTpl.apply(columns);
    var body     = this.bodyTpl.apply(columns);
    
    return String.format('<table>{0}<tpl for=".">{1}</tpl></table>', headings, body);
  },
  
  /**
   * Prepares data from the grid for use in the XTemplate
   * @param {Ext.grid.GridPanel} grid The grid panel
   * @return {Array} Data suitable for use in the XTemplate
   */
  prepareData: function(grid) {
    //We generate an XTemplate here by using 2 intermediary XTemplates - one to create the header,
    //the other to create the body (see the escaped {} below)
    var columns = this.getColumns(grid);
  
    //build a useable array of store data for the XTemplate
    var data = [];
    grid.store.data.each(function(item) {
      var convertedData = {};
      
      //apply renderers from column model
      Ext.iterate(item.data, function(key, value) {
        Ext.each(columns, function(column) {
          if (column.dataIndex == key) {
            convertedData[key] = column.renderer ? column.renderer(value, null, item) : value;
            return false;
          }
        }, this);
      });
    
      data.push(convertedData);
    });
    
    return data;
  },
  
  /**
   * Returns the array of columns from a grid
   * @param {Ext.grid.GridPanel} grid The grid to get columns from
   * @return {Array} The array of grid columns
   */
  getColumns: function(grid) {
    var columns = [];
    
  	Ext.each(grid.getColumnModel().config, function(col) {
  	  if (col.hidden != true) columns.push(col);
  	}, this);
  	
  	return columns;
  },
  
  /**
   * @property headerTpl
   * @type Ext.XTemplate
   * The XTemplate used to create the headings row. By default this just uses <th> elements, override to provide your own
   */
  headerTpl:  new Ext.XTemplate(
    '<tr>',
      '<tpl for=".">',
        '<th>{header}</th>',
      '</tpl>',
    '</tr>'
  ),
 
   /**
    * @property bodyTpl
    * @type Ext.XTemplate
    * The XTemplate used to create each row. This is used inside the 'print' function to build another XTemplate, to which the data
    * are then applied (see the escaped dataIndex attribute here - this ends up as "{dataIndex}")
    */
  bodyTpl:  new Ext.XTemplate(
    '<tr>',
      '<tpl for=".">',
        '<td>\{{dataIndex}\}</td>',
      '</tpl>',
    '</tr>'
  )
});

Ext.ux.Printer.registerRenderer('grid', Ext.ux.Printer.GridPanelRenderer);

/**
* Prints the contents of an Ext.Panel
*/
Ext.ux.Printer.PanelRenderer = Ext.extend(Ext.ux.Printer.BaseRenderer, {

    /**
    * Generates the HTML fragment that will be rendered inside the <html> element of the printing window
    */
    generateBody: function (panel) {
        return String.format("<div class='x-panel-print'>{0}</div>", panel.body.dom.innerHTML);
    }
});

Ext.ux.Printer.registerRenderer("panel", Ext.ux.Printer.PanelRenderer);



/*
**  A custom renderer field
**  by g13013 - (2009)
**   
**  the default renderer is set to internal money rendering method 
**  
*/
Ext.ux.customRendererField = Ext.extend(Ext.form.Field, {


    /**
    *@param: {priceUnit} Money unit Ex : Algerian DZD
    *
    */
    priceUnit: 'DZD',

    /**
    *@param: {priceDelemiter} Delemiter for the price space or ',' are a valid delemiter
    *
    */
    priceDelemiter: ' ',

    /**
    *@param: {enableRenderer} set price rendering is enabled or no
    *
    */
    enableRenderer: true,


    /**
    *@param: {customRenderer} a custom renderer 
    *
    */

    customRenderer: undefined,

    initComponent: function () {
        Ext.ux.customRendererField.superclass.initComponent.call(this);
        if (this.priceDelemiter != ',' && this.priceDelemiter != ' ') this.priceDelemiter = ' '
    },

    renderValue: function (action, disable) {//bypass enableRendering verification when desabling rendering
        if (this.enableRenderer || disable) {
            if (this.customRenderer === undefined) {
                this.RenderMoney(action) //if customRenderer is undefined call default renderer
            } else {
                this.customRenderer.call(this, action)
            }
        }
    },

    RenderMoney: function (action) {
        if (this.el) {
            if (!action && !this.el.dom.readOnly) {
                this.el.dom.value = this.el.dom.value.replace(/[^0-9.]+/g, ''); //replace all alphabetic ans special characters except '.'
            } else {
                value = this.el.dom.value.replace(/[^0-9.]+/g, ''); //replace all alphabetic ans special characters except '.'
                this.el.dom.value = SetMoney(value, this.priceDelemiter, this.priceUnit)//render in money format
            } 
        }
    },

    onFocus: function () {
        Ext.ux.customRendererField.superclass.onFocus.call(this);
        this.renderValue(false);
    },

    onBlur: function () {
        Ext.ux.customRendererField.superclass.onFocus.call(this);
        this.renderValue(true);
    },

    setValue: function (v) {
        Ext.ux.customRendererField.superclass.setValue.call(this, v);
        this.renderValue(true)
    },

    getValue: function () {
        if (!this.rendered) {
            return this.value;
        }
        this.renderValue(false)
        var v = this.el.getValue();
        if (v === this.emptyText || v === undefined) {
            v = '';
        }
        this.renderValue(true)
        return v;
    },

    setenableRenderer: function (set) {
        this.enableRenderer = set
        if (set) {
            this.renderValue(true);
        } else {
            this.renderValue(false, true); //disable rendering
        }

    }

});
Ext.reg('customrendererfield', Ext.ux.customRendererField)


function SetMoney(price, delemiter, unit) {
    /*
    **  render in Money format with somme adaptation for unit and delemiter changing posibility 
    **    price	  	price
    **    delemiter	delemiter
    **    unit  		unit
    **  returns new String like (100,000.00 DZD) or (200 000.00 DZD)
    */
    delemiter = (undefined === delemiter) ? (" ") : (delemiter)
    unit = (undefined === unit) ? ("$") : (unit)
    price = (Math.round((price - 0) * 100)) / 100;
    price = (price == Math.floor(price)) ? price + (".00") : ((price * 10 == Math.floor(price * 10)) ? price + "0" : price);
    price = String(price);
    var ps = price.split('.');
    var whole = ps[0];
    var sub = ps[1] ? '.' + ps[1] : '.00';
    var r = /(\d+)(\d{3})/;
    while (r.test(whole)) {
        whole = whole.replace(r, '$1' + delemiter + '$2');
    }
    price = whole + sub;
    if (price.charAt(0) == '-') {
        return '-$' + price.substr(1);
    }
    return price + " " + unit;
}

/**************************************************************************
*** this function is the simple adaptation of the original php str_replace
*** i find it in the internet
*** that can help for value rendering process
**************************************************************************/
function str_replace(a, b, str) {
    return str_replace2(str, a, b);
}
function str_replace2(SRs, SRt, SRu) {
    /*
    **  Replace a token in a string
    **    s  string to be processed
    **    t  token to be found and removed
    **    u  token to be inserted
    **  returns new String
    */
    SRRi = SRs.indexOf(SRt);
    SRRr = '';
    if (SRRi == -1) return SRs;
    SRRr += SRs.substring(0, SRRi) + SRu;
    if (SRRi + SRt.length < SRs.length)
        SRRr += str_replace2(SRs.substring(SRRi + SRt.length, SRs.length), SRt, SRu);
    return SRRr;
}



jQuery.ajaxSettings.contentType = 'application/x-www-form-urlencoded; charset=utf-8';

WebLight.namespace('Bud', 'Bud.form', 'Bud.page', 'Bud.grid');

var host = document.location.host;
if (!window.top.fin) {
    //window.top.fin = { appUI: { houseCodeId: 227, glbFscYear: 2, glbFscPeriod: 18} };
    window.top.fin = { appUI: { glbFscYear: 4, glbFscPeriod: 46} };
}

Bud.getGlobalHouseCodeStore = function () {
    if (!top.globalHouseCodeStore) {
        top.globalHouseCodeStore = new Bud.data.HouseCodeStore();
        top.globalHouseCodeStore.load();
    }
    else if (top.globalHouseCodeStore.getCount() > 0) {
        top.globalHouseCodeStore.fireEvent('load', top.globalHouseCodeStore, top.globalHouseCodeStore.getRange());
    }
    return top.globalHouseCodeStore;
};

Bud.Context = {
    userId: document.location.host == 'localhost' ? 'RAYMOND-DEV-XP\\Raymond+Liu' : '[user]',
    isTest: document.location.host == 'localhost',
    ytdBusinessDays: 261,
    getStickyHcmHouseCode: function () {
        var hcmHouseCode = window.top.fin.appUI.houseCodeId;
        if (!hcmHouseCode)
            return 0;
        return hcmHouseCode;
    },

    getStickyFscYear: function () {
        var fscYear = window.top.fin.appUI.glbFscYear;
        if (!fscYear)
            return 0;
        return fscYear;
    },

    getStickyFscPeriod: function () {

        var fscPeriod = window.top.fin.appUI.glbFscPeriod;
        if (!fscPeriod)
            return 0;
        return fscPeriod;
    },

    setStickyHouseCode: function (appUnit, id, name, brief, hirNode) {
        if (window.top.fin.appUI) {
            window.top.fin.appUI.unitId = appUnit;
            window.top.fin.appUI.houseCodeId = parseFloat(id);
            window.top.fin.appUI.houseCodeTitle = name;
            window.top.fin.appUI.houseCodeBrief = brief;
            window.top.fin.appUI.hirNode = hirNode;
        }
    },

    setStickyFiscalYear: function (id, name) {
        if (window.top.fin.appUI) {
            window.top.fin.appUI.glbFscYear = parseFloat(id);
            window.top.fin.appUI.glbfiscalYear = name;
        }
    },

    setStickyFiscalPeriod: function (id, name) {
        if (window.top.fin.appUI) {
            window.top.fin.appUI.glbFscPeriod = parseFloat(id);
            window.top.fin.appUI.glbPeriod = name;
        }
    }
};

Ext.override(Ext.form.Field, {

    showItem: function () {
        if (!Ext.isEmpty(this.getEl()))
            this.getEl().up('.x-form-item').setDisplayed(true);
    },

    hideItem: function () {
        if (!Ext.isEmpty(this.getEl()))
            this.getEl().up('.x-form-item').setDisplayed(false);
    }
});

Ext.override(Ext.form.DisplayField, {
    setRawValue: function (v) {

        if (this.htmlEncode) {
            v = Ext.util.Format.htmlEncode(v);
        }
        if (this.dateFormat && Ext.isDate(v)) {
            v = v.dateFormat(this.dateFormat);
        }

        if (this.numberFormat) {
            if (v == 0 || v == '') {
                if (this.numberFormat.indexOf(',') > 0)
                    v = this.numberFormat.substring(4);
                else
                    v = this.numberFormat;
            }
            else if (typeof v == 'number')
                v = Ext.util.Format.number(v, this.numberFormat);
        }

        if (this.rendered) {

            if (Ext.isEmpty(v)) {
                this.el.dom.innerHTML = '';
            }
            else {
                this.el.dom.innerHTML = v;
            }
        }
        else {
            this.value = v;
        }
    }
});

Ext.override(Ext.form.NumberField, {
    allowBlank: false
});

Bud.form.DropdownList = Ext.extend(Ext.form.ComboBox, {
    mode: 'local',
    forceSelection: true,
    triggerAction: 'all',
    selectOnFocus: true,
    editable: false,
    layzeInit: false,
    typeAhead: true,
    allowBlank: false,
    initComponent: function () {
        Bud.form.DropdownList.superclass.initComponent.call(this);
    },
    setValue: function (v) {
        var oldValue = this.value;
        this.innerValue = v;
        Bud.form.DropdownList.superclass.setValue.call(this, v);

        if (oldValue != v)
            this.fireEvent('valuechange', v, this.getRawValue());

        return this;
    }
});


Bud.grid.GridPanel = Ext.extend(WebLight.grid.GridPanel, {

    constructor: function (config) {

        if (config && config.width) {
            if (config.width > $(window).width() - 35)
                config.width = $(window).width() - 35;
        }

        Bud.grid.GridPanel.superclass.constructor.call(this, config);
    }
});

Bud.grid.EditorGridPanel = Ext.extend(Ext.grid.EditorGridPanel, {

    lastSelectedCell: null,

    constructor: function (config) {

        if (config && config.width) {
            if (config.width > $(window).width() - 35)
                config.width = $(window).width() - 35;
        }

        Bud.grid.EditorGridPanel.superclass.constructor.call(this, config);
    },

    initComponent: function () {
        Bud.grid.EditorGridPanel.superclass.initComponent.call(this);

        var me = this;

        this.getView().on('beforerefresh', function (gv) {
            me.lastSelectedCell = me.getSelectionModel().getSelectedCell();
        });

        /// fix staffing hours page, shift combo changing bug.
        ///  start
        me.on('render', function () {
            me.getStore().on('beforeload', function () {
                me.getSelectionModel().clearSelections();

            });
            me.resizeHeaderDiv();

            me.getView().on('refresh', function () {
                me.resizeHeaderDiv();
            });
        });
        //// end



        /// add event listener at last
        setTimeout(function () {
            me.getView().on('refresh', function (gv) {
                if (me.lastSelectedCell) {
                    me.getSelectionModel().select(me.lastSelectedCell[0], me.lastSelectedCell[1]);
                    me.startEditing(me.lastSelectedCell[0], me.lastSelectedCell[1]);
                    me.lastSelectedCell = null;
                }
            });
        }, 100);
    },

    resizeHeaderDiv: function () {
        // fix ie7 scrolled header width issue
        var gridWidth = $('#' + this.id).width();
        var headerWidth = $('.x-grid3-header-offset', $('#' + this.id)).width();
        if (headerWidth < gridWidth)
            headerWidth = gridWidth - 25;
        $('.x-grid3-header', $('#' + this.id)).width(headerWidth);

    },
    startEditing: function (row, col) {
        var me = this;

        if (me.lastSelectedCell && row == me.lastSelectedCell[0] && col == me.lastSelectedCell[1]) {
            return;
        }
        this.stopEditing();
        if (this.colModel.isCellEditable(col, row)) {
            this.view.ensureVisible(row, col, true);
            var r = this.store.getAt(row),
                field = this.colModel.getDataIndex(col),
                e = {
                    grid: this,
                    record: r,
                    field: field,
                    value: r.data[field],
                    row: row,
                    column: col,
                    cancel: false
                };
            if (this.fireEvent("beforeedit", e) !== false && !e.cancel) {
                this.editing = true;
                var ed = this.colModel.getCellEditor(col, row);
                if (!ed) {
                    return;
                }
                if (!ed.rendered) {
                    ed.parentEl = this.view.getEditorParent(ed);
                    ed.on({
                        scope: this,
                        render: {
                            fn: function (c) {
                                c.field.focus(false, true);
                            },
                            single: true,
                            scope: this
                        },
                        specialkey: function (field, e) {
                            this.getSelectionModel().onEditorKey(field, e);
                        },
                        complete: this.onEditComplete,
                        canceledit: this.stopEditing.createDelegate(this, [true])
                    });
                }
                Ext.apply(ed, {
                    row: row,
                    col: col,
                    record: r
                });
                this.lastEdit = {
                    row: row,
                    col: col
                };
                this.activeEditor = ed;
                // Set the selectSameEditor flag if we are reusing the same editor again and
                // need to prevent the editor from firing onBlur on itself.
                ed.selectSameEditor = (this.activeEditor == this.lastActiveEditor);
                var v = this.preEditValue(r, field);

                ed.startEdit(this.view.getCell(row, col).firstChild, Ext.isDefined(v) ? v : '');

                /// 2nd parameter need set true, for IE bug.
                ed.field.focus(true, true);
                // Clear the selectSameEditor flag
                (function () {
                    if (ed.noNeedDeleteselectSameEditor !== true)
                        delete ed.selectSameEditor;
                }).defer(50);
            }
        }
    }
});

function GetCursorLocation(textbox) {
    var CurrentSelection, FullRange, SelectedRange, LocationIndex = -1;
    if (typeof textbox.selectionStart == "number") {
        LocationIndex = textbox.selectionStart;
    }
    else if (document.selection && textbox.createTextRange) {
        CurrentSelection = document.selection;
        if (CurrentSelection) {
            SelectedRange = CurrentSelection.createRange();
            FullRange = textbox.createTextRange();
            FullRange.setEndPoint("EndToStart", SelectedRange);
            LocationIndex = FullRange.text.length;
        }
    }
    return LocationIndex;
}


//http://www.sencha.com/forum/showthread.php?81026-Excel-style-cell-editing-in-EditorGridPanel
Ext.override(Ext.grid.CellSelectionModel, {
    handleKeyDown: function (e) {
        // Original code commented out so standard keys can be used to start editing cells.
        //        if(!e.isNavKeyPress()){
        //            return;
        //        }

        var g = this.grid, s = this.selection;

        // If the cell is not selected and it's selectable then select it.
        // When does this happen?
        if (!s) {
            //console.log('select none-selected cell.');
            e.stopEvent();
            var cell = g.walkCells(0, 0, 1, this.isSelectable, this);
            if (cell) {
                this.select(cell[0], cell[1]);
            }
            return;
        }
        var sm = this;
        var walk = function (row, col, step) {
            return g.walkCells(row, col, step, sm.isSelectable, sm);
        };
        var k = e.getKey(), r = s.cell[0], c = s.cell[1];
        var newCell;

        if (!e.isNavKeyPress() && !e.isSpecialKey()) {
            // Added BY: Aaron Prohaska, 2009.09.21.14:15
            // Allow regular keys to start editing so we can type directly into cells.

            var keyCode = k;
            /*
            The String.fromCharCode method is return the charactor in upper case so I'm converting
            it back to lower case then later checking if the shiftKey was used and converting to upper case.
            */
            var keyValue = String.fromCharCode(keyCode).toLowerCase();
            var record = g.getStore().getAt(r);
            var field = g.colModel.getDataIndex(c);

            // Shift + charector should be upper case charector.
            if (e.shiftKey) {
                //console.log('e.shiftKey');
                keyValue = keyValue.toUpperCase();
            }

            g.startEditing(r, c);
            record.data[field] = keyValue;
        } else {
            switch (k) {
                case e.TAB:
                    if (e.shiftKey) {
                        newCell = walk(r, c - 1, -1);
                    } else {
                        newCell = walk(r, c + 1, 1);
                    }
                    break;
                case e.DOWN:
                    newCell = walk(r + 1, c, 1);
                    break;
                case e.UP:
                    newCell = walk(r - 1, c, -1);
                    break;
                case e.RIGHT:
                    newCell = walk(r, c + 1, 1);
                    break;
                case e.LEFT:
                    newCell = walk(r, c - 1, -1);
                    break;
                case e.ENTER:
                    if (g.isEditor && !g.editing) {
                        g.startEditing(r, c);
                        e.stopEvent();
                        // Added BY: Aaron Prohaska, 2009.09.21.14:15
                        // Set focus back to cell after pressing ENTER key.
                        g.getView().focusCell(r, c);
                        return;
                    }
                    break;
            }
        }

        if (newCell) {
            this.select(newCell[0], newCell[1]);
            e.stopEvent();
        }
    },
    onEditorKey: function (field, e) {
        var newCell = null;
        var k = e.getKey(), newCell, g = this.grid, ed = g.activeEditor;
        if (k == e.TAB) {
            if (e.shiftKey) {
                newCell = g.walkCells(ed.row, ed.col - 1, -1, this.acceptsNav, this);
            } else {
                newCell = g.walkCells(ed.row, ed.col + 1, 1, this.acceptsNav, this);
            }
            e.stopEvent();
        } else if (k == e.ENTER) {
            ed.completeEdit();
            e.stopEvent();
        } else if (k == e.ESC) {
            e.stopEvent();
            ed.cancelEdit();
            // Set focus back to cell after pressing ESC key.
            g.getView().focusCell(ed.row, ed.col);
        } else if (k == e.DOWN) {
            // When in edit mode and down arrow is pressed navigate to the cell on the next row down.
            ed.completeEdit();
            e.stopEvent();
            newCell = g.walkCells(ed.row + 1, ed.col, 1, this.acceptsNav, this);
            ed.noNeedDeleteselectSameEditor = true;
            ed.field.focus(true,true);
        } else if (k == e.UP) {
            // When in edit mode and down arrow is pressed navigate to the cell on the next row up.
            ed.completeEdit();
            e.stopEvent();
            newCell = g.walkCells(ed.row - 1, ed.col, -1, this.acceptsNav, this);
            ed.noNeedDeleteselectSameEditor = true;
            ed.field.focus(true,true);
        }
        else if (k == e.LEFT) {
            //alert('ok');
            //            var id = ed.id;
            //            var el = document.getElementById(id);
            //            debugger;
            //            alert(GetCursorLocation(document.getElementById(ed.id)));
        }

        var me = this;
        if (newCell) {

            //            if (window._focusTimer)
            //                clearTimeout(window._focusTimer);
            //            window._focusTimer = setTimeout(function () {
            g.startEditing(newCell[0], newCell[1]);
            setTimeout(function () { ed.field.focus(true,true); }, 100);
            //            }, 50);
        }
    }
});

function getDaysInMonth(year, month) {
    return new Date(year, month, 0).getDate();
}

if (!window.console)
    window.console = { log: function () { } }

function calcDaysInDateRange(date1, date2) {
    date1.setHours(0, 0, 0, 0);
    date2.setHours(0, 0, 0, 0);
    return Math.round((date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24)) + 1;
}

function calcBusinessDays(date1, date2) {

    date1.setHours(0, 0, 0, 0);
    date2.setHours(0, 0, 0, 0);

    var iWeekday1 = date1.getDay();                // day of week
    var iWeekday2 = date2.getDay();

    // calculate differnece in weeks (1000mS * 60sec * 60min * 24hrs * 7 days = 604800000)
    // use Math.ceil instead of Math.floor to fix Daylight saving date issue.  example 2013/03
    var dayCount = Math.round((date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24))
                                + (iWeekday1 == 6 ? -1 : iWeekday1) + (iWeekday2 == 0 ? 0 : 7 - iWeekday2);

    var weekCount = dayCount / 7;

    var businessDays = weekCount * 5 - (iWeekday1 <= 5 && iWeekday1 >= 1 ? iWeekday1 - 1 : 0)
                                                    - (iWeekday2 <= 5 && iWeekday2 > 0 ? 5 - iWeekday2 : 0);

    return businessDays;

}


Ext.ns('fin.bud');


function dirtyCheck(me) {
    return !window.top.fin.cmn.status.itemValid();
}

if (!top.ui)
    top.ui = { ctl: {} };

if (top.ui.ctl.menu) {
    var me = this;
    top.ui.ctl.menu.Dom.me.registerDirtyCheck(dirtyCheck, me);
}

if (document.location.host == 'localhost')
    window.__fin_modified = false;


var globalLoadingCounter = 0;
window.isSavedSuccessfully = false;

fin.bud.loading = function () {
    globalLoadingCounter++;
    $('#itemStatusImage').removeClass('Normal').addClass('Loading');
    $('#itemModifiedImage').removeClass('Modified');
    $('#itemStatusText').html('Loading, please wait...');
}

fin.bud.saving = function () {
    globalLoadingCounter++;
    $('#itemStatusImage').removeClass('Normal').addClass('Loading');
    $('#itemModifiedImage').removeClass('Modified');
    $('#itemStatusText').html('Saving, please wait...');
}

fin.bud.saved = function () {
    globalLoadingCounter--;
    window.isSavedSuccessfully = true;

    setTimeout(function () {
        if (globalLoadingCounter <= 0) {
            fin.bud.normal(window.__fin_modified);
            globalLoadingCounter = 0;

            setTimeout(function () {
                window.isSavedSuccessfully = false;
            }, 5000);
        }
    }, 20);
}

fin.bud.normal = function (isModified) {
    $('#itemStatusImage').removeClass('Loading').addClass('Normal');
    $('#itemStatusText').html(window.isSavedSuccessfully && !isModified ? 'Data Save Successfully' : 'Normal');
    if (isModified === true) {
        $('#itemModifiedImage').addClass('Modified');
    }
    else {
        $('#itemModifiedImage').removeClass('Modified');
    }
}

fin.bud.loaded = function () {
    globalLoadingCounter--;

    setTimeout(function () {
        if (globalLoadingCounter <= 0) {
            fin.bud.normal(window.__fin_modified);
            globalLoadingCounter = 0;
        }
    }, 20);
};

fin.bud.modified = function () {

    if (arguments.length == 1) {
        fin.bud.normal(arguments[0]);
    }

    if (arguments.length == 0) {
        if (!window.top.fin || !window.top.fin.cmn || !window.top.fin.cmn.status) {
            return window.__fin_modified;
        }
        else
            return !window.top.fin.cmn.status.itemValid();
    }
    else {
        window.__fin_modified = arguments[0];

        if (window.top.fin && window.top.fin.appUI)
            window.top.fin.appUI.modified = arguments[0];
    }
}

fin.bud.dirtyCheck = function () { return !fin.bud.modified(); }



WebLight.form.FormView = WebLight.extend(WebLight.Control, {

    simulateTabKey: false,

    _fields: null,

    constructor: function (config) {

        var me = this;

        me.addEvents('bound', 'storechanged');

        /// init fields
        me._fields = new Ext.util.MixedCollection();

        var setValues = function (values) {

            if (Ext.isArray(values)) { // array of objects
                for (var i = 0, len = values.length; i < len; i++) {
                    var v = values[i];
                    var f = me.getFieldByName(v.name);
                    if (f) {
                        f.setRawValue(v.value);
                        f.suspendEvents(false);
                        f.setValue(v.value);
                        f.resumeEvents();
                    }
                }
            } else { // object hash

                me._fields.each(function (item, index, length) {
                    var value = values[item.name];

                    /// if not in data schema, ignore it
                    if (value != undefined) {

                        if (value == null)
                            value = '';
                        /// Combobox need use setRawValue, Checkbox need use setValue

                        item.setRawValue(value);
                        item.suspendEvents(false);
                        item.setValue(value);
                        item.resumeEvents();
                    }
                }, me);

            }
        };

        var storeUpdateMonitor = function (store, record, operation) {
            // 2010/12/23 fix, need include REJECT and COMMIT notify
            if (record == me.boundRecord)  // && operation == Ext.data.Record.EDIT)
                setValues(record ? record.data : {});
        };

        /// remove field containers
        var resetHtmls = function () {
            me._fields.each(function (item, index, length) {
                var fieldContainer = me.$child(item.name);
                var $innerField = fieldContainer.children();
                $innerField.insertAfter(fieldContainer);
                fieldContainer.remove();
                //                if (me.enterKeyAsTabKey)
                //                    $innerField.keyup(function (event) {
                //                        if (event.keyCode == 13) {
                //                            if (item.nextCtrl)
                //                                item.nextCtrl.focus();
                //                            event.preventDefault();
                //                        }
                //                    });
            });
        };

        var refreshFields = function () {



            if (me.boundRecord)
                setValues(me.boundRecord.data);
        };

        /// update current bound
        /// if record is null ,act as unbind feature
        var updateBound = function (record) {

            me.boundRecord = record;
            setValues(record ? record.data : {});

            if (record)
                me.fireEvent('bound', record);
        };

        var setValue = function (name, value) {
            if (me.boundRecord && name) {
                // if (me.boundRecord.get(name) != value) {
                if (Ext.isArray(value)) {
                    /// checkboxgroup
                    var newValue = [];
                    Ext.each(value, function (item) {
                        newValue.push(name);
                    });
                    value = newValue;
                }
                else if (Ext.isObject(value)) {
                    // maybe radiogroup
                    if (value.inputValue)
                        value = value.inputValue;
                }
                me.boundRecord.set(name, value);
                //  }
            }
        };

        /// bind field value to record
        var applyFieldValueToRecord = function (field) {
            setValue(field.name, field.getValue());
        };

        var attachChangeEvent = function (f) {
            f.on({
                scope: me
                    , change: function (field) {
                        if (!me.boundRecord && me.store) {
                            var value = field.getValue();

                            var record = me.store.newRecord();
                            me.store.add(record);
                            updateBound(record);
                            setValue(field.name, value);
                        }
                        else
                            applyFieldValueToRecord(field);
                        me.fireEvent('change', field.name, value);

                    }
            });
        };

        var initField = function (f) {
            // register field if name defined. 
            if (f.name) {
                me._fields.add(f.name, f);
                attachChangeEvent(f);
            }

            var label = me.$child(f.name + 'Label');
            if (label.length)
                label.html(f.fieldLabel);

            if (f.xtype == 'compositefield' || f.xtype == 'checkboxgroup') {
                /// must do it in render method
                /// because compositefield not initialize, it still config, and after it rendered, the items will convert to MixedCollection, not array
                /// cannot use Ext.each method.
                f.on('render', function () {
                    f.items.each(function (innerField) {
                        if (innerField.name/* && innerField.xtype != 'radio'*/) {
                            me._fields.add(innerField.name, innerField);
                            attachChangeEvent(innerField);
                        }
                    });
                });
            }
        };
        me.initField = initField;

        var initStore = function (store) {

            if (store.bindControl)
                store.bindControl(me);

            store.on('update', storeUpdateMonitor);

            store.on('beforesubmit', function () {

                // sometimes bind store to 2 formpanels, like View mode and Edit mode
                /// we need ingore view mode because it not changed.
                /// if not ,it will be some issue, because current.bindRecord is null
                if (!me.boundRecord)
                    return;

                /// because changed reject feature, if call form.reset method
                /// record will be removed from store
                /// if submit ,need ensure new record in store
                if (me.store.indexOf(me.boundRecord) == -1)
                    me.store.add(me.boundRecord);

                // sometimes combobox or checkbox cannot save value to record correctly.
                // below code ensure all fields applied to record.
                me._fields.each(function (item, index, length) {
                    if (item.xtype != 'displayfield')
                        applyFieldValueToRecord(item);
                }, me);
            }, this);

            if (store.getCount() > 0) {
                if (store.selectedIndex)
                    updateBound(store.getAt(store.selectedIndex()));
                else
                    updateBound(store.getAt(0));
            }

            store.on('selectedIndexChanged', function () {
                if (store.selectedIndex) {
                    if (store.selectedIndex() == -1)
                        updateBound(null);
                    else
                        updateBound(store.getAt(store.selectedIndex()));
                }
                else
                    updateBound(store.getAt(0));
            });
        };

        WebLight.form.FormView.superclass.constructor.call(this, config);

        if (me.items) {
            WebLight.each(me.items, function (item, index) {
                ctrl = item;
                if (!ctrl.events)
                    ctrl = me.createComponent(item);
                me.addChildControl(ctrl, ctrl.name);
            });
            //            delete me.items;

        }

        if (config.store) {
            initStore(config.store);
        }

        me.on('storechanged', function (newStore, oldStore) {
            initStore(newStore);
            if (oldStore && oldStore.unbindControl) {
                oldStore.unbindControl(me);
                oldStore.un('update', storeUpdateMonitor);
            }
        });

        var simulateTabKey = function () {
            if (me.simulateTabKey === true)
            // exclude textarea and button fields ':input:not(textarea):not(:button):visible'
                var inputs = $(':input:visible', me.$this).keypress(function (e) {
                    var type = $(this).attr('type');
                    if (this.tagName == 'TEXTAREA' || type == 'button' || type == 'image' || type == 'submit')
                        return;

                    if (e.which == 13) {
                        e.preventDefault();
                        var nextInput = inputs.get(inputs.index(this) + 1);
                        if (nextInput) { nextInput.focus(); nextInput.select(); }
                    }
                });
        };

        me.on('render', function () { resetHtmls(); refreshFields(); simulateTabKey(); });
    },

    _setValues: function (values) {

        if (Ext.isArray(values)) { // array of objects
            for (var i = 0, len = values.length; i < len; i++) {
                var v = values[i];
                var f = me.getFieldByName(v.name);
                if (f) {
                    f.setRawValue(v.value);
                    f.suspendEvents(false);
                    f.setValue(v.value);
                    f.resumeEvents();
                }
            }
        } else { // object hash

            me._fields.each(function (item, index, length) {
                var value = values[item.name];

                /// if not in data schema, ignore it
                if (value != undefined) {

                    if (value == null)
                        value = '';
                    /// Combobox need use setRawValue, Checkbox need use setValue

                    item.setRawValue(value);
                    item.suspendEvents(false);
                    item.setValue(value);
                    item.resumeEvents();
                }
            }, me);

        }
    },

    _initField: function (f) {
        // register field if name defined. 
        if (f.name) {
            me._fields.add(f.name, f);
            attachChangeEvent(f);
        }

        var label = me.$child(f.name + 'Label');
        if (label.length)
            label.html(f.fieldLabel);

        if (f.xtype == 'compositefield' || f.xtype == 'checkboxgroup') {
            /// must do it in render method
            /// because compositefield not initialize, it still config, and after it rendered, the items will convert to MixedCollection, not array
            /// cannot use Ext.each method.
            f.on('render', function () {
                f.items.each(function (innerField) {
                    if (innerField.name/* && innerField.xtype != 'radio'*/) {
                        me._fields.add(innerField.name, innerField);
                        attachChangeEvent(innerField);
                    }
                });
            });
        }
    },

    _attachChangeEvent: function (f) {
        f.on({
            scope: me
                    , change: function (field) {
                        if (!me.boundRecord && me.store) {
                            var value = field.getValue();

                            var record = me.store.newRecord();
                            me.store.add(record);
                            updateBound(record);
                            setValue(field.name, value);
                        }
                        else
                            applyFieldValueToRecord(field);
                    }
        });
    },

    loadTemplate: function (html, container) {
        var me = this;
        if (me.$this != container) {
            WebLight.form.FormView.superclass.loadTemplate.call(me, html, container);
            return;
        }

        var regex = new RegExp('\{.*?\}', 'gi');
        var match;

        var formattedHtml = html;
        var cmps = [];
        this.cmpIndex = 0;
        while (match = regex.exec(formattedHtml)) {
            var config = Ext.decode(match[0]);
            if (!config.name)
                config.name = String.format('{0}', this.cmpIndex++);

            var replaceHtml = String.format('<span id="{0}"></span>', config.name);
            formattedHtml = formattedHtml.replace(match[0], replaceHtml);
            cmps.push(config);
        }

        WebLight.form.FormView.superclass.loadTemplate.call(this, formattedHtml, container);

        Ext.each(cmps, function (item, index) {
            me.addChildControl(Ext.create(item), item.name);

            me.$child(item.name).replaceWith(me.$child(item.name).html());
        });
    },

    // private
    applyDefaults: function (c) {
        var d = this.defaults;
        if (d) {
            if (Ext.isFunction(d)) {
                d = d.call(this, c);
            }
            if (Ext.isString(c)) {
                c = Ext.ComponentMgr.get(c);
                Ext.apply(c, d);
            } else if (!c.events) {
                Ext.applyIf(c, d);
            } else {
                Ext.apply(c, d);
            }
        }
        return c;
    },

    // private
    createComponent: function (config, defaultType) {
        if (config.render) {
            return config;
        }
        var c = Ext.create(config, defaultType || this.defaultType);
        return c;
    },

    _lastField: null,
    addChildControl: function (control, containerId) {
        var me = this;
        WebLight.form.FormView.superclass.addChildControl.call(this, control, containerId);

        if (me.isField(control)) {
            me.initField(control);
            //            if (me.enterKeyAsTabKey) {
            //                if (me._lastField) {
            //                    me._lastField.nextCtrl = control;
            //                }

            //                me._lastField = control;
            //            }
        }
        return me;
    },

    getBoundRecord: function () {
        return this.boundRecord;
    },

    addField: function (field) {
        if (this.isField(field))
            this.addChildControl(field, field.name);
    },

    isValid: function () {
        var valid = true;
        this._fields.each(function (f) {
            if (!f.validate()) {
                valid = false;
            }
        });
        return valid;
    },

    findField: function (name) {
        if (this._fields && this._fields.containsKey(name))
            return this._fields.get(name);
        return null;
    },

    bindStore: function (store) {
        if (store != this.store) {
            var oldStore = this.store;
            this.store = store;
            this.fireEvent('storechanged', store, oldStore);
        }
        return this;
    },

    ///obsolete, use findField
    getFieldByName: function (name) {
        return this.findField(name);
    },

    // Determine if a Component is usable as a form Field.
    isField: function (c) {
        return !!c.name && !!c.setValue && !!c.getValue && !!c.markInvalid && !!c.clearInvalid;
    }

});


WebLight.override(WebLight.form.FormPanel, {
    autoStoreMask: false
});

WebLight.override(WebLight.grid.GridPanel, {
    autoStoreMask: false
});

WebLight.override(WebLight.form.FormView, {
    autoStoreMask: false
});

/// <reference path="../../references/jquery-1.4.1.js" />
/// <reference path="../Core.js" />

WebLight.data.Store = Ext.extend(Ext.data.Store, {

    trackingChanges: false,

    /// Your changes have not been saved. \r\n\r\n Discard the changes?
    discardMessage: 'Your changes have not been saved. \r\n\r\n Discard the changes?',

    constructor: function (config) {
        config = config || {};
        var me = this;
        var current = this;

        WebLight.data.Store.superclass.constructor.call(this, config);

        this.changes = [];

        this.boundControls = [];

        var computeFields = function (record) {
            if (null == me._computedFields)
                return;

            WebLight.each(me._computedFields, function (item, index) {
                var value = 0;
                switch (item[1]) {
                    case 'func':
                        value = item[2](record);
                        break;
                    case 'sum':
                        var value = 0;
                        WebLight.each(item[2], function (field, fieldIndex) {
                            value += record.get(field) || 0;
                        });
                        break;
                };

                if (record.get(item[0] != value))
                    record.set(item[0], value);
            });
        };

        var calculateColumns = function (record) {
            if (me._columnSummaryRelations == null)
                return;

            WebLight.each(me._columnSummaryRelations, function (relation, index) {
                var value = 0;

                WebLight.each(relation[1], function (column, columnIndex) {
                    var rValue = record.get(column);
                    if (rValue)
                        value += rValue;
                });

                if (record.get(relation[0]) != value)
                    record.set(relation[0], value);
            });
        };

        var calculateRows = function (record) {
            if (null == me._rowSummaryRelations)
                return;

            WebLight.each(me._rowSummaryRelations, function (relation, index) {
                if (!record || relation[2].indexOf(record) != -1) {
                    WebLight.each(relation[1], function (column) {
                        var value = 0;
                        WebLight.each(relation[2], function (r) {
                            var rValue = r.get(column);
                            if (rValue)
                                value += rValue;
                        });

                        if (relation[0].get(column) != value)
                            relation[0].set(column, value);

                    });
                }
            });
        };


        this.on('add', function (store, records, index) {
            Ext.each(records, function (record) {
                if (store.changes.indexOf(record) == -1) {
                    //TODO:
                    //                    record.set('_sysStatus', 1);
                    //                    record.set('_sysName', this.otype);
                    store.changes.push(record);
                    computeFields(record);
                    calculateColumns(record);
                    calculateRows(record);
                }
            }, this);
        });

        this.on('remove', function (store, record, index) {
            var sysStatus = record.get('_sysStatus');
            if (sysStatus == 1)
            //if remove new record, just take it out from changes array
                store.changes.remove(record);
            else if (store.changes.indexOf(record) < 0) {
                // push record in changes
                store.changes.push(record);
            }
            record.set('_sysStatus', 3);
        });

        this.on('update', function (store, record, action) {
            if (action == Ext.data.Record.REJECT || action == Ext.data.Record.COMMIT) {
                if (store.changes.indexOf(record) >= 0)
                    store.changes.remove(record);
                /// remove rejected new record
                if (action == Ext.data.Record.REJECT && record.get('_sysStatus') == 1)
                    this.remove(record);
            }
            else if (action == Ext.data.Record.EDIT) {
                if (store.changes.indexOf(record) == -1) {
                    store.changes.push(record);
                    if (record.get('_sysStatus') != 1)
                        record.set('_sysStatus', 2);
                }
                computeFields(record);
                calculateColumns(record);
                calculateRows(record);
            }
        });

        var maskControls = function (message) {
            WebLight.each(current.boundControls, function (item, index, array) {
                if (item.getEl) {
                    var el = item.getEl();

                    if (item.autoStoreMask === false)
                        return;

                    if (el && el.mask && el.isMasked && !el.isMasked())
                        el.mask(message, 'x-mask-loading');
                }
            }, current);
        };

        var unmaskControls = function () {
            WebLight.each(current.boundControls, function (item, index, array) {
                if (item.getEl) {
                    var el = item.getEl();
                    ///ATTENTION, cannot check el.isMasked(), 
                    /// because if element is hidden or parent is hidden, it always return false even if masked
                    if (el && el.unmask)    // && el.isMasked && el.isMasked())
                        el.unmask();
                }
            }, current);
        };

        this.on('beforeload', function () {

            maskControls(Ext.LoadMask.prototype.msg);
        }, this);
        this.on('load', function () {
            /// ensure selectedIndex less than page count;
            current.selectedIndex(current.selectedIndex());
            /// let method executed after other event listener
            unmaskControls();
        });

        this.on('beforesubmit', function () {
            maskControls('Saving');
        });
        this.on('submit', function () {
            unmaskControls();
        });

        //        me.on('datachanged', function () {
        //            me.changes = [];
        //        });

        me.on('datachanged', function () {
            me._columnSummaryRelations = null;
            me.clearComputedFieldSettings();
            me._rowSummaryRelations = null;
            me.changes = [];

            setTimeout(function () {
                me.each(function (record) {
                    computeFields(record);
                    calculateColumns(record);
                });
                calculateRows();
            }, 100);
        });

    },
    bindControl: function (control) {
        if (this.boundControls.indexOf(control) < 0)
            this.boundControls.push(control);
    },
    unbindControl: function (control) {
        if (this.boundControls.indexOf(control) >= 0)
            this.boundControls.remove(control);
    },

    getChangedRecords: function () {
        return this.changes || [];
    },


    rejectChanges: function () {
        WebLight.data.Store.superclass.rejectChanges.call(this);
        this.changes = [];
    },
    /// load data
    load: function (options) {
        if (!this.trackingChanges || this.changes.length == 0)
        { return WebLight.data.Store.superclass.load.call(this, options); }
        else
            Ext.MessageBox.confirm('Confirm', discardMessage, function (btn) {
                if (btn == 'yes')
                    return WebLight.data.Store.superclass.load.call(this, options);
            }, this);
        return false;
    },

    // create new record 
    newRecord: function (defaultData) {
        var me = this;
        if (!WebLight.isDefined(this.recordType)) {
            alert('record Type not defined');
            return null;
        }

        var id = null;
        if (me.idProperty && defaultData && defaultData[me.idProperty])
            id = defaultData[me.idProperty];
        return new this.recordType(Ext.apply(defaultData || {}, { _sysStatus: 1 }), id);
    },

    isNewRecord: function (record) {
        return record.get('_sysStatus') == 1;
    },

    selectedIndex: function () {
        if (!this._selectedIndex)
            this._selectedIndex = 0;

        if (!arguments || arguments.length == 0)
            return this._selectedIndex;

        var index = arguments[0];
        if (index < 0)
            index = 0;

        if (this._selectedIndex != index || this._selectedIndex >= this.getCount()) {
            if (this.getCount() == 0)
                this._selectedIndex = -1;
            else
                this._selectedIndex = index;

            if (this._selectedIndex >= this.getCount())
                this._selectedIndex = 0;
        }
        /// CANNOT put fireEvent in above scope, because if store reload,and index in count range, the event not fired
        /// but it need be fired, because need update formpanel selected record
        this.fireEvent('selectedIndexChanged', this, this._selectedIndex);
        return this;
    },

    _rowSummaryRelations: null,

    addRowRelations: function (type, source, target, columns) {
        var me = this;
        if (type == 'sum') {
            if (me._rowSummaryRelations == null)
                me._rowSummaryRelations = [];

            var sources = source;
            if (!WebLight.isArray(source))
                sources = [source];

            var targetExisted = false;
            WebLight.each(me._rowSummaryRelations, function (item, index) {
                if (item[0] == target) {
                    item[2] = item[2].concat(sources).unique();
                    targetExisted = true;
                    return true;
                }
            });

            if (!targetExisted)
                me._rowSummaryRelations.push([target, columns, sources]);

        }
        return me;
    },



    _computedFields: null,
    clearComputedFieldSettings: function () {
        var me = this;
        me._computedFields = null;
    },
    setComputedField: function (field, computeType, expression) {
        var me = this;
        if (me._computedFields == null)
            me._computedFields = [];

        WebLight.each(me._computedFields, function (item, index) {
            if (item[0] == field) {
                me._computedFields.remove(item);
                return true;
            }
        });

        me._computedFields.push([field, computeType, expression]);
    },

    _columnSummaryRelations: null,
    addColumnRelations: function (type, source, target) {
        var me = this;
        if (type == 'sum') {

            if (me._columnSummaryRelations == null)
                me._columnSummaryRelations = [];

            var sources = source;
            if (!WebLight.isArray(source))
                sources = [source];

            me._columnSummaryRelations.push([target, sources]);
        }
    }
});



WebLight.data.Store.create = function (cacheId, creator) {
    // shift arguments if data argument was omited
    if (jQuery.isFunction(cacheId)) {
        creator = cacheId;
        cacheId = null;
    }

    if (!WebLight.data.Store.__cachedStores)
        WebLight.data.Store.__cachedStores = new Ext.util.MixedCollection();

    var store;
    if (cacheId) {
        store = WebLight.data.Store.__cachedStores.get(cacheId);
        if (store)
            return store;
    }

    store = creator();

    if (cacheId)
        WebLight.data.Store.__cachedStores.add(cacheId, store);

    return store;
};



WebLight.namespace('Bud.data');


Bud.data.XmlReader = WebLight.extend(Ext.data.XmlReader, {

    dataLoaded: false,

    read: function (response) {
        var me = this;
        me.dataLoaded = true;
        var text = response.responseText;
        if (text.indexOf('transmission Error') > 0)
            me.dataLoaded = false;

        var doc = response.responseXML;
        if (!doc) {
            throw { message: "XmlReader.read: XML Document not available" };
        }
        return this.readRecords(doc);
    }
});


Bud.data.XmlStore = WebLight.extend(WebLight.data.Store, {

    /// default api url
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    recordName: 'item',

    isAnnualizedStore: true,

    /// constructor
    constructor: function (config) {
        var me = this;
        config = config || {};
        var fields = config.fields || this.fields;
        var reader = config.reader || this.reader;
        var idProperty = config.idProperty || this.idProperty;
        if (!idProperty)
            idProperty = '@id';

        if (!reader && fields && fields.length) {
            reader = new Bud.data.XmlReader({ record: me.recordName, idProperty: idProperty }, fields);
            config.reader = reader;
            this.reader = reader;
        }

        Bud.data.XmlStore.superclass.constructor.call(this, config);

        this.on('beforeload', function () { fin.bud.loading(); });
        this.on('beforesubmit', function () { fin.bud.saving(); });
        this.on('submit', function () { fin.bud.saved(); });
        this.on('load', function () { fin.bud.loaded(); });

    },

    isDataLoaded: function () {
        return this.reader.dataLoaded;
    },

    requestId: 2,
    moduleId: 'bud',
    targetId: 'iiCache',
    storeId: '',

    getRequestId: function () {
        var me = this;
        switch (me.storeId) {
            case 'hcmHouseCodes':
                return 3;
            case 'houseCodes':
                return 4;
            case 'budAnnualBudgets':
                return 5;
            case 'budAnnualInformations':
                return 6;
            case 'houseCodeJobs':
                return 7;
            case 'fiscalYears':
                return 8;
        }
        return 2;
    },

    getStoreId: function () { return this.storeId; },

    getCriteria: function () {
        return {};
    },

    /// generate request xml content
    getRequestXml: function () {
        var arr = ['<criteria>'];
        var criteria = this.getCriteria();

        var userId = '[user]';
        var host = document.location.host;
        if (host == 'localhost' || host.substr(0, 10) == 'persistech')
            userId = 'RAYMOND-DEV-XP\\Raymond Liu';

        criteria = Ext.apply(criteria || {}, { storeId: this.getStoreId(), userId: userId });

        for (i in criteria) {
            arr.push(String.format('{0}:{1},', i, criteria[i]));
        }

        arr.push('</criteria>');

        return arr.join('');
    },

    load: function (options) {

        this.setBaseParam('requestId', this.getRequestId());
        this.setBaseParam('moduleId', this.moduleId);
        this.setBaseParam('targetId', this.targetId);
        this.setBaseParam('requestXml', this.getRequestXml());

        Bud.data.XmlStore.superclass.load.call(this, {});
    },

    reload: function (options) {
        // do not call subclass load event
        this.setBaseParam('requestId', this.getRequestId());
        this.setBaseParam('moduleId', this.moduleId);
        this.setBaseParam('targetId', this.targetId);
        this.setBaseParam('requestXml', this.getRequestXml());

        Bud.data.XmlStore.superclass.load.call(this, {});
    },

    loadData: function (xml) {
        var doc;
        if (window.ActiveXObject) {
            doc = new ActiveXObject("Microsoft.XMLDOM");
            doc.async = "false";
            doc.loadXML(xml);
        } else {
            doc = new DOMParser().parseFromString(xml, "text/xml");
        }

        Bud.data.XmlStore.superclass.loadData.call(this, doc);
    },

    addAttributes: function (data) { },

    _ignoredRecords: null,
    ignoreRecords: function (records) {
        var me = this;
        if (null == me._ignoredRecords)
            me._ignoredRecords = [];
        if (WebLight.isArray(records))
            me._ignoredRecords.concat(records);
        else
            me._ignoredRecords.push(records);

    },

    getChangedRecords: function () {
        var me = this;
        var records = Bud.data.XmlStore.superclass.getChangedRecords.call(this);

        if (null == me._ignoredRecords)
            return records;

        var changedRecords = [];
        WebLight.each(records, function (r) {
            if (me._ignoredRecords.indexOf(r) == -1)
                changedRecords.push(r);
        });
        return changedRecords;
    },

    /// submit changes to server
    submitChanges: function (callback) {
        var current = this;
        this.fireEvent('beforesubmit', this);

        var xml = ['<transaction id="1">'];
        var hcmHouseCode = 0;
        var hcmJob = 0;
        var fscYear = 0;

        var htmlEncode = function (str) {
            return String(str)
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
        }


        Ext.each(this.getChangedRecords(), function (item, index) {

            xml.push('<');
            xml.push(current.getStoreId().replace(/s$/, ''));
            current.addAttributes(item.data);
            for (key in item.data) {
                var value = item.data[key];
                if (Ext.isDate(value))
                    value = Ext.util.Format.date(value, 'm/d/Y');
                else if (Ext.isString(value))
                    value = htmlEncode(value);
                xml.push(String.format(' {0}="{1}"', key, value));

                if (key == 'hcmHouseCode')
                    hcmHouseCode = parseFloat(value);
                else if (key == 'hcmJob')
                    hcmJob = parseFloat(value);
                else if (key == 'fscYear') {
                    fscYear = parseFloat(value);

                }
            }
            xml.push('/>');
        }, this);

        xml.push('</transaction>');

        var postData = String.format('moduleId={0}&requestId={1}&requestXml={2}&&targetId=iiTransaction',
            this.moduleId, this.requestId, encodeURIComponent(xml.join('').replace(/\&/gi, '&amp;')));

        jQuery.post(this.url, postData, function (data, status) {
            var innerCallback = function () {
                if (callback)
                    callback(data, status);
                current.fireEvent('submit');
                current.changes = [];
            };

            if (current.isAnnualizedStore)
                current.updateBudDetails(hcmHouseCode, hcmJob, fscYear, innerCallback);
            else
                innerCallback();
        });
    },

    updateBudDetails: function (hcmHouseCode, hcmJob, fscYear, callback) {

        var xml = '<transaction id="1"><budDetailUpdate hcmHouseCode="' + hcmHouseCode + '" hcmJob="' + hcmJob + '" fscYear="' + fscYear + '"/></transaction>';
        var postData = String.format('moduleId={0}&requestId={1}&requestXml={2}&&targetId=iiTransaction',
            this.moduleId, this.requestId, encodeURIComponent(xml));

        jQuery.post(this.url, postData, function (data, status) {
            if (callback)
                callback(data, status);
            callback();
        });
    }

});

Bud.data.XmlStore._requestId = 2;



Bud.data.AuthorizationStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    targetId: 'iiAuthorization',

    recordName: 'authorize',

    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'path', mapping: '@path' }
           ],

    getRequestXml: function () {
        return '<authorization id="1"><authorize path="\\crothall\\chimes\\fin\\Budgeting"/></authorization>';
    },

    loadSampleData: function () {
        this.loadData(_builtInTemplate_6091cb6c[0]);
    },

    allowBudgetRead: function () {
        // return this.idAuthorized(16059);
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget\\Read');
    },

    allowBudgetWrite: function () {
        // return this.idAuthorized(16060);
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget\\Write');
    },

    allowWORRead: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\WORForecast\\Read');
    },

    allowWORWrite: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\WORForecast\\Write');
    },

    allowAnnualProjectionRead: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\ByPeriod\\Read');
    },

    allowAnnualProjectionWrite: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualProjections\\ByPeriod\\Write');
    },

    allowBudgetSummaryRead: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\BudgetSummary\\Read');
    },

    allowBudgetSummaryWrite: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\BudgetSummary\\Write');
    },

    allowApproveBudget: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget\\ApproveBudget\\Approve');
    },

    allowRejectBudget: function () {
        return this.authorized('\\crothall\\chimes\\fin\\Budgeting\\AnnualizedBudget\\ApproveBudget\\Reject');
    },

    authorized: function (path) {

        if (Bud.Context.isTest)
            return true;

        return this.queryBy(function (record) {
            return record.get('path') == path;
        }).getCount() > 0;
    },

    idAuthorized: function (id) {

        return this.queryBy(function (record) {
            return record.get('id') == id;
        }).getCount() > 0;
    }

});

/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.BudUnitStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',
    storeId: 'budUnits',


    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'name', mapping: '@name' },
               { name: 'number', mapping: '@number' },
               { name: 'brief', mapping: '@brief' },
               { name: 'appUnit', mapping: '@appUnit' },
               { name: 'hirNode', mapping: '@hirNode' }
           ]
});


WebLight.namespace('Bud.data');

Bud.data.FiscalYearStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/app/act/Provider.aspx',

    moduleId: 'fsc',
    storeId: 'fiscalYears',

    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'title', mapping: '@title' }
           ],

    minFscYear: 1,

    constructor: function (config) {
        Bud.data.FiscalYearStore.superclass.constructor.call(this, config);
        var me = this;
        this.on('load', function () {
            this.each(function (record) {
                if (record.get('id') < me.minFscYear)
                    me.remove(record);
            });
        });
    }
});


Bud.data.FiscalPeriodStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/app/act/Provider.aspx',

    moduleId: 'fsc',

    fiscalYearId: 0,
    storeId: 'fiscalPeriods',

    constructor: function (config) {
        Bud.data.FiscalPeriodStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });

        this.on('load', function () {
            Bud.Context.ytdBusinessDays = this.getTotalBusinessDays();

            if (Bud.Context.primaryNav && Bud.Context.primaryNav.currentBudgetLaborCalcMethod == 1)
                Bud.Context.ytdBusinessDays4Final = 364;     //this.getTotalDays();
            else
                Bud.Context.ytdBusinessDays4Final = this.getTotalBusinessDays();

            console.log(Bud.Context.ytdBusinessDays, Bud.Context.ytdBusinessDays4Final);
        });
    },

    updateTotals: function () {
        this.suspendEvents(false);
        for (var i = 0; i < this.getCount(); i++) {
            var r = this.getAt(i);
            var startDate = Ext.util.Format.date(r.get('startDate'), 'm/d/Y');
            var endDate = Ext.util.Format.date(r.get('endDate'), 'm/d/Y');
            r.set('friendlyTitle', String.format('{0}: {1} - {2}', r.get('title'), startDate, endDate));
        }
        this.resumeEvents();
    },

    getCriteria: function () {
        return { fiscalYearId: this.fiscalYearId };
    },

    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'fiscalYearId', mapping: '@year' },
               { name: 'title', mapping: '@title' },
               { name: 'fiscalYear', mapping: '@fscYeaTitle' },
               { name: 'startDate', mapping: '@startDate', type: 'date', dateFormat: 'n/j/Y' },
               { name: 'endDate', mapping: '@endDate', type: 'date', dateFormat: 'n/j/Y' },
               { name: 'friendlyTitle' }
           ],

    load: function (fiscalYearId) {
        this.fiscalYearId = fiscalYearId;
        Bud.data.FiscalPeriodStore.superclass.load.call(this);
    },

    getByTitle: function (title) {
        var me = this;

        var recordIndex = me.findBy(function (record, id) {
            return record.get('title') == title;
        });

        return me.getAt(recordIndex);
    },

    getBusinessDaysByTitle: function (title) {
        var me = this;
        var record = me.getByTitle(title);

        return calcBusinessDays(record.get('startDate'), record.get('endDate'));

    },

    getDaysByTitle: function (title) {
        var me = this;
        var record = me.getByTitle(title);

        return calcDaysInDateRange(record.get('startDate'), record.get('endDate'));

    },

    getTotalDays: function () {
        var me = this;
        var period1 = me.getByTitle(1);
        var period12 = me.getByTitle(12);
        return calcDaysInDateRange(period1.get('startDate'), period12.get('endDate'));

    },

    getTotalBusinessDays: function () {
        var me = this;
        var period1 = me.getByTitle(1);
        var period12 = me.getByTitle(12);
        return calcBusinessDays(period1.get('startDate'), period12.get('endDate'));

    }


});


WebLight.namespace('Bud.data');

Bud.data.HouseCodeReader = WebLight.extend(Ext.data.XmlReader, {

    read: function (response) {
       top.bud_housecodexml = response.responseText;
       var doc = response.responseXML;
       if (!doc) {
           throw { message: "XmlReader.read: XML Document not available" };
       }
       return this.readRecords(doc);
    }
});

Bud.data.HouseCodeStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/hcm/act/provider.aspx',

    moduleId: 'hcm',

    storeId: 'hcmHouseCodes',

    getCriteria: function () {
        var me = this;

        return { appUnitBrief: me.baseParams['query'] || '' };
    },

    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'name', mapping: '@name' },
               { name: 'number', mapping: '@number' },
               { name: 'brief', mapping: '@brief' },
               { name: 'appUnit', mapping: '@appUnit' },
               { name: 'hirNode', mapping: '@hirNode' }
           ]

    ,constructor: function (config) {
        config = config || {};
        var reader = new Bud.data.HouseCodeReader({ record: 'item', idProperty: '@id' }, this.fields);
        config.reader = reader;
        Bud.data.HouseCodeStore.superclass.constructor.call(this, config);

    }

   , load: function (options) {
        if (top.bud_housecodexml)
            this.loadData(top.bud_housecodexml);
        else {
            this.setBaseParam('requestId', this.getRequestId());
            this.setBaseParam('moduleId', this.moduleId);
            this.setBaseParam('targetId', this.targetId);
            this.setBaseParam('requestXml', this.getRequestXml());

            Bud.data.XmlStore.superclass.load.call(this, {});
        }
    }
});



WebLight.namespace('Bud.data');

Bud.data.JobCodeStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/hcm/act/Provider.aspx',

    moduleId: 'hcm',

    idProperty: '@jobId',

    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'jobTitle', mapping: '@jobTitle' },
               { name: 'jobDescription', mapping: '@jobDescription' },
               { name: 'jobNumber', mapping: '@jobNumber' },
               { name: 'houseCodeId', mapping: '@houseCodeId' },
               { name: 'jobId', mapping: '@jobId' }
           ],
    storeId: 'houseCodeJobs',

    getCriteria: function () {
        return { houseCodeId: this.houseCodeId, jobType: 0 };
    },

    load: function (houseCode) {
        this.houseCodeId = houseCode;
        Bud.data.JobCodeStore.superclass.load.call(this);
    }
});


/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.IncomeTypeStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    constructor: function (config) {

        var me = this;
        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@fscAccount',
            fields: [
               { name: 'fscAccount', mapping: '@fscAccount', type: 'float' },
               { name: 'fscAccCode', mapping: '@fscAccCode', type: 'float' },
               { name: 'description', mapping: '@description' },
               { name: 'period1', mapping: '@period1', type: 'float' },
               { name: 'period2', mapping: '@period2', type: 'float' },
               { name: 'period3', mapping: '@period3', type: 'float' },
               { name: 'period4', mapping: '@period4', type: 'float' },
               { name: 'period5', mapping: '@period5', type: 'float' },
               { name: 'period6', mapping: '@period6', type: 'float' },
               { name: 'period7', mapping: '@period7', type: 'float' },
               { name: 'period8', mapping: '@period8', type: 'float' },
               { name: 'period9', mapping: '@period9', type: 'float' },
               { name: 'period10', mapping: '@period10', type: 'float' },
               { name: 'period11', mapping: '@period11', type: 'float' },
               { name: 'period12', mapping: '@period12', type: 'float' },
               { name: 'period13', mapping: '@period13', type: 'float' },
               { name: 'period14', mapping: '@period14', type: 'float' },
               { name: 'period15', mapping: '@period15', type: 'float' },
               { name: 'period16', mapping: '@period16', type: 'float' },
               { name: 'fscYear', mapping: '@fscYear', type: 'float' }
           ]
        });
        Bud.data.IncomeTypeStore.superclass.constructor.call(this, config);

        me.on('datachanged', function () {

            var columns = [];
            var rows = me.getRange(0, me.getCount() - 1);
            for (var i = 1; i <= 16; i++)
                columns.push(String.format('period{0}', i));

            var totalRecord = this.getAt(this.getCount() - 1);
            if (!totalRecord || totalRecord.get('fscAccount') != 0) {
                totalRecord = new this.recordType({ fscAccount: 0, description: 'Total', fscAccCode: 0 });
                this.add([totalRecord]);
            }

            me.addRowRelations('sum', rows, totalRecord, columns);

            me.addColumnRelations('sum', columns, 'fscYear');


            me.ignoreRecords(totalRecord);
        });

    },
    storeId: 'budIncomeTypes',

    getCriteria: function () {
        return { hcmHouseCode: this._HcmHouseCode, hcmJob: this._HcmJob, fscYear: this._FscYear };
    },

    _HcmHouseCode: 0,
    _HcmJob: 0,
    _FscYear: 0,

    setContext: function (HcmHouseCode, HcmJob, FiscalYear) {

        this._FscYear = FiscalYear;
        this._HcmHouseCode = HcmHouseCode;
        this._HcmJob = HcmJob;
    },


    load: function (HcmHouseCode, HcmJob, FiscalYear) {
        this.setContext(HcmHouseCode, HcmJob, FiscalYear);

        Bud.data.IncomeTypeStore.superclass.load.call(this);
    },

    getColumnSummary: function (column) {
        var summary = 0;
        for (var i = 0; i < this.getCount() - 1; i++) {
            summary += this.getAt(i).get(column);
        }
        return parseFloat(summary.toFixed(2));
    },

    getFiscalYearValue: function (record) {
        var summary = 0;
        for (var i = 1; i <= 16; i++) {
            summary += record.get('period' + i);
        }
        return summary;
    },

    loadSampleData: function () {
        this.loadData(_builtInTemplate_6091cb6c[1]);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._HcmHouseCode, hcmJob: this._HcmJob, fscYear: this._FscYear });
    }

});


/// <reference path="../../references/jquery-1.4.1.js" />
/// <reference path="../ext-all-budget.js" />
/// <reference path="../../references/ext-jquery-adapter.js" />
/// <reference path="../../references/weblight4extjs.js" />

WebLight.namespace('Bud.data');

Bud.data.PeriodDefinitionStore = WebLight.extend(Ext.data.XmlStore, {

    constructor: function (config) {
        config = Ext.apply(config || {}, { record: 'item',

            fields: [
               { name: 'id', mapping: '@id', type: 'float' },
               { name: 'fscYear', mapping: '@fscYear', type: 'float' },
               { name: 'period', mapping: '@period',type:'float' },
               { name: 'startDate', mapping: '@startDate', type: 'date', dateFormat: 'Y-m-d H:i:s' },
               { name: 'endDate', mapping: '@endDate', type: 'date', dateFormat:'Y-m-d H:i:s' }
           ]
        });
        Bud.data.PeriodDefinitionStore.superclass.constructor.call(this, config);

    },

    loadSampleData: function () {
        var xml = _builtInTemplate_6091cb6c[2];
        var doc;
        if (window.ActiveXObject) {
            doc = new ActiveXObject("Microsoft.XMLDOM");
            doc.async = "false";
            doc.loadXML(xml);
        } else {
            doc = new DOMParser().parseFromString(xml, "text/xml");
        }
        this.loadData(doc);
    }
});

/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.BudBillingPeriodStore = WebLight.extend(Bud.data.XmlStore, {


    /// private variables
    _HcmHouseCode: 0,
    _HcmJob: 0,
    _FscYear: 0,


    /// data api url
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budBillingPeriods',

    /// custom criteria for data request
    getCriteria: function () {
        return { hcmHouseCode: this._HcmHouseCode, hcmJob: this._HcmJob, fscYear: this._FscYear };
    },

    /// load method, define custom parameters.
    load: function (HcmHouseCode, HcmJob, FiscalYear) {
        
        /// store parameters to variables. 
        this._FscYear = FiscalYear;
        this._HcmHouseCode = HcmHouseCode;
        this._HcmJob = HcmJob;

        /// call base load method.
        Bud.data.BudBillingPeriodStore.superclass.load.call(this);
    },

    /// add default properties to data before post changed data to server.
    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._HcmHouseCode, hcmJob: this._HcmJob, fscYear: this._FscYear });
    },

    /// record fields ,and xml mapping.
    fields: [
               { name: 'id', mapping: '@id', type: 'float' },
               { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
               { name: 'fscYear', mapping: '@fscYear', type: 'float' },
               { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
               { name: 'rate', mapping: '@rate', type: 'float' },
               { name: 'percentIncrease', mapping: '@percentIncrease', type: 'float' },
               { name: 'dateEffective', mapping: '@dateEffective', dateFormat: 'n/j/Y' },
               { name: 'description', mapping: '@description' }
           ]
});


/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.HcmHouseDetailStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/hcm/act/provider.aspx',

    moduleId: 'hcm',

    storeId: 'houseCodes',

    getCriteria: function () {
        return { houseCode: this.houseCode };
    },

    load: function (houseCode) {
        this.houseCode = houseCode;
        Bud.data.HcmHouseDetailStore.superclass.load.call(this);
    },

    fields: [
               { name: 'id', mapping: '@id', type: 'float' },
    /// changed at 2013/1/22, need use budgetTemplate column ,but still call it contractTypeId on client side for temporary.
               {name: 'budgetTemplateId', mapping: '@budgetTemplateId', type: 'float' },
                 { name: 'contractTypeId', mapping: '@contractTypeId', type: 'float' },
               { name: 'billingCycleFrequencyTypeId', mapping: '@billingCycleFrequencyTypeId', type: 'float' },
               { name: 'budgetLaborCalcMethod', mapping: '@budgetLaborCalcMethod', type: 'float' },
               { name: 'houseCodeTypeId', mapping: '@houseCodeTypeId', type: 'float' }
           ]
});


/// <reference path="XmlStore.js" />

Bud.data.BudStaffingHourStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budStaffingHours',

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, budShiftType: this._budShiftType };
    },

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,
    _budShiftType: 0,

    _totalRow: null,

    constructor: function (config) {
        var me = this;

        Bud.data.BudStaffingHourStore.superclass.constructor.call(this, config);

        me.on('beforeload', function () {
            me._totalRow = this.newRecord({ id: 0, unit: 'Total' });
        });

        me.on('load', function () {
            me.addingTotalRow = true;
            me.add(me._totalRow);
            me.ignoreRecords(me._totalRow);
            me.addingTotalRow = false;
            me.updateTotals();

            this.fireEvent('datachanged', this);
        });

        this.on({
            add: { fn: this.updateTotals },
            remove: { fn: this.updateTotals },
            update: { fn: this.updateTotals }
        });
    },

    plannedPerWeek: 0,
    shortStaffingOnLegalHolidays: 0,

    plannedPerWeek4FnlLabor: 0,
    shortStaffingOnLegalHolidays4FnlLabor: 0,


    decimal2: function (v) {
        return Math.round(v * 100) / 100;
    },

    updateTotals: function () {
        var me = this;

        if (this.updatingTotals || this.addingTotalRow)
            return;
        this.suspendEvents(false);

        this.updatingTotals = true;

        var proposedWeeklyTotal = 0;
        var currentWeeklyTotal = 0;
        var proposedHolidaysTotal = 0;
        var currentHolidaysTotal = 0;

        var curMon = 0;
        var curTue = 0;
        var curWed = 0;
        var curThur = 0;
        var curFri = 0;
        var curSat = 0;
        var curSun = 0;
        var curWt = 0;
        var curLh = 0;

        var proMon = 0;
        var proTue = 0;
        var proWed = 0;
        var proThur = 0;
        var proFri = 0;
        var proSat = 0;
        var proSun = 0;
        var proWt = 0;
        var proLh = 0;

        for (var i = 0; i < this.getCount() - 1; i++) {
            var r = this.getAt(i);
            r.set('currentTotal', (r.get('currentMonday') || 0)
                    + (r.get('currentTuesday') || 0)
                    + (r.get('currentWednesday') || 0)
                    + (r.get('currentThursday') || 0)
                    + (r.get('currentFriday') || 0)
                    + (r.get('currentSaturday') || 0)
                    + (r.get('currentSunday') || 0));

            r.set('proposedTotal', (r.get('proposedMonday') || 0)
                    + (r.get('proposedTuesday') || 0)
                    + (r.get('proposedWednesday') || 0)
                    + (r.get('proposedThursday') || 0)
                    + (r.get('proposedFriday') || 0)
                    + (r.get('proposedSaturday') || 0)
                    + (r.get('proposedSunday') || 0));

            currentWeeklyTotal += r.get('currentTotal');
            proposedWeeklyTotal += r.get('proposedTotal');

            currentHolidaysTotal += (r.get('currentHolidays') || 0);
            proposedHolidaysTotal += (r.get('proposedHolidays') || 0);

            curMon += (r.get('currentMonday') || 0);
            curTue += (r.get('currentTuesday') || 0);
            curWed += (r.get('currentWednesday') || 0);
            curThur += (r.get('currentThursday') || 0);
            curFri += (r.get('currentFriday') || 0);
            curSat += (r.get('currentSaturday') || 0);
            curSun += (r.get('currentSunday') || 0);

            proMon += (r.get('proposedMonday') || 0);
            proTue += (r.get('proposedTuesday') || 0);
            proWed += (r.get('proposedWednesday') || 0);
            proThur += (r.get('proposedThursday') || 0);
            proFri += (r.get('proposedFriday') || 0);
            proSat += (r.get('proposedSaturday') || 0);
            proSun += (r.get('proposedSunday') || 0);

        }

        this.plannedPerWeek = me.decimal2(proposedWeeklyTotal - currentWeeklyTotal);
        // @2012/3/1 Proposed Monday Hours – Proposed Legal Holiday Hours
        this.shortStaffingOnLegalHolidays = me.decimal2(proMon - proposedHolidaysTotal);

        this.plannedPerWeek4FnlLabor = me.decimal2(proposedWeeklyTotal);
        this.shortStaffingOnLegalHolidays4FnlLabor = this.shortStaffingOnLegalHolidays;           // me.decimal2(proposedHolidaysTotal);

        this._totalRow.set('currentMonday', this.decimal2(curMon));
        this._totalRow.set('currentTuesday', this.decimal2(curTue));
        this._totalRow.set('currentWednesday', this.decimal2(curWed));
        this._totalRow.set('currentThursday', this.decimal2(curThur));
        this._totalRow.set('currentFriday', this.decimal2(curFri));
        this._totalRow.set('currentSaturday', this.decimal2(curSat));
        this._totalRow.set('currentSunday', this.decimal2(curSun));

        this._totalRow.set('currentTotal', this.decimal2(currentWeeklyTotal));
        this._totalRow.set('currentHolidays', this.decimal2(currentHolidaysTotal));

        this._totalRow.set('proposedMonday', this.decimal2(proMon));
        this._totalRow.set('proposedTuesday', this.decimal2(proTue));
        this._totalRow.set('proposedWednesday', this.decimal2(proWed));
        this._totalRow.set('proposedThursday', this.decimal2(proThur));
        this._totalRow.set('proposedFriday', this.decimal2(proFri));
        this._totalRow.set('proposedSaturday', this.decimal2(proSat));
        this._totalRow.set('proposedSunday', this.decimal2(proSun));

        this._totalRow.set('proposedTotal', this.decimal2(proposedWeeklyTotal));
        this._totalRow.set('proposedHolidays', this.decimal2(proposedHolidaysTotal));

        this.updatingTotals = false;
        this.resumeEvents();

        me.fireEvent('datarefresh', me);
    },

    load: function (hcmHouseCode, hcmJob, fscYear, budShiftType) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;
        this._budShiftType = budShiftType;

        Bud.data.BudStaffingHourStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, budShiftType: this._budShiftType });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'budShiftType', mapping: '@budShiftType', type: 'float' },
     { name: 'unit', mapping: '@unit' },
     { name: 'currentMonday', mapping: '@currentMonday', type: 'float' },
     { name: 'currentTuesday', mapping: '@currentTuesday', type: 'float' },
     { name: 'currentWednesday', mapping: '@currentWednesday', type: 'float' },
     { name: 'currentThursday', mapping: '@currentThursday', type: 'float' },
     { name: 'currentFriday', mapping: '@currentFriday', type: 'float' },
     { name: 'currentSaturday', mapping: '@currentSaturday', type: 'float' },
     { name: 'currentSunday', mapping: '@currentSunday', type: 'float' },
     { name: 'currentHolidays', mapping: '@currentHolidays', type: 'float' },
       { name: 'currentHourlyRate', mapping: '@currentHourlyRate', type: 'float' },
     { name: 'proposedMonday', mapping: '@proposedMonday', type: 'float' },
     { name: 'proposedTuesday', mapping: '@proposedTuesday', type: 'float' },
     { name: 'proposedWednesday', mapping: '@proposedWednesday', type: 'float' },
     { name: 'proposedThursday', mapping: '@proposedThursday', type: 'float' },
     { name: 'proposedFriday', mapping: '@proposedFriday', type: 'float' },
     { name: 'proposedSaturday', mapping: '@proposedSaturday', type: 'float' },
     { name: 'proposedSunday', mapping: '@proposedSunday', type: 'float' },
     { name: 'proposedHolidays', mapping: '@proposedHolidays', type: 'float' },
          { name: 'proposedHourlyRate', mapping: '@proposedHourlyRate', type: 'float' },
     { name: 'currentTotal', type: 'float' },
     { name: 'proposedTotal', type: 'float' }
    ],

    newRecord: function (data) {
        data = data || {};

        Ext.applyIf(data, { unit: 'New Unit',
            currentMonday: 0, currentTuesday: 0, currentWednesday: 0, currentThursday: 0,
            currentFriday: 0, currentSaturday: 0, currentSunday: 0, currentHolidays: 0,
            proposedMonday: 0, proposedTuesday: 0, proposedWednesday: 0, proposedThursday: 0,
            proposedFriday: 0, proposedSaturday: 0, proposedSunday: 0, proposedHolidays: 0
        });

        return Bud.data.BudStaffingHourStore.superclass.newRecord.call(this, data);
    },

    addNewRecord: function () {
        var index = this.getCount() - 1;
        if (index < 0)
            index = 0;
        this.insert(index, this.newRecord({}));
    }

});

/// <reference path="XmlStore.js" />

Bud.data.BudShiftTypeStore = Ext.extend(Bud.data.XmlStore, {

    fields: [
               { name: 'id', mapping: '@id', type: 'float' },
               { name: 'title', mapping: '@title' }
           ],
    loadSampleData: function () {
        this.loadData(_builtInTemplate_6091cb6c[3]);
    }

});



/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.EmployeeLockStore = WebLight.extend(Bud.data.XmlStore, {

    _totalRow: null,
    isMgtHistory: false,

    _payPeriodStore: null,
    _budPeriodStore: null,


    constructor: function (config) {
        var me = this;

        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@id',
            fields: [
               { name: 'id', mapping: '@id', type: 'int' },
               { name: 'employeeName', mapping: '@employeeName' },
               { name: 'yearsOfService', mapping: '@yearsOfService', type: 'int' },
               { name: 'vacationDays', mapping: '@vacationDays', type: 'float' },
               { name: 'dueIncrease', mapping: '@dueIncrease', type: 'bool' },
               { name: 'payRate', mapping: '@payRate', type: 'float' },
               { name: 'differentialPayRate', mapping: '@differentialPayRate', type: 'float' },
               { name: 'otherPayRate', mapping: '@otherPayRate', type: 'float' },
               { name: 'totalCurrentWageRatePerHour', mapping: '@totalCurrentWageRatePerHour', type: 'float' },
               { name: 'scheduledHours', mapping: '@scheduledHours', type: 'float' },
               { name: 'costPerPayPeriod', mapping: '@costPerPayPeriod', type: 'float' },
               { name: 'costBeforeDifferential', mapping: '@costBeforeDifferential', type: 'float' },
               { name: 'fscPeriodOfIncrease', mapping: '@fscPeriodOfIncrease', type: 'float' },
               { name: 'typeMeritPromotion', mapping: '@typeMeritPromotion' },
               { name: 'fiscalIncrease', mapping: '@fiscalIncrease', type: 'float' },
               { name: 'exempt', mapping: '@exempt', type: 'int' },
               { name: 'position', mapping: '@position' },
               { name: 'annualSalary', mapping: '@annualSalary', type: 'float' },
               { name: 'newAnnualSalary', mapping: '@newAnnualSalary', type: 'float' },
               { name: 'payFrequencyType', mapping: '@payFrequencyType', type: 'float' },
               { name: 'period1', mapping: '@period1', type: 'float' },
               { name: 'period2', mapping: '@period2', type: 'float' },
               { name: 'period3', mapping: '@period3', type: 'float' },
               { name: 'period4', mapping: '@period4', type: 'float' },
               { name: 'period5', mapping: '@period5', type: 'float' },
               { name: 'period6', mapping: '@period6', type: 'float' },
               { name: 'period7', mapping: '@period7', type: 'float' },
               { name: 'period8', mapping: '@period8', type: 'float' },
               { name: 'period9', mapping: '@period9', type: 'float' },
               { name: 'period10', mapping: '@period10', type: 'float' },
               { name: 'period11', mapping: '@period11', type: 'float' },
               { name: 'period12', mapping: '@period12', type: 'float' },
               { name: 'period13', mapping: '@period13', type: 'float' },
               { name: 'periodTotal', type: 'float' },
               { name: 'dueIncreaseCount', type: 'float' }
           ]
        });

        Bud.data.EmployeeLockStore.superclass.constructor.call(this, config);

        me.on('beforeload', function () {
            me._totalRow = this.newRecord({ id: 0, employeeName: 'Total' });
        });

        me.on('load', me.onLoadEvent);

        me.on({
            add: { fn: me.updateTotals },
            remove: { fn: me.updateTotals },
            update: { fn: me.updateTotals }
        });

        this._payPeriodStore = new Bud.data.PayPeriodStore();
        this._budPeriodStore = new Bud.data.FiscalPeriodStore();

    },

    onLoadEvent: function (store) {
        store.addingTotalRow = true;
        store.add(store._totalRow);
        store.ignoreRecords(store._totalRow);
        store.addingTotalRow = false;

        store.updateTotals();
        this.fireEvent('datachanged', this);
    },

    numberOfEmployees: 0,
    averageBaseWageRate: 0,
    averageWageRate: 0,

    calculateSummary: function () {
        var me = this;

        var numberOfEmployees = this.getCount() - 1;
        var totalCostPerPayPeriod = 0;
        var totalCostBeforeDifferential = 0;
        var totalScheduledHours = 0;
        for (var i = 0; i < numberOfEmployees; i++) {
            var r = this.getAt(i);
            totalCostPerPayPeriod += r.get('costPerPayPeriod');
            totalScheduledHours += r.get('scheduledHours');
            totalCostBeforeDifferential += r.get('costBeforeDifferential');
        }

        this.numberOfEmployees = numberOfEmployees;
        this.averageBaseWageRate = me.decimal2(totalCostBeforeDifferential / totalScheduledHours);
        this.averageWageRate = me.decimal2(totalCostPerPayPeriod / totalScheduledHours);
    },

    decimal2: function (v) {
        return Math.round(v * 100) / 100;
    },

    ignoreUpdateTotal: false,

    updateTotals: function () {
        var me = this;
        if (me.updatingTotals || me.addingTotalRow || me.ignoreUpdateTotal)
            return;
        this.suspendEvents(false);

        me.updatingTotals = true;

        var totalCount = this.getCount() - 1;

        var periodTotal = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        var allPeriodTotal = 0;
        var annSalaryTotal = 0;
        var newAnnSalaryTotal = 0;

        var empDueIncreaseTotal = 0;
        var annualTotal = 0;
        var hoursTotal = 0;
        var costBeforeDiffTotal = 0;
        var costPerPeriodTotal = 0;
        var fiscalIncreaseTotal = 0;

        for (var i = 0; i < totalCount; i++) {
            var r = this.getAt(i);
            var exempt = r.get('exempt');
            if (exempt == 0) {
                var totalCurrentWageRate = r.get('payRate') + r.get('differentialPayRate') + r.get('otherPayRate');
                r.set('totalCurrentWageRatePerHour', totalCurrentWageRate);

                var costPerPeriod = totalCurrentWageRate * r.get('scheduledHours');
                r.set('costPerPayPeriod', me.decimal2(costPerPeriod));

                var costBeforeDifferential = r.get('payRate') * r.get('scheduledHours');
                r.set('costBeforeDifferential', me.decimal2(costBeforeDifferential));

                var annual = costPerPeriod * (r.get('payFrequencyType') == 1 ? 26 : 52);
                r.set('annualSalary', me.decimal2(annual));

                annualTotal += annual;
                empDueIncreaseTotal += !!r.get('dueIncrease') ? 1 : 0;
                hoursTotal += r.get('scheduledHours');
                costPerPeriodTotal += costPerPeriod;
                costBeforeDiffTotal += costBeforeDifferential;
            }
            else {
                var salaryEachBiweekly = r.get('annualSalary') / 26;
                var salaryEachMon = 0;
                var periodOfInc = r.get('fscPeriodOfIncrease');
                var fiscIncrease = 1 + r.get('fiscalIncrease') / 100;

                /* changes 2012/3/16
                Mgmt
                100000 / 365 * 31 = 8493.15
                The work days will be replaced with the number of days in year. This number of days is a fixed 365 days.
                The number of work days in a period is replaced with the number of days in a period. October has 31 days, November has 30, December 31 etc
                */

                var total = 0;
                for (var n = 0; n < 12; n++) {
                    //salaryEachMon = r.get('annualSalary') / me._budPeriodStore.getTotalBusinessDays() * me._budPeriodStore.getBusinessDaysByTitle(n + 1)            ///salaryEachBiweekly * me.getPayPeriodCount(n + 1);
                    salaryEachMon = r.get('annualSalary') / 365 * me._budPeriodStore.getDaysByTitle(n + 1);
                    var fieldName = 'period' + (n + 1);
                    if (periodOfInc == 0 || n < periodOfInc - 1)
                        r.set(fieldName, me.decimal2(salaryEachMon));
                    else
                        r.set(fieldName, me.decimal2(salaryEachMon * fiscIncrease));

                    total += r.get(fieldName);
                    periodTotal[n] += r.get(fieldName);
                }

                r.set('newAnnualSalary', me.decimal2(r.get('annualSalary') * fiscIncrease));
                r.set('periodTotal', me.decimal2(total));

                allPeriodTotal += total;
                newAnnSalaryTotal += r.get('annualSalary') * fiscIncrease;
                annSalaryTotal += r.get('annualSalary');
                fiscalIncreaseTotal += r.get('fiscalIncrease');
            }
        }

        if (this.isMgtHistory) {
            for (var i = 0; i < 12; i++) {
                var field = 'period' + (i + 1);
                this._totalRow.set(field, this.decimal2(periodTotal[i]));
            }
            this._totalRow.set('periodTotal', this.decimal2(allPeriodTotal));
            this._totalRow.set('newAnnualSalary', this.decimal2(newAnnSalaryTotal));
            this._totalRow.set('annualSalary', this.decimal2(annSalaryTotal));
            this._totalRow.set('fiscalIncrease', this.decimal2(fiscalIncreaseTotal / (this.getCount() - 1)));
        }
        else {
            this._totalRow.set('dueIncreaseCount', this.decimal2(empDueIncreaseTotal));
            this._totalRow.set('scheduledHours', this.decimal2(hoursTotal));
            this._totalRow.set('costPerPayPeriod', this.decimal2(costPerPeriodTotal));
            this._totalRow.set('costBeforeDifferential', this.decimal2(costBeforeDiffTotal));
            this._totalRow.set('annualSalary', this.decimal2(annualTotal));
            this.calculateSummary();
        }
        me.updatingTotals = false;
        this.resumeEvents();
        this.fireEvent('datarefresh', this);
    },

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budEmployeeLocks',

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, exempt: this._exempt };
    },

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,
    _exempt: 0,

    load: function (hcmHouseCode, hcmJob, fscYear, exempt) {

        var me = this;

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;
        this._exempt = exempt;

        if (me.isMgtHistory === true) {

            var budPeriodStoreLoaded = function () {
                me._payPeriodStore.on('load', payPeriodStoreLoaded);
                me._payPeriodStore.load(fscYear, 1);
                me._budPeriodStore.un('load', budPeriodStoreLoaded);
            };

            var payPeriodStoreLoaded = function () {

                Bud.data.EmployeeLockStore.superclass.load.call(me);
                me._payPeriodStore.un('load', payPeriodStoreLoaded);
            };

            me._budPeriodStore.on('load', budPeriodStoreLoaded);
            me._budPeriodStore.load(fscYear);

        }
        else
            Bud.data.EmployeeLockStore.superclass.load.call(this);
    },

    getPayPeriodCount: function (periodTitle) {
        var me = this;
        var period = me._budPeriodStore.getByTitle(periodTitle);
        if (!period)
            return 0;
        var startDate = period.get('startDate');
        var endDate = period.get('endDate');
        var payCount = 0;
        me._payPeriodStore.each(function (record) {
            if (record.get('endDate') >= startDate && record.get('endDate') <= endDate)
                payCount++;
        });
        return payCount
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, exempt: this._exempt });
    },

    addNewRecord: function () {
        var index = this.getCount() - 1;
        if (index < 0)
            index = 0;
        this.insert(index, this.newRecord({ exempt: 1, annualSalary: 0 }));
    }

});


/// <reference path="XmlStore.js" />

Bud.data.BudAnnualBudgetStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAnnualBudgets',

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear };
    },

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,

    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudAnnualBudgetStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    fields: [
        { name: 'id', mapping: '@id', type: 'float' },
        { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
        { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
        { name: 'fscYear', mapping: '@fscYear', type: 'float' },
        { name: 'crtdAt', mapping: '@crtdAt', type: 'date', dateFormat: 'n/j/Y' },
        { name: 'crtdBy', mapping: '@crtdBy', type: 'string' },
        { name: 'exported', mapping: '@exported', type: 'bool' },
        { name: 'lockedDown', mapping: '@lockedDown', type: 'bool' },
        { name: 'startDate', mapping: '@startDate', type: 'date', dateFormat: 'n/j/Y' },
        { name: 'startedBy', mapping: '@startedBy', type: 'string' },
        { name: 'approved', mapping: '@approved', type: 'bool' },
        { name: 'comments' },
            { name: 'budgetTemplateId', mapping: '@budgetTemplateId', type: 'float' },
                 { name: 'contractTypeId', mapping: '@contractTypeId', type: 'float' },
               { name: 'billingCycleFrequencyTypeId', mapping: '@billingCycleFrequencyTypeId', type: 'float' },
               { name: 'budgetLaborCalcMethod', mapping: '@budgetLaborCalcMethod', type: 'float' },
               { name: 'houseCodeTypeId', mapping: '@houseCodeTypeId', type: 'float' }
    ]
});


Bud.data.BudAnnualBudgetStartStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAnnualBudgetStart',

    fields: [
        { name: 'hcmHouseCode', type: 'float' },
        { name: 'hcmJob', type: 'float' },
        { name: 'fscYear', type: 'float' }
    ]

});

Bud.data.BudAnnualBudgetApprovalStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAnnualBudgetApprove',

    fields: [
        { name: 'id', type: 'float' },
        { name: 'hcmHouseCode', type: 'float' },
        { name: 'hcmJob', type: 'float' },
        { name: 'fscYear', type: 'float' },
        { name: 'approved', type:'bool' },
        { name: 'comments' }
    ]

});


Bud.data.BudLaborCalculationStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budLaborCalculations',

    constructor: function (config) {
        Bud.data.BudLaborCalculationStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });
    },

    updateTotals: function () {

        if (this.getCount() != 1)
            return;

        this.suspendEvents(false);

        var decimal2 = function (d) {
            return Math.round(d * 100) / 100;
        }

        var decimalPercentage = function (d) {
            return Math.round(d * 10000) / 100;
        }

        var workDaysPerYear = Bud.Context.ytdBusinessDays || 260;         ///260;
        // console.log(workDaysPerYear);
        var r = this.getAt(0);

        //on ".Net prod days per emp & FTEs" tab, we use "Average sick days taken over last 52 weeks (days per employee) " 
        //on "Sick pay" tab to do the calculation on "Sick days Taken".
        // we need to change it to use "Proj. number of sick days to be used in budget year (days per employee) " on "Sick pay" tab.

        if (!r.get('vacationEarned'))
            r.set('vacationEarned', 0);

        if (Bud.Context.primaryNav.currentBudgetTemplateId == 4) {
            r.set('nonReplaceSickPayPerc', 100);
            r.set('nonReplaceVacationPerc', 100);
            r.set('nonReplaceHolidayPerc', 100);
            r.set('nonReplacePersonalPerc', 100);
        }

        var total = r.get('sickDaysProjected') + r.get('legalHolidays') + r.get('personalDays') + r.get('otherPaidLeave') + r.get('vacationEarned');

        r.set('sickDaysTakenPercentage', decimalPercentage(r.get('sickDaysProjected') / workDaysPerYear));
        r.set('legalHolidaysPercentage', decimalPercentage(r.get('legalHolidays') / workDaysPerYear));
        r.set('personalDaysPercentage', decimalPercentage(r.get('personalDays') / workDaysPerYear));
        r.set('otherPaidLeavePercentage', decimalPercentage(r.get('otherPaidLeave') / workDaysPerYear));
        r.set('vacationEarnedPercentage', decimalPercentage(r.get('vacationEarned') / workDaysPerYear));
        r.set('totalPaidLeave', decimal2(total));
        r.set('totalPaidLeavePercentage', decimalPercentage(total / workDaysPerYear));
        r.set('netEmployeeProductiveDaysPerYear', decimal2(workDaysPerYear - total));

        var employeeHoursPerDay = r.get('employeeHoursPerDay');
        if (employeeHoursPerDay) {
            var approximateStaffingInFTERequired = r.get('totalWeeklyStaffingHours') / (r.get('employeeHoursPerDay') * 5) * (workDaysPerYear / (workDaysPerYear - total));
            r.set('approximateStaffingInFTERequired', decimal2(approximateStaffingInFTERequired));
        } else
            r.set('approximateStaffingInFTERequired', 0);

        // tab 6
        r.set('laborStandardBeforeShortStaffing', r.get('totalWeeklyStaffingHours') * 52);
        r.set('totalTrainingHours', r.get('projectedNewEmployees') * r.get('projectedEmployeeTrainingHours'));
        r.set('productiveLaborStandard', r.get('laborStandardBeforeShortStaffing') + r.get('totalTrainingHours'));

        r.set('nonReplaceSickPayCount', r.get('productiveLaborStandard') * r.get('sickDaysTakenPercentage') * r.get('nonReplaceSickPayPerc') / 10000);
        r.set('nonReplaceVacationCount', r.get('productiveLaborStandard') * r.get('vacationEarnedPercentage') * r.get('nonReplaceVacationPerc') / 10000);
        r.set('nonReplaceHolidayCount', r.get('productiveLaborStandard') * r.get('legalHolidaysPercentage') * r.get('nonReplaceHolidayPerc') / 10000);
        r.set('nonReplacePersonalCount', r.get('productiveLaborStandard') * r.get('personalDaysPercentage') * r.get('nonReplacePersonalPerc') / 10000);

        r.set('totalShortStaffing', r.get('nonReplaceSickPayCount') + r.get('nonReplaceVacationCount') + r.get('nonReplaceHolidayCount') + r.get('nonReplacePersonalCount'));
        r.set('productiveLaborStandards', r.get('productiveLaborStandard') - r.get('totalShortStaffing'));

        r.set('shortStaffingOnLegalHolidays', r.get('totalStaffingLegalHolidays') * r.get('legalHolidays'));
        r.set('netProductiveStandard', r.get('productiveLaborStandards') - r.get('shortStaffingOnLegalHolidays'));

        r.set('sickPayStandard', Math.round(r.get('netProductiveStandard') * r.get('sickDaysTakenPercentage') / 100));
        r.set('legalHolidayStandard', Math.round(r.get('netProductiveStandard') * r.get('legalHolidaysPercentage') / 100));
        r.set('personalLeaveStandard', Math.round(r.get('netProductiveStandard') * r.get('personalDaysPercentage') / 100));
        r.set('vacationAccrualStandard', Math.round(r.get('netProductiveStandard') * r.get('vacationEarnedPercentage') / 100));
        r.set('paidLeaveStandards', r.get('sickPayStandard') + r.get('legalHolidayStandard') + r.get('personalLeaveStandard') + r.get('vacationAccrualStandard'));

        r.set('total52WeekPaidHoursStandard', r.get('paidLeaveStandards') + r.get('netProductiveStandard'));


        ///tab 7
        r.set('totalIncreaseInWageCost', r.get('totalWorkedHoursPerPayPeriod') * r.get('meritIncreasePerHour'));
        r.set('avgWageRateReduction', r.get('avgWageRate') - r.get('startingWageRate'));
        r.set('decreaseInWageRate', r.get('employeesLeaving') * r.get('avgWageRateReduction')
                                            * r.get('totalWorkedHoursPerPayPeriod') / r.get('totalEmployees'));
        r.set('avgWageRateNetEffect', (r.get('totalIncreaseInWageCost') - r.get('decreaseInWageRate'))
                                            / r.get('totalWorkedHoursPerPayPeriod'));

        r.set('projectedAvgWageRate', r.get('avgWageRateNetEffect') + r.get('avgWageRate'));
        r.set('estimatedCOLAvgWageRate', r.get('projectedAvgWageRate') + r.get('estimatedCOLIncreasePerHour'));

        r.set('paidLeaveNoNightDifferential', r.get('avgWageRateNetEffect') + r.get('avgWageRateExcludingDifferential'));
        r.set('avgWageRateCOLNoNightDifferential', r.get('paidLeaveNoNightDifferential') + r.get('estimatedCOLIncreasePerHour'));
        /*
        
        { name: 'totalIncreaseInWageCost', type: 'float' },
        { name: 'avgWageRateReduction', type: 'float' },
        //{ name: 'startingWageRate', type: 'float' },
        {name: 'decreaseInWageRate', type: 'float' },
        { name: 'avgWageRateNetEffect', type: 'float' },
        { name: 'projectedAvgWageRate', type: 'float' },
        { name: 'estimatedCOLAvgWageRate', type: 'float' },
        { name: 'paidLeaveNoNightDifferential', type: 'float' },
        { name: 'avgWageRateCOLNoNightDifferential', type: 'float' }
        */
        //
        r.set('meritIncreasePerHour', decimal2(r.get('meritIncreasePerHour')));
        r.set('employeesLeaving', decimal2(r.get('employeesLeaving')));
        r.set('startingWageRate', decimal2(r.get('startingWageRate')));
        r.set('estimatedCOLPeriodOfIncrease', decimal2(r.get('estimatedCOLPeriodOfIncrease')));
        r.set('estimatedCOLIncreasePerHour', decimal2(r.get('estimatedCOLIncreasePerHour')));
//        console.log(r.data);
        this.resumeEvents();
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear };
    },

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,


    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudLaborCalculationStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'sickDays', mapping: '@sickDays', type: 'float' },
     { name: 'sickDaysTaken', mapping: '@sickDaysTaken', type: 'float' },
     { name: 'sickDaysProjected', mapping: '@sickDaysProjected', type: 'float' },
     { name: 'personalDays', mapping: '@personalDays', type: 'float' },
     { name: 'otherPaidLeave', mapping: '@otherPaidLeave', type: 'float' },
     { name: 'employeeHoursPerDay', mapping: '@employeeHoursPerDay', type: 'float' },
     { name: 'projectedNewEmployees', mapping: '@projectedNewEmployees', type: 'float' },
     { name: 'projectedEmployeeTrainingHours', mapping: '@projectedEmployeeTrainingHours', type: 'float' },
     { name: 'nonReplaceVacationPerc', mapping: '@nonReplaceVacationPerc', type: 'float' },
     { name: 'nonReplaceSickPayPerc', mapping: '@nonReplaceSickPayPerc', type: 'float' },
     { name: 'nonReplaceHolidayPerc', mapping: '@nonReplaceHolidayPerc', type: 'float' },
     { name: 'nonReplacePersonalPerc', mapping: '@nonReplacePersonalPerc', type: 'float' },
     { name: 'meritIncreasePerHour', mapping: '@meritIncreasePerHour', type: 'float' },
     { name: 'employeesLeaving', mapping: '@employeesLeaving', type: 'float' },
     { name: 'startingWageRate', mapping: '@startingWageRate', type: 'float' },
     { name: 'estimatedCOLPeriodOfIncrease', mapping: '@estimatedCOLPeriodOfIncrease', type: 'float' },
     { name: 'estimatedCOLIncreasePerHour', mapping: '@estimatedCOLIncreasePerHour', type: 'float' },

     { name: 'totalWeeklyStaffingHours', type: 'float' },
     { name: 'totalStaffingLegalHolidays', type: 'float' },
     { name: 'totalWorkedHoursPerPayPeriod', type: 'float' },


     { name: 'legalHolidays', type: 'float' },
     { name: 'vacationEarned', type: 'float' },
     { name: 'totalPaidLeave', type: 'float' },
     { name: 'sickDaysTakenPercentage', type: 'float' },
     { name: 'legalHolidaysPercentage', type: 'float' },
     { name: 'personalDaysPercentage', type: 'float' },
     { name: 'otherPaidLeavePercentage', type: 'float' },
     { name: 'vacationEarnedPercentage', type: 'float' },
     { name: 'totalPaidLeavePercentage', type: 'float' },

     { name: 'totalPaidLeave', type: 'float' },
     { name: 'netEmployeeProductiveDaysPerYear', type: 'float' },
     { name: 'hoursPerDayPerEmployee', type: 'float' },
     { name: 'approximateStaffingInFTERequired', type: 'float' },
    // { name: 'staffingWeeklyTotal', type: 'float' },

    // #tab 6 fields
     {name: 'laborStandardBeforeShortStaffing', type: 'float' },
     { name: 'totalTrainingHours', type: 'float' },
     { name: 'productiveLaborStandard', type: 'float' },

     { name: 'nonReplaceVacationCount', type: 'float' },
     { name: 'nonReplaceSickPayCount', type: 'float' },
     { name: 'nonReplaceHolidayCount', type: 'float' },
     { name: 'nonReplacePersonalCount', type: 'float' },
     { name: 'totalShortStaffing', type: 'float' },
     { name: 'productiveLaborStandards', type: 'float' },

     { name: 'shortStaffingOnLegalHolidays', type: 'float' },
     { name: 'netProductiveStandard', type: 'float' },
     { name: 'sickPayStandard', type: 'float' },
     { name: 'legalHolidayStandard', type: 'float' },
     { name: 'personalLeaveStandard', type: 'float' },
     { name: 'vacationAccrualStandard', type: 'float' },
     { name: 'paidLeaveStandards', type: 'float' },
     { name: 'total52WeekPaidHoursStandard', type: 'float' },

    ///tab 7
     {name: 'avgWageRate', type: 'float' },
     { name: 'avgWageRateExcludingDifferential', type: 'float' },
     { name: 'meritIncreaseEmployees', type: 'float' },
     { name: 'totalEmployees', type: 'float' },
     { name: 'totalIncreaseInWageCost', type: 'float' },
     { name: 'avgWageRateReduction', type: 'float' },
    //{ name: 'startingWageRate', type: 'float' },
     {name: 'decreaseInWageRate', type: 'float' },
     { name: 'avgWageRateNetEffect', type: 'float' },
     { name: 'projectedAvgWageRate', type: 'float' },
     { name: 'estimatedCOLAvgWageRate', type: 'float' },
     { name: 'paidLeaveNoNightDifferential', type: 'float' },
     { name: 'avgWageRateCOLNoNightDifferential', type: 'float' }

    ]
});


WebLight.namespace('Bud.data');

Bud.data.BudFinalLaborStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    constructor: function (config) {
        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@id',
            fields: [
               { name: 'id', mapping: '@id', type: 'float' },
               { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
               { name: 'title', mapping: '@title' },
               { name: 'period1', mapping: '@period1', type: 'float' },
               { name: 'period2', mapping: '@period2', type: 'float' },
               { name: 'period3', mapping: '@period3', type: 'float' },
               { name: 'period4', mapping: '@period4', type: 'float' },
               { name: 'period5', mapping: '@period5', type: 'float' },
               { name: 'period6', mapping: '@period6', type: 'float' },
               { name: 'period7', mapping: '@period7', type: 'float' },
               { name: 'period8', mapping: '@period8', type: 'float' },
               { name: 'period9', mapping: '@period9', type: 'float' },
               { name: 'period10', mapping: '@period10', type: 'float' },
               { name: 'period11', mapping: '@period11', type: 'float' },
               { name: 'period12', mapping: '@period12', type: 'float' },
               { name: 'period13', mapping: '@period13', type: 'float' },
               { name: 'fscYear', mapping: '@fscYear', type: 'float' },
               { name: 'hcmJob', mapping: '@hcmJob', type: 'float' }
           ]
        });
        Bud.data.BudFinalLaborStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });

    },
    storeId: 'budFinalLabors',

    getCriteria: function () {
        return { hcmHouseCode: this._HcmHouseCode, hcmJob: this._HcmJob, fscYear: this._FscYear };
    },

    _HcmHouseCode: 0,
    _HcmJob: 0,
    _FscYear: 0,

    setContext: function (HcmHouseCode, HcmJob, FscYear) {

        this._FscYear = FscYear;
        this._HcmHouseCode = HcmHouseCode;
        this._HcmJob = HcmJob;
    },


    load: function (HcmHouseCode, HcmJob, FscYear) {
        this.setContext(HcmHouseCode, HcmJob, FscYear);

        Bud.data.BudFinalLaborStore.superclass.load.call(this);
    },

    updateTotals: function () {
        this.suspendEvents(false);

        this.resumeEvents();
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._HcmHouseCode, hcmJob: this._HcmJob, fscYear: this._FscYear });
    }

});



WebLight.namespace('Bud.data');

Bud.data.BudFinalLaborCalculationSummaryStore = WebLight.extend(Bud.data.XmlStore, {

    constructor: function (config) {
        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@rowId',
            fields: [
               { name: 'rowId', mapping: '@rowId', type: 'float' },
               { name: 'description', mapping: '@description' },
               { name: 'period1', mapping: '@period1', type: 'float' },
               { name: 'period2', mapping: '@period2', type: 'float' },
               { name: 'period3', mapping: '@period3', type: 'float' },
               { name: 'period4', mapping: '@period4', type: 'float' },
               { name: 'period5', mapping: '@period5', type: 'float' },
               { name: 'period6', mapping: '@period6', type: 'float' },
               { name: 'period7', mapping: '@period7', type: 'float' },
               { name: 'period8', mapping: '@period8', type: 'float' },
               { name: 'period9', mapping: '@period9', type: 'float' },
               { name: 'period10', mapping: '@period10', type: 'float' },
               { name: 'period11', mapping: '@period11', type: 'float' },
               { name: 'period12', mapping: '@period12', type: 'float' },
               { name: 'period13', mapping: '@period13', type: 'float' },
               { name: 'period14', mapping: '@period14', type: 'float' },
               { name: 'period15', mapping: '@period15', type: 'float' },
               { name: 'period16', mapping: '@period16', type: 'float' },
               { name: 'fscYear', mapping: '@fscYear', type: 'float' }
           ]
        });
        Bud.data.BudFinalLaborCalculationSummaryStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });

    },

    // labor Calc. VII labor standards.Sub-Total of Productive labor standards
    productiveLaborStandards: 0,

    totalLegalHolidays: 0,
    //Employee.II. Staffing Hours Summary Worksheet . 
    //Short Staffing Reduction or (Increase) on Legal Holidays * Labor Calc.II legal holidays
    shortStaffingOnLegalHolidays: 0,

    //Labor Calc.VIII Labor Standard in dollars. C. Projected Avg Wage Rate before cost of living increase including differentia
    projectedAvgWageRate: 0,

    /// Labor Calc.VIII Labor Standard in dollars.
    // Estimated date of increase (period)
    estimatedCOLPeriodOfIncrease: 0,
    // Estimated increase per hour
    estimatedCOLIncreasePerHour: 0,

    //Labor Calc. VIII Labor standard in dollars. F. Paid Leave does not get Evening Shift Differential 
    paidLeaveNoNightDifferential: 0,
    //Labor Calc. V. Computation Of Net Productive Days Per Employee. Sick days taken Percentage
    sickDaysTakenPercentage: 0,
    //Labor Calc. V. Computation Of Net Productive Days Per Employee. Personal Days Percentage + Other paid leave percentage
    personalDaysPercentage: 0,
    otherPaidLeavePercentage: 0,

    // Labor Calc. Vii.Labor standards. E. computation of paid leave Standard.Legal holiday standard
    // Labor Calc. II Legal holidays. Row count of legal holidays * average wage rate for paid leave * number of holiday In the period
    legalHolidayStandard: 0,
    legalHolidaysPercentage: 0,

    //Labor Calc. V. computation of net productive days per employee. Paid leave. Vacation Earned percentage
    vacationEarnedPercentage: 0,

    legalHolidayMix: null,


    applyUserInputData: function (rec13, rec51, rec52, rec54) {
        this.suspendEvents(false);
        var r13 = this.getById(13);
        var r51 = this.getById(51);
        var r52 = this.getById(52);
        var r54 = this.getById(54);
        for (var i = 0; i < 12; i++) {
            var field = String.format('period{0}', i + 1);
            if (r13 && rec13)
                r13.set(field, rec13.get(field));
            if (r51 && rec51)
                r51.set(field, rec51.get(field));
            if (r52 && rec52)
                r52.set(field, rec52.get(field));
            if (r54 && rec54)
                r54.set(field, rec54.get(field));
        }
        this.resumeEvents();
        //this.updateTotals();
    },

    fscPeriodStore: null,


    updateTotals: function () {
        var me = this;
        this.suspendEvents(false);
        if (this.legalHolidayMix) {
            var decimal2 = function (d) {
                return Math.round(d * 100) / 100;
            }
            var rec1 = this.getById(1);
            console.log('productiveLaborStandards', this.productiveLaborStandards);

            /* changes 2012/3/16
            Hourly
            100000 / 364 * 31 = 8516.48
            The work days will be replaced with the number of “days” in a year. This number of “days” is taking the number of weeks (52) multiplied by number of days in a week (7) = 364
            The number of work days in a period is replaced with the number of days in a period. October has 31 days, November has 30, December 31 etc

            */
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                //var v = this.productiveLaborStandards / me.fscPeriodStore.getTotalBusinessDays() * me.fscPeriodStore.getBusinessDaysByTitle(i + 1);
                var v = this.productiveLaborStandards / Bud.Context.ytdBusinessDays4Final *
                        ((Bud.Context.primaryNav && Bud.Context.primaryNav.currentBudgetLaborCalcMethod == 1) ? me.fscPeriodStore.getDaysByTitle(i + 1) : me.fscPeriodStore.getBusinessDaysByTitle(i + 1));
                rec1.set(field, decimal2(v));
            }

            var rec2 = this.getById(2);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = 0;
                if (this.totalLegalHolidays > 0)
                    v = (this.shortStaffingOnLegalHolidays || 0) / this.totalLegalHolidays * this.legalHolidayMix.get(i + 1);
                rec2.set(field, decimal2(v));
            }

            var rec3 = this.getById(3);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec1.get(field) - rec2.get(field);
                rec3.set(field, decimal2(v));
            }

            var rec4 = this.getById(4);
            for (var i = 0; i < 12; i++) {
                var v = this.projectedAvgWageRate;
                if (i + 1 >= this.estimatedCOLPeriodOfIncrease)
                    v += this.estimatedCOLIncreasePerHour;
                rec4.set(String.format('period{0}', i + 1), decimal2(v));
            }

            var rec5 = this.getById(5);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec3.get(field) * rec4.get(field);
                rec5.set(field, decimal2(v));
            }

            var rec6 = this.getById(6);
            for (var i = 0; i < 12; i++) {

                var v = this.paidLeaveNoNightDifferential;
                if (i + 1 >= this.estimatedCOLPeriodOfIncrease)
                    v += this.estimatedCOLIncreasePerHour;
                rec6.set(String.format('period{0}', i + 1), decimal2(v));
            }

            var rec7 = this.getById(7);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec3.get(field) * rec6.get(field);
                rec7.set(field, decimal2(v));
            }

            var rec8 = this.getById(8);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec7.get(field) * this.sickDaysTakenPercentage / 100;
                rec8.set(field, decimal2(v));
            }

            var rec9 = this.getById(9);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec7.get(field) * (this.otherPaidLeavePercentage + this.personalDaysPercentage) / 100;
                rec9.set(field, decimal2(v));
            }

            var rec10 = this.getById(10);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                //console.log(i, this.legalHolidayStandard, this.totalLegalHolidays, rec6.get(field), this.legalHolidayMix.get('' + (i + 1)));
                var v = 0;
                if (this.totalLegalHolidays > 0)
                    v = (this.legalHolidayStandard || 0) / this.totalLegalHolidays * rec6.get(field) * (this.legalHolidayMix.get('' + (i + 1)) || 0);
                rec10.set(field, decimal2(v));
            }

            var rec11 = this.getById(11);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec8.get(field) + rec9.get(field) + rec10.get(field);
                rec11.set(field, decimal2(v));
            }


            var rec13 = this.getById(13);

            var rec14 = this.getById(14);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var v = rec4.get(field) * rec13.get(field) * 1.5;
                rec14.set(field, decimal2(v));
            }



            /*
            a.	Project Work Wage Rate (user input data)
            b.	Non-Chargeable Project Work (user input data)
            c.	Non-Chargeable Project Work Subtotal ( wage rate * Non-Chargeable Project Work)
            d.	Chargeable Project Work (user input data)
            e.	Chargeable Project Work Subtotal (wage rate * Chargeable Project Work)
            */

            var rec51 = this.getById(51);
            var rec52 = this.getById(52);
            var rec53 = this.getById(53);
            var rec54 = this.getById(54);
            var rec55 = this.getById(55);

            if (rec51) {
                for (var i = 0; i < 12; i++) {
                    var field = String.format('period{0}', i + 1);
                    rec53.set(field, decimal2(rec51.get(field) * rec52.get(field)));
                    rec55.set(field, decimal2(rec51.get(field) * rec54.get(field)));
                }
            }


            //Vacation Pay Accrual
            var rec12 = this.getById(12);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                var baseValue = rec5.get(field);
                if (Bud.Context.primaryNav.currentHouseCodeTypeId == 1 && Bud.Context.primaryNav.currentBudgetTemplateId == 4) {
                    baseValue = rec5.get(field) + rec11.get(field) + rec14.get(field)
                        + (rec53 ? rec53.get(field) : 0) + (rec55 ? rec55.get(field) : 0);
                }

                var v = baseValue * this.vacationEarnedPercentage / 100;
                rec12.set(field, decimal2(v));
            }

            var rec99 = this.getById(99);
            for (var i = 0; i < 12; i++) {

                //, the final labor calc total should be:
                //  Prod Labor Standard Cost +     Sub-Total Paid Leave + Vacation Pay Accrual + Cost associated with overtime

                var field = String.format('period{0}', i + 1);
                var v = rec5.get(field) + rec11.get(field) + rec12.get(field) + rec14.get(field)
                                + (rec53 ? rec53.get(field) : 0) + (rec55 ? rec55.get(field) : 0);
                rec99.set(field, decimal2(v));
            }

            var recs = this.getRange();
            Ext.each(recs, function (record, index) {
                var total = 0;
                for (var i = 0; i < 12; i++) {
                    var field = String.format('period{0}', i + 1);
                    total += parseFloat(record.get(field));
                }
                record.set('fscYear', total);
            });
        }
        this.resumeEvents();
        this.fireEvent('datarefresh');
    },

    loadSampleData: function () {
        this.loadData(_builtInTemplate_6091cb6c[4]);
    },
    loadSampleData4Retail: function () {
        this.loadData(_builtInTemplate_6091cb6c[5]);
    }
});


/// <reference path="XmlStore.js" />

Bud.data.BudProductiveEmployeesInsuranceStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budProductiveEmployeesInsurances',

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear };
    },

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,

    constructor: function (config) {
        Bud.data.BudProductiveEmployeesInsuranceStore.superclass.constructor.call(this, config);
        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });
    },

    updateTotals: function () {
        this.suspendEvents(false);

        for (var i = 0; i < this.getCount(); i++) {
            var r = this.getAt(i);

            r.set('singleTotalCount', r.get('singleHMOCount') + r.get('singlePOSCount') + r.get('singleMedical3Count') + r.get('singleMedical4Count') + r.get('singleMedical5Count')
                                        + r.get('singleLibertyCount') + r.get('singleDentalCount'));
            r.set('singleTotalCost', r.get('singleHMOCost') + r.get('singlePOSCost') + r.get('singleLibertyCost') + r.get('singleDentalCost'))
                                + +r.get('singleMedical3Cost') + r.get('singleMedical4Cost') + r.get('singleMedical5Cost');

            r.set('singleSpouseTotalCount', r.get('singleSpouseHMOCount') + r.get('singleSpousePOSCount') + r.get('singleSpouseMedical3Count') + r.get('singleSpouseMedical4Count') + r.get('singleSpouseMedical5Count')
                                        + r.get('singleSpouseLibertyCount') + r.get('singleSpouseDentalCount'));

            r.set('singleSpouseTotalCost', r.get('singleSpouseHMOCost') + r.get('singleSpousePOSCost') + r.get('singleSpouseLibertyCost') + r.get('singleSpouseDentalCost'))
                                + +r.get('singleSpouseMedical3Cost') + r.get('singleSpouseMedical4Cost') + r.get('singleSpouseMedical5Cost');

            r.set('singleDependantTotalCount', r.get('singleDependantHMOCount') + r.get('singleDependantPOSCount') + r.get('singleDependantMedical3Count') + r.get('singleDependantMedical4Count') + r.get('singleDependantMedical5Count')
                                        + r.get('singleDependantLibertyCount') + r.get('singleDependantDentalCount'));

            r.set('singleDependantTotalCost', r.get('singleDependantHMOCost') + r.get('singleDependantPOSCost') + r.get('singleDependantLibertyCost') + r.get('singleDependantDentalCost'))
                                + +r.get('singleDependantMedical3Cost') + r.get('singleDependantMedical4Cost') + r.get('singleDependantMedical5Cost');

            r.set('familyTotalCount', r.get('familyHMOCount') + r.get('familyPOSCount') + r.get('familyMedical3Count') + r.get('familyMedical4Count') + r.get('familyMedical5Count')
                                         + r.get('familyLibertyCount') + r.get('familyDentalCount'));
            r.set('familyTotalCost', r.get('familyHMOCost') + r.get('familyPOSCost') + r.get('familyLibertyCost') + r.get('familyDentalCost'))
                                + +r.get('familyMedical3Cost') + r.get('familyMedical4Cost') + r.get('familyMedical5Cost');

            r.set('totalHMOCount', r.get('singleHMOCount') + r.get('singleSpouseHMOCount') + r.get('singleDependantHMOCount') + r.get('familyHMOCount'));
            r.set('totalPOSCount', r.get('singlePOSCount') + r.get('singleSpousePOSCount') + r.get('singleDependantPOSCount') + r.get('familyPOSCount'));
            r.set('totalMedical3Count', r.get('singleMedical3Count') + r.get('singleSpouseMedical3Count') + r.get('singleDependantMedical3Count') + r.get('familyMedical3Count'));
            r.set('totalMedical4Count', r.get('singleMedical4Count') + r.get('singleSpouseMedical4Count') + r.get('singleDependantMedical4Count') + r.get('familyMedical4Count'));
            r.set('totalMedical5Count', r.get('singleMedical5Count') + r.get('singleSpouseMedical5Count') + r.get('singleDependantMedical5Count') + r.get('familyMedical5Count'));
            r.set('totalLibertyCount', r.get('singleLibertyCount') + r.get('singleSpouseLibertyCount') + r.get('singleDependantLibertyCount') + r.get('familyLibertyCount'));
            r.set('totalDentalCount', r.get('singleDentalCount') + r.get('singleSpouseDentalCount') + r.get('singleDependantDentalCount') + r.get('familyDentalCount'));
            r.set('totalLifeCount', r.get('singleLifeCount') + r.get('singleSpouseLifeCount') + r.get('singleDependantLifeCount') + r.get('familyLifeCount'));
            r.set('totalUnionCount', r.get('singleUnionCount') + r.get('singleSpouseUnionCount') + r.get('singleDependantUnionCount') + r.get('familyUnionCount'));
            r.set('totalCount', r.get('singleTotalCount') + r.get('singleSpouseTotalCount') + r.get('singleDependantTotalCount') + r.get('familyTotalCount'));

            r.set('totalHMOCost', r.get('singleHMOCost') + r.get('singleSpouseHMOCost') + r.get('singleDependantHMOCost') + r.get('familyHMOCost'));
            r.set('totalPOSCost', r.get('singlePOSCost') + r.get('singleSpousePOSCost') + r.get('singleDependantPOSCost') + r.get('familyPOSCost'));
            r.set('totalMedical3Cost', r.get('singleMedical3Cost') + r.get('singleSpouseMedical3Cost') + r.get('singleDependantMedical3Cost') + r.get('familyMedical3Cost'));
            r.set('totalMedical4Cost', r.get('singleMedical4Cost') + r.get('singleSpouseMedical4Cost') + r.get('singleDependantMedical4Cost') + r.get('familyMedical4Cost'));
            r.set('totalMedical5Cost', r.get('singleMedical5Cost') + r.get('singleSpouseMedical5Cost') + r.get('singleDependantMedical5Cost') + r.get('familyMedical5Cost'));
            r.set('totalLibertyCost', r.get('singleLibertyCost') + r.get('singleSpouseLibertyCost') + r.get('singleDependantLibertyCost') + r.get('familyLibertyCost'));
            r.set('totalDentalCost', r.get('singleDentalCost') + r.get('singleSpouseDentalCost') + r.get('singleDependantDentalCost') + r.get('familyDentalCost'));
            r.set('totalLifeCost', r.get('singleLifeCost') + r.get('singleSpouseLifeCost') + r.get('singleDependantLifeCost') + r.get('familyLifeCost'));
            r.set('totalUnionCost', r.get('singleUnionCost') + r.get('singleSpouseUnionCost') + r.get('singleDependantUnionCost') + r.get('familyUnionCost'));
            r.set('totalCost', r.get('singleTotalCost') + r.get('singleSpouseTotalCost') + r.get('singleDependantTotalCost') + r.get('familyTotalCost'));
        }

        this.resumeEvents();
    },


    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudProductiveEmployeesInsuranceStore.superclass.load.call(this);
    },

    newRecord: function (data) {
        data = data || {};

        Ext.applyIf(data, {
            singleHMOCount: 0, singlePOSCount: 0, singleLibertyCount: 0, singleDentalCount: 0, singleLifeCount: 0, singleUnionCount: 0,
            singleHMOCost: 0, singlePOSCost: 0, singleLibertyCost: 0, singleDentalCost: 0, singleLifeCost: 0, singleUnionCost: 0,
            familyHMOCount: 0, familyPOSCount: 0, familyLibertyCount: 0, familyDentalCount: 0, familyLifeCount: 0, familyUnionCount: 0,
            familyHMOCost: 0, familyPOSCost: 0, familyLibertyCost: 0, familyDentalCost: 0, familyLifeCost: 0, familyUnionCost: 0
        });

        return Bud.data.BudProductiveEmployeesInsuranceStore.superclass.newRecord.call(this, data);
    },


    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },

     { name: 'singleHMOCount', mapping: '@singleHMOCount', type: 'float' },
     { name: 'singlePOSCount', mapping: '@singlePOSCount', type: 'float' },
     { name: 'singleMedical3Count', mapping: '@singleMedical3Count', type: 'float' },
     { name: 'singleMedical4Count', mapping: '@singleMedical4Count', type: 'float' },
     { name: 'singleMedical5Count', mapping: '@singleMedical5Count', type: 'float' },
     { name: 'singleLibertyCount', mapping: '@singleLibertyCount', type: 'float' },
     { name: 'singleDentalCount', mapping: '@singleDentalCount', type: 'float' },
     { name: 'singleLifeCount', mapping: '@singleLifeCount', type: 'float' },
     { name: 'singleUnionCount', mapping: '@singleUnionCount', type: 'float' },

     { name: 'singleTotalCount', type: 'float' },

     { name: 'singleHMOCost', mapping: '@singleHMOCost', type: 'float' },
     { name: 'singlePOSCost', mapping: '@singlePOSCost', type: 'float' },
     { name: 'singleMedical3Cost', mapping: '@singleMedical3Cost', type: 'float' },
     { name: 'singleMedical4Cost', mapping: '@singleMedical4Cost', type: 'float' },
     { name: 'singleMedical5Cost', mapping: '@singleMedical5Cost', type: 'float' },
     { name: 'singleLibertyCost', mapping: '@singleLibertyCost', type: 'float' },
     { name: 'singleDentalCost', mapping: '@singleDentalCost', type: 'float' },
     { name: 'singleLifeCost', mapping: '@singleLifeCost', type: 'float' },
     { name: 'singleUnionCost', mapping: '@singleUnionCost', type: 'float' },

     { name: 'singleTotalCost', type: 'float' },

       { name: 'singleSpouseHMOCount', mapping: '@singleSpouseHMOCount', type: 'float' },
     { name: 'singleSpousePOSCount', mapping: '@singleSpousePOSCount', type: 'float' },
     { name: 'singleSpouseMedical3Count', mapping: '@singleSpouseMedical3Count', type: 'float' },
     { name: 'singleSpouseMedical4Count', mapping: '@singleSpouseMedical4Count', type: 'float' },
     { name: 'singleSpouseMedical5Count', mapping: '@singleSpouseMedical5Count', type: 'float' },
     { name: 'singleSpouseLibertyCount', mapping: '@singleSpouseLibertyCount', type: 'float' },
     { name: 'singleSpouseDentalCount', mapping: '@singleSpouseDentalCount', type: 'float' },
     { name: 'singleSpouseLifeCount', mapping: '@singleSpouseLifeCount', type: 'float' },
     { name: 'singleSpouseUnionCount', mapping: '@singleSpouseUnionCount', type: 'float' },

     { name: 'singleSpouseTotalCount', type: 'float' },

    { name: 'singleSpouseHMOCost', mapping: '@singleSpouseHMOCost', type: 'float' },
     { name: 'singleSpousePOSCost', mapping: '@singleSpousePOSCost', type: 'float' },
     { name: 'singleSpouseMedical3Cost', mapping: '@singleSpouseMedical3Cost', type: 'float' },
     { name: 'singleSpouseMedical4Cost', mapping: '@singleSpouseMedical4Cost', type: 'float' },
     { name: 'singleSpouseMedical5Cost', mapping: '@singleSpouseMedical5Cost', type: 'float' },
     { name: 'singleSpouseLibertyCost', mapping: '@singleSpouseLibertyCost', type: 'float' },
     { name: 'singleSpouseDentalCost', mapping: '@singleSpouseDentalCost', type: 'float' },
     { name: 'singleSpouseLifeCost', mapping: '@singleSpouseLifeCost', type: 'float' },
     { name: 'singleSpouseUnionCost', mapping: '@singleSpouseUnionCost', type: 'float' },

     { name: 'singleSpouseTotalCost', type: 'float' },

       { name: 'singleDependantHMOCount', mapping: '@singleDependantHMOCount', type: 'float' },
     { name: 'singleDependantPOSCount', mapping: '@singleDependantPOSCount', type: 'float' },
     { name: 'singleDependantMedical3Count', mapping: '@singleDependantMedical3Count', type: 'float' },
     { name: 'singleDependantMedical4Count', mapping: '@singleDependantMedical4Count', type: 'float' },
     { name: 'singleDependantMedical5Count', mapping: '@singleDependantMedical5Count', type: 'float' },
     { name: 'singleDependantLibertyCount', mapping: '@singleDependantLibertyCount', type: 'float' },
     { name: 'singleDependantDentalCount', mapping: '@singleDependantDentalCount', type: 'float' },
     { name: 'singleDependantLifeCount', mapping: '@singleDependantLifeCount', type: 'float' },
     { name: 'singleDependantUnionCount', mapping: '@singleDependantUnionCount', type: 'float' },

     { name: 'singleDependantTotalCount', type: 'float' },

    { name: 'singleDependantHMOCost', mapping: '@singleDependantHMOCost', type: 'float' },
     { name: 'singleDependantPOSCost', mapping: '@singleDependantPOSCost', type: 'float' },
     { name: 'singleDependantMedical3Cost', mapping: '@singleDependantMedical3Cost', type: 'float' },
     { name: 'singleDependantMedical4Cost', mapping: '@singleDependantMedical4Cost', type: 'float' },
     { name: 'singleDependantMedical5Cost', mapping: '@singleDependantMedical5Cost', type: 'float' },
     { name: 'singleDependantLibertyCost', mapping: '@singleDependantLibertyCost', type: 'float' },
     { name: 'singleDependantDentalCost', mapping: '@singleDependantDentalCost', type: 'float' },
     { name: 'singleDependantLifeCost', mapping: '@singleDependantLifeCost', type: 'float' },
     { name: 'singleDependantUnionCost', mapping: '@singleDependantUnionCost', type: 'float' },

     { name: 'singleDependantTotalCost', type: 'float' },

     { name: 'familyHMOCount', mapping: '@familyHMOCount', type: 'float' },
     { name: 'familyPOSCount', mapping: '@familyPOSCount', type: 'float' },
      { name: 'familyMedical3Count', mapping: '@familyMedical3Count', type: 'float' },
      { name: 'familyMedical4Count', mapping: '@familyMedical4Count', type: 'float' },
      { name: 'familyMedical5Count', mapping: '@familyMedical5Count', type: 'float' },
    { name: 'familyLibertyCount', mapping: '@familyLibertyCount', type: 'float' },
     { name: 'familyDentalCount', mapping: '@familyDentalCount', type: 'float' },
     { name: 'familyLifeCount', mapping: '@familyLifeCount', type: 'float' },
     { name: 'familyUnionCount', mapping: '@familyUnionCount', type: 'float' },

      { name: 'familyTotalCount', type: 'float' },

     { name: 'familyHMOCost', mapping: '@familyHMOCost', type: 'float' },
     { name: 'familyPOSCost', mapping: '@familyPOSCost', type: 'float' },
     { name: 'familyMedical3Cost', mapping: '@familyMedical3Cost', type: 'float' },
     { name: 'familyMedical4Cost', mapping: '@familyMedical4Cost', type: 'float' },
     { name: 'familyMedical5Cost', mapping: '@familyMedical5Cost', type: 'float' },
     { name: 'familyLibertyCost', mapping: '@familyLibertyCost', type: 'float' },
     { name: 'familyDentalCost', mapping: '@familyDentalCost', type: 'float' },
     { name: 'familyLifeCost', mapping: '@familyLifeCost', type: 'float' },
     { name: 'familyUnionCost', mapping: '@familyUnionCost', type: 'float' },

     { name: 'familyTotalCost', type: 'float' },

     { name: 'totalHMOCount', type: 'float' },
     { name: 'totalPOSCount', type: 'float' },
       { name: 'totalMedical3Count', type: 'float' },
       { name: 'totalMedical4Count', type: 'float' },
       { name: 'totalMedical5Count', type: 'float' },
   { name: 'totalLibertyCount', type: 'float' },
     { name: 'totalDentalCount', type: 'float' },
     { name: 'totalLifeCount', type: 'float' },
     { name: 'totalUnionCount', type: 'float' },

      { name: 'totalCount', type: 'float' },

     { name: 'totalHMOCost', type: 'float' },
     { name: 'totalPOSCost', type: 'float' },
       { name: 'totalMedical3Cost', type: 'float' },
       { name: 'totalMedical4Cost', type: 'float' },
       { name: 'totalMedical5Cost', type: 'float' },
     { name: 'totalLibertyCost', type: 'float' },
     { name: 'totalDentalCost', type: 'float' },
     { name: 'totalLifeCost', type: 'float' },
     { name: 'totalUnionCost', type: 'float' },

     { name: 'totalCost', type: 'float' }


    ]
});

/// <reference path="XmlStore.js" />

Bud.data.BudAnnualInformationStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAnnualInformations',

    getCriteria: function () {
        return { fscYear: this._fscYear };
    },

    _fscYear: 0,

    load: function (fscYear) {

        this._fscYear = fscYear;
        Bud.data.BudAnnualInformationStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { fscYear: this._fscYear });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'startDate', mapping: '@startDate', type: 'date' },
     { name: 'cutOffDate', mapping: '@cutOffDate', type: 'date' },
     { name: 'genLiabilityRate', mapping: '@genLiabilityRate', type: 'float' },
     { name: 'genLiabilityAccCodes', mapping: '@genLiabilityAccCodes' },
     { name: 'benefitAdjStartPeriod', mapping: '@benefitAdjStartPeriod', type: 'float' },
     { name: 'benefitAdjEndPeriod', mapping: '@benefitAdjEndPeriod', type: 'float' },
     { name: 'benefitAdjPercent', mapping: '@benefitAdjPercent', type: 'float' },
     { name: 'announcement', mapping: '@announcement' },
     { name: 'retailVacationAccrualPercent', mapping: '@retailVacationAccrualPercent' }
    ]
});

/// <reference path="XmlStore.js" />

Bud.data.BudHolidayStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budHolidays',

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear };
    },

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,

    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudHolidayStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'fscPeriod', mapping: '@fscPeriod', type: 'float' },
     { name: 'title', mapping: '@title', type: 'string' }
    ]
});

/// <reference path="XmlStore.js" />

Bud.data.BudSupplyExpenditureStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budSupplyExpenditures',

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,
    _fscAccount: 0,

    _totalRow: null,

    _addingTotalRow: false,
    _updatingTotals: false,

    constructor: function (config) {
        var me = this;
        Bud.data.BudSupplyExpenditureStore.superclass.constructor.call(this, config);

        me.on('beforeload', function () {
            me._totalRow = me.newRecord({ id: 0, description: 'Total' });
        });


        me.on('load', function () {
            // identify addingTotalRow, skip run updateTotals method
            me._addingTotalRow = true;

            me.add(me._totalRow);
            // ignore total row changes
            me.ignoreRecords(me._totalRow);

            me._addingTotalRow = false;
            // calculate totalrow, apply data summary to totalRow
            me.updateTotals();
        });

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals }

        });
    },

    decimal2: function (v) {
        if (v)
            return Math.round(v * 100) / 100;
        return 0;
    },

    updateTotals: function () {
        var me = this;
       
        if (me._updatingTotals || me._addingTotalRow)
            return;

        me._updatingTotals = true;

        var costPerPeriodTotal = 0;
        var costPerPeriodOverrideTotal = 0;
        var priceDiffTotal = 0;

        for (var i = 0; i < this.getCount() - 1; i++) {
            var record = this.getAt(i);

            var costPerPeriod = record.get('unitPrice') * record.get('usagePerPeriod');
            var costPerPeriodOverride = record.get('unitPrice') * record.get('usagePerPeriodOverride');
            record.set('costPerPeriod', me.decimal2(costPerPeriod));
            record.set('costPerPeriodOverride', me.decimal2(costPerPeriodOverride));
            record.set('qtyDiff', me.decimal2(record.get('usagePerPeriodOverride') - record.get('usagePerPeriod')));
            record.set('priceDiff', me.decimal2(costPerPeriodOverride - costPerPeriod));

            costPerPeriodTotal += costPerPeriod;
            costPerPeriodOverrideTotal += costPerPeriodOverride;
        }

        priceDiffTotal = costPerPeriodOverrideTotal - costPerPeriodTotal;


        this._totalRow.set('costPerPeriod', me.decimal2(costPerPeriodTotal));
        this._totalRow.set('costPerPeriodOverride', me.decimal2(costPerPeriodOverrideTotal));
        this._totalRow.set('priceDiff', me.decimal2(priceDiffTotal));

        me._updatingTotals = false;
    },

    addNew: function () {
        var index = this.getCount() - 1;
        if (index < 0)
            index = 0;
        this.insert(index, this.newRecord({}));
           },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, fscAccount: this._fscAccount };
    },

    load: function (hcmHouseCode, hcmJob, fscYear, fscAccount) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;
        this._fscAccount = fscAccount;

        Bud.data.BudSupplyExpenditureStore.superclass.load.call(this);
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'poItemID', mapping: '@poItemID', type: 'int' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'entAt', mapping: '@entAt', type: 'date', dateFormat: 'n/j/Y' },
     { name: 'entBy', mapping: '@entBy', type: 'string' },
     { name: 'fscAccount', mapping: '@fscAccount', type: 'int' },
     { name: 'description', mapping: '@description', type: 'string' },
     { name: 'unit', mapping: '@unit', type: 'string' },
     { name: 'unitPrice', mapping: '@unitPrice', type: 'float' },
     { name: 'usagePerPeriod', mapping: '@usagePerPeriod', type: 'int' },
     { name: 'usagePerPeriodOverride', mapping: '@usagePerPeriodOverride', type: 'float' },
     { name: 'costPerPeriod', type: 'float' },
     { name: 'costPerPeriodOverride', type: 'float' },
     { name: 'qtyDiff', type: 'float' },
     { name: 'priceDiff', type: 'float' }
    ],

    newRecord: function (data) {
        data = data || {};

        Ext.applyIf(data, { description: '', unit: '',
            unitPrice: 0, usagePerPeriod: 0, usagePerPeriodOverride: 0
        });

        return Bud.data.BudSupplyExpenditureStore.superclass.newRecord.call(this, data);
    },


    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, fscAccount: this._fscAccount });
    }
});

/// <reference path="XmlStore.js" />

Bud.data.BudCapitalExpenditureStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budCapitalExpenditures',

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,
    _capitalType: 0,

    constructor: function (config) {
        var me = this;
        Bud.data.BudCapitalExpenditureStore.superclass.constructor.call(this, config);

        this._totalRow = this.newRecord({ id: 0, description: 'Total' });
        this.on('datachanged', function () {
            me.suspendEvents(false);

            if (me.indexOf(me._totalRow) < 0) {
                me.add(me._totalRow);
            }

            me.resumeEvents();
        });

        this.on({
            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });
    },

    _totalRow: null,
    decimal2: function (v) {
        if (v)
            return Math.round(v * 100) / 100;
        return 0;
    },

    updateTotals: function () {
        var me = this;

        this.suspendEvents(false);

        var totalCost = 0;
        var totalDepreciationPerPeriod = 0;
        var totalcost = 0;
        var totalPeriodDepreciation = 0;

        for (var i = 0; i < this.getCount() - 1; i++) {
            var record = this.getAt(i);
            var depreciationPerPeriod = 0;
            if (record.get('usefulLife') != 0)
                depreciationPerPeriod = record.get('cost') / record.get('usefulLife') / 12;
            record.set('depreciationPerPeriod', me.decimal2(depreciationPerPeriod));

            totalCost += record.get('cost');
            totalDepreciationPerPeriod += record.get('depreciationPerPeriod');
            totalcost += record.get('cost');
            totalDepreciationPerPeriod += record.get('periodDepreciation');
        }

        this._totalRow.set('cost', me.decimal2(totalCost));
        this._totalRow.set('depreciationPerPeriod', me.decimal2(totalDepreciationPerPeriod));
        this._totalRow.set('cost', me.decimal2(totalcost));
        this._totalRow.set('periodDepreciation', me.decimal2(totalDepreciationPerPeriod));

        this.resumeEvents();

        //setTimeout(function () { me.fireEvent('datarefresh', me); }, 10);
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, capitalType: this._capitalType };
    },

    addNewRecord: function () {
        this.insert(this.getCount() - 1, this.newRecord({}));
    },

    newRecord: function (data) {
        data = data || {};

        Ext.applyIf(data, { description: '', justification: '',
            periodInstalled: 0, cost: 0, usefulLife: 0,
            periodDisposed: 0, cost: 0, periodDepreciation: 0,
            depreciationPerPeriod: 0
        });

        return Bud.data.BudCapitalExpenditureStore.superclass.newRecord.call(this, data);
    },

    load: function (hcmHouseCode, hcmJob, fscYear, capitalType) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;
        this._capitalType = capitalType;

        Bud.data.BudCapitalExpenditureStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear, capitalType: this._capitalType });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'entAt', mapping: '@entAt', type: 'date', dateFormat: 'n/j/Y' },
     { name: 'entBy', mapping: '@entBy', type: 'string' },
     { name: 'capitalType', mapping: '@capitalType', type: 'int' },
     { name: 'description', mapping: '@description', type: 'string' },
     { name: 'periodInstalled', mapping: '@periodInstalled', type: 'int' },
     { name: 'cost', mapping: '@cost', type: 'float' },
     { name: 'usefulLife', mapping: '@usefulLife', type: 'int' },
     { name: 'periodDisposed', mapping: '@periodDisposed', type: 'int' },
     { name: 'periodDepreciation', mapping: '@periodDepreciation', type: 'float' },
     { name: 'justification', mapping: '@justification', type: 'string' },
     { name: 'depreciationPerPeriod', type: 'float' }
    ]
});

/// <reference path="XmlStore.js" />

Bud.data.CapitalExpenditurePeriodStore = Ext.extend(Bud.data.XmlStore, {

});


/// <reference path="XmlStore.js" />

Bud.data.BudAppJDEGLTransactionStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'appJDEGLTransactions',

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,
    _fscPeriod: 0,
    _annualized: 0,

    getCriteria: function () {
        return {
            hcmHouseCode: this._hcmHouseCode,
            hcmJob: this._hcmJob,
            fscYear: this._fscYear,
            fscPeriod: this._fscPeriod,
            annualized: this._annualized
        };
    },

    load: function (hcmHouseCode, hcmJob, fscYear, fscPeriod, annualized) {

        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;
        this._fscYear = fscYear;
        this._fscPeriod = fscPeriod;
        this._annualized = annualized;

        Bud.data.BudAppJDEGLTransactionStore.superclass.load.call(this);
    },

    fields: [
        { name: 'id', mapping: '@id', type: 'int' },
        { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'int' },
        { name: 'hcmJob', mapping: '@hcmJob', type: 'int' },
        { name: 'fscYear', mapping: '@fscYear', type: 'int' },
        { name: 'fscPeriod', mapping: '@fscPeriod', type: 'int' },
        { name: 'fscAccount', mapping: '@fscAccount', type: 'int' },
        { name: 'appJDEtAmount', mapping: '@appJDEtAmount', type: 'float' },
        { name: 'annualized', type: 'float' }
    ]

});

/// <reference path="XmlStore.js" />

Bud.data.BudAdjustmentStore = Ext.extend(Bud.data.XmlStore, {
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAdjustments',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,

    isRemoteStore: false,
    isDataLoaded: false,

    constructor: function (config) {
        var me = this;
        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@fscAccount',
            fields: [
                { name: 'id', mapping: '@id', type: 'float' },
                { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
                { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
                { name: 'fscYear', mapping: '@fscYear', type: 'float' },
                { name: 'fscAccount', mapping: '@fscAccount', type: 'float' },
                { name: 'amount', mapping: '@amount', type: 'float' },
                { name: 'entAt', mapping: '@entAt', type: 'date' },
                { name: 'entBy', mapping: '@entBy', type: 'string' },
                { name: 'period0', mapping: '@period0', type: 'float' },       // auto spread column
                {name: 'period1', mapping: '@period1', type: 'float' },
                { name: 'period2', mapping: '@period2', type: 'float' },
                { name: 'period3', mapping: '@period3', type: 'float' },
                { name: 'period4', mapping: '@period4', type: 'float' },
                { name: 'period5', mapping: '@period5', type: 'float' },
                { name: 'period6', mapping: '@period6', type: 'float' },
                { name: 'period7', mapping: '@period7', type: 'float' },
                { name: 'period8', mapping: '@period8', type: 'float' },
                { name: 'period9', mapping: '@period9', type: 'float' },
                { name: 'period10', mapping: '@period10', type: 'float' },
                { name: 'period11', mapping: '@period11', type: 'float' },
                { name: 'period12', mapping: '@period12', type: 'float' },
                { name: 'period13', mapping: '@period13', type: 'float' },
                { name: 'period14', mapping: '@period14', type: 'float' },
                { name: 'period15', mapping: '@period15', type: 'float' },
                { name: 'period16', mapping: '@period16', type: 'float' },
                { name: 'fscAccCode', mapping: '@fscAccCode' },
                { name: 'description', mapping: '@description' },
                { name: 'accountCategoryId', type: 'float' },
                { name: 'accountCategory' },
                { name: 'total', type: 'float' }
           ]
        });

        Bud.data.BudAdjustmentStore.superclass.constructor.call(this, config);

        if (!this.isRemoteStore)
            this.on({
                add: { fn: this.updateTotals },
                remove: { fn: this.updateTotals },
                update: { fn: this.updateTotals },
                datachanged: { fn: me.updateTotals }
            });
    },

    round2: function (d) {
        return Math.round(d * 100) / 100;
    },

    updateTotals: function (commitIt) {
        var me = this;
        this.suspendEvents(false);
        if (me.isDataLoaded) {

            this.each(function (record) {
                if (!record.get('fscAccCode')) {
                    var cateId = record.get('id');
                    var recordCollection = me.queryBy(function (r, id) {
                        return r.get('accountCategoryId') == cateId;
                    });

                    var periods = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                    recordCollection.each(function (item, index) {
                        for (var i = 0; i < 16; i++) {
                            var fieldName = String.format('period{0}', i + 1);
                            periods[i] += item.get(fieldName);
                        }
                    });


                    for (var i = 0; i < 16; i++) {
                        var fieldName = String.format('period{0}', i + 1);
                        record.set(fieldName, me.round2(periods[i]));
                    }
                }
            });

            this.each(function (record) {
                var total = 0;
                for (var i = 0; i < 16; i++) {
                    var fieldName = String.format('period{0}', i + 1);
                    total += record.get(fieldName);
                }
                record.set('total', me.round2(total));
            });

            // commit changes for data loaded.
            // mark all data is valid, not dirty.
            if (commitIt === true)
                me.commitChanges();
        }
        this.resumeEvents();

        this.fireEvent('datarefresh', this);
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    getChangedRecords: function () {
        var records = [];
        var recs = Bud.data.BudAdjustmentStore.superclass.getChangedRecords.call(this);

        Ext.each(recs, function (rec, index) {
            if (!!rec.get('fscAccCode'))
                records.push(rec);
        });

        return records;
    },

    load: function (hcmHouseCode, fscYear, hcmJob) {
        var me = this;

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudAdjustmentStore.superclass.load.call(this);
    },

    loadSampleData: function (hcmHouseCode, fscYear, hcmJob) {
        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        this.loadData(_builtInTemplate_6091cb6c[6]);
    },

    relateTo: function (store) {
        var me = this;
        this.suspendEvents(false);

        var findAccRecord = function (fscAccount) {
            var result = store.queryBy(function (r, id) {
                return r.get('id') == fscAccount;
            });
            return result;
        }

        this.each(function (record) {
            var fscAccount = record.get('fscAccount');
            var recs = findAccRecord(fscAccount);

            if (recs.getCount() == 1) {
                var rec = recs.get(0);
                if (rec.get('code') == '5950')
                    me.remove(record);
                else {
                    record.set('fscAccCode', rec.get('code'));
                    record.set('description', rec.get('name'));
                    record.set('accountCategoryId', rec.get('accountCategoryId'));
                    record.set('accountCategory', rec.get('accountCategory'));
                }
            }
        });

        this.sort('fscAccCode', 'ASC');

        var periods = {};
        for (var i = 0; i < 16; i++) {
            var fieldName = String.format('period{0}', i + 1);
            periods[fieldName] = 0;
        }

        for (var i = 0; i < this.getCount(); i++) {
            var record = this.getAt(i);

            var cateId = record.get('accountCategoryId');
            var cateName = record.get('accountCategory');

            var collection = me.queryBy(function (r, id) {
                return r.get('accountCategoryId') == cateId;
            });

            var length = collection.getCount();
            me.insert(i + length, me.newRecord(Ext.apply({ id: cateId, description: cateName, accountCategoryId: 0 }, periods)));
            i += length;
        }

        this.add(me.newRecord(Ext.apply({ id: 0, description: 'Total' }, periods)));

        this.resumeEvents();
    },

    importBudDetails: function (store) {
        var me = this;
        this.suspendEvents(false);

        if (store && store.getCount() > 0) {
            var r = store.getAt(0);
            this._fscYear = r.get('fscYear');
            this._hcmHouseCode = r.get('hcmHouseCode');
            this._hcmJob = r.get('hcmJob');

            var periods = {};
            for (var i = 0; i < 16; i++) {
                var fieldName = String.format('period{0}', i + 1);
                periods[fieldName] = 0;
            }

            store.each(function (record) {
                if (!!record.get('isReadOnly')) {
                    me.add(me.newRecord(Ext.apply({
                        id: record.get('id'),
                        fscAccount: record.get('fscAccount')
                    }, periods)));
                }
            });
        }

        this.resumeEvents();
    },

    loadRemoteData: function (remoteStore) {
        var me = this;
        this.suspendEvents(false);

        var periods = {};
        for (var i = 0; i < 16; i++) {
            var fieldName = String.format('period{0}', i + 1);
            periods[fieldName] = 0;
        }

        var findRecord = function (fscAccount) {
            var result = me.queryBy(function (r, id) {
                return r.get('fscAccount') == fscAccount;
            });

            if (!result || result.getCount()==0) {
                me.add(me.newRecord(Ext.apply({
                    fscAccount: fscAccount
                }, periods)));
                return findRecord(fscAccount);
            }
            return result;
        }

        remoteStore.each(function (rec) {
            var fscAccount = rec.get('fscAccount');
            var records = findRecord(fscAccount);
            if (records && records.getCount() == 1) {
                var record = records.get(0);
                for (var i = 0; i < 16; i++) {
                    var fieldname = String.format('period{0}', i + 1);
                    record.set(fieldname, rec.get(fieldname));
                }
            }
        });

        this.resumeEvents();
        this.isDataLoaded = true;
        this.updateTotals(true);
    }
});

/// <reference path="XmlStore.js" />

Bud.data.BudAdjustmentNoteStore = Ext.extend(Bud.data.XmlStore, {
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAdjustmentNotes',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,

    constructor: function (config) {

        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@id',
            fields: [
                { name: 'id', mapping: '@id', type: 'float' },
                { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
                { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
                { name: 'fscYear', mapping: '@fscYear', type: 'float' },
                { name: 'notes', mapping: '@notes' },
                { name: 'entAt', mapping: '@entAt', type: 'date' },
                { name: 'entBy', mapping: '@entBy' }
           ]
        });

        Bud.data.BudAdjustmentNoteStore.superclass.constructor.call(this, config);

        this.on({
            add: { fn: this.updateTotals },
            remove: { fn: this.updateTotals },
            update: { fn: this.updateTotals },
            datachanged: { fn: this.updateTotals }
        });

    },

    updateTotals: function () {
        this.suspendEvents(false);
        var me = this;

        this.resumeEvents();
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    load: function (hcmHouseCode, fscYear, hcmJob) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudAdjustmentNoteStore.superclass.load.call(this);
    }
});

/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.BudgetAccountStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budFscAccounts',

    wor: '',

    fields: [
        { name: 'id', mapping: '@id', type: 'float' },
        { name: 'accountCategoryId', mapping: '@accountCategoryId', type: 'float' },
        { name: 'accountCategory', mapping: '@accountCategory' },
        { name: 'code', mapping: '@code' },
        { name: 'glHeader', mapping: '@glHeader' },
        { name: 'isNegative', mapping: '@isNegative', type: 'bool' },
        { name: 'name', mapping: '@name' },
        { name: 'categoryDisplayOrder', mapping: '@categoryDisplayOrder', type: 'float' },
        { name: 'displayOrder', mapping: '@displayOrder', type: 'float' },
        { name: 'friendlyName' }
    ],

    constructor: function (config) {

        Bud.data.BudgetAccountStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });

    },

    load: function (wor) {
        /// 20110816  add a checking on annual projection and wor page to list only fscaccounts.fscaccwor = 1
        if (wor)
            this.wor = wor;

        Bud.data.BudgetAccountStore.superclass.load.call(this);

    },

    getCriteria: function () {
        return { budget: 1, wor: this.wor };
    },

    updateTotals: function () {
        this.suspendEvents(false);

        this.each(function (record) {
            var code = record.get('code');
            var name = record.get('name');
            record.set('friendlyName', String.format('{0} - {1}', code, name));
        });

        this.resumeEvents();
    }
});


/// <reference path="XmlStore.js" />

Bud.data.BudSummaryStore = Ext.extend(Bud.data.XmlStore, {
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    isInitialized: false,

    fscAccountStore: null,

    constructor: function (config) {

        config = Ext.apply(config || {}, { record: 'item',
            idProperty: 'fscAccount',
            fields: [
                { name: 'fscAccount', type: 'float' },
                { name: 'fscAccCode' },
                { name: 'description' },
                { name: 'annualProjections', type: 'float' },
                { name: 'originalBudget', type: 'float' },
                { name: 'budget', type: 'float' },
                { name: 'variance', type: 'float' },
                { name: 'variancePercentage', type: 'float' },
                { name: 'comment' },
                { name: 'accountCategoryId', type: 'float' },
                { name: 'accountCategory' }
           ]
        });

        Bud.data.BudSummaryStore.superclass.constructor.call(this, config);

        this.on({
            add: { fn: this.updateTotals },
            remove: { fn: this.updateTotals },
            update: { fn: this.updateTotals },
            datachanged: { fn: this.updateTotals }
        });

    },

    round2: function (d) {
        return Math.round(d * 100) / 100;
    },

    calculate: function (v, total) {
        if (total)
            return v / total;
        if (v)
            return 1;
        return 0;
    },

    updateTotals: function () {
        var me = this;
        if (!me.fscAccountStore)
            return;

        this.suspendEvents(false);
        if (this.isInitialized) {
            var collection = me.queryBy(function (r, id) {
                return !r.get('fscAccCode');
            });

            collection.each(function (item, index) {
                var fscAccount = item.get('fscAccount');    // accountCategoryId
                var mix = me.queryBy(function (r, id) {
                    return r.get('accountCategoryId') == fscAccount;
                });

                var annual = 0;
                var original = 0;
                var budget = 0;

                mix.each(function (r, id) {
                    var fscAccount = me.fscAccountStore.getById(r.get('fscAccount'));
                    var isNegative = !fscAccount || fscAccount.get('isNegative');
                    annual += isNegative ? -r.get('annualProjections') : r.get('annualProjections');
                    original += isNegative ? -r.get('originalBudget') : r.get('originalBudget');
                    budget += isNegative ? -r.get('budget') : r.get('budget');
                });

                item.set('annualProjections', me.round2(annual));
                item.set('originalBudget', me.round2(original));
                item.set('budget', me.round2(budget));
            });

            this.each(function (record) {
                var variance = record.get('budget') - record.get('annualProjections');
                record.set('variance', me.round2(variance));
                record.set('variancePercentage', me.calculate(variance, record.get('annualProjections')));
            });
        }
        this.resumeEvents();

        this.fireEvent('datarefresh', this);
    },

    relateTo: function (store) {
        var me = this;

        this.suspendEvents(false);

        store.each(function (record) {
            var rec = me.findByFscAccount(record.get('fscAccount'));
            rec.set('comment', record.get('comment'));
        });

        this.resumeEvents();

    },

    findByFscAccount: function (fscAccount) {
        var me = this;

        var collections = me.queryBy(function (record) {
            return record.get('fscAccount') == fscAccount;
        });

        var record = collections.get(0);
        if (!record) {
            var fscAccountRecord = me.fscAccountStore.getById(fscAccount);

            record = me.newRecord({
                fscAccount: fscAccountRecord.get('id'),
                fscAccCode: fscAccountRecord.get('code'),
                description: fscAccountRecord.get('name'),
                accountCategoryId: fscAccountRecord.get('accountCategoryId'),
                accountCategory: fscAccountRecord.get('accountCategory'),
                budget: 0,
                annualProjections: 0,
                originalBudget: 0,
                variance: 0,
                variancePercentage: 0
            });

            me.add(record);
        }

        return record;
    },

    setFscAccountStore: function (fscAccountStore) {
        this.fscAccountStore = fscAccountStore;
    },

    setStores: function (currentYearBudgetStore, lastYearBudgetStore, budProjectedDetailStore, budAnnualProjectionSnapshotStore) {
        var me = this;
        me.removeAll();

        this.suspendEvents(false);

        currentYearBudgetStore.each(function (record) {
            var total = 0;
            for (var i = 0; i < 16; i++) {
                var fieldName = String.format('period{0}', i + 1);
                total += record.get(fieldName);
            }
            var rec = me.findByFscAccount(record.get('fscAccount'));
            rec.set('budget', me.round2(total));
        });

        lastYearBudgetStore.each(function (record) {
            var total = 0;
            for (var i = 0; i < 16; i++) {
                var fieldName = String.format('period{0}', i + 1);
                total += record.get(fieldName);
            }

            var rec = me.findByFscAccount(record.get('fscAccount'));
            rec.set('originalBudget', me.round2(total));
        });

        //        budProjectedDetailStore.each(function (record) {
        //            var total = 0;
        //            for (var i = 0; i < 13; i++) {
        //                var fieldName = String.format('period{0}', i + 1);
        //                total += record.get(fieldName);
        //            }

        //            var rec = me.findByFscAccount(record.get('fscAccount'));
        //            rec.set('annualProjections', me.round2(total));
        //        });

        budAnnualProjectionSnapshotStore.each(function (record) {
            var rec = me.findByFscAccount(record.get('fscAccount'));
            rec.set('annualProjections', me.round2(record.get('actualAmount') + record.get('worAmount') + record.get('projAmount')));
        });

        this.each(function (record) {
            if (!record.get('budget') && !record.get('originalBudget') && !record.get('annualProjections'))
                me.remove(record);
        });

        this.sort('fscAccCode', 'ASC');

        for (var i = 0; i < this.getCount(); i++) {
            var record = this.getAt(i);
            var cateId = record.get('accountCategoryId');
            var cateName = record.get('accountCategory');

            var collection = me.queryBy(function (r, id) {
                return r.get('accountCategoryId') == cateId;
            });

            var length = collection.getCount();
            me.insert(i + length, me.newRecord({
                fscAccount: cateId,
                description: cateName,
                accountCategoryId: 0,
                budget: 0,
                annualProjections: 0,
                originalBudget: 0,
                variance: 0,
                variancePercentage: 0
            }));
            i += length;
        }

        this.add(me.newRecord({
            fscAccount: 0,
            description: 'Total',
            budget: 0,
            annualProjections: 0,
            originalBudget: 0,
            variance: 0,
            variancePercentage: 0
        }));

        this.resumeEvents();

        this.isInitialized = true;

        this.updateTotals();
    }

});

/// <reference path="XmlStore.js" />

Bud.data.BudSummaryCommentStore = Ext.extend(Bud.data.XmlStore, {
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budSummaryComments',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,

    constructor: function (config) {

        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@id',
            fields: [
                { name: 'id', mapping: '@id', type: 'float' },
                { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
                { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
                { name: 'fscYear', mapping: '@fscYear', type: 'float' },
                { name: 'comment', mapping: '@comment' },
                { name: 'entAt', mapping: '@entAt', type: 'date' },
                { name: 'entBy', mapping: '@entBy' },
                { name: 'fscAccount', mapping: '@fscAccount', type: 'float' }
           ]
        });

        Bud.data.BudSummaryCommentStore.superclass.constructor.call(this, config);

        this.on({
            add: { fn: this.updateTotals },
            remove: { fn: this.updateTotals },
            update: { fn: this.updateTotals },
            datachanged: { fn: this.updateTotals }
        });

    },

    updateTotals: function () {
        this.suspendEvents(false);
        var me = this;

        this.resumeEvents();
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudSummaryCommentStore.superclass.load.call(this);
    }
});

/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.BudAnnualBudgetHistoryStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAnnualBudgetHistories',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,

    constructor: function (config) {

        Bud.data.BudAnnualBudgetHistoryStore.superclass.constructor.call(this, config);

        this.on({
            add: { fn: this.updateTotals },
            remove: { fn: this.updateTotals },
            update: { fn: this.updateTotals },
            datachanged: { fn: this.updateTotals }
        });

    },

    updateTotals: function () {
        var me = this;
        this.suspendEvents(false);

        this.resumeEvents();

        this.fireEvent('datarefresh', this);
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudAnnualBudgetHistoryStore.superclass.load.call(this);
    },

    fields: [
         { name: 'id', mapping: '@id', type: 'float' },
        { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
        { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
        { name: 'fscYear', mapping: '@fscYear', type: 'float' },
        { name: 'crtdAt', mapping: '@crtdAt', type: 'date' },
        { name: 'crtdBy', mapping: '@crtdBy' },
        { name: 'approvedBySite', mapping: '@approvedBySite' },
        { name: 'approvedByRM', mapping: '@approvedByRM' },
        { name: 'comments', mapping: '@comments' },
        { name: 'fscYeaTitle', mapping: '@fscYeaTitle' },
        { name: 'appUniTitle', mapping: '@appUniTitle' }
    ]
});


Bud.data.BudAnnualProjectionSnapshotStore = Ext.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budAnnualProjectionSnapshots',

    _hcmHouseCode: 0,
    _hcmJob: 0,
    _fscYear: 0,

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear };
    },

    load: function (houseCode, hcmJob, fscYear) {

        this._hcmHouseCode = houseCode;
        this._hcmJob = hcmJob;
        this._fscYear = fscYear;

        Bud.data.BudAnnualInformationStore.superclass.load.call(this);
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    fields: [
     { name: 'id', mapping: '@id', type: 'float' },
     { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
     { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
     { name: 'fscYear', mapping: '@fscYear', type: 'float' },
     { name: 'fscAccount', mapping: '@fscAccount', type: 'float' },
     { name: 'actualAmount', mapping: '@actualAmount', type: 'float' },
     { name: 'worAmount', mapping: '@worAmount', type: 'float' },
     { name: 'projAmount', mapping: '@projAmount', type: 'float' },
     { name: 'hirNode', mapping: '@hirNode', type: 'float' }
    ]
});


WebLight.namespace('Bud.data');

Bud.data.PayPeriodStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/pay/act/Provider.aspx',

    moduleId: 'pay',

    idProperty: '@id',

    fields: [
               { name: 'id', mapping: '@id' },
               { name: 'year', mapping: '@year' },
               { name: 'frequencyType', mapping: '@frequencyType' },
               { name: 'title', mapping: '@title' },
               { name: 'houseCodeId', mapping: '@houseCodeId' },
               { name: 'startDate', mapping: '@startDate', type: 'date' },
               { name: 'endDate', mapping: '@endDate', type: 'date' }
           ],
    storeId: 'payPeriods',

    getCriteria: function () {
        return { fiscalYearId: this.fscYear, frequencyType: this.payFrequencyType };
    },

    load: function (fscYear, payFrequencyType) {
        this.fscYear = fscYear;
        this.payFrequencyType = payFrequencyType;
        Bud.data.PayPeriodStore.superclass.load.call(this);
    }
});




WebLight.Router.mapRoute('^budget/startbudget$', {
    xtype: 'startbudget'
});
WebLight.Router.mapRoute('^budget/contractbilling$', {
    xtype: 'contractbilling'
});
WebLight.Router.mapRoute('^budget/staffing$', {
    xtype: 'staffing'
});
WebLight.Router.mapRoute('^budget/employee$', {
    xtype: 'employee'
});
WebLight.Router.mapRoute('^budget/mgthist$', {
    xtype: 'managementhistory'
});
WebLight.Router.mapRoute('^budget/laborcalculate$', {
    xtype: 'laborcalculations'
});
WebLight.Router.mapRoute('^budget/fnllaborcalc$', {
    xtype: 'finallaborcalculations'
});
WebLight.Router.mapRoute('^budget/supplyexp$', {
    xtype: 'supplyexpenditures'
});
WebLight.Router.mapRoute('^budget/capitalexp$', {
    xtype: 'capitalexpenditures'
});
WebLight.Router.mapRoute('^budget/bgtadj$', {
    xtype: 'budgetadjustments'
});
WebLight.Router.mapRoute('^budget/bgtdetails$', {
    xtype: 'budgetdetails'
});
WebLight.Router.mapRoute('^budget/bgtsummary$', {
    xtype: 'budgetsummary'
});
WebLight.Router.mapRoute('^budget/bgtapproval$', {
    xtype: 'budgetapproval'
});

/******************* Annual Projections ******************/

WebLight.Router.mapRoute('^projection/annualprojectionsbyperiod$', {
    xtype: 'annualprojectionsbyperiod',cacheable:true
});
WebLight.Router.mapRoute('^projection/worforecast$', {
    xtype: 'worforecast', cacheable: true
});

/******************* Budget Summary ******************/

WebLight.Router.mapRoute('^budSummary/summary$', {
    xtype: 'budgetsummary'
});

/******************* Transaction Summary ******************/

WebLight.Router.mapRoute('^ledger/transactionsummary$', {
    xtype: 'transactionsummary'
});

/******************* Epay Schedule ******************/

WebLight.Router.mapRoute('^epaySchedule/uploadsites$', {
    xtype: 'epaySchedule_uploadsites'
});
WebLight.Router.mapRoute('^epaySchedule/epaytaskcallhistory$', {
    xtype: 'epaytaskcallhistory'
});

WebLight.Router.mapRoute('^epaySchedule/uploademployees$', {
    xtype: 'epaySchedule_uploademployees'
});

WebLight.Router.mapRoute('^epaySchedule/downloadhours$', {
    xtype: 'epaySchedule_downloadhours'
});

/// <reference path="Core.js" />

Bud.NavbarItem = Ext.extend(Ext.Button, {
    url: null,
    initComponent: function () {

        Bud.NavbarItem.superclass.initComponent.call(this);

        if (!this.handler && this.url) {
            this.setHandler(function () {
                if (!fin.bud.modified())
                    WebLight.Router.route(this.url);
            }, this);
        }

    }
});

/// <reference path="Core.js" />

Bud.PrimaryNavbar = Ext.extend(Ext.Toolbar, {
    initComponent: function () {
        var menuItems = [];

        menuItems.push(new Bud.NavbarItem({ text: 'Start Budget', pattern: 'budget/startbudget', url: '/budget/startbudget' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Contract Billing', pattern: 'budget/contractbilling', url: '/budget/contractbilling' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Staffing', pattern: 'budget/staffing', url: '/budget/staffing' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Employee', pattern: 'budget/employee', url: '/budget/employee' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Mgt Hist', pattern: 'budget/mgthist', url: '/budget/mgthist' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Labor Calc', pattern: 'budget/laborcalculate', url: '/budget/laborcalculate' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Fnl Labor Calc', pattern: 'budget/fnllaborcalc', url: '/budget/fnllaborcalc' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Supply Exp', pattern: 'budget/supplyexp', url: '/budget/supplyexp' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Capital Exp', pattern: 'budget/capitalexp', url: '/budget/capitalexp' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Bgt Adj', pattern: 'budget/bgtadj', url: '/budget/bgtadj' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Bgt Details', pattern: 'budget/bgtdetails', url: '/budget/bgtdetails' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Bgt Summary', pattern: 'budget/bgtsummary', url: '/budget/bgtsummary' }));
        menuItems.push(new Bud.NavbarItem({ text: 'Bgt Approval', pattern: 'budget/bgtapproval', url: '/budget/bgtapproval' }));

        this.items = menuItems;
        this.menuItems = menuItems;

        Bud.PrimaryNavbar.superclass.initComponent.call(this);

        var toggleActiveButton = function (url) {
            Ext.each(menuItems, function (item) {
                if (item.pattern) {
                    var regex = new RegExp(item.pattern, 'gi');
                    regex.test(url) ? item.addClass('x-btn-active') : item.removeClass('x-btn-active');
                }
            });
        };

        WebLight.PageMgr.on('load', function (url, page) {
            toggleActiveButton(url);
        });

        WebLight.PageMgr.on('resume', function (url, page) {
            toggleActiveButton(url);
        });
    },

    currentContractType: 2,
    currentBudgetTemplateId: 2,
    currentBudgetLaborCalcMethod: 1,
    currentBudgetStarted: false,
    resetMenuItems: function () {
        /*
        1	Management Fee
        2	Full Service Bil
        3	Over Head Accoun
        4 Retail

        Overhead - Following available tabs - Mgt Hist, Capital Exp, Bgt Adj, Bgt Details, Bgt Summary and Bgt Approval
        Management Fee - Following available tabs - Contract Billing, Mgt Hist, Supply Exp, Capital Exp, Bgt Adj, Bgt Details, Bgt Summary and Bgt Approval
        Full Service - Following available tabs - Contract Billing, Staffing, Employee, Mgt Hist, Labor Calc, Fnl Labor Calc, Supply Exp, Capital Exp, Bgt Adj, Bgt Details, Bgt Summary and Bgt Approval

        */
        var me = this;

        var budgetTemplateId = me.currentBudgetTemplateId;
        var budgetStarted = me.currentBudgetStarted;

        for (var i = 1; i < this.menuItems.length; i++) {
            if (!budgetStarted || budgetTemplateId == 3 && (i == 1 || i == 2 || i == 3 || i == 5 || i == 6 || i == 7)
                || budgetTemplateId == 4 && i == 7
                || budgetTemplateId == 1 && (i == 2 || i == 3 || i == 5 || i == 6))
                this.menuItems[i].hide();
            else
                this.menuItems[i].show();
        }

    }
});

/// <reference path="../../references/jquery-1.4.1.js" />
/// <reference path="../../references/ext-jquery-adapter.js" />
/// <reference path="../../references/ext-all.js" />
/// <reference path="../../references/weblight4extjs.js" />


Ext.namespace("Bdg.store");
Ext.namespace("Bdg.object");

Bdg.store.Contract = [['4005 Full Service Bills', '92054.79', '92054.79', '92054.79', '92054.79', '92054.79', '92054.79', '92054.79', '92778.08', '93895.89', '93895.89', '93895.89', '93895.89', '93895.89', '1206641.06'],
                        ['4010 Management Fee Billing', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4020 Miscellaneous Income', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4030 Reimbursement Start-up Costs', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4040 Reimbursement Direct Costs', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4050 Reimbursement Equipment', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4060 Quality Incentive Income', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4070 Prepayment Discount', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                        ['4080 Finalily', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0']
                        ];

Bdg.store.Staff = [['name', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                    ['text', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0']];


Bdg.store.Employee = [['Jackson,Bo', '1', '0', '', '7.75', '0', '0', '7.75', '60', '465.00', '465.00', '12090.00'],
                    ['Simpson,Bo', '1', '1', '', '10.00', '0', '0', '10.00', '80', '800.00', '800.00', '20800.00'],
                    ['Simpson,Homer', '1', '2', '', '2.00', '0', '0', '2.00', '80', '160.00', '160.00', '4160.00']];

Bdg.store.Hist = [['Joseph', 'Director of POH', '80000', '1', 'Annual', '2', '81600']];

Bdg.store.Hist1 = [['Joseph Smith', '92054.79', '92054.79', '92054.79', '92054.79', '92054.79',
                '92054.79', '92054.79', '92778.08', '93895.89', '93895.89', '93895.89', '93895.89', '93895.89', '1206641.06']];

Bdg.store.Labor = [['Productive Hours', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0'],
                  ['Short Staffing Legal Holidays', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0'],
                  ['Productive Hours Standard', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                  ['Average Wage Rate', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48'],
                  ['Prod Labor Standard Cost', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0'],
                  ['Average Wage Rate For Paid Leave', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48', '$6.48'],
                  ['Paid Leave Calculation', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0'],
                  ['Sick Pay', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0'],
                  ['Personal and Other Pay', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0'],
                  ['Legal Holiday', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0'],
                  ['Sub-total Paid Leave', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0'],
                  ['Vacation Pay Account', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0.00', '$0'],
                  ['Overtime Hours', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0.00', '0'],
                  ['Cost associated with Overtime', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0'],
                  ['Total Labor Cost', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0', '$0']
                 ];

Bdg.store.Supply = [['', 'cs', '45', '2', '90', '2', '90', '0', '0'], ['Remove', '0', '26.2', '10', '265', '4', '106', '-6', '-159']];

Bdg.store.Captial = [['PDA', '1', '8000.00', '3', '205.13', 'TeamOps']];

Bdg.store.Captial1 = [['', '0', '0', '0', '']];

Bdg.store.Captial3 = [['PDA', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '2666.69'],
                    ['Total New Depreciation', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '2666.69'],
                    ['Carry Forward Depr.per Sch', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                    ['Less Disposed Equipment', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0'],
                    ['Total Depreciation', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '2666.69']
                    ];
Bdg.store.Captial2 = [['PDA', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '205.13', '2666.69']];
Bdg.store.Captial4 = [['', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0']];

Bdg.store.Adj = [['Management Fee Billings', '4010', '0', '0', '0', '0', '0', '0', '0', '-2.000', '0', '0', '0', '0', '0', '-2.000'],
                ['Management Labor', '5610', '0', '0', '0', '0', '0', '0', '0', '0', '-4.000', '0', '0', '0', '0', '-2.000'],
                ['Fringe Benefits Management', '5805', '0', '0', '0', '0', '0', '0', '0', '0', '-4.000', '0', '0', '0', '0', '-2.000'],
                ['Plastic Supplies', '6205', '0', '0', '0', '0', '0', '0', '0', '0', '-4.000', '0', '0', '0', '0', '-2.000']];

Bdg.store.Detail = [['General Liab Ins--Fringe', '5950', '644', '644', '644', '644', '644', '644', '644', '635', '657', '657', '657', '657', '657', '8,433', '0.70%'],
                    ['Plastic Supplies', '6025', '196', '196', '196', '196', '196', '196', '196', '196', '196', '196', '196', '196', '196', '2,548', '0.21%'],
                    ['Computer Related  Charge', '6240', '125', '0', '125', '0', '125', '0', '125', '0', '-4.000', '0', '0', '0', '0', '875', '0.07%'],
                    ['Repairs And Maintenance', '6310', '100', '100', '100', '100', '100', '100', '200', '200', '200', '200', '200', '200', '200', '2,000', '0.17%'],
                    ['Travel-Hotel/Auto/Other', '6430', '5,000', '1', '0', '2,000', '1,000', '0', '0', '10,000', '0', '0', '0', '0', '0', '18,000', '1.49%'],
                    ['Office Supplies', '6605', '50', '50', '50', '50', '50', '0', '0', '0', '0', '125', '0', '0', '0', '250', '0.02%'],
                    ['Uniforms', '7770', '100', '100', '100', '100', '100', '100', '100', '100', '100', '100', '100', '100', '100', '1,300', '0.11%'],
                    ['Depreciation', '8605', '205', '205', '205', '205', '205', '205', '205', '205', '205', '205', '205', '205', '205', '2665', '0.22%']];

Bdg.store.summary = [['Productive Labor', '5210', '305', '0', '0', '-305', '-100.00%', ''],
                      ['Manegement Labor', '5610', '0', '0', '77,600', '77,600', '0.00%', ''],
                      ['Frige Benefits-Management', '5610', '0', '0', '77,600', '77,600', '0.00%', ''],
                      ['General Liab Ins--Fringe', '5610', '0', '0', '77,600', '77,600', '0.00%', ''],
                      ['Plastic Suuplies', '5610', '0', '0', '77,600', '77,600', '0.00%', ''],
                      ['Computer Related Charge', '5610', '0', '0', '77,600', '77,600', '0.00%']];

Bdg.store.Approval = [['', '', '2011', '9999 Text Site', '', '', '5/11/10 2:30PM']];

Bdg.store = (function () {
    var getTimeStore = function () {
        var i = 0;
        var data = [];
        for (i = 0; i < 24; i++) {
            data.push([i * 2, i + ':00'])
        }

        return new Ext.data.ArrayStore({
            fields: ['id', 'name'],
            data: data
        });
    }

    return {
        TimeStore: getTimeStore()
    }
})();

/// <reference path="../Core.js" />


WebLight.namespace('Bud.page');

Bud.page.BudgetPage = WebLight.extend(WebLight.Page, {

    _fscYear: 0,
    _fscYearTitle: '',
    _hcmHouseCode: 0,
    _hcmHouseCodeTitle: '',
    _hcmJob: 0,
    _hcmJobTitle: '',

    _prevFscYear: 0,
    _prevFscYearTitle: '',

    // obsolete methods
    getFscYear: function () { return this._fscYear; },
    getHcmHouseCode: function () { return this._hcmHouseCode; },
    getHcmJob: function () { return this._hcmJob; },
    getFscYearTitle: function () { return this._fscYearTitle; },
    getHcmHouseCodeTitle: function () { return this._hcmHouseCodeTitle; },
    getHcmJobTitle: function () { return this._hcmJobTitle; },

    getPrevFscYear: function () {
        if (this._fscYear == 4)
            return 3;
        return this._prevFscYear;
    },
    getPrevFscYearTitle: function () {
        if (this._fscYear == 4)
            return 2012;
        return this._prevFscYearTitle;
    },

    //2011/06/24
    //hide budget start button before budget start date on budget admin and show it only between budget start and cut off date from budget admin.
    // make all budget readonly, disable approve and reject buttons after budget cut off date from budget admin
    isBudgetApproved: false,
    isAnnualEditable: false,

    _authStore: null,

    authStore: function (authStore) {
        if (arguments.length == 0)
            return this._authStore;
        else {
            this._authStore = arguments[0];
            this.fireEvent('modechanged');
        }
    },

    budAnnualBudgetStore: null,
    annualInformationStore: null,

    createChildControls: function () {
        var me = this;

        window.isSavedSuccessfully = false;


        me.budAnnualBudgetStore = new Bud.data.BudAnnualBudgetStore();
        me.annualInformationStore = new Bud.data.BudAnnualInformationStore();


        me.grouping([me, me.budAnnualBudgetStore, me.annualInformationStore], {
            load: function () {

                if (me.budAnnualBudgetStore.getCount() <= 0 || !me.budAnnualBudgetStore.getAt(0).get('approved')) {
                    me.isBudgetApproved = false;
                } else {
                    me.isBudgetApproved = true;
                }

                var annualInformation = me.annualInformationStore.getAt(0);
                var startDate = annualInformation.get('startDate');
                var cutOffDate = annualInformation.get('cutOffDate');
                var today = new Date();

                //
                if (startDate <= today && today <= cutOffDate)
                    me.isAnnualEditable = true;
                else
                    me.isAnnualEditable = false;

                me.fireEvent('modechanged');
            }
        });

        Bud.page.BudgetPage.superclass.createChildControls.call(this);
    },

    setContext: function (hcmHouseCode, hcmJob, fscYear, hcmHouseCodeTitle, hcmJobTitle, fscYearTitle, prevFscYear, prevFscYearTitle) {
        var me = this;
        if (!hcmHouseCode || hcmHouseCode == ''
                || !hcmJob || hcmJob == ''
                || !fscYear || fscYear == ''
        )
            return;

        if (this._fscYear == fscYear && this._hcmHouseCode == hcmHouseCode && this._hcmJob == hcmJob)
            return;

        this._fscYearTitle = fscYearTitle;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;
        this._fscYear = fscYear;
        this._hcmHouseCodeTitle = hcmHouseCodeTitle;
        this._hcmJobTitle = hcmJobTitle;

        if (prevFscYear)
            this._prevFscYear = prevFscYear;
        if (prevFscYearTitle)
            this._prevFscYearTitle = prevFscYearTitle;

        this.fireEvent('contextChanged');

        me.budAnnualBudgetStore.load(this._hcmHouseCode, this._hcmJob, this._fscYear);
        me.annualInformationStore.load(this._fscYear);
    },


    isReadOnlyMode: function () {
        if (document.location.host == 'localhost') {
            return false;
        }

        return (this.isBudgetApproved || !this.isAnnualEditable || !window.authStore.allowBudgetWrite());
    }
});


/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.page.BudgetAdjustmentsPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Bgt Adj',
    html: _builtInTemplate_6091cb6c[7],

    _adjustmentRemoteStore: null,
    _adjustmentStore: null,
    _adjustmentGrid: null,
    _detailStore: null,

    _fiscalPeriodStore: null,
    _gridColumnModel: null,
    _adjustmentNoteStore: null,
    _notesForm: null,
    _fscAccountStore: null,

    refreshGridColumnModel: function () {
        var me = this;
        var displayRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (metaData && record) {
                if (!record.get('fscAccCode')) {
                    if (colIndex == 0)
                        metaData.attr = 'style="font-weight:bold;font-size:1.1em;text-align:right;"';
                    else
                        metaData.attr = 'style="font-weight:bold;font-size:1.1em;"';
                }
                else {
                    if (colIndex > 1 && colIndex < 15)
                        metaData.attr = 'style="color:#43A643;font-weight:bold;"';
                }

                //                if (record.get('description') == 'Total' && typeof value == 'number')
                //                    value = -value;
            }

            /// hide auto spread column's value @ 2012/2/20
            if (colIndex == 2)
                return '';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00');

            return value;
        };

        var columns = [
            { header: 'GL Account', width: 180, dataIndex: 'description', renderer: displayRenderer },
            { header: 'Account Number', width: 90, dataIndex: 'fscAccCode', align: 'center', renderer: displayRenderer },
            { header: 'Spread', width: 68, dataIndex: 'period0', align: 'center', renderer: displayRenderer,
                editor: new Ext.form.NumberField()
            }
        ];

        this._fiscalPeriodStore.each(function (record) {
            columns.push({
                header: String.format('{0}',
                            Ext.util.Format.date(record.get('endDate'), 'm/d/Y')),
                width: 68,
                align: 'center',
                dataIndex: 'period' + record.get('title'),
                renderer: displayRenderer,
                editor: new Ext.form.NumberField()
            });
        });

        columns.push({ header: 'Total', dataIndex: 'total', align: 'center', width: 100, renderer: displayRenderer });

        if (this._gridColumnModel)
            this._gridColumnModel.setConfig(columns);
        else {
            this._gridColumnModel = new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                isCellEditable: function (col, row) {
                    var record = me._adjustmentStore.getAt(row);
                    return !!record.get('fscAccount');
                },
                columns: columns
            });
        }
    },

    createAdjustmentGrid: function () {
        var me = this;
        var groupRows = [{ header: '', colspan: 2}];
        groupRows.push({ header: 'Auto', colspan: 1, align: 'center' });
        for (var i = 1; i <= 12; i++) {
            groupRows.push({ header: 'Period ' + i, colspan: 1, align: 'center' });
        }
        groupRows.push({ header: '', colspan: 1 });

        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [groupRows]
        });

        this.refreshGridColumnModel();

        var width = $(window).width() - 25;
        if (width > 1300)
            width = 1300;

        this._adjustmentGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1 hightlight-dirtydata', height: 400,
            width: width,
            enableHdMenu: false,
            clicksToEdit: 1,
            store: this._adjustmentStore,
            cm: this._gridColumnModel,
            plugins: [group]
        });

        this.addChildControl(this._adjustmentGrid, 'budget-adjustment-grid');

        this._adjustmentStore.on('datarefresh', function () {
            me._adjustmentGrid.getView().refresh();
        });

        this._adjustmentGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });

        this._adjustmentGrid.on('afteredit', function (e) {
            /*
            grid - This grid
            record - The record being edited
            field - The field name being edited
            value - The value being set
            originalValue - The original value for the field, before the edit.
            row - The grid row index
            column - The grid column index */

            if (e.field == 'period0' && e.value != e.originalValue) {
                me._adjustmentStore.suspendEvents(false);
                for (var i = 2; i <= 12; i++)
                    e.record.set('period' + i, e.value);
                me._adjustmentStore.resumeEvents();
                e.record.set('period1', e.value);
            }
            fin.bud.modified(true);
        });

    },

    ensureAdjustmentGridCreated: function () {
        if (!this._adjustmentGrid)
            this.createAdjustmentGrid();
    },

    createChildControls: function () {
        var me = this;
        this._adjustmentStore = new Bud.data.BudAdjustmentStore({ isRemoteStore: false });
        this._adjustmentRemoteStore = new Bud.data.BudAdjustmentStore({ isRemoteStore: true });
        this._fiscalPeriodStore = new Bud.data.FiscalPeriodStore();
        this._adjustmentNoteStore = new Bud.data.BudAdjustmentNoteStore();
        this._fscAccountStore = new Bud.data.BudgetAccountStore();
        this._detailStore = new Bud.data.BudDetailsStore({ includeReadOnly: true });

        this._notesForm = new WebLight.form.FormPanel({
            border: false, header: false, frame: false,
            items: [{ width: 1000, height: 100, name: 'notes', xtype: 'textarea'}]
        });
        this._notesForm.bindStore(this._adjustmentNoteStore);
        this.addChildControl(this._notesForm, 'budget-adjustment-note-form');

        var saveButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Save', width: 80, id: me.getClientId('btnSave'),
            handler: function () {
                me._adjustmentNoteStore.submitChanges();
                me._adjustmentStore.submitChanges();
                fin.bud.modified(false);
            }
        });
        var cancelButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Cancel', width: 80, id: me.getClientId('btnCancel'),
            handler: function () {
                me._adjustmentRemoteStore.reload();
            }
        });
        var printButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Print', width: 80,
            handler: function () {
                me.printBudgetAdjustmentGrid();
            }
        });

        this.addChildControl(saveButton, 'save-button');
        this.addChildControl(cancelButton, 'cancel-button');
        this.addChildControl(printButton, 'print-button');

        Bud.page.BudgetAdjustmentsPage.superclass.createChildControls.call(this);
    },

    printBudgetAdjustmentGrid: function () {
        var me = this;

        Ext.ux.Printer.print('Budget Adjustments', _builtInTemplate_6091cb6c[8],
         { incomeTypes: me._adjustmentGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle(),
             'notes': me._notesForm.getFieldByName('notes').getValue()
         },
         '../../res/css/print-all.css');
    },

    dataBind: function () {
        var me = this;

        this.grouping([this,
            this._fiscalPeriodStore,
            this._adjustmentStore,
            this._adjustmentRemoteStore,
            this._adjustmentNoteStore,
            this._detailStore,
            this._fscAccountStore], {
                load: function () {
                    me._adjustmentStore.suspendEvents(false);
                    me._adjustmentStore.removeAll();
                    me._adjustmentStore.resumeEvents();
                    // the only ".removeAll()" method cause a "this.getRow(b) is undefined" bug,
                    // because the "remove" event is fired.
                    //me._adjustmentStore.removeAll();
                    me._adjustmentStore.importBudDetails(me._detailStore);
                    me._adjustmentStore.loadRemoteData(me._adjustmentRemoteStore);
                    me._adjustmentStore.relateTo(me._fscAccountStore);
                    me._adjustmentStore.loadRemoteData(me._adjustmentRemoteStore);
                    fin.bud.modified(false);
                },
                submit: function () {
                    //me._adjustmentRemoteStore.reload();
                }
            });

        this.on('contextChanged', function () {
            me._fiscalPeriodStore.load(me.getFscYear());
            me._detailStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._adjustmentRemoteStore.load(me.getHcmHouseCode(), me.getFscYear(), me.getHcmJob());
        });

        this._fscAccountStore.load();

        this.on('modechanged', function () {
            me.onModeChanged();
        });

        this._fiscalPeriodStore.on('load', function (store) {
            me.refreshGridColumnModel();
            me.ensureAdjustmentGridCreated();
        });

        this._adjustmentRemoteStore.on('load', function () {
            me._adjustmentNoteStore.load(me.getHcmHouseCode(), me.getFscYear(), me.getHcmJob());
        });

        Bud.page.BudgetAdjustmentsPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    onModeChanged: function () {
        var me = this;
        var btnSave = Ext.get(me.getClientId('btnSave'));
        var btnCancel = Ext.get(me.getClientId('btnCancel'));
        if (me.isReadOnlyMode()) {
            me._notesForm.getFieldByName('notes').disable();
            btnSave.hide();
            btnCancel.hide();
        } else {
            btnSave.show();
            btnCancel.show();
            me._notesForm.getFieldByName('notes').enable();
        }
    }
});

WebLight.PageMgr.registerType('budgetadjustments', Bud.page.BudgetAdjustmentsPage);

/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.page.BudgetApprovalPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Bgt Approval',
    html: _builtInTemplate_6091cb6c[9],

    _annualForm: null,
    _annualStore: null,
    _annualHistoryGrid: null,
    _annualHistoryStore: null,

    _budRejectButton: null,
    _budApprovedButton: null,
    _isApproved: false,

    createAnnualForm: function () {
        var me = this;

        this._budRejectButton = new Ext.Button({
            text: 'Reject', ctCls: 'ux-button-1', hidden: true,
            handler: function () {

                var data = me._annualForm.getForm().getFieldValues();

                var store = new Bud.data.BudAnnualBudgetApprovalStore();
                store.add(store.newRecord(Ext.apply({
                    hcmHouseCode: me.getHcmHouseCode(),
                    hcmJob: me.getHcmJob(),
                    fscYear: me.getFscYear(),
                    approved: false
                }, data)));

                store.submitChanges(function () {
                    me._annualStore.reload();
                    me._annualHistoryStore.reload();
                    fin.bud.modified(false);
                });
            }
        });
        this._budApprovedButton = new Ext.Button({
            text: 'Approve', ctCls: 'ux-button-1', hidden: true,
            handler: function () {

                var data = me._annualForm.getForm().getFieldValues();

                var store = new Bud.data.BudAnnualBudgetApprovalStore();
                store.add(store.newRecord(Ext.apply({
                    hcmHouseCode: me.getHcmHouseCode(),
                    hcmJob: me.getHcmJob(),
                    fscYear: me.getFscYear(),
                    approved: true
                }, data)));

                store.submitChanges(function () {
                    me._annualStore.reload();
                    me._annualHistoryStore.reload();
                    fin.bud.modified(false);
                });
            }
        });

        this._annualForm = new WebLight.form.FormPanel({
            border: false, header: false, frame: false,
            defaults: { anchor: '90%' },
            items: [
                { fieldLabel: 'Send Email to', name: 'email', xtype: 'textfield' },
                { fieldLabel: 'Subject', name: 'subject', xtype: 'textarea', height: 35 },
                { fieldLabel: 'Comments', name: 'comments', xtype: 'textarea', height: 100 }
            ], store: this._annualStore,
            buttons: [this._budApprovedButton, this._budRejectButton]
        });
        //this._annualForm.bindStore(this._annualStore);
    },

    createAnnualHistoryGrid: function () {

        var colModel = new Ext.grid.ColumnModel({
            defaults: { sortable: false },
            width: 1250,
            columns: [
                { header: 'Site Approved', dataIndex: 'approvedBySite' },
                { header: 'Reginal Manager Approved', width: 200, dataIndex: 'approvedByRM' },
                { header: 'Fiscal Year', dataIndex: 'fscYeaTitle' },
                { header: 'Site', dataIndex: 'appUniTitle', width: 220 },
                { header: 'Comments', width: 300, dataIndex: 'comments' },
                { header: 'Entered By', dataIndex: 'crtdBy', width: 150 },
                { header: 'Date Entered', dataIndex: 'crtdAt', renderer: new Ext.util.Format.dateRenderer('M d, Y') }
            ]
        });

        this._annualHistoryGrid = new WebLight.grid.GridPanel({
            ctCls: 'ux-grid-1', height: 400,
            enableHdMenu: false,
            cm: colModel, store: this._annualHistoryStore
        });

        //this._annualHistoryGrid.bindStore(this._annualHistoryStore);
    },

    createChildControls: function () {
        var me = this;
        this._annualStore = new Bud.data.BudAnnualBudgetStore();
        this._annualHistoryStore = new Bud.data.BudAnnualBudgetHistoryStore();

        this._annualStore.on('update', function () { fin.bud.modified(true); });

        this._annualStore.on('load', function () { fin.bud.modified(false); });


        this.createAnnualForm();
        this.createAnnualHistoryGrid();

        this.grouping([this, this._annualStore, this._annualHistoryStore], {
            load: function () {
                me.refreshButtons();
            }
        });


        this.addChildControl(this._annualForm, 'budget-approval-form');
        this.addChildControl(this._annualHistoryGrid, 'budget-approval-grid');

        Bud.page.BudgetApprovalPage.superclass.createChildControls.call(this);
    },

    dataBind: function () {
        var me = this;

        this.on('contextChanged', function () {
            me._annualStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._annualHistoryStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());

            var subject = [];
            subject.push(me.getHcmHouseCodeTitle());
            if (me.getHcmJob() != 1)
                subject.push(me.getHcmJobTitle());
            subject.push(me.getFscYearTitle());
            subject.push('Budget');
            var f = me._annualForm.getFieldByName('subject');
            f.setValue(subject.join(' '));


        });

        this.on('modechanged', function () { me.refreshButtons(); });



        Bud.page.BudgetApprovalPage.superclass.dataBind.call(this);
    },

    refreshButtons: function () {
        var me = this;

        if (!me.isAnnualEditable) {
            me._budApprovedButton.setVisible(false);
            me._budRejectButton.setVisible(false);
            return;
        }

        if (me._annualStore.getCount() == 0)
            return;


        me._isApproved = (me._annualStore.getCount() == 1) && !!me._annualStore.getAt(0).get('approved');

        me._budApprovedButton.setVisible(!me._isApproved && window.authStore.allowApproveBudget());
        me._budRejectButton.setVisible(me._isApproved && window.authStore.allowRejectBudget());
    }
});

WebLight.PageMgr.registerType('budgetapproval', Bud.page.BudgetApprovalPage);


/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.page.BudgetDetailsPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Bgt Details',
    html: _builtInTemplate_6091cb6c[10],

    _budDetailsGrid: null,
    _budDetailsStore: null,

    _fiscalPeriodStore: null,
    _gridColumnModel: null,
    _budgetAccountStore: null,
    _accountComboBox: null,
    _budgetAccountStore4ComboBox: null,

    refreshGridColumnModel: function () {
        var me = this;

        var displayRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (record && metaData) {
                if (!record.get('fscAccount')) {
                    if (colIndex == 0)
                        metaData.attr = 'style="font-weight:bold;font-size:1.1em;text-align:right;"';
                    else if (colIndex == 1)
                        metaData.attr = 'style="font-weight:bold;font-size:1.1em;"';
                    else
                        metaData.attr = 'style="font-weight:bold;text-align:right;"';
                }
                else {
                    if (colIndex > 1 && colIndex < 15 && !record.get('isReadOnly'))
                        metaData.attr = 'style="color:#43A643;font-weight:bold;text-align:right;"';
                    else if (colIndex >= 15)
                        metaData.attr = 'style="font-weight:bold;text-align:right;"';
                    else if (colIndex > 1 && colIndex < 15)
                        metaData.attr = 'style="text-align:right;"';
                }
                if (record.get('description') == 'Revenue' && typeof value == 'number')
                    value = -value;
            }

            if (colIndex == 2)
            // auto spread column
                return '';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00');

            return value;
        };

        var percentageRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (metaData)
                metaData.attr = 'style="font-weight:bold;text-align:right;"';

            // total row
            if (record && record.get('id') == 0)
                return '0%';
            if (value < 0)
                value = -value;

            return Ext.util.Format.number(value * 100, '0.00%');
        }

        var columns = [
            { header: 'GL Account<br />&nbsp;', width: 180, dataIndex: 'description', renderer: displayRenderer },
            { header: 'Account Number<br />&nbsp;', width: 90, dataIndex: 'fscAccCode', align: 'center', renderer: displayRenderer },
            { header: 'Spread', width: 68, dataIndex: 'period0', align: 'center', renderer: displayRenderer,
                editor: new Ext.form.NumberField()
            }
        ];

        this._fiscalPeriodStore.each(function (record) {
            columns.push({
                header: String.format('{0}<br />&nbsp;',
                            Ext.util.Format.date(record.get('endDate'), 'm/d/Y')),
                width: 70,
                align: 'center',
                dataIndex: 'period' + record.get('title'),
                editor: new Ext.form.NumberField(),
                renderer: displayRenderer
            });
        });

        columns.push({ header: 'Total<br />&nbsp;', dataIndex: 'total', width: 100, align: 'center', renderer: displayRenderer });
        columns.push({ header: 'Percentage<br />Of Billings', dataIndex: 'percentage', align: 'center', width: 80, renderer: percentageRenderer });

        if (this._gridColumnModel)
            this._gridColumnModel.setConfig(columns);
        else {
            this._gridColumnModel = new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                isCellEditable: function (col, row) {
                    var rec = me._budDetailsStore.getAt(row);
                    return !!rec.get('fscAccount') && !rec.get('isReadOnly');
                },
                columns: columns
            });
        }
    },

    createDetailsGrid: function () {
        var me = this;
        var groupRows = [{ header: '', colspan: 2}];
        groupRows.push({ header: 'Auto', colspan: 1, align: 'center' });

        for (var i = 1; i <= 12; i++) {
            groupRows.push({ header: 'Period ' + i, colspan: 1, align: 'center' });
        }
        groupRows.push({ header: '', colspan: 2 });

        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [groupRows]
        });

        this.refreshGridColumnModel();

        var width = $(window).width() - 25;
        if (width > 1450)
            width = 1450;

        this._budDetailsGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1 hightlight-dirtydata',
            height: 400,
            enableHdMenu: false,
            clicksToEdit: 1,
            width: width,
            store: this._budDetailsStore,
            cm: this._gridColumnModel,
            plugins: [group]
        });

        this.addChildControl(this._budDetailsGrid, 'budget-details-grid');

        this._budDetailsStore.on('datarefresh', function () {
            setTimeout(function () {
                me._budDetailsGrid.getView().refresh();
            }, 100);
        });

        this._budDetailsStore.on('load', function () { fin.bud.modified(false); });

        this._budDetailsGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });

        this._budDetailsGrid.on('afteredit', function (e) {
            /*
            grid - This grid
            record - The record being edited
            field - The field name being edited
            value - The value being set
            originalValue - The original value for the field, before the edit.
            row - The grid row index
            column - The grid column index */

            if (e.field == 'period0' && e.value != e.originalValue) {
                me._budDetailsGrid.suspendEvents(false);
                for (var i = 2; i <= 12; i++)
                    e.record.set('period' + i, e.value);
                me._budDetailsGrid.resumeEvents();
                e.record.set('period1', e.value);
                me._budDetailsGrid.getView().refresh();
            }
            fin.bud.modified(true);
        });
    },

    ensureDetailsGridCreated: function () {
        if (!this._budDetailsGrid)
            this.createDetailsGrid();
    },

    printDetailsGrid: function () {
        var me = this;

        Ext.ux.Printer.print('Budget Details', _builtInTemplate_6091cb6c[11],
         { incomeTypes: me._budDetailsGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },

    createChildControls: function () {
        var me = this;

        this._budgetAccountStore = new Bud.data.BudgetAccountStore();
        this._fiscalPeriodStore = new Bud.data.FiscalPeriodStore();
        this._budgetAccountStore4ComboBox = new Bud.data.BudgetAccountStore();
        this._budDetailsStore = new Bud.data.BudDetailsStore();

        me._accountComboBox = new WebLight.form.ComboBox({
            mode: 'local',
            typeAhead: true,
            triggerAction: 'all',
            //editable: false,
            store: this._budgetAccountStore4ComboBox,
            displayField: 'friendlyName',
            valueField: 'id',
            width: 230
        });

        var addButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Add Account Code', width: 120, id: me.getClientId('btnAdd'),
            handler: function () {
                var id = me._accountComboBox.getValue();
                if (id) {
                    var rec = me._budgetAccountStore.getById(id);
                    if (rec) {
                        me._budDetailsStore.addNewRecord(rec);
                    }
                    fin.bud.modified(true);
                }
                else
                    alert('You must select an account to be added.');
            }
        });
        var saveButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Save', width: 80, id: me.getClientId('btnSave'),
            handler: function () {
                me._budDetailsStore.submitChanges(function () {
                    //me._budDetailsStore.reload();
                    fin.bud.modified(false);
                });
            }
        });
        var cancelButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Cancel', width: 80, id: me.getClientId('btnCancel'),
            handler: function () {
                me._budDetailsStore.reload();
            }
        });
        var printButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Print', width: 80,
            handler: function () {
                me.printDetailsGrid();
            }
        });

        this.addChildControl(me._accountComboBox, 'account-combobox');
        this.addChildControl(addButton, 'add-account-code-button');
        this.addChildControl(saveButton, 'save-button');
        this.addChildControl(cancelButton, 'cancel-button');
        this.addChildControl(printButton, 'print-button');

        Bud.page.BudgetDetailsPage.superclass.createChildControls.call(this);
    },

    dataBind: function () {
        var me = this;

        this._budgetAccountStore.on('load', function (store, records) {
            Ext.each(records, function (rec, index) {
                if (['5950', '5805', '5405'].indexOf(rec.get('code')) < 0) {
                    me._budgetAccountStore4ComboBox.add(rec);
                }
            });
        });

        this.grouping([this, this._budgetAccountStore, this._budDetailsStore, this._fiscalPeriodStore], {
            load: function () {
                me._budDetailsStore.relateTo(me._budgetAccountStore);
                me.refreshGridColumnModel();
                me.ensureDetailsGridCreated();
            }
        });

        this.on('contextChanged', function () {
            me._fiscalPeriodStore.load(me.getFscYear());
            me._budDetailsStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
        });
        this.on('modechanged', function () {
            me.onModeChanged();
        });

        this._budgetAccountStore.load();

        Bud.page.BudgetDetailsPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    onModeChanged: function () {
        var me = this;
        var btnSave = Ext.get(me.getClientId('btnSave'));
        var btnCancel = Ext.get(me.getClientId('btnCancel'));
        var btnAdd = Ext.get(me.getClientId('btnAdd'));
        if (me.isReadOnlyMode()) {
            btnSave.hide();
            btnCancel.hide();
            btnAdd.hide();
        } else {
            btnSave.show();
            btnCancel.show();
            btnAdd.show();
        }
    }
});

WebLight.PageMgr.registerType('budgetdetails', Bud.page.BudgetDetailsPage);




WebLight.namespace('Bud.page');

Bud.page.BudgetSummaryPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Bgt Summary',
    html: _builtInTemplate_6091cb6c[12],

    _summaryGridColumnModel: null,
    _summaryGrid: null,
    _summaryStore: null,
    _summaryCommentStore: null,

    _budAnnualProjectionSnapshotStore: null,
    _budgetAccountStore: null,
    _currentYearBudgetStore: null,
    _lastYearBudgetStore: null,
    _budProjectedDetailStore: null,

    isDataLoaded: false,

    refreshColumnModel: function () {
        var me = this;

        var displayRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (record && metaData) {
                if (!record.get('fscAccCode')) {
                    if (colIndex == 0)
                        metaData.attr = 'style="font-weight:bold;font-size:1.1em;text-align:right;"';
                    else
                        metaData.attr = 'style="font-weight:bold;font-size:1.1em;"';
                }
                else {
                    if (colIndex == 7)
                        metaData.attr = 'style="color:#43A643;font-weight:bold;"';
                }
                if (record.get('description') == 'Revenue' && typeof value == 'number')
                    value = -value;
            }

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000');

            return value;
        };

        var percentageRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (metaData)
                metaData.attr = 'style="font-weight:bold;"';

            return Ext.util.Format.number(value * 100, '0.00%');
        }

        var year = this.getFscYearTitle();
        var prevYear = this.getPrevFscYearTitle();

        var columns = [
            { header: 'GL Account<br />&nbsp;', width: 200, dataIndex: 'description', renderer: displayRenderer },
            { header: 'Account Number<br />&nbsp;', dataIndex: 'fscAccCode', renderer: displayRenderer },
            { header: String.format('{0} Annual<br/>Projections', prevYear), align: 'center', dataIndex: 'annualProjections', renderer: displayRenderer },
            { header: String.format('{0} Original<br />Budget', prevYear), align: 'center', dataIndex: 'originalBudget', renderer: displayRenderer },
            { header: String.format('{0} Budget<br />&nbsp;', year), align: 'center', dataIndex: 'budget', renderer: displayRenderer },
            { header: 'Variance<br />&nbsp;', align: 'center', dataIndex: 'variance', renderer: displayRenderer },
            { header: 'Variance Perc<br />&nbsp;', align: 'center', dataIndex: 'variancePercentage', renderer: percentageRenderer },
            { header: 'Comments<br />&nbsp;', width: 350, dataIndex: 'comment', renderer: displayRenderer,
                editor: new Ext.form.TextField()
            }
        ];

        if (this._summaryGridColumnModel) {
            this._summaryGridColumnModel.setConfig(columns);
        }
        else {
            this._summaryGridColumnModel = new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                isCellEditable: function (col, row) {
                    var record = me._summaryStore.getAt(row);
                    return col == 7 && !!record.get('fscAccCode');
                },
                columns: columns
            });
        }
    },

    createSummaryGrid: function () {
        var me = this;

        this.refreshColumnModel();

        this._summaryGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', height: 400,

            enableHdMenu: false,
            width: 1250,
            clicksToEdit: 1,
            cm: this._summaryGridColumnModel,
            store: this._summaryStore,
            viewConfig: {
                forceFit: true
            }
        });

        this.addChildControl(this._summaryGrid, 'budget-summary-grid');

        this._summaryStore.on('datarefresh', function () {
            setTimeout(function () {
                me._summaryGrid.getView().refresh();
            }, 100);
        });

        this._summaryGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });

        this._summaryGrid.on('afteredit', function (e) {
            fin.bud.modified(true);
        });
    },

    printSummaryGrid: function () {
        var me = this;

        Ext.ux.Printer.print('Budget Summary', _builtInTemplate_6091cb6c[13],
         { incomeTypes: me._summaryGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },

    createChildControls: function () {
        var me = this;

        this._summaryStore = new Bud.data.BudSummaryStore();
        this._summaryCommentStore = new Bud.data.BudSummaryCommentStore();

        this._summaryCommentStore.on('load', function () { fin.bud.modified(false); });

        this._budAnnualProjectionSnapshotStore = new Bud.data.BudAnnualProjectionSnapshotStore();
        this._budgetAccountStore = new Bud.data.BudgetAccountStore();
        this._currentYearBudgetStore = new Bud.data.BudDetailsStore();
        this._lastYearBudgetStore = new Bud.data.BudDetailsStore();
        this._budProjectedDetailStore = new Bud.data.BudProjectedDetailStore();

        var saveButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Save', width: 80, id: me.getClientId('btnSave'),
            handler: function () {

                var records = me._summaryStore.getChangedRecords();
                Ext.each(records, function (record, index) {
                    if (!!record.get('fscAccCode')) {
                        me._summaryCommentStore.add(me._summaryCommentStore.newRecord({
                            comment: record.get('comment'),
                            fscAccount: record.get('fscAccount')
                        }));
                    }
                });
                me._summaryCommentStore.submitChanges(function () {
                    me._summaryCommentStore.reload();
                });
            }
        });
        var cancelButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Cancel', width: 80, id: me.getClientId('btnCancel'),
            handler: function () {
                me._summaryCommentStore.reload();
            }
        });
        var printButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Print', width: 80,
            handler: function () {
                me.printSummaryGrid();
            }
        });

        this.addChildControl(saveButton, 'save-button');
        this.addChildControl(cancelButton, 'cancel-button');
        this.addChildControl(printButton, 'print-button');

        Bud.page.BudgetSummaryPage.superclass.createChildControls.call(this);
    },

    dataBind: function () {
        var me = this;

        this.on('contextChanged', function () {
            me.isDataLoaded = false;

            if (me._summaryGrid)
                me.refreshColumnModel();
            else
                me.createSummaryGrid();

            me._budAnnualProjectionSnapshotStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getPrevFscYear());
            me._currentYearBudgetStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._lastYearBudgetStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getPrevFscYear());
            me._summaryCommentStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._budProjectedDetailStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getPrevFscYear());
        });
        this.on('modechanged', function () {
            me.onModeChanged();
        });


        this.grouping([this,
            this._budAnnualProjectionSnapshotStore,
            this._budgetAccountStore,
            this._currentYearBudgetStore,
            this._lastYearBudgetStore,
            this._summaryCommentStore,
            this._budProjectedDetailStore], {
                load: function () {
                    if (!me.isDataLoaded) {
                        //                        me._currentYearBudgetStore.assign(me._budgetAccountStore);
                        //                        me._lastYearBudgetStore.assign(me._budgetAccountStore);
                        me._summaryStore.setFscAccountStore(me._budgetAccountStore);

                        me._summaryStore.setStores(me._currentYearBudgetStore,
                            me._lastYearBudgetStore, me._budProjectedDetailStore,
                            me._budAnnualProjectionSnapshotStore);

                        //me._summaryStore.combine(me._currentYearBudgetStore, me._lastYearBudgetStore);

                        me.isDataLoaded = true;
                    }
                    me._summaryStore.relateTo(me._summaryCommentStore);
                }
            });

        this._budgetAccountStore.load();

        Bud.page.BudgetSummaryPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },
    onModeChanged: function () {
        var me = this;
        var btnSave = Ext.get(me.getClientId('btnSave'));
        var btnCancel = Ext.get(me.getClientId('btnCancel'));
        if (me.isReadOnlyMode()) {
            btnSave.hide();
            btnCancel.hide();
        } else {
            btnSave.show();
            btnCancel.show();
        }
    }
});

WebLight.PageMgr.registerType('budgetsummary', Bud.page.BudgetSummaryPage);


/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.page.CapitalExpendituresPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Capital Exp',
    html: _builtInTemplate_6091cb6c[14],

    _capitalExpenditureTab: null,
    _appJDEGLTransactionStore: null,

    _newCapitalEquipmentStore: null,
    _newCapitalEquipmentGrid: null,

    _capitalEquipmentDisposalStore: null,
    _capitalEquipmentDisposalGrid: null,

    _deprecationGrid: null,
    _deprecationGrid2: null,
    _deprecationDisposalGrid: null,

    _capitalExpDeprecationStore: null,
    _capitalExpDeprecationStore2: null,
    _capitalExpDeprecationDisposalStore: null,

    createCapitalExpenditureStore: function () {
        var fields = [{ name: 'description'}];
        for (var i = 0; i < 12; i++) {
            fields.push({ name: String.format('period{0}', i + 1), type: 'float' });
        }
        fields.push({ name: 'total', type: 'float' });

        this._capitalExpDeprecationStore = new Ext.data.JsonStore({
            root: 'data',
            fields: fields
        });
        this._capitalExpDeprecationStore2 = new Ext.data.JsonStore({
            root: 'data',
            fields: fields
        });
        this._capitalExpDeprecationDisposalStore = new Ext.data.JsonStore({
            root: 'data',
            fields: fields
        });
    },

    renderValue: function (value) {
        if (typeof value == 'string')
            return value;
        else if (typeof value == 'number') {
            return value ? value : '';
        }
        return '';
    },

    addNewCapitalEquipmentTab: function () {
        var me = this;

        var newCapitalEquipmentRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == me._newCapitalEquipmentStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            return me.renderValue(value);
        };

        var colModel = new Ext.grid.ColumnModel({
            defaults: { sortable: false },
            columns: [
                { header: 'Equipment Description', dataIndex: 'description', width: 200, css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.TextField(),
                    renderer: newCapitalEquipmentRenderer
                },
                { header: 'Period', dataIndex: 'periodInstalled', css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.NumberField({ allowDecimals: false, minValue: 0, maxValue: 12 }),
                    align: 'right', renderer: newCapitalEquipmentRenderer
                },
                { header: 'Cost', dataIndex: 'cost', css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.NumberField(), align: 'right',
                    renderer: newCapitalEquipmentRenderer
                },
                { header: 'Estimated Useful Life (Years)', dataIndex: 'usefulLife', width: 200, css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.NumberField({ allowDecimals: false }),
                    align: 'right', renderer: newCapitalEquipmentRenderer
                },
                { header: 'Depreciation Per Period', dataIndex: 'depreciationPerPeriod', width: 200,
                    align: 'right', renderer: newCapitalEquipmentRenderer
                },
                { header: 'Justification', dataIndex: 'justification', width: 200, css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.TextField(),
                    renderer: newCapitalEquipmentRenderer
                },
                { header: 'Remove', width: 60, align: 'center',
                    renderer: function (value, metaData, record, rowIndex, colIndex, store) {
                        if (record.get('_sysStatus') == 1 && rowIndex != me._newCapitalEquipmentStore.getCount() - 1)
                            return '<a href="javascript:void(0);" xcmd="remove">Remove</a>';
                        return '';
                    }
                }
            ],
            isCellEditable: function (colIndex, rowIndex) {
                return rowIndex < me._newCapitalEquipmentStore.getCount() - 1;
            }
        });

        this._newCapitalEquipmentGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', height: 400,
            enableHdMenu: false,
            clicksToEdit: 1,
            store: this._newCapitalEquipmentStore,
            cm: colModel,
            width: 1150
        });
        this._newCapitalEquipmentGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });

        this._newCapitalEquipmentGrid.on('afteredit', function (e) {
            fin.bud.modified(true);
        });

        this._newCapitalEquipmentGrid.on('cellclick', function (grid, rowIndex, colIndex, e) {
            var cmd = $(e.getTarget()).attr('xcmd');
            var record = grid.getStore().getAt(rowIndex);
            switch (cmd) {
                case 'remove':
                    grid.getStore().remove(record);
                    me._newCapitalEquipmentGrid.getView().refresh();
                    break;
            }
        });


        var addButton = new Ext.Button({
            text: 'Add New Row', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnEquipmentAdd'),
            handler: function () {
                me._newCapitalEquipmentStore.addNewRecord();
                me._newCapitalEquipmentGrid.getView().refresh();
                fin.bud.modified(true);
            }
        });
        var saveButton = new Ext.Button({
            text: 'Save', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnEquipmentSave'),
            handler: function () {
                me._newCapitalEquipmentStore.submitChanges(function () {
                    me._newCapitalEquipmentStore.reload();

                });
            }
        });
        var cancelButton = new Ext.Button({
            text: 'Cancel', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnEquipmentCancel'),
            handler: function () {
                me._newCapitalEquipmentStore.reload();
            }
        });
        var printButton = new Ext.Button({
            text: 'Print', ctCls: 'ux-button-1', width: 90,
            handler: function () {
                me.printNewCapitalEquipmentWorksheet();
            }
        });

        me._newCapitalEquipmentStore.on('update', function () {
            me._newCapitalEquipmentGrid.getView().refresh();
        });

        this._newCapitalEquipmentStore.on('load', function () {
            fin.bud.modified(false);
        });

        this.addChildControl(this._newCapitalEquipmentGrid, 'new-capital-equipment-grid');
        this.addChildControl(addButton, 'nce-addNewRowButton');
        this.addChildControl(saveButton, 'nce-saveButton');
        this.addChildControl(cancelButton, 'nce-cancelButton');
        this.addChildControl(printButton, 'nce-printButton');
    },

    addcapitalEquipmentDisposalTab: function () {
        var me = this;

        var capitalEquipmentDisposalRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == me._capitalEquipmentDisposalStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            return me.renderValue(value);
        };

        var colModel = new Ext.grid.ColumnModel({
            defaults: { sortable: false },
            columns: [
                { header: 'Equipment Description', dataIndex: 'description', width: 200, css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.TextField(),
                    renderer: capitalEquipmentDisposalRenderer
                },
                { header: 'Period Disposed', dataIndex: 'periodDisposed', css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.NumberField({ allowDecimals: false, minValue: 0, maxValue: 12 }),
                    align: 'right', renderer: capitalEquipmentDisposalRenderer
                },
                { header: 'Book Value', dataIndex: 'cost', css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.NumberField(), align: 'right',
                    renderer: capitalEquipmentDisposalRenderer
                },
                { header: 'Period Depreciation', dataIndex: 'periodDepreciation', css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.NumberField(), align: 'right',
                    renderer: capitalEquipmentDisposalRenderer
                },
                { header: 'Justification', dataIndex: 'justification', width: 200, css: 'color:#43A643;font-weight:bold;',
                    editor: new Ext.form.TextField(),
                    renderer: capitalEquipmentDisposalRenderer
                },
                { header: 'Remove', width: 60, align: 'center',
                    renderer: function (value, metaData, record, rowIndex, colIndex, store) {
                        if (record.get('_sysStatus') == 1 && rowIndex != me._capitalEquipmentDisposalStore.getCount() - 1)
                            return '<a href="javascript:void(0);" xcmd="remove">Remove</a>';
                        return '';
                    }
                }
            ],
            isCellEditable: function (colIndex, rowIndex) {
                return rowIndex < me._capitalEquipmentDisposalStore.getCount() - 1;
            }
        });

        this._capitalEquipmentDisposalGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', height: 400,
            enableHdMenu: false,
            clicksToEdit: 1,
            store: this._capitalEquipmentDisposalStore,
            cm: colModel,
            width: 1250
        });

        this._capitalEquipmentDisposalGrid.on('cellclick', function (grid, rowIndex, colIndex, e) {
            var cmd = $(e.getTarget()).attr('xcmd');
            var record = grid.getStore().getAt(rowIndex);
            switch (cmd) {
                case 'remove':
                    grid.getStore().remove(record);
                    me._capitalEquipmentDisposalGrid.getView().refresh();
                    break;
            }
        });

        this._capitalEquipmentDisposalGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });

        this._capitalEquipmentDisposalGrid.on('afteredit', function (e) {
            fin.bud.modified(true);
        });

        var addButton = new Ext.Button({
            text: 'Add New Row', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnCapitalAdd'),
            handler: function () {
                me._capitalEquipmentDisposalStore.addNewRecord();
                me._capitalEquipmentDisposalGrid.getView().refresh();
                fin.bud.modified(true);
            }
        });
        var saveButton = new Ext.Button({
            text: 'Save', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnCapitalSave'),
            handler: function () {
                me._capitalEquipmentDisposalStore.submitChanges(function () {
                    me._capitalEquipmentDisposalStore.reload();
                });
            }
        });
        var cancelButton = new Ext.Button({
            text: 'Cancel', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnCapitalCancel'),
            handler: function () {
                me._capitalEquipmentDisposalStore.reload();
            }
        });
        var printButton = new Ext.Button({
            text: 'Print', ctCls: 'ux-button-1', width: 90,
            handler: function () {
                me.printCapitalEquipmentDisposalWorksheet();
            }
        });

        me._capitalEquipmentDisposalStore.on('update', function () {
            me._capitalEquipmentDisposalGrid.getView().refresh();
        });

        me._capitalEquipmentDisposalStore.on('load', function () { fin.bud.modified(false); });

        this.addChildControl(this._capitalEquipmentDisposalGrid, 'capital-equipment-disposal-grid');
        this.addChildControl(addButton, 'ced-addNewRowButton');
        this.addChildControl(saveButton, 'ced-saveButton');
        this.addChildControl(cancelButton, 'ced-cancelButton');
        this.addChildControl(printButton, 'ced-printButton');
    },

    addDeprecationTab: function () {
        var me = this;

        var columns = [{ header: 'Equipment Description', dataIndex: 'description', width: 200}];
        var columns2 = [{ header: 'Period', dataIndex: 'description', width: 200}];
        for (var i = 0; i < 12; i++) {
            columns.push({
                header: String.format('Period {0}', i + 1),
                dataIndex: String.format('period{0}', i + 1),
                align: 'right', width: 70
            });
            columns2.push({
                header: String.format('{0}', i + 1),
                dataIndex: String.format('period{0}', i + 1),
                align: 'right', width: 70
            });
        }
        columns.push({ header: 'Total', align: 'right', dataIndex: 'total', width: 70 });
        columns2.push({ header: 'Total', align: 'right', dataIndex: 'total', width: 70 });

        this._deprecationGrid = new Bud.grid.GridPanel({
            ctCls: 'ux-grid-1', width: 1250, maxHeight: 400,
            enableHdMenu: false,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: columns
            }),
            store: me._capitalExpDeprecationStore
        });

        this._deprecationGrid2 = new Bud.grid.GridPanel({
            ctCls: 'ux-grid-1', width: 1250, height: 400,
            enableHdMenu: false,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: columns2
            }),
            store: me._capitalExpDeprecationStore2
        });

        var printButton = new Ext.Button({
            text: 'Print', ctCls: 'ux-button-1', width: 90,
            handler: function () {
                me.printDepreciationWorksheet();
            }
        });

        this.addChildControl(this._deprecationGrid, 'depreciation-grid1');
        this.addChildControl(this._deprecationGrid2, 'depreciation-grid2');
        this.addChildControl(printButton, 'depreciation-printButton');
    },

    addDeprecationDisposalTab: function () {
        var me = this;

        var columns = [{ header: 'Equipment Description', dataIndex: 'description', width: 200}];
        for (var i = 0; i < 12; i++) {
            columns.push({
                header: String.format('Period {0}', i + 1),
                dataIndex: String.format('period{0}', i + 1),
                align: 'right', width: 70
            });
        }
        columns.push({ header: 'Total', align: 'right', dataIndex: 'total', width: 70 });

        this._deprecationDisposalGrid = new Bud.grid.GridPanel({
            ctCls: 'ux-grid-1', width: 1250, height: 400,
            enableHdMenu: false,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: columns
            }),
            store: me._capitalExpDeprecationDisposalStore
        });

        var printButton = new Ext.Button({
            text: 'Print', ctCls: 'ux-button-1', width: 90,
            handler: function () {
                me.printDepreciationDisposalWorksheet();
            }
        });

        this.addChildControl(this._deprecationDisposalGrid, 'depreciation-disposal-grid');
        this.addChildControl(printButton, 'dd-printButton');
    },

    printNewCapitalEquipmentWorksheet: function () {
        var me = this;
        me._newCapitalEquipmentGrid.getColumnModel().config[me._newCapitalEquipmentGrid.getColumnModel().config.length - 1].hidden = true;

        Ext.ux.Printer.print('New Capital Equipment Worksheet', _builtInTemplate_6091cb6c[15],
         { incomeTypes: me._newCapitalEquipmentGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');

        me._newCapitalEquipmentGrid.getColumnModel().config[me._newCapitalEquipmentGrid.getColumnModel().config.length - 1].hidden = false;
    },

    printCapitalEquipmentDisposalWorksheet: function () {
        var me = this;
        me._capitalEquipmentDisposalGrid.getColumnModel().config[me._capitalEquipmentDisposalGrid.getColumnModel().config.length - 1].hidden = true;

        Ext.ux.Printer.print('Capital Equipment Disposal Worksheet', _builtInTemplate_6091cb6c[16],
         { incomeTypes: me._capitalEquipmentDisposalGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');

        me._capitalEquipmentDisposalGrid.getColumnModel().config[me._capitalEquipmentDisposalGrid.getColumnModel().config.length - 1].hidden = false;
    },

    printDepreciationWorksheet: function () {
        var me = this;

        Ext.ux.Printer.print('Depreciation Worksheet', _builtInTemplate_6091cb6c[17],
         { incomeTypes: me._deprecationGrid,
             incomeTypes2: me._deprecationGrid2,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },

    printDepreciationDisposalWorksheet: function () {
        var me = this;

        Ext.ux.Printer.print('Depreciation Disposal Worksheet', _builtInTemplate_6091cb6c[18],
         { incomeTypes: me._deprecationDisposalGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },


    createChildControls: function () {
        var me = this;
        this._appJDEGLTransactionStore = new Bud.data.BudAppJDEGLTransactionStore();
        this._newCapitalEquipmentStore = new Bud.data.BudCapitalExpenditureStore();
        this._capitalEquipmentDisposalStore = new Bud.data.BudCapitalExpenditureStore();
        this.createCapitalExpenditureStore();

        this.addNewCapitalEquipmentTab();
        this.addcapitalEquipmentDisposalTab();
        this.addDeprecationTab();
        this.addDeprecationDisposalTab();

        this._newCapitalEquipmentStore.on('datarefresh', function () {
            me._newCapitalEquipmentGrid.getView().refresh();
            me._deprecationGrid2.getView().refresh();
            me._deprecationGrid.getView().refresh();
        });

        this._capitalEquipmentDisposalStore.on('datarefresh', function () {
            me._capitalEquipmentDisposalGrid.getView().refresh();
            me._deprecationGrid2.getView().refresh();
            me._deprecationDisposalGrid.getView().refresh();
        });

        Bud.page.CapitalExpendituresPage.superclass.createChildControls.call(this);

        this._capitalExpenditureTab = $('#' + this.getClientId('capital-expanditurer-tab-panel')).tabs({
            select: function (event, ui) { return !fin.bud.modified(); }
        });
    },

    dataBind: function () {
        var me = this;

        this.on('contextChanged', function () {
            // 9: get appJDEGLTransaction for capital 
            me._appJDEGLTransactionStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 0, 9);
            me._appJDEGLTransactionStore.on('load', function () {
                me._newCapitalEquipmentStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 1);
                me._capitalEquipmentDisposalStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 2);
            });
        });

        this.on('modechanged', function () {
            me.onModeChanged();
        });

        var decimal2 = function (v) {
            if (v)
                return Math.round(v * 100) / 100;
            return 0;
        };

        var bindDeprecationStore = function () {

            var totalNewDepreciation = [];
            var lessDisposedEquipment = [];
            // init arrays
            for (var i = 0; i < 12; i++) {
                totalNewDepreciation[i] = 0;
                lessDisposedEquipment[i] = 0;
            }

            var data1 = [];
            for (var n = 0; n < me._newCapitalEquipmentStore.getCount() - 1; n++) {
                var record = me._newCapitalEquipmentStore.getAt(n);
                var d = { description: record.get('description') };
                var total = 0;

                for (var i = 0; i < 12; i++) {
                    if (record.get('periodInstalled') <= i + 1) {
                        d[String.format('period{0}', i + 1)] = record.get('depreciationPerPeriod');
                        total += record.get('depreciationPerPeriod');
                        totalNewDepreciation[i] += record.get('depreciationPerPeriod')
                    }
                }
                d['total'] = decimal2(total);
                data1.push(d);
            }

            var data2 = [];
            for (var n = 0; n < me._capitalEquipmentDisposalStore.getCount() - 1; n++) {
                var record = me._capitalEquipmentDisposalStore.getAt(n);
                var d = { description: record.get('description') };
                var total = 0;
                for (var i = 0; i < 12; i++) {
                    if (record.get('periodDisposed') <= i + 1) {
                        d[String.format('period{0}', i + 1)] = -record.get('periodDepreciation');
                        total += record.get('periodDepreciation');
                        lessDisposedEquipment[i] += -record.get('periodDepreciation');
                    }
                }
                d['total'] = -decimal2(total);
                data2.push(d);
            }

            var dataArr = [
                { description: 'Total New Depreciation' },
                { description: 'Carry Forward Depr. per Sch' },
                { description: 'Less Disposed Equipment' },
                { description: 'Total Depreciation' }
            ];

            var cfdPerSch = 0;
            me._appJDEGLTransactionStore.each(function (rec) {
                cfdPerSch += rec.get('appJDEtAmount');
            });

            var t1 = 0, t2 = 0, t3 = 0, t4 = 0;

            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);

                dataArr[0][field] = decimal2(totalNewDepreciation[i]);
                dataArr[1][field] = decimal2(cfdPerSch);
                dataArr[2][field] = decimal2(lessDisposedEquipment[i]);
                dataArr[3][field] = decimal2(totalNewDepreciation[i] + cfdPerSch + lessDisposedEquipment[i]);

                t1 += totalNewDepreciation[i];
                t2 += cfdPerSch;
                t3 += lessDisposedEquipment[i];
                t4 += totalNewDepreciation[i] + cfdPerSch + lessDisposedEquipment[i];
            }

            dataArr[0]['total'] = decimal2(t1);
            dataArr[1]['total'] = decimal2(t2);
            dataArr[2]['total'] = decimal2(t3);
            dataArr[3]['total'] = decimal2(t4);

            data2.push(Ext.applyIf({ description: 'Total' }, dataArr[2]));

            me._capitalExpDeprecationStore.loadData({ data: data1 });
            me._capitalExpDeprecationStore2.loadData({ data: dataArr });
            me._capitalExpDeprecationDisposalStore.loadData({ data: data2 });
        };

        me._newCapitalEquipmentStore.on({
            add: bindDeprecationStore,
            remove: bindDeprecationStore,
            update: bindDeprecationStore,
            datachanged: bindDeprecationStore
        });
        me._capitalEquipmentDisposalStore.on({
            add: bindDeprecationStore,
            remove: bindDeprecationStore,
            update: bindDeprecationStore,
            datachanged: bindDeprecationStore
        });

        this.grouping([this, this._newCapitalEquipmentStore, this._capitalEquipmentDisposalStore]
        , {

        });

        Bud.page.CapitalExpendituresPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },
    onModeChanged: function () {
        var me = this;
        var btnCapitalAdd = Ext.get(me.getClientId('btnCapitalAdd'));
        var btnCapitalSave = Ext.get(me.getClientId('btnCapitalSave'));
        var btnCapitalCancel = Ext.get(me.getClientId('btnCapitalCancel'));
        var btnEquipmentAdd = Ext.get(me.getClientId('btnEquipmentAdd'));
        var btnEquipmentSave = Ext.get(me.getClientId('btnEquipmentSave'));
        var btnEquipmentCancel = Ext.get(me.getClientId('btnEquipmentCancel'));
        if (me.isReadOnlyMode()) {
            btnCapitalAdd.hide();
            btnCapitalSave.hide();
            btnCapitalCancel.hide();
            btnEquipmentAdd.hide();
            btnEquipmentSave.hide();
            btnEquipmentCancel.hide();
        } else {
            btnCapitalAdd.show();
            btnCapitalSave.show();
            btnCapitalCancel.show();
            btnEquipmentAdd.show();
            btnEquipmentSave.show();
            btnEquipmentCancel.show();
        }
    }
});

WebLight.PageMgr.registerType('capitalexpenditures', Bud.page.CapitalExpendituresPage);


/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.page.ContractBillingPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Contract Billing',
    html: _builtInTemplate_6091cb6c[19],
    arrayStore: null,

    _billingPeriodLabel: null,
    _currentBillingRateTextBox: null,
    _currentBillingDailyRateLabel: null,

    _currentBillingPercentIncreaseTextBox: null,
    _currentBillingAmountIncreaseLabel: null,
    _currentBillingDateEffectiveDateBox: null,
    _newBillingRateLabel: null,
    _newBillingDailyRateLabel: null,


    _currentBillingDailyRate: 0,
    _newBillingDailyRate: 0,

    _incomeTypeStore: null,
    _incomeTypeGrid: null,
    _incomeTypeGridColumnModel: null,
    _liveIncomeTypeStore: null,
    _billingPeriodStore: null,
    _hcmHouseDetailStore: null,

    _fiscalPeriodStore: null,
    _currentBillingNoes: null,
    _currentBillingSaveButton: null,
    _currentBillingCancelButton: null,
    _currentBillingPrintButton: null,


    createBillingPeriodFields: function () {

        this._billingPeriodLabel = Ext.create({ xtype: 'displayfield' });
        this.addChildControl(this._billingPeriodLabel, 'billing-period');

        this._currentBillingRateTextBox = Ext.create({ xtype: 'numberfield', priceUnit: '', priceDelemiter: ',', style: 'border-width:0px; color:#5679FF; text-align:right;' });
        this.addChildControl(this._currentBillingRateTextBox, 'current-billing-rate');

        this._currentBillingDailyRateLabel = Ext.create({ xtype: 'displayfield' });
        this.addChildControl(this._currentBillingDailyRateLabel, 'current-billing-daily-rate');


        this._currentBillingPercentIncreaseTextBox = Ext.create({ xtype: 'numberfield', style: 'border-width:0px; color:#5679FF; text-align:right;' });
        this.addChildControl(this._currentBillingPercentIncreaseTextBox, 'current-billing-percent-increase');

        this._currentBillingAmountIncreaseLabel = Ext.create({ xtype: 'displayfield' });
        this.addChildControl(this._currentBillingAmountIncreaseLabel, 'current-billing-amount-increase');

        this._currentBillingDateEffectiveDateBox = Ext.create({ xtype: 'datefield', style: 'color:#5679FF; text-align:right;' });
        this.addChildControl(this._currentBillingDateEffectiveDateBox, 'current-billing-date-effective');


        this._newBillingRateLabel = Ext.create({ xtype: 'displayfield' });
        this.addChildControl(this._newBillingRateLabel, 'new-billing-rate');

        this._newBillingDailyRateLabel = Ext.create({ xtype: 'displayfield' });
        this.addChildControl(this._newBillingDailyRateLabel, 'new-billing-daily-rate');


        this._billingPeriodLabel.setValue('Monthly');
        this._currentBillingPercentIncreaseTextBox.setValue('0');
        this._currentBillingRateTextBox.setValue('0');

        this._currentBillingRateTextBox.on('change', function () {
            this.refreshPeriodFields();
            this.applyRateToGrid();
        }, this);

        this._currentBillingPercentIncreaseTextBox.on('change', function () {
            this.refreshPeriodFields();
            this.applyRateToGrid();
        }, this);

        this._currentBillingDateEffectiveDateBox.on('change', function () {
            this.applyRateToGrid();
        }, this);
    },

    applyRateToGrid: function (isInit) {

        if (isInit !== true)
            fin.bud.modified(true);

        // 169 Full Service Billings
        // 170 Management Fee Billings
        var me = this;
        var incomeTypeId = 170;
        if (this._hcmHouseDetailStore.getCount() > 0) {
            if (this._hcmHouseDetailStore.getAt(0).get('contractTypeId') == 2)
                incomeTypeId = 169;
        }

        var incomeType = this._incomeTypeStore.getById(incomeTypeId);
        if (incomeType) {
            var dateEffective = this._currentBillingDateEffectiveDateBox.getValue();
            for (var i = 0; i < this._fiscalPeriodStore.getCount(); i++) {
                var record = this._fiscalPeriodStore.getAt(i);

                var startDay = record.get('startDate').getYear() * 365 + record.get('startDate').getDayOfYear();
                var endDay = record.get('endDate').getYear() * 365 + record.get('endDate').getDayOfYear();
                var daysInMonth = endDay - startDay + 1;

                var value = this._currentBillingDailyRate * daysInMonth;

                if (me.isMonthlyBilling()) {
                    value = me._currentBillingMonthlyRate;
                    if (dateEffective) {
                        var effectiveDay = dateEffective.getYear() * 365 + dateEffective.getDayOfYear();
                        if (startDay >= effectiveDay || startDay < effectiveDay && endDay > effectiveDay)
                            value = me._newBillingMonthlyRate;
                    }
                }
                else {

                    if (dateEffective) {
                        var effectiveDay = dateEffective.getYear() * 365 + dateEffective.getDayOfYear();
                        if (startDay >= effectiveDay)
                            value = this._newBillingDailyRate * daysInMonth;
                        else if (startDay < effectiveDay && endDay > effectiveDay) {
                            value = (effectiveDay - startDay) * this._currentBillingDailyRate
                         + (endDay - effectiveDay + 1) * this._newBillingDailyRate;
                        }
                    }
                }

                incomeType.set('period' + record.get('title'), parseFloat(value.toFixed(2)));
            }
            this._incomeTypeGrid.getView().refresh(false);
        }
    },

    isMonthlyBilling: function () {
        return this._billingPeriodLabel.getValue() != 'Biweekly';
    },

    refreshPeriodFields: function () {

        var period = this._billingPeriodLabel.getValue();
        var rate = this._currentBillingRateTextBox.getValue();

        if (period == 'Biweekly')
            this._currentBillingDailyRate = rate / 14;
        else
            this._currentBillingDailyRate = rate * 12 / 365;

        var increasedAmount = this._currentBillingPercentIncreaseTextBox.getValue() * rate / 100;
        var dateEffective = this._currentBillingDateEffectiveDateBox.getValue();

        var newRate = rate + increasedAmount;

        this._currentBillingMonthlyRate = rate;
        this._newBillingMonthlyRate = newRate;

        if (period == 'Biweekly')
            this._newBillingDailyRate = newRate / 14;
        else
            this._newBillingDailyRate = newRate * 12 / 365;

        this._currentBillingDailyRateLabel.setValue(Ext.util.Format.number(this._currentBillingDailyRate, '0,000.00'));

        this._currentBillingAmountIncreaseLabel.setValue(Ext.util.Format.number(increasedAmount, '0,000.00'));

        this._newBillingRateLabel.setValue(Ext.util.Format.number(newRate, '0,000.00'));
        this._newBillingDailyRateLabel.setValue(Ext.util.Format.number(this._newBillingDailyRate, '0,000.00'));



    },

    refreshIncomeTypeGridColumnModel: function () {
        var numberRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            return Ext.util.Format.number(value, '0,000.00');
        };

        var descriptionRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (record.get('fscAccCode') == 0)
                return record.get('description');
            return String.format('{0} {1}', record.get('fscAccCode'), record.get('description'));
        };

        var columns = [{ header: this.getFscYearTitle() + ' Period End Dates', width: 200, dataIndex: 'fscAccount', renderer: descriptionRenderer },
          { header: 'Spread', width: 68, dataIndex: 'period0', align: 'center', renderer: function () { return ''; },
              editor: new Ext.form.NumberField()
          }];

        // for (var i = 0; i < this._fiscalPeriodStore.getCount(); i++) {
        for (var i = 0; i < 12; i++) {
            var record = this._fiscalPeriodStore.getAt(i);
            columns.push({ header: Ext.util.Format.date(record.get('endDate'), 'm/d/Y'), width: 70,
                dataIndex: 'period' + record.get('title'), editable: true, renderer: numberRenderer,
                align: 'right',
                editor: new Ext.form.NumberField({ allowBlank: false, allowNegative: true })
            });
        }
        columns.push({ header: this.getFscYearTitle(), align: 'right', width: 70, dataIndex: 'fscYear', renderer: numberRenderer });

        if (this._incomeTypeGridColumnModel)
            this._incomeTypeGridColumnModel.setConfig(columns);
        else {
            this._incomeTypeGridColumnModel = new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: columns
            });
        }
    },

    ensureIncomeTypeGridCreated: function () {
        if (!this._incomeTypeGrid)
            this.createIncomeTypeGrid();
    },

    createIncomeTypeGrid: function () {
        var me = this;

        var descriptionRow = [{ header: 'Period End Date', colspan: 1, align: 'center' }, { header: 'Auto', colspan: 1, align: 'center'}];

        for (var i = 1; i <= 12; i++) {
            descriptionRow.push({ header: 'Period ' + i, colspan: 1 });
        }

        descriptionRow.push({ header: 'Fiscal Year', colspan: 1 });

        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [descriptionRow]
        });

        this.refreshIncomeTypeGridColumnModel();

        this._incomeTypeGrid = new Bud.grid.EditorGridPanel({
            clicksToEdit: 1, enableHdMenu: false, height: 400,
            store: this._incomeTypeStore, width: 1250,
            ctCls: 'ux-grid-1',
            plugins: group,
            cm: this._incomeTypeGridColumnModel
        });

        this._incomeTypeGrid.on('afteredit', function (e) {
            /*
            grid - This grid
            record - The record being edited
            field - The field name being edited
            value - The value being set
            originalValue - The original value for the field, before the edit.
            row - The grid row index
            column - The grid column index
            */

            if (e.field == 'period0' && e.value != e.originalValue) {
                me._incomeTypeGrid.suspendEvents(false);
                for (var i = 1; i <= 12; i++)
                    e.record.set('period' + i, e.value);
                me._incomeTypeGrid.resumeEvents();
            }

            this._incomeTypeGrid.getView().refresh();
            fin.bud.modified(true);
        }, this);

        this._incomeTypeGrid.on('beforeedit', function (e) {
            /*
            grid - This grid
            record - The record being edited
            field - The field name being edited
            value - The value for the field being edited.
            row - The grid row index
            column - The grid column index
            cancel - Set this to true to cancel the edit or return false from your handler.
            */

            if (me.isReadOnlyMode())
                e.cancel = true;

            if (e.record.get('fscAccount') == 0)
                e.cancel = true;

        });

        this.addChildControl(this._incomeTypeGrid, 'period-grid-holder');
    },

    createNoteFields: function () {
        var current = this;
        this._currentBillingNoes = Ext.create({ xtype: 'textarea', style: 'width: 95%' });
        this.addChildControl(this._currentBillingNoes, 'billing-notes');

        this._currentBillingSaveButton = Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Save', width: 80 });
        this._currentBillingSaveButton.on('click', function () {
            //current.maskPage('Saving...');
            if (current._billingPeriodStore.getCount() == 0)
                current._billingPeriodStore.add(current._billingPeriodStore.newRecord({}));
            var record = current._billingPeriodStore.getAt(0);
            record.set('rate', current._currentBillingRateTextBox.getValue());
            record.set('dateEffective', current._currentBillingDateEffectiveDateBox.getValue());
            record.set('percentIncrease', current._currentBillingPercentIncreaseTextBox.getValue() / 100);
            record.set('description', current._currentBillingNoes.getValue());
            current._billingPeriodStore.submitChanges();
            current._incomeTypeStore.submitChanges();
            fin.bud.modified(false);
        }, this);
        this.addChildControl(this._currentBillingSaveButton, 'billing-save-button');

        this._currentBillingCancelButton = Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Cancel', width: 80 });
        this.addChildControl(this._currentBillingCancelButton, 'billing-cancel-button');

        this._currentBillingPrintButton = Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Print', width: 80 });
        this._currentBillingPrintButton.on('click', function () {
            current.print();
        });
        this.addChildControl(this._currentBillingPrintButton, 'billing-print-button');
    },

    createChildControls: function () {
        var me = this;

        this._incomeTypeStore = new Bud.data.IncomeTypeStore();
        this._fiscalPeriodStore = new Bud.data.FiscalPeriodStore();
        this._liveIncomeTypeStore = new Bud.data.IncomeTypeStore();
        this._billingPeriodStore = new Bud.data.BudBillingPeriodStore();
        this._hcmHouseDetailStore = new Bud.data.HcmHouseDetailStore();

        this.createBillingPeriodFields();
        //this.createIncomeTypeGrid();
        this.createNoteFields();

        this.on('contextChanged', function () {
            this._incomeTypeStore.loadSampleData();
            this._billingPeriodStore.load(this.getHcmHouseCode(), this.getHcmJob(), this.getFscYear());
            this._incomeTypeStore.setContext(this.getHcmHouseCode(), this.getHcmJob(), this.getFscYear());
            this._fiscalPeriodStore.load(this.getFscYear());
            this._liveIncomeTypeStore.load(this.getHcmHouseCode(), this.getHcmJob(), this.getFscYear());
            this._hcmHouseDetailStore.load(this.getHcmHouseCode());

        }, this);

        this.on('modechanged', function () {
            me.onModeChanged();
        });

        Bud.page.ContractBillingPage.superclass.createChildControls.call(this);

    },
    dataBind: function () {
        var me = this;

        this._incomeTypeStore.loadSampleData();

        if (this.getFscYear() > 0) {
            this._fiscalPeriodStore.load(this.getFscYear());
            this._liveIncomeTypeStore.load(this.getHcmHouseCode(), this.getHcmJob(), this.getFscYear());
        }
        this.refreshPeriodFields();

        this.grouping([this, this._fiscalPeriodStore, this._liveIncomeTypeStore, this._billingPeriodStore,
             this._incomeTypeStore, this._hcmHouseDetailStore]
        , { 
            load: function () {

            var billingCycleFrequencyTypeId = Bud.Context.primaryNav.currentBillingCycleFrequencyTypeId;               //me._hcmHouseDetailStore.getAt(0).get('billingCycleFrequencyTypeId');
            switch (billingCycleFrequencyTypeId) {
                case 1:
                    me._billingPeriodLabel.setValue('Monthly');
                    break;
                case 2:
                    me._billingPeriodLabel.setValue('Quarterly');
                    break;
                case 3:
                    me._billingPeriodLabel.setValue('Biweekly');
                    break;
            };

            me.refreshIncomeTypeGridColumnModel();
            me.ensureIncomeTypeGridCreated();
            me._incomeTypeGrid.getView().refresh(true);

            if (me._billingPeriodStore.getCount() == 0) {
                me._currentBillingDateEffectiveDateBox.setValue('');
                me._currentBillingPercentIncreaseTextBox.setValue(0);
                me._currentBillingRateTextBox.setValue(0);
                me._currentBillingNoes.setValue('');
            }
            else {
                var record = me._billingPeriodStore.getAt(0);
                me._currentBillingDateEffectiveDateBox.setValue(record.get('dateEffective'));
                me._currentBillingPercentIncreaseTextBox.setValue(parseFloat((record.get('percentIncrease') * 100).toFixed(2)));
                me._currentBillingRateTextBox.setValue(record.get('rate'));
                me._currentBillingNoes.setValue(record.get('description'));
            }
            me.refreshPeriodFields();
            me.applyRateToGrid(true);

            for (var j = 0; j < me._liveIncomeTypeStore.getCount(); j++) {
                var record = me._liveIncomeTypeStore.getAt(j);
                var fscAccount = record.get("fscAccount");
                var incomeType = me._incomeTypeStore.getById(fscAccount);
                if (incomeType) {
                    for (var i = 1; i <= 16; i++)
                        incomeType.set('period' + i, record.get('period' + i));
                }
            }

            me._incomeTypeGrid.getView().refresh(false);
        }
        });


        Bud.page.ContractBillingPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    print: function () {

        Ext.ux.Printer.print('Contract Billing', _builtInTemplate_6091cb6c[20],
         { incomeTypes: this._incomeTypeGrid,
             'billing-period': this._billingPeriodLabel.getValue(),
             'current-rate': Ext.util.Format.number(this._currentBillingRateTextBox.getValue(), '0,000.00'),
             'current-daily-rate': this._currentBillingDailyRateLabel.getValue(),
             'percent-increase': this._currentBillingPercentIncreaseTextBox.getValue(),
             'amount-increase': this._currentBillingAmountIncreaseLabel.getValue(),
             'date-effective': Ext.util.Format.date(this._currentBillingDateEffectiveDateBox.getValue(), 'm/d/Y'),
             'new-rate': this._newBillingRateLabel.getValue(),
             'new-daily-rate': this._newBillingDailyRateLabel.getValue(),
             'description': this._currentBillingNoes.getValue(),
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },

    onModeChanged: function () {
        var me = this;
        if (me.isReadOnlyMode()) {
            me._currentBillingRateTextBox.disable();
            me._currentBillingPercentIncreaseTextBox.disable();
            me._currentBillingDateEffectiveDateBox.disable();
            me._currentBillingNoes.disable();
            me._currentBillingSaveButton.hide();
            me._currentBillingCancelButton.hide();
        } else {
            me._currentBillingRateTextBox.enable();
            me._currentBillingPercentIncreaseTextBox.enable();
            me._currentBillingDateEffectiveDateBox.enable();
            me._currentBillingNoes.enable();
            me._currentBillingSaveButton.show();
            me._currentBillingCancelButton.show();
        }
    }
});

WebLight.PageMgr.registerType('contractbilling', Bud.page.ContractBillingPage);


/// <reference path="../../references/jquery-1.4.1.js" />
/// <reference path="../../references/ext-jquery-adapter.js" />
/// <reference path="../../references/ext-all.js" />
/// <reference path="../../references/weblight4extjs.js" />

WebLight.namespace('Bud.page');

Bud.page.EmployeePage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Employee',
    html: _builtInTemplate_6091cb6c[21],

    _employeeStore: null,

    _employeeGrid: null,
    _statisticsForm: null,
    _increasesCheckbox: null,

    createEmployeeGrid: function () {
        var me = this;
        var checkboxRenderer = function (value) {
            return '<div><input type="checkbox" autocomplete="off" size="24" value="' + (value || '') + '"\
                style="width: 30px; height:16px;border:none;" />\
                </div>';
        }

        var numberRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == me._employeeStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00');

            return value;
        };
        this._employeeGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', enableHdMenu: false, height: 400,
            clicksToEdit: 1, width: 1250,
            viewConfig: { forceFit: true },
            store: this._employeeStore,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                isCellEditable: function (col, row) {
                    return row < current._employeeStore.getCount() - 1;
                },
                columns: [
                        { header: 'Employee<br/>&nbsp;<br/>&nbsp;', dataIndex: 'employeeName', width: 100,
                            renderer: numberRenderer
                        },
                        { header: 'Years <br/>of <br/>Service', dataIndex: 'yearsOfService', width: 70 },
                        { header: 'Vacation <br/>Earned<br/>(Days)', dataIndex: 'vacationDays', width: 80, css: 'color:#43A643;font-weight:bold;',
                            editor: new Ext.form.NumberField({ allowBlank: false, allowNegative: false, minValue: 0 }),
                            renderer: Ext.util.Format.numberRenderer('0,000.00')
                        },
                        { header: 'Employees<br/> due<br/> Increases', dataIndex: 'dueIncrease', width: 100, css: 'color:#43A643;font-weight:bold;',
                            renderer: function (v, metaData, record, rowIndex, colIndex, store) {
                                if (rowIndex == me._employeeStore.getCount() - 1) {
                                    metaData.attr = 'style="color:#333;font-weight:bold;"';
                                    return record.get('dueIncreaseCount');
                                }
                                return v ? 'Y' : 'N';
                            },
                            editor: new Ext.form.Checkbox()
                        },
                        { header: 'Base Wage <br/>Rate<br/>($/hr)', renderer: numberRenderer, align: 'right', dataIndex: 'payRate', width: 70 },
                        { header: 'Shift <br/>Differential<br/>($/hr)', align: 'right', dataIndex: 'differentialPayRate', width: 100, css: 'color:#43A643;font-weight:bold;',
                            renderer: numberRenderer,
                            editor: new Ext.form.NumberField({ allowBlank: false, allowNegative: false, minValue: 0 })
                        },
                        { header: 'Other<br/>($/hr)<br/>&nbsp', align: 'right', dataIndex: 'otherPayRate', width: 70, css: 'color:#43A643;font-weight:bold;',
                            renderer: numberRenderer,
                            editor: new Ext.form.NumberField({ allowBlank: false, allowNegative: false, minValue: 0 })
                        },
                        { header: 'Total Current<br/> Wage rate <br/>per hr', align: 'right', renderer: numberRenderer, dataIndex: 'totalCurrentWageRatePerHour', width: 80 },
                        { header: 'Hours worked <br/>Per Pay<br/> Period', align: 'right', renderer: numberRenderer, dataIndex: 'scheduledHours', width: 100 },
                        { header: 'Cost Per <br/>Pay<br/> Period', align: 'right', renderer: numberRenderer, width: 100, dataIndex: 'costPerPayPeriod' },
                        { header: 'Cost<br/> before <br/>Differential', align: 'right', renderer: numberRenderer, width: 150, dataIndex: 'costBeforeDifferential' },
                        { header: 'Annual<br/>&nbsp<br/>&nbsp', align: 'right', renderer: numberRenderer, width: 150, dataIndex: 'annualSalary' }
                    ]
            })
        });
        var current = this;
        this._employeeGrid.on('afteredit', function (e) {
            //current.setDisplayFieldValue();
            //            if (e.value != e.originalValue) {
            //                this._employeeGrid.getView().refresh();
            //            }
            fin.bud.modified(true);
        }, this);

        this._employeeGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });
    },

    createStatisticsForm: function () {
        var current = this;

        current._increasesCheckbox = Ext.create({ boxLabel: 'Set Increases for all', name: 'setIncreasesForAll', xtype: 'checkbox' })
        this._statisticsForm = new WebLight.form.FormPanel({
            border: false,
            labelWidth: 150, labelAlign: 'right',
            items: [{ border: false, layout: 'column', defaults: { layout: 'form', border: false },
                items: [
                        { columnWidth: .2, items: [
                            { fieldLabel: 'Number of Employees', name: 'numberOfEmployees', labelStyle: 'margin-top:-2px;', numberfield: '0,000', xtype: 'displayfield', width: 50}]
                        },
                        { columnWidth: .2, items: [
                            { fieldLabel: 'Average Wage Rate', name: 'averageWageRate', labelStyle: 'margin-top:-2px;', numberfield: '0,000.00', xtype: 'displayfield', width: 50}]
                        },
                        { columnWidth: .3, labelWidth: 300, items: [
                            { fieldLabel: 'Base Average Wage Rate Excluding Differential', labelStyle: 'margin-top:-2px;', numberfield: '0,000.00', name: 'averageBaseWageRate', xtype: 'displayfield', width: 50}]
                        },
                        { columnWidth: .3, items: [
                           current._increasesCheckbox]
                        }
                    ]
            }]
        });

        //
        this._statisticsForm.getFieldByName('setIncreasesForAll').on('check', function (obj, checked) {
            // current._employeeStore.suspendEvents(false);
            current._employeeStore.ignoreUpdateTotal = true;
            if (checked) {
                for (var i = 0; i < current._employeeStore.getCount(); i++) {
                    var rec = current._employeeStore.getAt(i);
                    var oldValue = rec.get('dueIncrease');
                    if (oldValue !== true) {
                        rec.set('dueIncrease', true);
                    }
                }
            }
            else {
                for (var i = 0; i < current._employeeStore.getCount(); i++) {
                    var rec = current._employeeStore.getAt(i);
                    var oldValue = rec.get('dueIncrease');
                    if (oldValue !== false) {
                        rec.set('dueIncrease', false);
                    }
                }
            }
            current._employeeStore.ignoreUpdateTotal = false;

            fin.bud.modified(true);

            current._employeeStore.updateTotals();
            //  current._employeeStore.resumeEvents();
            current._employeeGrid.getView().refresh();
        });
    },

    createChildControls: function () {
        var current = this;
        this._employeeStore = new Bud.data.EmployeeLockStore();

        this.createEmployeeGrid();
        this.createStatisticsForm();

        Bud.page.EmployeePage.superclass.createChildControls.call(this);

        this.addChildControl(this._employeeGrid, 'employee-grid');
        this.addChildControl(this._statisticsForm, 'employee-form');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', width: 100, text: 'Save Changes', id: current.getClientId('btnSave'),
            handler: function () {

                current._employeeStore.submitChanges(function () {
                    current._employeeStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), 0);
                });
            }
        }), 'employee-save-button');

        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', width: 90, text: 'Print',
            handler: function () {
                current.print();
            }
        }), 'employee-print-button');

    },

    setDisplayFieldValue: function () {
        var numberOfEmployees = this._employeeStore.getCount();
        var totalBaseWageRate = 0;
        var totalWageRate = 0;
        for (var i = 0; i < numberOfEmployees; i++) {
            var r = this._employeeStore.getAt(i);
            totalBaseWageRate += r.get('payRate');
            totalWageRate += r.get('payRate') + r.get('differentialPayRate') + r.get('otherPayRate');
        }

        this._statisticsForm.getFieldByName('numberOfEmployees').setValue(numberOfEmployees);
        this._statisticsForm.getFieldByName('averageBaseWageRate').setValue(Math.round(totalBaseWageRate / numberOfEmployees * 100) / 100);
        this._statisticsForm.getFieldByName('averageWageRate').setValue(Math.round(totalWageRate / numberOfEmployees * 100) / 100);
    },

    dataBind: function () {
        var current = this;

        this.on('contextChanged', function () {
            current._employeeStore.load(current.getHcmHouseCode(), current.getHcmJob(), current.getFscYear(), 0);
        });
        this.on('modechanged', function () {
            current.onModeChanged();
        });

        this._employeeStore.on('load', function () {
            fin.bud.modified(false);
        });
        this._employeeStore.on('datarefresh', function () {
            //this.setDisplayFieldValue();

            current._statisticsForm.getFieldByName('numberOfEmployees').setValue(current._employeeStore.numberOfEmployees);
            current._statisticsForm.getFieldByName('averageBaseWageRate').setValue(current._employeeStore.averageBaseWageRate);
            current._statisticsForm.getFieldByName('averageWageRate').setValue(current._employeeStore.averageWageRate);
        }, this);

        this.grouping([this, this._employeeStore], {
        });

        Bud.page.EmployeePage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    print: function () {
        Ext.ux.Printer.print('Employee', _builtInTemplate_6091cb6c[22],
         { incomeTypes: this._employeeGrid,
             'numberOfEmployees': this._statisticsForm.getFieldByName('numberOfEmployees').getValue(),
             'averageBaseWageRate': this._statisticsForm.getFieldByName('averageBaseWageRate').getValue(),
             'averageWageRate': this._statisticsForm.getFieldByName('averageWageRate').getValue(),
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },
    onModeChanged: function () {
        var me = this;
        var increasesCheckbox = Ext.get(me.getClientId('increasesCheckbox'));
        var saveButton = Ext.get(me.getClientId('btnSave'));
        if (me.isReadOnlyMode()) {
            me._increasesCheckbox.disable();
            saveButton.hide();
        } else {
            me._increasesCheckbox.enable();
            saveButton.show();
        }
    }

});

WebLight.PageMgr.registerType('employee', Bud.page.EmployeePage);



WebLight.namespace('Bud.page');

Bud.page.FinalLaborCalculationsPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Fnl Labor Calc',
    html: _builtInTemplate_6091cb6c[23],

    _flcsStore: null,
    _flcsGrid: null,
    _flcsGridColumnModel: null,
    _fiscalPeriodStore: null,

    _staffingSummaryStore: null,
    _budLaborCalculationStore: null,
    _budHolidayStore: null,
    _budPeriodStore: null,
    _employeeStore: null,
    _vacationStore: null,
    _finalLaborStore: null,

    refreshFlcGridColumnModel: function () {
        var me = this;
        var numberRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            var rowId = record.get('rowId');
            if ((rowId == 13 || rowId == 51 || rowId == 52 || rowId == 54) && (colIndex >= 1 && colIndex <= 12)) {
                metaData.attr = 'style="color:#43A643;font-weight:bold;"';
            }
            else if (rowId == 99) {
                metaData.attr = 'style="font-weight:bold;"';
            }
            if (value == 0) {
                return '0.00';
            }
            return Ext.util.Format.number(value, '0,000.00');
        };

        var columns = [{ header: 'Item', width: 200, dataIndex: 'description',
            renderer: function (value, metaData, record, rowIndex, colIndex, store) {
                if (rowIndex == me._flcsStore.getCount() - 1)
                    metaData.attr = 'style="font-weight:bold;"';

                return value;
            }
        }];
        for (var i = 0; i < this._fiscalPeriodStore.getCount(); i++) {
            var record = this._fiscalPeriodStore.getAt(i);
            columns.push({ header: Ext.util.Format.date(record.get('endDate'), 'm/d/Y'),
                align: 'center', width: 73,
                dataIndex: 'period' + record.get('title'), editable: true, renderer: numberRenderer
            });
        }
        columns.push({ header: this.getFscYearTitle(), align: 'center', width: 75, dataIndex: 'fscYear', renderer: numberRenderer });

        if (this._flcsGridColumnModel)
            this._flcsGridColumnModel.setConfig(columns);
        else {
            this._flcsGridColumnModel = new WebLight.grid.EditorColumnModel({
                defaults: { sortable: false },
                columns: columns,
                isCellEditable: function (colIndex, rowIndex) {
                    var rowId = me._flcsStore.getAt(rowIndex).get('rowId');
                    return (rowId == 13 || rowId == 51 || rowId == 52 || rowId == 54) && (colIndex >= 1 && colIndex <= 12);
                    //return rowIndex == 12 && (colIndex >= 1 && colIndex <= 12);
                },
                getCellEditor: function (colIndex, rowIndex) {
                    return this.createNumberEditor();
                }
            });
        }
    },

    ensureFlcGridCreated: function () {
        if (!this._flcsGrid)
            this.createFlcGrid();
    },

    createFlcGrid: function () {
        var me = this;
        var descriptionRow = [{ header: '', colspan: 1, align: 'center'}];

        for (var i = 1; i <= 12; i++) {
            descriptionRow.push({ header: 'Period ' + i, colspan: 1 });
        }

        descriptionRow.push({ header: 'Fiscal Year', colspan: 1 });

        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [descriptionRow]
        });

        this.refreshFlcGridColumnModel();

        this._flcsGrid = new Bud.grid.EditorGridPanel({
            enableHdMenu: false, clicksToEdit: 1,
            store: this._flcsStore, width: 1250, height: 400,
            ctCls: 'ux-grid-1',
            plugins: group,
            cm: this._flcsGridColumnModel,
            viewConfig: {
                forceFit: true
            }
        });

        this._flcsGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });

        this._flcsGrid.on('afteredit', function () { fin.bud.modified(true); });

        this.addChildControl(this._flcsGrid, 'period-grid-holder');
    },

    createChildControls: function () {
        var me = this;

        Bud.page.FinalLaborCalculationsPage.superclass.createChildControls.call(this);
        this._flcsStore = new Bud.data.BudFinalLaborCalculationSummaryStore();
        this._fiscalPeriodStore = new Bud.data.FiscalPeriodStore();

        this._annualInformationStore = new Bud.data.BudAnnualInformationStore();

        this._budHolidayStore = new Bud.data.BudHolidayStore();
        this._budLaborCalculationStore = new Bud.data.BudLaborCalculationStore();
        this._budPeriodStore = new Bud.data.FiscalPeriodStore();
        this._employeeStore = new Bud.data.EmployeeLockStore();
        this._staffingSummaryStore = new Bud.data.BudStaffingHourStore();

        me._finalLaborStore = new Bud.data.BudFinalLaborStore();
        me._flcsStore.fscPeriodStore = me._fiscalPeriodStore;

        this._vacationStore = new Ext.data.ArrayStore({
            fields: ['annualVacation', 'employees', 'total']
        });

        this._saveButton = Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Save', width: 80, id: me.getClientId('btnSave'), handler:
        function () {
            me._finalLaborStore.removeAll(true);

            var rec13 = me._finalLaborStore.newRecord({ title: 'Overtime Hours' });
            me._finalLaborStore.add(rec13);
            var record13 = me._flcsStore.getById(13);
            for (var i = 0; i < 12; i++) {
                var field = String.format('period{0}', i + 1);
                rec13.set(field, record13.get(field));
            }

            var record51 = me._flcsStore.getById(51);
            var record52 = me._flcsStore.getById(52);
            var record54 = me._flcsStore.getById(54);
            var record53 = me._flcsStore.getById(53);
            var record55 = me._flcsStore.getById(55);

            if (record51) {
                var rec51 = me._finalLaborStore.newRecord({ title: 'Project Work Wage Rate' });
                var rec52 = me._finalLaborStore.newRecord({ title: 'Non-Chargeable Project Work' });
                var rec54 = me._finalLaborStore.newRecord({ title: 'Chargeable Project Work' });

                var rec53 = me._finalLaborStore.newRecord({ title: 'Non-Chargeable Project Work Subtotal' });
                var rec55 = me._finalLaborStore.newRecord({ title: 'Chargeable Project Work Subtotal' });

                me._finalLaborStore.add(rec51);
                me._finalLaborStore.add(rec52);
                me._finalLaborStore.add(rec54);
                me._finalLaborStore.add(rec53);
                me._finalLaborStore.add(rec55);

                for (var i = 0; i < 12; i++) {
                    var field = String.format('period{0}', i + 1);
                    rec51.set(field, record51.get(field));
                    rec52.set(field, record52.get(field));
                    rec54.set(field, record54.get(field));
                    rec53.set(field, record53.get(field));
                    rec55.set(field, record55.get(field));
                }

            }


            me._finalLaborStore.submitChanges();
            fin.bud.modified(false);
        }
        });

        this.addChildControl(this._saveButton, 'save-button');

        this._printButton = Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Print', width: 80, handler: function () {
            Ext.ux.Printer.print('Final Labor Calculation', _builtInTemplate_6091cb6c[24],
         { finalLabors: me._flcsGrid,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');
        }
        });

        this.addChildControl(this._printButton, 'print-button');


    },
    dataBind: function () {
        var me = this;

        if (Bud.Context.primaryNav.currentBudgetTemplateId == 4) {
            me._flcsStore.loadSampleData4Retail();
        }
        else {
            me._flcsStore.loadSampleData();
        }



        this.on('contextChanged', function () {
            this._fiscalPeriodStore.load(this.getFscYear());
            this._annualInformationStore.load(this.getFscYear());
            me._budPeriodStore.load(me.getFscYear());
            me._budHolidayStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._budLaborCalculationStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._employeeStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 0);
            me._finalLaborStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._staffingSummaryStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 0);
            fin.bud.modified(false);
        });

        this.on('modechanged', function () {
            me.onModeChanged();
        });

        me._flcsStore.on('datarefresh', function () {
            me._flcsGrid.getView().refresh();
        });

        me.grouping([me._fiscalPeriodStore, me._budHolidayStore,
            me._budLaborCalculationStore, me._budPeriodStore, me._annualInformationStore,
            me._employeeStore, me._finalLaborStore,
            me._staffingSummaryStore, me], {
                load: function () {

                    me.calculateStaffing();
                    me.calculateVacationEarned();

                    var record = me._budLaborCalculationStore.getAt(0);
                    if (record) {
                        var availHolidays = me._budHolidayStore.queryBy(function (rec) {
                            return rec.get('fscPeriod') != 0;
                        });
                        record.set('legalHolidays', availHolidays.getCount());
                    }

                    me._flcsStore.applyUserInputData(
                    me._finalLaborStore.queryBy(function (r) { return r.get('title') == 'Overtime Hours' || !r.get('title'); }).first() || null,
                     me._finalLaborStore.queryBy(function (r) { return r.get('title') == 'Project Work Wage Rate'; }).first() || null,
                     me._finalLaborStore.queryBy(function (r) { return r.get('title') == 'Non-Chargeable Project Work'; }).first() || null,
                     me._finalLaborStore.queryBy(function (r) { return r.get('title') == 'Chargeable Project Work'; }).first() || null
                    );


                    me.refreshFlcGridColumnModel();
                    me.ensureFlcGridCreated();
                    me.updateFiscalPeriodStore();
                }
            });



        Bud.page.FinalLaborCalculationsPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    decimal2: function (d) {
        return Math.round(d * 100) / 100;
    },

    updateFiscalPeriodStore: function () {
        var me = this;

        var mix = new Ext.util.MixedCollection();
        for (var i = 0; i < 12; i++) {
            mix.add('' + (i + 1), 0);
        }
        var records = me._budHolidayStore.getRange();
        Ext.each(records, function (record, index) {
            var v = record.get('fscPeriod');

            var index = me._budPeriodStore.find('id', v);
            var rec = me._budPeriodStore.getAt(index);
            if (rec) {
                var key = rec.get('title');
                mix.replace(key, mix.get(key) + 1);
            }
        });

        if (me._budLaborCalculationStore.getCount() > 0) {
            with (me._flcsStore) {
                productiveLaborStandards = me._budLaborCalculationStore.getAt(0).get('productiveLaborStandards');
                totalLegalHolidays = me._budHolidayStore.getCount();
                shortStaffingOnLegalHolidays = me._budLaborCalculationStore.getAt(0).get('shortStaffingOnLegalHolidays');
                projectedAvgWageRate = me._budLaborCalculationStore.getAt(0).get('projectedAvgWageRate');
                estimatedCOLPeriodOfIncrease = me._budLaborCalculationStore.getAt(0).get('estimatedCOLPeriodOfIncrease');
                estimatedCOLIncreasePerHour = me._budLaborCalculationStore.getAt(0).get('estimatedCOLIncreasePerHour');
                paidLeaveNoNightDifferential = me._budLaborCalculationStore.getAt(0).get('paidLeaveNoNightDifferential');
                sickDaysTakenPercentage = me._budLaborCalculationStore.getAt(0).get('sickDaysTakenPercentage');
                personalDaysPercentage = me._budLaborCalculationStore.getAt(0).get('personalDaysPercentage');
                otherPaidLeavePercentage = me._budLaborCalculationStore.getAt(0).get('otherPaidLeavePercentage');
                legalHolidayStandard = me._budLaborCalculationStore.getAt(0).get('legalHolidayStandard');
                legalHolidaysPercentage = me._budLaborCalculationStore.getAt(0).get('legalHolidaysPercentage');
                vacationEarnedPercentage = me._budLaborCalculationStore.getAt(0).get('vacationEarnedPercentage');
                legalHolidayMix = mix;

                if (Bud.Context.primaryNav.currentHouseCodeTypeId == 1 && Bud.Context.primaryNav.currentBudgetTemplateId == 4) {

                    var annualInformation = me._annualInformationStore.getAt(0);
                    vacationEarnedPercentage = parseFloat(annualInformation.get('retailVacationAccrualPercent')) || 0;

                }
                updateTotals();
            }


        }
    },

    calculateStaffing: function () {
        var me = this;

        if (me._staffingSummaryStore.getCount() <= 1 || me._budLaborCalculationStore.getCount() == 0)
            return;

        var weeklyTotal = 0;
        var holidaysTotal = 0;
        for (var i = 0; i < me._staffingSummaryStore.getCount() - 1; i++) {
            weeklyTotal += me._staffingSummaryStore.getAt(i).get('proposedTotal');
            holidaysTotal += me._staffingSummaryStore.getAt(i).get('proposedHolidays');
        }
        var record = me._budLaborCalculationStore.getAt(0);
        record.set('totalWeeklyStaffingHours', weeklyTotal);
        record.set('totalStaffingLegalHolidays', me._staffingSummaryStore.shortStaffingOnLegalHolidays);       //holidaysTotal);
    },
    calculateVacationEarned: function () {
        var me = this;

        if (me._employeeStore.getCount() <= 1 || me._budLaborCalculationStore.getCount() == 0)
            return;

        var records = me._employeeStore.getRange(0, me._employeeStore.getCount() - 2);
        var totalWorkedHoursPerPayPeriod = 0;
        var mix = new Ext.util.MixedCollection();
        Ext.each(records, function (record, index) {
            var vacationDays = record.get('vacationDays');
            if (vacationDays && vacationDays > 0) {
                if (mix.containsKey(vacationDays))
                    mix.replace(vacationDays, mix.get(vacationDays) + 1);
                else
                    mix.add(vacationDays, 1);
            }
            totalWorkedHoursPerPayPeriod += record.get('scheduledHours');
        });

        var vacationData = [];
        var totalVacation = 0;
        var totalEmployee = 0;
        mix.eachKey(function (key, item) {
            vacationData.push([key, item, key * item]);
            totalVacation += key * item;
            totalEmployee += item;
        });
        vacationData.push([0, 0, 0]);

        me._vacationStore.loadData(vacationData);

        var averageVacation = Math.round(totalVacation / totalEmployee * 100) / 100;

        if (me._budLaborCalculationStore.getCount() > 0) {
            me._budLaborCalculationStore.getAt(0).set('vacationEarned', averageVacation);
            me._budLaborCalculationStore.getAt(0).set('totalWorkedHoursPerPayPeriod', totalWorkedHoursPerPayPeriod);
        }

        me._budLaborCalculationStore.getAt(0).set('avgWageRate', me._employeeStore.averageWageRate);
        me._budLaborCalculationStore.getAt(0).set('avgWageRateExcludingDifferential', me._employeeStore.averageBaseWageRate);
        me._budLaborCalculationStore.getAt(0).set('meritIncreaseEmployees', me._employeeStore.numberOfEmployees);
        me._budLaborCalculationStore.getAt(0).set('totalEmployees', me._employeeStore.numberOfEmployees);
    },
    onModeChanged: function () {
        var me = this;
        var btnSave = Ext.get(me.getClientId('btnSave'));
        if (me.isReadOnlyMode()) {
            btnSave.hide();
        } else {
            btnSave.show()
        }
    }
});

WebLight.PageMgr.registerType('finallaborcalculations', Bud.page.FinalLaborCalculationsPage);



WebLight.namespace('Bud.page');

Bud.page.LaborCalculationsPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Labor Calc',
    html: _builtInTemplate_6091cb6c[25],
    sickPayHtml: _builtInTemplate_6091cb6c[26],
    legalHolidaysHtml: _builtInTemplate_6091cb6c[27],
    insuranceHtml: _builtInTemplate_6091cb6c[28],
    netProdDaysPerEmpFtesHtml: _builtInTemplate_6091cb6c[29],
    laborStandardsHtml: _builtInTemplate_6091cb6c[30],
    laborStandardsInDollarsHtml: _builtInTemplate_6091cb6c[31],

    _staffingSummaryStore: null,
    _budLaborCalculationStore: null,
    _budHolidayStore: null,
    _budPeriodStore: null,
    _payPeriodStore: null,
    _budProductiveEmployeesInsuranceStore: null,
    _employeeStore: null,
    _budProductiveEmployeesInsuranceBlWeeklyStore: null,
    _budAnnualInformationStore: null,

    _insuranceGrid: null,
    _vacationGrid: null,
    _vacationStore: null,
    _averageVacationBox: null,

    _holidayGrid: null,

    _sickPayForm: null,
    _legalHolidaysForm: null,
    _insuranceForm: null,
    _netProdDaysPerEmpFtesForm: null,
    _laborStandardsForm: null,
    _laborStandardInDollarsForm: null,

    createSickPayForm: function (config) {
        var me = this;
        return new WebLight.form.FormView({ html: this.sickPayHtml, items: [
           { xtype: 'numberfield', name: 'sickDays', decimalPrecision: 1 },
           { xtype: 'numberfield', name: 'sickDaysTaken', decimalPrecision: 1 },
           { xtype: 'numberfield', name: 'sickDaysProjected', decimalPrecision: 1 }
        ], store: me._budLaborCalculationStore
        });
    },

    createLegalHolidaysForm: function (config) {
        var me = this;
        return new WebLight.form.FormView({ html: this.legalHolidaysHtml, items: [
            { xtype: 'numberfield', name: 'personalDays' },
            { xtype: 'numberfield', name: 'otherPaidLeave' }
        ], store: me._budLaborCalculationStore
        });
    },

    createInsuranceForm: function (config) {
        var me = this;
        return new WebLight.form.FormView({ html: this.insuranceHtml, autoStoreMask:false, items: [
        { xtype: 'numberfield', name: 'singleHMOCount', decimalPrecision: 0, maskRe: '' },
         { xtype: 'numberfield', name: 'singlePOSCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleMedical3Count', decimalPrecision: 0 },
            { xtype: 'numberfield', name: 'singleMedical4Count', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleMedical5Count', decimalPrecision: 0 },
      { xtype: 'numberfield', name: 'singleLibertyCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleDentalCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleLifeCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleUnionCount', decimalPrecision: 0 },
         { xtype: 'displayfield', name: 'singleTotalCount' },

            { xtype: 'numberfield', name: 'singleSpouseHMOCount', decimalPrecision: 0, maskRe: '' },
         { xtype: 'numberfield', name: 'singleSpousePOSCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleSpouseMedical3Count', decimalPrecision: 0 },
            { xtype: 'numberfield', name: 'singleSpouseMedical4Count', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleSpouseMedical5Count', decimalPrecision: 0 },
      { xtype: 'numberfield', name: 'singleSpouseLibertyCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleSpouseDentalCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleSpouseLifeCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleSpouseUnionCount', decimalPrecision: 0 },
         { xtype: 'displayfield', name: 'singleSpouseTotalCount' },

            { xtype: 'numberfield', name: 'singleDependantHMOCount', decimalPrecision: 0, maskRe: '' },
         { xtype: 'numberfield', name: 'singleDependantPOSCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleDependantMedical3Count', decimalPrecision: 0 },
            { xtype: 'numberfield', name: 'singleDependantMedical4Count', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleDependantMedical5Count', decimalPrecision: 0 },
      { xtype: 'numberfield', name: 'singleDependantLibertyCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleDependantDentalCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleDependantLifeCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'singleDependantUnionCount', decimalPrecision: 0 },
         { xtype: 'displayfield', name: 'singleDependantTotalCount' },

         { xtype: 'numberfield', name: 'familyHMOCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyPOSCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyMedical3Count', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyMedical4Count', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyMedical5Count', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyLibertyCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyDentalCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyLifeCount', decimalPrecision: 0 },
         { xtype: 'numberfield', name: 'familyUnionCount', decimalPrecision: 0 },
         { xtype: 'displayfield', name: 'familyTotalCount' },

         { xtype: 'displayfield', name: 'totalHMOCount' },
         { xtype: 'displayfield', name: 'totalPOSCount' },
           { xtype: 'displayfield', name: 'totalMedical3Count' },
           { xtype: 'displayfield', name: 'totalMedical4Count' },
           { xtype: 'displayfield', name: 'totalMedical5Count' },
       { xtype: 'displayfield', name: 'totalLibertyCount' },
         { xtype: 'displayfield', name: 'totalDentalCount' },
         { xtype: 'displayfield', name: 'totalLifeCount' },
         { xtype: 'displayfield', name: 'totalUnionCount' },
         { xtype: 'displayfield', name: 'totalCount' },

         { xtype: 'numberfield', name: 'singleHMOCost' },
         { xtype: 'numberfield', name: 'singlePOSCost' },
         { xtype: 'numberfield', name: 'singleMedical3Cost' },
         { xtype: 'numberfield', name: 'singleMedical4Cost' },
         { xtype: 'numberfield', name: 'singleMedical5Cost' },
         { xtype: 'numberfield', name: 'singleLibertyCost' },
         { xtype: 'numberfield', name: 'singleDentalCost' },
         { xtype: 'numberfield', name: 'singleLifeCost' },
         { xtype: 'numberfield', name: 'singleUnionCost' },
         { xtype: 'displayfield', name: 'singleTotalCost', numberFormat: '0.00' },


         { xtype: 'numberfield', name: 'singleSpouseHMOCost' },
         { xtype: 'numberfield', name: 'singleSpousePOSCost' },
         { xtype: 'numberfield', name: 'singleSpouseMedical3Cost' },
         { xtype: 'numberfield', name: 'singleSpouseMedical4Cost' },
         { xtype: 'numberfield', name: 'singleSpouseMedical5Cost' },
         { xtype: 'numberfield', name: 'singleSpouseLibertyCost' },
         { xtype: 'numberfield', name: 'singleSpouseDentalCost' },
         { xtype: 'numberfield', name: 'singleSpouseLifeCost' },
         { xtype: 'numberfield', name: 'singleSpouseUnionCost' },
         { xtype: 'displayfield', name: 'singleSpouseTotalCost', numberFormat: '0.00' },


         { xtype: 'numberfield', name: 'singleDependantHMOCost' },
         { xtype: 'numberfield', name: 'singleDependantPOSCost' },
         { xtype: 'numberfield', name: 'singleDependantMedical3Cost' },
         { xtype: 'numberfield', name: 'singleDependantMedical4Cost' },
         { xtype: 'numberfield', name: 'singleDependantMedical5Cost' },
         { xtype: 'numberfield', name: 'singleDependantLibertyCost' },
         { xtype: 'numberfield', name: 'singleDependantDentalCost' },
         { xtype: 'numberfield', name: 'singleDependantLifeCost' },
         { xtype: 'numberfield', name: 'singleDependantUnionCost' },
         { xtype: 'displayfield', name: 'singleDependantTotalCost', numberFormat: '0.00' },

         { xtype: 'numberfield', name: 'familyHMOCost' },
         { xtype: 'numberfield', name: 'familyPOSCost' },
         { xtype: 'numberfield', name: 'familyMedical3Cost' },
         { xtype: 'numberfield', name: 'familyMedical4Cost' },
         { xtype: 'numberfield', name: 'familyMedical5Cost' },
         { xtype: 'numberfield', name: 'familyLibertyCost' },
         { xtype: 'numberfield', name: 'familyDentalCost' },
         { xtype: 'numberfield', name: 'familyLifeCost' },
         { xtype: 'numberfield', name: 'familyUnionCost' },
         { xtype: 'displayfield', name: 'familyTotalCost', numberFormat: '0.00' },

         { xtype: 'displayfield', name: 'totalHMOCost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalPOSCost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalMedical3Cost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalMedical4Cost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalMedical5Cost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalLibertyCost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalDentalCost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalLifeCost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalUnionCost', numberFormat: '0.00' },
         { xtype: 'displayfield', name: 'totalCost', numberFormat: '0.00' }
        ], store: me._budProductiveEmployeesInsuranceStore
        });
    },

    getSickPayTab: function () {
        var me = this;

        me._sickPayForm = me.createSickPayForm();
        me._sickPayForm.on('change', function () { fin.bud.modified(true); });
        return WebLight.Control.ExtjsWrapper(me._sickPayForm,
          { style: 'margin:10px 0', xtype: 'panel', border: false, xtype: 'panel',
              buttons: [
                Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Save', id: me.getClientId('btnSickSave'), handler: function () {
                    me._budLaborCalculationStore.submitChanges(function () {
                        me._budLaborCalculationStore.reload();
                    });
                }
                }),
                Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Cancel', id: me.getClientId('btnSickCancel'), handler: function () { me._budLaborCalculationStore.reload(); } })
            ]
          });
    },


    createHolidayGrid: function () {
        var me = this;
        this._holidayGrid = new Bud.grid.EditorGridPanel({
            enableHdMenu: false,
            autoHeight: true,
            stripeRows: true,
            loadMask: true,
            clicksToEdit: 1, width: 1250,
            store: this._budHolidayStore,
            viewConfig: { forceFit: true },
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: [
                    { dataIndex: 'title', header: 'Holiday',
                        editor: new Ext.form.TextField()
                    },
                    { dataIndex: 'fscPeriod', header: 'Period',
                        renderer: function (v, m, r, row, col, store) {
                            if (v) {
                                var index = me._budPeriodStore.find('id', v);
                                var rec = me._budPeriodStore.getAt(index);
                                if (rec)
                                    return rec.get('friendlyTitle');
                                return v;
                            }
                            return v;
                        },
                        editor: new WebLight.form.ComboBox({
                            mode: 'local',
                            store: me._budPeriodStore,
                            displayField: 'friendlyTitle', triggerAction: 'all', forceSelection: true, editable: false,
                            valueField: 'id'
                        })
                    },
                    { header: 'Action', align: 'center',
                        renderer: function (v, m, r, row, col, store) {
                            //if (r.get('_sysStatus') == 1)
                            if (me.isReadOnlyMode())
                                return '';
                            return '<a href="javascript:void(0);" xcmd="remove">Remove</a>';
                            // return '';
                        }
                    }
                ]
            })
        });

        this._holidayGrid.on('cellclick', function (grid, rowIndex, colIndex, e) {
            var cmd = $(e.getTarget()).attr('xcmd');
            var record = grid.getStore().getAt(rowIndex);
            switch (cmd) {
                case 'remove':
                    grid.getStore().remove(record);
                    break;
            }
        });
        this._holidayGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });
    },

    getLegalHolidaysTab: function () {
        var me = this;
        this.createHolidayGrid();
        me._legalHolidaysForm = me.createLegalHolidaysForm();
        me._legalHolidaysForm.on('change', function () { fin.bud.modified(true); });

        return Ext.create({
            style: 'margin:10px 0', xtype: 'panel', border: false, items: [
                 WebLight.Control.ExtjsWrapper(me._legalHolidaysForm,
                      { style: 'margin:10px 0', xtype: 'panel', border: false, xtype: 'panel',
                          buttons: [
                            { ctCls: 'ux-button-1', text: 'Save', id: me.getClientId('btnLegSave1'), handler: function () {

                                me._budLaborCalculationStore.submitChanges(function () {
                                    me._budLaborCalculationStore.reload();
                                });
                            }
                            },
                            { ctCls: 'ux-button-1', text: 'Cancel', id: me.getClientId('btnLegCancel1'), handler: function () { me._budLaborCalculationStore.reload(); } }
                        ]
                      })
                , this._holidayGrid
            ],
            buttons: [
                { ctCls: 'ux-button-1', text: 'Add Holiday', id: me.getClientId('btnLegAdd'),
                    handler: function () {
                        me._budHolidayStore.add(me._budHolidayStore.newRecord());
                        fin.bud.modified(true);
                    }
                },
                { ctCls: 'ux-button-1', text: 'Save', id: me.getClientId('btnLegSave2'),
                    handler: function () {
                        me._holidayGrid.stopEditing();
                        me._holidayGrid.getEl().mask('Saving...');

                        me._budHolidayStore.submitChanges(function () {
                            me._holidayGrid.getEl().unmask();
                            me._budHolidayStore.reload();
                        }, function () {
                            me._holidayGrid.getEl().unmask();
                        });
                    }
                },
                { ctCls: 'ux-button-1', text: 'Cancel', id: me.getClientId('btnLegCancel2'),
                    handler: function () {
                        me._budHolidayStore.reload();
                    }
                }
            ]
        });
    },

    printVacation: function () {
        Ext.ux.Printer.print('Vacation', _builtInTemplate_6091cb6c[32],
         { incomeTypes: this._vacationGrid,
             'averageVacation': this._averageVacationBox.getValue(),
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },

    createVacationGrid: function () {
        var me = this;
        this._vacationGrid = new WebLight.grid.GridPanel({
            ctCls: 'ux-grid-1',
            autoHeight: true,
            stripeRows: true,
            enableHdMenu: false, width: 1250,
            store: me._vacationStore,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: [
                    { header: 'Employees', dataIndex: 'employees',
                        renderer: function (v, m, r, col, row, store) {
                            if (v == 0) {
                                var val = 0;
                                for (var i = 0; i < me._vacationStore.getCount(); i++) {
                                    var rec = me._vacationStore.getAt(i);
                                    val += rec.get('employees');
                                }
                                return val;
                            }
                            return v;
                        }
                    },
                    { header: 'Annual Vacation Entitlement', dataIndex: 'annualVacation', width: 300,
                        renderer: function (v, m, r, col, row, store) {
                            if (v == 0)
                                return 'Totals';
                            return v;
                        }
                    },
                    { header: 'Proj Vac Days Entitlement', width: 300, dataIndex: 'total',
                        renderer: function (v, m, r, col, row, store) {
                            if (v == 0) {
                                var val = 0;
                                for (var i = 0; i < me._vacationStore.getCount(); i++) {
                                    var rec = me._vacationStore.getAt(i);
                                    val += rec.get('total');
                                }
                                return val;
                            }
                            return v;
                        }
                    }
                ]
            })
        });
    },

    getVacationTab: function () {
        var me = this;
        this.createVacationGrid();

        this._averageVacationBox = new Ext.form.DisplayField({ name: 'averageVacationField' });

        var averageVacationHolder = WebLight.Control.ExtjsWrapper(new WebLight.form.FormView({
            html: '<table width="90%" style="margin-top:10px"><tr><td>Average Vacation Entitlement</td><td>\
                <div style="float:left" id="averageVacationField"></div>&nbsp;&nbsp;Days</td></tr></table>',
            items: [this._averageVacationBox]
        }));

        return Ext.create({
            style: 'margin:10px 0', xtype: 'panel', border: false, items: [
               me._vacationGrid, averageVacationHolder
            ], buttons: [
                { ctCls: 'ux-button-1', text: 'Print', handler: function () { me.printVacation(); } }
            ]
        });
    },

    printLaborStandards: function () {
        if (me._budLaborCalculationStore.getCount() == 0)
            return;
        var record = this._budLaborCalculationStore.getAt(0);

        Ext.ux.Printer.print('Labor Standards', _builtInTemplate_6091cb6c[33],
         {
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle(),

             'projectedNewEmployees': record.get('projectedNewEmployees'),
             'projectedEmployeeTrainingHours': record.get('projectedEmployeeTrainingHours'),
             'nonReplaceVacationPerc': record.get('nonReplaceVacationPerc'),
             'nonReplaceSickPayPerc': record.get('nonReplaceSickPayPerc'),
             'nonReplaceHolidayPerc': record.get('nonReplaceHolidayPerc'),
             'nonReplacePersonalPerc': record.get('nonReplacePersonalPerc'),

             'laborStandardBeforeShortStaffing': record.get('laborStandardBeforeShortStaffing'),
             'totalTrainingHours': record.get('totalTrainingHours'),
             'productiveLaborStandard': record.get('productiveLaborStandard'),

             'nonReplaceVacationCount': record.get('nonReplaceVacationCount'),
             'nonReplaceSickPayCount': record.get('nonReplaceSickPayCount'),
             'nonReplaceHolidayCount': record.get('nonReplaceHolidayCount'),
             'nonReplacePersonalCount': record.get('nonReplacePersonalCount'),
             'totalShortStaffing': record.get('totalShortStaffing'),
             'productiveLaborStandards': record.get('productiveLaborStandards'),

             'shortStaffingOnLegalHolidays': record.get('shortStaffingOnLegalHolidays'),
             'netProductiveStandard': record.get('netProductiveStandard'),
             'sickPayStandard': record.get('sickPayStandard'),
             'legalHolidayStandard': record.get('legalHolidayStandard'),
             'personalLeaveStandard': record.get('personalLeaveStandard'),
             'vacationAccrualStandard': record.get('vacationAccrualStandard'),
             'paidLeaveStandards': record.get('paidLeaveStandards'),
             'total52WeekPaidHoursStandard': record.get('total52WeekPaidHoursStandard')
         },
         '../../res/css/print-all.css');
    },

    getLaborStandardsTab: function () {
        var me = this;
        me._laborStandardsForm = new WebLight.form.FormView({
            html: this.laborStandardsHtml,
            items: [
                         { name: 'projectedNewEmployees', xtype: 'numberfield' },
                         { name: 'projectedEmployeeTrainingHours', xtype: 'numberfield' },
                         { name: 'nonReplaceVacationPerc', xtype: 'numberfield' },
                         { name: 'nonReplaceSickPayPerc', xtype: 'numberfield' },
                         { name: 'nonReplaceHolidayPerc', xtype: 'numberfield' },
                         { name: 'nonReplacePersonalPerc', xtype: 'numberfield' },

                         { name: 'laborStandardBeforeShortStaffing', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'totalTrainingHours', xtype: 'displayfield' },
                         { name: 'productiveLaborStandard', xtype: 'displayfield', numberFormat: '0,000' },

                         { name: 'nonReplaceVacationCount', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'nonReplaceSickPayCount', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'nonReplaceHolidayCount', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'nonReplacePersonalCount', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'totalShortStaffing', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'productiveLaborStandards', xtype: 'displayfield', numberFormat: '0,000' },

                         { name: 'shortStaffingOnLegalHolidays', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'netProductiveStandard', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'sickPayStandard', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'legalHolidayStandard', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'personalLeaveStandard', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'vacationAccrualStandard', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'paidLeaveStandards', xtype: 'displayfield', numberFormat: '0,000' },
                         { name: 'total52WeekPaidHoursStandard', xtype: 'displayfield', numberFormat: '0,000' }
                    ],
            store: me._budLaborCalculationStore
        });

        me._laborStandardsForm.on('change', function () { fin.bud.modified(true); });

        return Ext.create({
            style: 'margin:10px 0', xtype: 'panel', border: false, items: [
                WebLight.Control.ExtjsWrapper(me._laborStandardsForm)
            ], buttons: [
                    { ctCls: 'ux-button-1', text: 'Save', id: me.getClientId('btnLaborStandardsSave'),
                        handler: function () {
                            me._budLaborCalculationStore.submitChanges(function () {
                                me._budLaborCalculationStore.reload();
                            });
                        }
                    },
                    { ctCls: 'ux-button-1', text: 'Cancel', id: me.getClientId('btnLaborStandardsCancel'),
                        handler: function () {
                            me._budLaborCalculationStore.reload();
                        }
                    },
                    { ctCls: 'ux-button-1', text: 'Print',
                        handler: function () {
                            me.printLaborStandards();
                        }
                    }
            ]
        });
    },

    printLaborStandardInDollars: function () {
        if (me._budLaborCalculationStore.getCount() == 0)
            return;
        var record = this._budLaborCalculationStore.getAt(0);

        Ext.ux.Printer.print('Labor Standard In Dollars',
            _builtInTemplate_6091cb6c[34],
        Ext.apply({}, record.data, {
            'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
            'hcmJobTitle': this.getHcmJobTitle(),
            'fscYearTitle': this.getFscYearTitle()
        }),
         '../../res/css/print-all.css');
    },

    getLaborStandardInDollarsTab: function () {
        var me = this;
        me._laborStandardInDollarsForm = new WebLight.form.FormView({
            html: this.laborStandardsInDollarsHtml,
            items: [
                         { name: 'meritIncreasePerHour', xtype: 'numberfield' },
                         { name: 'employeesLeaving', xtype: 'numberfield' },
                         { name: 'startingWageRate', xtype: 'numberfield' },
                         { name: 'estimatedCOLPeriodOfIncrease', xtype: 'numberfield' },
                         { name: 'estimatedCOLIncreasePerHour', xtype: 'numberfield' },

                         { name: 'avgWageRate', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'avgWageRateExcludingDifferential', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'meritIncreaseEmployees', xtype: 'displayfield' },
                         { name: 'totalEmployees', xtype: 'displayfield' },
                         { name: 'totalIncreaseInWageCost', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'avgWageRateReduction', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'decreaseInWageRate', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'avgWageRateNetEffect', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'projectedAvgWageRate', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'estimatedCOLAvgWageRate', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'paidLeaveNoNightDifferential', xtype: 'displayfield', numberFormat: '$0.00' },
                         { name: 'avgWageRateCOLNoNightDifferential', xtype: 'displayfield', numberFormat: '$0.00' }
                    ],
            store: me._budLaborCalculationStore
        });

        me._laborStandardInDollarsForm.on('change', function () { fin.bud.modified(true); });


        return Ext.create({
            style: 'margin:10px 0', xtype: 'panel', border: false, items: [
                WebLight.Control.ExtjsWrapper(me._laborStandardInDollarsForm)
            ], buttons: [
                    { ctCls: 'ux-button-1', text: 'Save', id: me.getClientId('btnLaborStandardInDollarsSave'),
                        handler: function () {
                            me._budLaborCalculationStore.submitChanges(function () {
                                me._budLaborCalculationStore.reload();
                            });
                        }
                    },
                    { ctCls: 'ux-button-1', text: 'Cancel', id: me.getClientId('btnLaborStandardInDollarsCancel'),
                        handler: function () {
                            me._budLaborCalculationStore.reload();
                        }
                    },
                    { ctCls: 'ux-button-1', text: 'Print',
                        handler: function () {
                            me.printLaborStandardInDollars();
                        }
                    }
            ]
        });
    },

    createInsuranceGrid: function () {
        var me = this;
        var gridColumns = [{ header: 'Period', dataIndex: 'title', width: 120}];
        for (var i = 0; i < 12; i++) {
            gridColumns.push({ header: (i + 1).toString(), dataIndex: String.format('field{0}', i + 1), width: 65 });
        }
        //        gridColumns.push({ header: 'Total', dataIndex: 'total',
        //            renderer: function (v, m, r, col, row, store) {
        //                if (r.get('title') == '% Adjustment')
        //                    return '';
        //                var t = 0;
        //                for (var i = 0; i < 12; i++) {
        //                    t += r.get(String.format('field{0}', i + 1));
        //                }
        //                return Math.round(t * 100) / 100;
        //            }
        //        });

        this._insuranceGrid = new WebLight.grid.GridPanel({
            ctCls: 'ux-grid-1',

            stripeRows: true, autoHeight: true,
            enableHdMenu: false,
            viewConfig: { forceFit: true },
            store: me._budProductiveEmployeesInsuranceBlWeeklyStore,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                columns: gridColumns
            })
        });
    },

    printInsurance: function () {
        Ext.ux.Printer.print('Productive Employees Health/Dental/Life Insurance BI-Weekly Cost', _builtInTemplate_6091cb6c[35],
         { incomeTypes: this._insuranceGrid,
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },

    getInsuranceTab: function () {
        var me = this;
        this.createInsuranceGrid();
        me._insuranceForm = this.createInsuranceForm();
        me._insuranceForm.on('change', function () { fin.bud.modified(true); });

        var saveButton = new Ext.Button({
            ctCls: 'ux-button-1', text: 'Save', id: me.getClientId('btnInsuranceSave'),
            handler: function () {
                me._budProductiveEmployeesInsuranceStore.submitChanges();
                fin.bud.modified(false);
            }
        });
        var printButton = new Ext.Button({ ctCls: 'ux-button-1', text: 'Print',
            handler: function () {
                me.printInsurance();
            }
        });

        return Ext.create({
            style: 'margin:10px 0;', xtype: 'panel', border: false, items: [
               WebLight.Control.ExtjsWrapper(me._insuranceForm),
                    { border: false, html: '<p class="table-title">Productive Employees Health/Dental/Life Insurance BI-Weekly Cost</p>' },
                    me._insuranceGrid
            ], buttons: [saveButton, printButton]
        });
    },

    createNetProdDaysPerEmpFtesForm: function () {
        var me = this;

        var form = new WebLight.form.FormView({
            html: this.netProdDaysPerEmpFtesHtml,
            items: [
            //{ xtype: 'displayfield', name: 'sickDaysTaken', numberFormat: '0.00' },
              {xtype: 'displayfield', name: 'sickDaysProjected', numberFormat: '0.00' },
                { xtype: 'displayfield', name: 'sickDaysTakenPercentage', numberFormat: '0.00%' },
                { xtype: 'displayfield', name: 'legalHolidays', numberFormat: '0.00' },
                { xtype: 'displayfield', name: 'legalHolidaysPercentage', numberFormat: '0.00%' },
                { xtype: 'displayfield', name: 'personalDays', numberFormat: '0.00' },
                { xtype: 'displayfield', name: 'personalDaysPercentage', numberFormat: '0.00%' },
                { xtype: 'displayfield', name: 'otherPaidLeave', numberFormat: '0.00' },
                { xtype: 'displayfield', name: 'otherPaidLeavePercentage', numberFormat: '0.00%' },
                { xtype: 'displayfield', name: 'vacationEarned', numberFormat: '0.00' },
                { xtype: 'displayfield', name: 'vacationEarnedPercentage', numberFormat: '0.00%' },
                { xtype: 'displayfield', name: 'totalPaidLeave', numberFormat: '0.00' },
                { xtype: 'displayfield', name: 'totalPaidLeavePercentage', numberFormat: '0.00%' },
                { xtype: 'displayfield', name: 'netEmployeeProductiveDaysPerYear' },
                { xtype: 'numberfield', name: 'employeeHoursPerDay' },
                { xtype: 'displayfield', name: 'approximateStaffingInFTERequired' }
            ],
            store: me._budLaborCalculationStore
        });

        form.$child('ytdBusinessDays').html(Bud.Context.ytdBusinessDays);
        return form;
    },

    printNetProdDaysPerEmpFtes: function () {
        var me = this;
        if (me._budLaborCalculationStore.getCount() == 0)
            return;
        var record = this._budLaborCalculationStore.getAt(0);

        Ext.ux.Printer.print('Net Prod Days Per Emp &amp; FTEs', _builtInTemplate_6091cb6c[36],
         {
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle(),
             'sickDaysTaken': record.get('sickDaysTaken'),
             'sickDaysTakenPercentage': record.get('sickDaysTakenPercentage'),
             'legalHolidays': record.get('legalHolidays'),
             'legalHolidaysPercentage': record.get('legalHolidaysPercentage'),
             'personalDays': record.get('personalDays'),
             'personalDaysPercentage': record.get('personalDaysPercentage'),
             'otherPaidLeave': record.get('otherPaidLeave'),
             'otherPaidLeavePercentage': record.get('otherPaidLeavePercentage'),
             'vacationEarned': record.get('vacationEarned'),
             'vacationEarnedPercentage': record.get('vacationEarnedPercentage'),
             'totalPaidLeave': record.get('totalPaidLeave'),
             'totalPaidLeavePercentage': record.get('totalPaidLeavePercentage'),
             'netEmployeeProductiveDaysPerYear': record.get('netEmployeeProductiveDaysPerYear'),
             'employeeHoursPerDay': record.get('employeeHoursPerDay'),
             'approximateStaffingInFTERequired': record.get('approximateStaffingInFTERequired'),
             'ytdBusinessDays': Bud.Context.ytdBusinessDays
         },
         '../../res/css/print-all.css');
    },

    getNetProdDaysPerEmpFtesTab: function () {
        var me = this;
        me._netProdDaysPerEmpFtesForm = this.createNetProdDaysPerEmpFtesForm();
        me._netProdDaysPerEmpFtesForm.on('change', function () { fin.bud.modified(true); });

        return Ext.create({
            style: 'margin:10px 0', xtype: 'panel', border: false,
            items: [WebLight.Control.ExtjsWrapper(me._netProdDaysPerEmpFtesForm)],
            buttons: [
                { text: 'Save', ctCls: 'ux-button-1', id: me.getClientId('btnNetProdDaysSave'),
                    handler: function () {
                        me._budLaborCalculationStore.submitChanges(function () {
                            me._budLaborCalculationStore.reload();
                        });
                    }
                },
                { text: 'Cancel', ctCls: 'ux-button-1', id: me.getClientId('btnNetProdDaysCancel'),
                    handler: function () {
                        me._budLaborCalculationStore.reload();
                    }
                },
                { text: 'Print', ctCls: 'ux-button-1',
                    handler: function () {
                        me.printNetProdDaysPerEmpFtes();
                    }
                }
            ]
        });
    },

    createChildControls: function () {
        var me = this;
        this._budLaborCalculationStore = new Bud.data.BudLaborCalculationStore();

        this._budLaborCalculationStore.on('load', function () { fin.bud.modified(false); });

        this._budHolidayStore = new Bud.data.BudHolidayStore();
        this._budPeriodStore = new Bud.data.FiscalPeriodStore();
        this._payPeriodStore = new Bud.data.PayPeriodStore();
        me._budProductiveEmployeesInsuranceStore = new Bud.data.BudProductiveEmployeesInsuranceStore();


        this._budProductiveEmployeesInsuranceStore.on('update', function () { fin.bud.modified(true); });
        this._budProductiveEmployeesInsuranceStore.on('load', function () { fin.bud.modified(false); });

        this._budHolidayStore.on('update', function () { fin.bud.modified(true); });
        this._budHolidayStore.on('load', function () { fin.bud.modified(false); });

        this._employeeStore = new Bud.data.EmployeeLockStore();
        this._vacationStore = new Ext.data.ArrayStore({
            fields: ['annualVacation', 'employees', 'total']
        });
        this._budProductiveEmployeesInsuranceBlWeeklyStore = new Ext.data.ArrayStore({
            fields: ['title', 'field1', 'field2', 'field3', 'field4', 'field5', 'field6',
            'field7', 'field8', 'field9', 'field10', 'field11', 'field12', 'field13', 'total']
        });
        this._budAnnualInformationStore = new Bud.data.BudAnnualInformationStore();
        this._staffingSummaryStore = new Bud.data.BudStaffingHourStore();

        this.addChildControl(Ext.create({
            xtype: 'box', html: '<h2 class="page-title">Labor Calculations</h2>'
        }), 'container');

        var gridTitleI = Ext.create({
            xtype: 'box', html: '<h2 class="page-sub-title">I.Sick Pay</h2>'
        });

        var panelI = me.getSickPayTab();

        var gridTitleII = Ext.create({
            xtype: 'box', html: '<h2 class="page-sub-title">II.Legal Holidays</h2>'
        });
        var panelII = me.getLegalHolidaysTab();

        var gridTitleIII = Ext.create({
            xtype: 'box', html: '<h2 class="page-sub-title">III.Vacation</h2>'
        });
        var panelIII = me.getVacationTab();

        var gridTitleIV = Ext.create({
            xtype: 'box', html: '<h2 class="page-sub-title">IV.Prod Employees Health/Dental/Life and Union Contributions & BI-Weekly Cost</h2>'
        });
        var panelIV = me.getInsuranceTab();

        var panelV = me.getNetProdDaysPerEmpFtesTab();

        var panelVII = me.getLaborStandardsTab();

        var panelVIII = me.getLaborStandardInDollarsTab();

        var items = [
                   { title: 'Sick Pay', header: false, border: false, autoHeight: true, items: [gridTitleI, panelI] },
                   { title: 'Legal Holidays', header: false, border: false, autoHeight: true, items: [gridTitleII, panelII] },
                   { title: 'Vacation', header: false, border: false, autoHeight: true, items: [gridTitleIII, panelIII] },
                   { title: 'Prod Employees Health/Dental/Life <br/>and Union Contributions & BI-Weekly Cost', autoHeight: true, header: false, border: false, items: [gridTitleIV, panelIV] },
                   { title: 'Net Prod Days Per Emp & FTEs', autoHeight: true, header: false, border: false, items: [panelV] },
                   { title: 'Labor Standards', autoHeight: true, header: false, border: false, items: [panelVII] },
                   { title: 'Labor Standard In Dollars', autoHeight: true, header: false, border: false, items: [panelVIII] }
                ];

        if (Bud.Context.primaryNav.currentBudgetTemplateId == 4) {
            //retail
            items = [
             { title: 'Legal Holidays', header: false, border: false, autoHeight: true, items: [gridTitleII, panelII] },
              { title: 'Prod Employees Health/Dental/Life <br/>and Union Contributions & BI-Weekly Cost', autoHeight: true, header: false, border: false, items: [gridTitleIV, panelIV] }
            ];
        }
        else if (Bud.Context.primaryNav.currentBudgetTemplateId == 5) {
            //Education
            items = [
              { title: 'Prod Employees Health/Dental/Life <br/>and Union Contributions & BI-Weekly Cost', autoHeight: true, header: false, border: false, items: [gridTitleIV, panelIV] }
            ];
        }

        var tabs = new Ext.TabPanel({
            activeTab: 0,
            border: false,
            ctCls: 'ux-tab-2',
            autoHeight: true, deferredRender: false,
            items: items
        });
        this.addChildControl(tabs, 'container');
        tabs.on('beforetabchange', function () { return !fin.bud.modified(); });
        Bud.page.LaborCalculationsPage.superclass.createChildControls.call(this);
    },

    dataBind: function () {
        var me = this;
        //me.grouping([me, me._budLaborCalculationStore], null);
        me._budPeriodStore.on('load', function () {
            me._budHolidayStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            calculate();
        });

        var getPayPeriodCount = function (periodTitle) {
            var period = me._budPeriodStore.getByTitle(periodTitle);
            if (!period)
                return 0;
            var startDate = period.get('startDate');
            var endDate = period.get('endDate');
            var payCount = 0;
            me._payPeriodStore.each(function (record) {
                if (record.get('endDate') >= startDate && record.get('endDate') <= endDate)
                    payCount++;
            });
            return payCount
        };

        me._payPeriodStore.on('load', function () {
            calculate();
        });

        var decimal2 = function (d) {
            return Math.round(d * 100) / 100;
        }

        this.on('contextChanged', function () {
            me._budLaborCalculationStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._budPeriodStore.load(me.getFscYear());

            me._budProductiveEmployeesInsuranceStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._employeeStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 0);
            me._budAnnualInformationStore.load(me.getFscYear());
            me._payPeriodStore.load(me.getFscYear(), 1);
            me._staffingSummaryStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), 0);
        });

        this.on('modechanged', function () {
            me.onModeChanged();
        });

        var calculate = function () {
            //console.log(me._budAnnualInformationStore.getCount(), me._payPeriodStore.getCount(), me._budPeriodStore.getCount());
            if (me._budAnnualInformationStore.getCount() == 0 || me._payPeriodStore.getCount() == 0 || me._budPeriodStore.getCount() == 0)
                return;

            var adjustStart = 0;
            var adjustEnd = 0;
            var adjustment = 0;

            //alert(Ext.encode(me._budAnnualInformationStore.getAt(0).data));
            if (me._budAnnualInformationStore.getCount() > 0) {
                var rec = me._budAnnualInformationStore.getAt(0);
                //                adjustStart = rec.get('benefitAdjStartPeriod');
                //                adjustEnd = rec.get('benefitAdjEndPeriod');
                var adjustStartRecord = me._budPeriodStore.getById(rec.get('benefitAdjStartPeriod'));
                var adjustEndRecord = me._budPeriodStore.getById(rec.get('benefitAdjEndPeriod'));
                if (adjustStartRecord && adjustStartRecord.get)
                    adjustStart = adjustStartRecord.get('title');
                if (adjustEndRecord && adjustEndRecord.get)
                    adjustEnd = adjustEndRecord.get('title');

                adjustment = rec.get('benefitAdjPercent') / 100;
            }
            var rec = me._budAnnualInformationStore.getAt(0);
            var record = me._budProductiveEmployeesInsuranceStore.getAt(0);

            var singleCoverage = 0;
            var singleSpouseCoverage = 0;
            var singleDependantCoverage = 0;
            var familyCoverage = 0;
            var unionContribution = 0;

            if (record) {
                singleCoverage = record.get('singleHMOCount') * record.get('singleHMOCost')
                                    + record.get('singlePOSCount') * record.get('singlePOSCost')
                                     + record.get('singleMedical3Count') * record.get('singleMedical3Cost')
                                      + record.get('singleMedical4Count') * record.get('singleMedical4Cost')
                                       + record.get('singleMedical5Count') * record.get('singleMedical5Cost')
                                    + record.get('singleLibertyCount') * record.get('singleLibertyCost')
                                    + record.get('singleDentalCount') * record.get('singleDentalCost')
                                    + record.get('singleLifeCount') * record.get('singleLifeCost')
                                    + record.get('singleUnionCount') * record.get('singleUnionCost');

                singleSpouseCoverage = record.get('singleSpouseHMOCount') * record.get('singleSpouseHMOCost')
                                    + record.get('singleSpousePOSCount') * record.get('singleSpousePOSCost')
                                     + record.get('singleSpouseMedical3Count') * record.get('singleSpouseMedical3Cost')
                                      + record.get('singleSpouseMedical4Count') * record.get('singleSpouseMedical4Cost')
                                       + record.get('singleSpouseMedical5Count') * record.get('singleSpouseMedical5Cost')
                                    + record.get('singleSpouseLibertyCount') * record.get('singleSpouseLibertyCost')
                                    + record.get('singleSpouseDentalCount') * record.get('singleSpouseDentalCost')
                                    + record.get('singleSpouseLifeCount') * record.get('singleSpouseLifeCost')
                                    + record.get('singleSpouseUnionCount') * record.get('singleSpouseUnionCost');

                singleDependantCoverage = record.get('singleDependantHMOCount') * record.get('singleDependantHMOCost')
                                    + record.get('singleDependantPOSCount') * record.get('singleDependantPOSCost')
                                     + record.get('singleDependantMedical3Count') * record.get('singleDependantMedical3Cost')
                                      + record.get('singleDependantMedical4Count') * record.get('singleDependantMedical4Cost')
                                       + record.get('singleDependantMedical5Count') * record.get('singleDependantMedical5Cost')
                                    + record.get('singleDependantLibertyCount') * record.get('singleDependantLibertyCost')
                                    + record.get('singleDependantDentalCount') * record.get('singleDependantDentalCost')
                                    + record.get('singleDependantLifeCount') * record.get('singleDependantLifeCost')
                                    + record.get('singleDependantUnionCount') * record.get('singleDependantUnionCost');

                familyCoverage = record.get('familyHMOCount') * record.get('familyHMOCost')
                                    + record.get('familyPOSCount') * record.get('familyPOSCost')
                                     + record.get('familyMedical3Count') * record.get('familyMedical3Cost')
                                      + record.get('familyMedical4Count') * record.get('familyMedical4Cost')
                                       + record.get('familyMedical5Count') * record.get('familyMedical5Cost')
                                    + record.get('familyLibertyCount') * record.get('familyLibertyCost')
                                    + record.get('familyDentalCount') * record.get('familyDentalCost')
                                    + record.get('familyLifeCount') * record.get('familyLifeCost')
                                    + record.get('familyUnionCount') * record.get('familyUnionCost');

                unionContribution = record.get('singleUnionCount') * record.get('singleUnionCost')
                                        + record.get('singleSpouseUnionCount') * record.get('singleSpouseUnionCost')
                                        + record.get('singleDependantUnionCount') * record.get('singleDependantUnionCost')
                                        + record.get('familyUnionCount') * record.get('familyUnionCost');
            }
            var total = singleCoverage + singleSpouseCoverage + singleDependantCoverage + familyCoverage;
            var data = [];
            var scArr = ['Single Coverage'];
            var ssArr = ['Single + Spouse'];
            var sdArr = ['Single + Dependant'];
            var fcArr = ['Family Coverage'];
            var totalArr = ['Tot Med/Dental/Life'];
            var adjustmentArr = ['% Adjustment'];
            var adjustTotalArr = ['Adjust Total'];
            var unionContributionArr = ['Union Contributions'];

            for (var i = 0; i < 12; i++) {
                var payCount = 1;      //getPayPeriodCount(i + 1);
                scArr.push(decimal2(singleCoverage * payCount));
                ssArr.push(decimal2(singleSpouseCoverage * payCount));
                sdArr.push(decimal2(singleDependantCoverage * payCount));
                fcArr.push(decimal2(familyCoverage * payCount));
                totalArr.push(decimal2(total * payCount));
                unionContributionArr.push(decimal2(unionContribution * payCount));

                if (i + 1 >= adjustStart && i + 1 <= adjustEnd) {
                    adjustmentArr.push(String.format('{0}%', decimal2(adjustment * payCount * 100)));
                    adjustTotalArr.push(decimal2(total * payCount + total * adjustment * payCount));
                }
                else {
                    adjustmentArr.push('0%');
                    adjustTotalArr.push(decimal2(total * payCount));
                }
            }

            data.push(scArr, ssArr, sdArr, fcArr, totalArr, adjustmentArr, adjustTotalArr, unionContributionArr);

            me._budProductiveEmployeesInsuranceBlWeeklyStore.loadData(data);

        }

        me._budAnnualInformationStore.on('load', calculate);

        me._budProductiveEmployeesInsuranceStore.on({
            add: { fn: calculate },
            update: { fn: calculate },
            datachanged: { fn: calculate }
        });

        var calculateVacationEarned = function () {

            // 2012/4/4
            //when creating a new full service budget, then go to the Employee tab and enter in vacation days for the employees, 
            //click save, then go to the labor calc tab and then look at the vacation tab, no vacations appear. 
            //if I make a change to the sick pay tab and save, the vacation days will list. this is in IE9 and matt did not try firefox yet
            if (me._employeeStore.getCount() <= 1) //       || me._budLaborCalculationStore.getCount() == 0)
                return;

            var records = me._employeeStore.getRange(0, me._employeeStore.getCount() - 2);
            var totalWorkedHoursPerPayPeriod = 0;
            var mix = new Ext.util.MixedCollection();
            Ext.each(records, function (record, index) {
                var vacationDays = record.get('vacationDays');
                if (vacationDays && vacationDays > 0) {
                    if (mix.containsKey(vacationDays))
                        mix.replace(vacationDays, mix.get(vacationDays) + 1);
                    else
                        mix.add(vacationDays, 1);
                }
                totalWorkedHoursPerPayPeriod += record.get('scheduledHours');
            });

            var vacationData = [];
            var totalVacation = 0;
            var totalEmployee = 0;
            mix.eachKey(function (key, item) {
                vacationData.push([key, item, key * item]);
                totalVacation += key * item;
                totalEmployee += item;
            });
            vacationData.push([0, 0, 0]);

            me._vacationStore.loadData(vacationData);

            var averageVacation = Math.round(totalVacation / totalEmployee * 100) / 100;
            me._averageVacationBox.setValue(averageVacation);
            if (me._budLaborCalculationStore.getCount() > 0) {
                me._budLaborCalculationStore.getAt(0).set('vacationEarned', averageVacation);
                me._budLaborCalculationStore.getAt(0).set('totalWorkedHoursPerPayPeriod', totalWorkedHoursPerPayPeriod);


                me._budLaborCalculationStore.getAt(0).set('avgWageRate', me._employeeStore.averageWageRate);
                me._budLaborCalculationStore.getAt(0).set('avgWageRateExcludingDifferential', me._employeeStore.averageBaseWageRate);
                me._budLaborCalculationStore.getAt(0).set('meritIncreaseEmployees', me._employeeStore.numberOfEmployees);
                me._budLaborCalculationStore.getAt(0).set('totalEmployees', me._employeeStore.numberOfEmployees);
            }
        }

        me._budLaborCalculationStore.on('load', function () {
            calculate();
            calculateVacationEarned();
            calculateStaffing();
            setLegalHolidays();
        });

        me._employeeStore.on('datarefresh', function () {
            calculateVacationEarned();
        });


        me._employeeStore.on('load', function () {
            calculateVacationEarned();
        });

        var setLegalHolidays = function () {
            if (me._budLaborCalculationStore.getCount() == 0)
                return;
            var record = me._budLaborCalculationStore.getAt(0);
            var availHolidays = me._budHolidayStore.queryBy(function (rec) {
                return rec.get('fscPeriod') != 0;
            });
            record.set('legalHolidays', availHolidays.getCount());
        }

        me._budHolidayStore.on({
            add: { fn: setLegalHolidays },
            remove: { fn: setLegalHolidays },
            update: { fn: setLegalHolidays },
            datachanged: { fn: setLegalHolidays }
        });

        var calculateStaffing = function () {
            if (me._staffingSummaryStore.getCount() <= 1 || me._budLaborCalculationStore.getCount() == 0)
                return;

            var weeklyTotal = 0;
            var holidaysProposedTotal = 0;
            var holidaysCurrentTotal = 0;
            // _staffingSummaryStore has a 'total row'
            for (var i = 0; i < me._staffingSummaryStore.getCount() - 1; i++) {
                weeklyTotal += me._staffingSummaryStore.getAt(i).get('proposedTotal');
                holidaysProposedTotal += me._staffingSummaryStore.getAt(i).get('proposedHolidays');
                holidaysCurrentTotal += me._staffingSummaryStore.getAt(i).get('currentHolidays');
            }
            var record = me._budLaborCalculationStore.getAt(0);
            record.set('totalWeeklyStaffingHours', weeklyTotal);
            record.set('totalStaffingLegalHolidays', me._staffingSummaryStore.shortStaffingOnLegalHolidays);           /// holidaysProposedTotal - holidaysCurrentTotal);
        };

        me._staffingSummaryStore.on('load', function () {
            calculateStaffing();
        });

        Bud.page.LaborCalculationsPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    render: function () {

        Bud.page.LaborCalculationsPage.superclass.render.call(this);
    },
    onModeChanged: function () {
        var me = this;
        var btnSickSave = Ext.get(me.getClientId('btnSickSave'));
        var btnSickCancel = Ext.get(me.getClientId('btnSickCancel'));

        var btnLegSave1 = Ext.get(me.getClientId('btnLegSave1'));
        var btnLegSave2 = Ext.get(me.getClientId('btnLegSave2'));
        var btnLegCancel1 = Ext.get(me.getClientId('btnLegCancel1'));
        var btnLegCancel2 = Ext.get(me.getClientId('btnLegCancel2'));
        var btnLegAdd = Ext.get(me.getClientId('btnLegAdd'));

        var btnInsuranceSave = Ext.get(me.getClientId('btnInsuranceSave'));

        var btnNetProdDaysSave = Ext.get(me.getClientId('btnNetProdDaysSave'));
        var btnNetProdDaysCancel = Ext.get(me.getClientId('btnNetProdDaysCancel'));

        var btnLaborStandardsSave = Ext.get(me.getClientId('btnLaborStandardsSave'));
        var btnLaborStandardsCancel = Ext.get(me.getClientId('btnLaborStandardsCancel'));

        var btnLaborStandardInDollarsSave = Ext.get(me.getClientId('btnLaborStandardInDollarsSave'));
        var btnLaborStandardInDollarsCancel = Ext.get(me.getClientId('btnLaborStandardInDollarsCancel'));

        var hideElement = function (el) { if (el && el.hide) el.hide(); }
        var showElement = function (el) { if (el && el.show) el.show(); }
        var disableElement = function (el) { if (el && el.disable) el.disable(); }
        var enableElement = function (el) { if (el && el.enable) el.enable(); }

        if (me.isReadOnlyMode()) {
            disableElement(me._sickPayForm.findField('sickDays'));
            disableElement(me._sickPayForm.findField('sickDaysTaken'));
            disableElement(me._sickPayForm.findField('sickDaysProjected'));

            disableElement(me._legalHolidaysForm.findField('personalDays'));
            disableElement(me._legalHolidaysForm.findField('otherPaidLeave'));

            disableElement(me._insuranceForm.findField('singleHMOCount'));
            disableElement(me._insuranceForm.findField('singlePOSCount'));
            disableElement(me._insuranceForm.findField('singleLibertyCount'));
            disableElement(me._insuranceForm.findField('singleDentalCount'));
            disableElement(me._insuranceForm.findField('singleLifeCount'));
            disableElement(me._insuranceForm.findField('singleUnionCount'));
            disableElement(me._insuranceForm.findField('familyHMOCount'));
            disableElement(me._insuranceForm.findField('familyPOSCount'));
            disableElement(me._insuranceForm.findField('familyLibertyCount'));
            disableElement(me._insuranceForm.findField('familyDentalCount'));
            disableElement(me._insuranceForm.findField('familyLifeCount'));
            disableElement(me._insuranceForm.findField('familyUnionCount'));
            disableElement(me._insuranceForm.findField('singleHMOCost'));
            disableElement(me._insuranceForm.findField('singlePOSCost'));
            disableElement(me._insuranceForm.findField('singleLibertyCost'));
            disableElement(me._insuranceForm.findField('singleDentalCost'));
            disableElement(me._insuranceForm.findField('singleLifeCost'));
            disableElement(me._insuranceForm.findField('singleUnionCost'));
            disableElement(me._insuranceForm.findField('familyHMOCost'));
            disableElement(me._insuranceForm.findField('familyPOSCost'));
            disableElement(me._insuranceForm.findField('familyLibertyCost'));
            disableElement(me._insuranceForm.findField('familyDentalCost'));
            disableElement(me._insuranceForm.findField('familyLifeCost'));
            disableElement(me._insuranceForm.findField('familyUnionCost'));

            disableElement(me._netProdDaysPerEmpFtesForm.findField('employeeHoursPerDay'));

            disableElement(me._laborStandardsForm.findField('projectedNewEmployees'));
            disableElement(me._laborStandardsForm.findField('projectedEmployeeTrainingHours'));
            disableElement(me._laborStandardsForm.findField('nonReplaceVacationPerc'));
            disableElement(me._laborStandardsForm.findField('nonReplaceSickPayPerc'));
            disableElement(me._laborStandardsForm.findField('nonReplaceHolidayPerc'));
            disableElement(me._laborStandardsForm.findField('nonReplacePersonalPerc'));

            disableElement(me._laborStandardInDollarsForm.findField('meritIncreasePerHour'));
            disableElement(me._laborStandardInDollarsForm.findField('employeesLeaving'));
            disableElement(me._laborStandardInDollarsForm.findField('startingWageRate'));
            disableElement(me._laborStandardInDollarsForm.findField('estimatedCOLPeriodOfIncrease'));
            disableElement(me._laborStandardInDollarsForm.findField('estimatedCOLIncreasePerHour'));

            hideElement(btnSickSave);
            hideElement(btnSickCancel);

            hideElement(btnLegSave1);
            hideElement(btnLegSave2);
            hideElement(btnLegCancel1);
            hideElement(btnLegCancel2);
            hideElement(btnLegAdd);

            hideElement(btnInsuranceSave);

            hideElement(btnNetProdDaysSave);
            hideElement(btnNetProdDaysCancel);

            hideElement(btnLaborStandardsSave);
            hideElement(btnLaborStandardsCancel);

            hideElement(btnLaborStandardInDollarsSave);
            hideElement(btnLaborStandardInDollarsCancel);

        } else {
            enableElement(me._sickPayForm.findField('sickDays'));
            enableElement(me._sickPayForm.findField('sickDaysTaken'));
            enableElement(me._sickPayForm.findField('sickDaysProjected'));

            enableElement(me._legalHolidaysForm.findField('personalDays'));
            enableElement(me._legalHolidaysForm.findField('otherPaidLeave'));

            enableElement(me._insuranceForm.findField('singleHMOCount'));
            enableElement(me._insuranceForm.findField('singlePOSCount'));
            enableElement(me._insuranceForm.findField('singleLibertyCount'));
            enableElement(me._insuranceForm.findField('singleDentalCount'));
            enableElement(me._insuranceForm.findField('singleLifeCount'));
            enableElement(me._insuranceForm.findField('singleUnionCount'));
            enableElement(me._insuranceForm.findField('familyHMOCount'));
            enableElement(me._insuranceForm.findField('familyPOSCount'));
            enableElement(me._insuranceForm.findField('familyLibertyCount'));
            enableElement(me._insuranceForm.findField('familyDentalCount'));
            enableElement(me._insuranceForm.findField('familyLifeCount'));
            enableElement(me._insuranceForm.findField('familyUnionCount'));
            enableElement(me._insuranceForm.findField('singleHMOCost'));
            enableElement(me._insuranceForm.findField('singlePOSCost'));
            enableElement(me._insuranceForm.findField('singleLibertyCost'));
            enableElement(me._insuranceForm.findField('singleDentalCost'));
            enableElement(me._insuranceForm.findField('singleLifeCost'));
            enableElement(me._insuranceForm.findField('singleUnionCost'));
            enableElement(me._insuranceForm.findField('familyHMOCost'));
            enableElement(me._insuranceForm.findField('familyPOSCost'));
            enableElement(me._insuranceForm.findField('familyLibertyCost'));
            enableElement(me._insuranceForm.findField('familyDentalCost'));
            enableElement(me._insuranceForm.findField('familyLifeCost'));
            enableElement(me._insuranceForm.findField('familyUnionCost'));

            enableElement(me._netProdDaysPerEmpFtesForm.findField('employeeHoursPerDay'));

            enableElement(me._laborStandardsForm.findField('projectedNewEmployees'));
            enableElement(me._laborStandardsForm.findField('projectedEmployeeTrainingHours'));
            enableElement(me._laborStandardsForm.findField('nonReplaceVacationPerc'));
            enableElement(me._laborStandardsForm.findField('nonReplaceSickPayPerc'));
            enableElement(me._laborStandardsForm.findField('nonReplaceHolidayPerc'));
            enableElement(me._laborStandardsForm.findField('nonReplacePersonalPerc'));

            enableElement(me._laborStandardInDollarsForm.findField('meritIncreasePerHour'));
            enableElement(me._laborStandardInDollarsForm.findField('employeesLeaving'));
            enableElement(me._laborStandardInDollarsForm.findField('startingWageRate'));
            enableElement(me._laborStandardInDollarsForm.findField('estimatedCOLPeriodOfIncrease'));
            enableElement(me._laborStandardInDollarsForm.findField('estimatedCOLIncreasePerHour'));

            showElement(btnSickSave);
            showElement(btnSickCancel);

            showElement(btnLegSave1);
            showElement(btnLegSave2);
            showElement(btnLegCancel1);
            showElement(btnLegCancel2);
            showElement(btnLegAdd);

            showElement(btnInsuranceSave);

            showElement(btnNetProdDaysSave);
            showElement(btnNetProdDaysCancel);

            showElement(btnLaborStandardsSave);
            showElement(btnLaborStandardsCancel);

            showElement(btnLaborStandardInDollarsSave);
            showElement(btnLaborStandardInDollarsCancel);
        }
    }
});

WebLight.PageMgr.registerType('laborcalculations', Bud.page.LaborCalculationsPage);


/// <reference path="../../references/jquery-1.4.1.js" />
/// <reference path="../../references/weblight4extjs.js" />

WebLight.namespace('Bud.page');

Bud.page.ManagementHistoryPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Mgt Hist',
    html: _builtInTemplate_6091cb6c[37],

    _managementHistoryStore: null,

    _personalSalaryGrid: null,
    _managementAdministrationGrid: null,

    numberRenderer: function (value, metaData, record, rowIndex, colIndex, store) {
        return Ext.util.Format.number(value, '0,000.00');
    },

    createPersonalSalaryReviewGrid: function () {
        var current = this;

        var totalRowRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == current._managementHistoryStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00');

            return value;
        }

        this._personalSalaryGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', enableHdMenu: false,
            store: this._managementHistoryStore,

            clicksToEdit: 1, height: 400,
            width: 1250,
            viewConfig: { forceFit: true },
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false },
                isCellEditable: function (col, row) {
                    return row < current._managementHistoryStore.getCount() - 1;
                },
                columns: [
                            { header: 'Name', dataIndex: 'employeeName', css: 'color:#43A643;font-weight:bold;',
                                editor: new Ext.form.TextField(),
                                renderer: totalRowRenderer
                            },
                            { header: 'Position', dataIndex: 'position', css: 'color:#43A643;font-weight:bold;',
                                editor: new Ext.form.TextField()
                            },
                            { header: 'Annual Salary', dataIndex: 'annualSalary', css: 'color:#43A643;font-weight:bold;',
                                editor: new Ext.form.NumberField(),
                                renderer: totalRowRenderer,
                                align: 'right'
                            },
                            { header: 'Period of Incerase', dataIndex: 'fscPeriodOfIncrease', css: 'color:#43A643;font-weight:bold;',
                                editor: new Ext.form.NumberField({ minValue: 0, maxValue: 13 }),
                                align: 'right'
                            },
                            { header: 'Type Merit Promotion', dataIndex: 'typeMeritPromotion', css: 'color:#43A643;font-weight:bold;',
                                editor: new Ext.form.TextField({ maxLength: 1 }),
                                align: 'right'
                            },
                            { header: '<span id="fsc-year">2011</span> Fiscal Increase(%)', dataIndex: 'fiscalIncrease', css: 'color:#43A643;font-weight:bold;',
                                editor: new Ext.form.NumberField(),
                                renderer: totalRowRenderer,
                                align: 'right'
                            },
                            { header: 'New Salary', dataIndex: 'newAnnualSalary',
                                renderer: totalRowRenderer,
                                align: 'right'
                            },
                            { header: 'Remove', width: 50, align: 'center',
                                renderer: function (value, metaData, record, rowIndex, colIndex, store) {
                                    if (record.get('_sysStatus') == 1 && rowIndex < current._managementHistoryStore.getCount() - 1)
                                        return '<a href="javascript:void(0);" xcmd="remove">Remove</a>';
                                    return '';
                                }
                            }
                        ]
            })
        });

        this._personalSalaryGrid.on('cellclick', function (grid, rowIndex, colIndex, e) {
            if (colIndex == 7) {
                var cmd = $(e.getTarget()).attr('xcmd');
                var record = grid.getStore().getAt(rowIndex);
                switch (cmd) {
                    case 'remove':
                        current._managementHistoryStore.remove(record);
                        current._personalSalaryGrid.getView().refresh();
                        break;
                }
            }
        });
        this._personalSalaryGrid.on('beforeedit', function (e) {
            if (current.isReadOnlyMode())
                e.cancel = true;
        });

        this._personalSalaryGrid.on('afteredit', function () { fin.bud.modified(true); });
    },

    createManagementAdministrationGrid: function () {
        var current = this;

        var totalRowRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == current._managementHistoryStore.getCount() - 1)
                metaData.attr = 'style="font-weight:bold;"';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00');

            return value;
        }

        this._managementAdministrationGrid = new WebLight.grid.GridPanel({
            ctCls: 'ux-grid-1', enableHdMenu: false,
            store: this._managementHistoryStore,
            width: 1250,
            viewConfig: { forceFit: true }, height: 400,
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false, width: 68, renderer: totalRowRenderer, align: 'right' },
                columns: [
                            { header: 'Name', dataIndex: 'employeeName', width: 100, align: 'left' },
                            { header: 'Period 1', dataIndex: 'period1' },
                            { header: 'Period 2', dataIndex: 'period2' },
                            { header: 'Period 3', dataIndex: 'period3' },
                            { header: 'Period 4', dataIndex: 'period4' },
                            { header: 'Period 5', dataIndex: 'period5' },
                            { header: 'Period 6', dataIndex: 'period6' },
                            { header: 'Period 7', dataIndex: 'period7' },
                            { header: 'Period 8', dataIndex: 'period8' },
                            { header: 'Period 9', dataIndex: 'period9' },
                            { header: 'Period 10', dataIndex: 'period10' },
                            { header: 'Period 11', dataIndex: 'period11' },
                            { header: 'Period 12', dataIndex: 'period12' },
                // { header: 'Period 13', dataIndex: 'period13' },
                            {header: 'Total', dataIndex: 'periodTotal' }
                        ]
            })
        });
    },

    createChildControls: function () {
        var current = this;
        this._managementHistoryStore = new Bud.data.EmployeeLockStore({ isMgtHistory: true });

        this.createPersonalSalaryReviewGrid();
        this.createManagementAdministrationGrid();


        this.addChildControl(this._personalSalaryGrid, 'personal-salary-review-grid');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', width: 80, text: 'Add', id: current.getClientId('btnAdd'),
            handler: function () {
                current._managementHistoryStore.addNewRecord();
                current._personalSalaryGrid.getView().refresh();
                fin.bud.modified(true);
            }
        }), 'personal-salary-review-add-button');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', width: 100, text: 'Save Changes', id: current.getClientId('btnSave'),
            handler: function () {
                current._managementHistoryStore.submitChanges(function () {
                    current._managementHistoryStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), 1);
                });
            }
        }), 'personal-salary-review-save-button');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', width: 80, text: 'Cancel', id: current.getClientId('btnCancel'),
            handler: function () {
                current._managementHistoryStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), 1);

            }
        }), 'personal-salary-review-cancel-button');

        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', width: 80, text: 'Print',
            handler: function () { current.print(); }
        }), 'personal-salary-review-print-button');

        this.addChildControl(this._managementAdministrationGrid, 'management-admin-worksheet-grid');

        Bud.page.ManagementHistoryPage.superclass.createChildControls.call(this);

        $('#' + this.getClientId('management-history-tab-panel')).tabs();
    },
    dataBind: function () {
        var current = this;
        this.on('contextChanged', function () {
            $('#fsc-year').text(current.getFscYearTitle());
            current._managementHistoryStore.load(current.getHcmHouseCode(), current.getHcmJob(), current.getFscYear(), 1);
        });
        this.on('modechanged', function () {
            current.onModeChanged();
        });
        this._managementHistoryStore.on('load', function () {
            fin.bud.modified(false);
        }, this);

        this.grouping([this, this._managementHistoryStore], {
        });

        Bud.page.ManagementHistoryPage.superclass.dataBind.call(this);
        current.onModeChanged();
    },

    print: function () {
        Ext.ux.Printer.print('Management History', _builtInTemplate_6091cb6c[38],
         { incomeTypes: this._personalSalaryGrid,
             'hcmHouseCodeTitle': this.getHcmHouseCodeTitle(),
             'hcmJobTitle': this.getHcmJobTitle(),
             'fscYearTitle': this.getFscYearTitle()
         },
         '../../res/css/print-all.css');
    },
    onModeChanged: function () {
        var me = this;

        var btnSave = Ext.get(me.getClientId('btnSave'));
        var btnCancel = Ext.get(me.getClientId('btnCancel'));
        var btnAdd = Ext.get(me.getClientId('btnAdd'));
        if (me.isReadOnlyMode()) {
            btnSave.hide();
            btnCancel.hide();
            btnAdd.hide();
        } else {
            btnSave.show();
            btnCancel.show();
            btnAdd.show();
        }
    }
});

WebLight.PageMgr.registerType('managementhistory', Bud.page.ManagementHistoryPage);


/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.form.StaffingHourNumberField = Ext.extend(Ext.form.NumberField, {
    allowBlank: false, allowNegative: false, minValue: 0, decimalPrecision: 2
});

Bud.page.StaffingHourPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Staffing Hours',
    html: _builtInTemplate_6091cb6c[39],
    arrayStore: null,

    _shiftTypeStore: null,
    _staffingDetailStore: null,
    _staffingSummaryStore: null,
    _educationStaffingStore: null,

    _shiftTypeDorpdown: null,
    _staffingDetailGrid: null,
    _staffingSummaryGrid: null,
    _educatioStaffingGrid: null,

    createStaffingDetailGrid: function () {
        var current = this;

        var xRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == current._staffingDetailStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00').replace(/\.00$/gi, '');

            return value;
        }

        var isRetailType = Bud.Context.primaryNav.currentBudgetTemplateId == 4;

        var descriptionRow = [
            { header: '', colspan: 1}];

        if (isRetailType)
            descriptionRow.push({ header: '', colspan: 1 });
        descriptionRow = descriptionRow.concat([
            { header: 'Current Staff:Productive Hours per Shift', colspan: 9 },
            { header: 'Proposed Staff:Productive Hours per Shift', colspan: 9 },
            { header: '', colspan: 1 }
        ]);
        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [descriptionRow]
        });

        var detailColumns = [
                            { header: 'Unit', width: 60, dataIndex: 'unit', align: 'left', editor: new Ext.form.TextField(), renderer: xRenderer}];


        if (isRetailType)
            detailColumns.push({ header: 'Hourly Rate', width: 60, dataIndex: 'proposedHourlyRate', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() });

        detailColumns = detailColumns.concat([
                            { header: 'Sun', width: 55, dataIndex: 'currentSunday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Mon', width: 55, dataIndex: 'currentMonday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Tues', width: 55, dataIndex: 'currentTuesday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Weds', width: 55, dataIndex: 'currentWednesday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Thurs', width: 55, dataIndex: 'currentThursday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Fri', width: 55, dataIndex: 'currentFriday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Sat', width: 55, dataIndex: 'currentSaturday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Wkly Total', width: 60, dataIndex: 'currentTotal', renderer: xRenderer },
                            { header: 'Legal Hol', width: 60, dataIndex: 'currentHolidays', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField()}]);

        //        if (isRetailType)
        //            detailColumns.push({ header: 'Hourly Rate', width: 60, dataIndex: 'currentHourlyRate', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() });

        detailColumns = detailColumns.concat([{ header: 'Sun', width: 55, dataIndex: 'proposedSunday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Mon', width: 55, dataIndex: 'proposedMonday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Tues', width: 55, dataIndex: 'proposedTuesday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Weds', width: 55, dataIndex: 'proposedWednesday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Thurs', width: 55, dataIndex: 'proposedThursday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Fri', width: 55, dataIndex: 'proposedFriday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Sat', width: 55, dataIndex: 'proposedSaturday', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() },
                            { header: 'Wkly Total', width: 60, dataIndex: 'proposedTotal', renderer: xRenderer },
                            { header: 'Legal Hol', width: 60, dataIndex: 'proposedHolidays', renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField()}]);


        detailColumns.push({ header: 'Remove', width: 50, align: 'center',
            renderer: function (value, metaData, record, rowIndex, colIndex, store) {
                if (record.get('_sysStatus') == 1 && rowIndex < current._staffingDetailStore.getCount() - 1)
                    return '<a href="javascript:void(0);" xcmd="remove">Remove</a>';
                return '';
            }
        });

        this._staffingDetailGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', enableHdMenu: false,
            viewConfig: { forceFit: true },
            store: this._staffingDetailStore, height: 400,
            clicksToEdit: 1, width: 1250,
            plugins: [group],
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false, align: 'right' },
                isCellEditable: function (col, row) {
                    return row < current._staffingDetailStore.getCount() - 1;
                },
                columns: detailColumns
            })
        });

        this._staffingDetailGrid.on('cellclick', function (grid, rowIndex, colIndex, e) {
            if (colIndex == 19) {
                var cmd = $(e.getTarget()).attr('xcmd');
                switch (cmd) {
                    case 'remove':
                        grid.getStore().removeAt(rowIndex);
                        current._staffingDetailGrid.getView().refresh();
                        current.refreshSummayValues();
                        break;
                }
            }
        });
        this._staffingDetailGrid.on('beforeedit', function (e) {
            if (current.isReadOnlyMode())
                e.cancel = true;
        });

        this._staffingDetailGrid.on('afteredit', function (e) {
            fin.bud.modified(true);
        });
    },

    createStaffingSummaryGrid: function () {
        var current = this;

        var xRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == current._staffingSummaryStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00').replace(/\.00$/gi, '');

            return value;
        }

        var descriptionRow = [
            { header: '', colspan: 1 },
            { header: 'Current Staff:Productive Hours per Shift', colspan: 9 },
            { header: 'Proposed Staff:Productive Hours per Shift', colspan: 9 }
        ];
        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [descriptionRow]
        });

        this._staffingSummaryGrid = new Bud.grid.GridPanel({
            ctCls: 'ux-grid-1', enableHdMenu: false,
            viewConfig: { forceFit: true },
            store: this._staffingSummaryStore, height: 400,
            clicksToEdit: 1,
            plugins: [group],
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false, renderer: xRenderer, align: 'right' },
                columns: [
                            { header: 'Unit', width: 60, dataIndex: 'unit', align: 'left' },
                            { header: 'Sun', width: 60, dataIndex: 'currentSunday' },
                            { header: 'Mon', width: 60, dataIndex: 'currentMonday' },
                            { header: 'Tues', width: 60, dataIndex: 'currentTuesday' },
                            { header: 'Weds', width: 60, dataIndex: 'currentWednesday' },
                            { header: 'Thurs', width: 60, dataIndex: 'currentThursday' },
                            { header: 'Fri', width: 60, dataIndex: 'currentFriday' },
                            { header: 'Sat', width: 60, dataIndex: 'currentSaturday' },
                            { header: 'Wkly Total', width: 60, dataIndex: 'currentTotal' },
                            { header: 'Legal Hol', width: 60, dataIndex: 'currentHolidays' },
                            { header: 'Sun', width: 60, dataIndex: 'proposedSunday' },
                            { header: 'Mon', width: 60, dataIndex: 'proposedMonday' },
                            { header: 'Tues', width: 60, dataIndex: 'proposedTuesday' },
                            { header: 'Weds', width: 60, dataIndex: 'proposedWednesday' },
                            { header: 'Thurs', width: 60, dataIndex: 'proposedThursday' },
                            { header: 'Fri', width: 60, dataIndex: 'proposedFriday' },
                            { header: 'Sat', width: 60, dataIndex: 'proposedSaturday' },
                            { header: 'Wkly Total', width: 60, dataIndex: 'proposedTotal' },
                            { header: 'Legal Hol', width: 60, dataIndex: 'proposedHolidays' }
                    ]
            })
        });
    },

    createEducationStaffingGrid: function () {
        var current = this;

        var xRenderer = function (value, metaData, record, rowIndex, colIndex, store) {

            if (typeof value == 'number')
                return Ext.util.Format.number(value, '0,000.00').replace(/\.00$/gi, '');

            return value;
        }

        var groupRow = [];

        for (var i = 1; i <= 12; i++) {
            groupRow.push({ header: String.format('<div style="text-align:center;">Period {0}</div>', i), colspan: 4 });
        }
        //groupRow.push({ header: 'Fiscal Year', colspan: 1 });

        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [groupRow]
        });


        var columns = [];

        for (var i = 1; i <= 12; i++) {
            columns.push({ header: 'Hours<br/>Per<br/>Day', width: 52, dataIndex: 'hoursPerDay' + i, renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() });
            columns.push({ header: 'Avg.<br/>Wage<br/>Rate', width: 52, dataIndex: 'avgWageRate' + i, renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() });
            columns.push({ header: 'Days<br/>Per<br/>Month', width: 52, dataIndex: 'daysPerMonth' + i, renderer: xRenderer, editor: new Bud.form.StaffingHourNumberField() });
            columns.push({ header: 'Amount', width: 60, dataIndex: 'amount' + i, renderer: xRenderer });
        }
        //columns.push({ header: 'Amount', dataIndex: 'amountFY', renderer: xRenderer });

        current._educatioStaffingGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', enableHdMenu: false,
            store: this._educationStaffingStore,
            height: 150, clicksToEdit: 1,
            plugins: [group],
            cm: new Ext.grid.ColumnModel({
                defaults: { sortable: false, width: 120, renderer: xRenderer, align: 'right' },
                isCellEditable: function (col, row) {
                    return col != 48 && col % 4 != 3;
                },
                columns: columns
            })
        });

        this._educatioStaffingGrid.on('beforeedit', function (e) {
            if (current.isReadOnlyMode())
                e.cancel = true;
        });

        this._educatioStaffingGrid.on('afteredit', function (e) {
            fin.bud.modified(true);
        });
    },

    createChildControls: function () {
        var current = this;
        this._shiftTypeStore = new Bud.data.BudShiftTypeStore();
        this._shiftTypeStore.loadSampleData();
        this._shiftTypeDorpdown = new Bud.form.DropdownList({
            store: this._shiftTypeStore,
            value: 1,
            displayField: 'title',
            valueField: 'id'
        });
        this.addChildControl(this._shiftTypeDorpdown, 'staffing-shift-select-box');

        this._shiftTypeDorpdown.on('beforeselect', function () { return !fin.bud.modified(); });


        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Add Unit\\Position', width: 120, id: current.getClientId('btnAdd'),
            handler: function () {
                current._staffingDetailStore.addNewRecord({});
                current._staffingDetailGrid.getView().refresh();
                current.refreshSummayValues();
                fin.bud.modified(true);
            }
        }), 'staffing-add-unit-button');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Save', width: 80, id: current.getClientId('btnSave'),
            handler: function () {
                current._staffingDetailStore.submitChanges(function () {
                    current._staffingDetailStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), current._shiftTypeDorpdown.getValue());
                    current._staffingSummaryStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), 0);
                    fin.bud.modified(false);
                });
            }
        }), 'staffing-update-button');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Cancel', id: current.getClientId('btnCancel'), width: 80, handler: function () {
            current._staffingDetailStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), current._shiftTypeDorpdown.getValue());
        }
        }), 'staffing-cancel-button');
        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Print', width: 80, handler: function () {
            current._staffingDetailGrid.getColumnModel().config[current._staffingDetailGrid.getColumnModel().config.length - 1].hidden = true;

            Ext.ux.Printer.print('Staffing Hour', _builtInTemplate_6091cb6c[40],
         { staffingHours: current._staffingDetailGrid,
             'hcmHouseCodeTitle': current.getHcmHouseCodeTitle(),
             'hcmJobTitle': current.getHcmJobTitle(),
             'fscYearTitle': current.getFscYearTitle()
         },
         '../../res/css/print-all.css');
            current._staffingDetailGrid.getColumnModel().config[current._staffingDetailGrid.getColumnModel().config.length - 1].hidden = false;
        }
        }), 'staffing-print-button');

        this._staffingDetailStore = new Bud.data.BudStaffingHourStore();
        this._staffingDetailStore.on('load', function () { fin.bud.modified(false); });

        this.createStaffingDetailGrid();
        this.addChildControl(this._staffingDetailGrid, 'staffing-detail-worksheet-grid');

        this._educationStaffingStore = new Bud.data.BudEducationStaffingHourStore();

        this.createEducationStaffingGrid();
        this.addChildControl(this._educatioStaffingGrid, 'education-staffing-grid');

        this._educationStaffingStore.on('datarefresh', function () {
            $('#' + current.getClientId('educationFiscalYear')).html(Ext.util.Format.number(current._educationStaffingStore.getAt(0).get('amountFY'), '0,000.00'));
        });

        this._staffingSummaryStore = new Bud.data.BudStaffingHourStore();
        this.createStaffingSummaryGrid();
        this.addChildControl(this._staffingSummaryGrid, 'staffing-hours-summary-worksheet-grid');



        this.addChildControl(this._increasePerWeek = Ext.create({ xtype: 'displayfield' }), 'increase-per-week-textbox');
        this.addChildControl(this._increaseOnLegalHolidays = Ext.create({ xtype: 'displayfield' }), 'increase-on-legal-holidays-textbox');

        Bud.page.StaffingHourPage.superclass.createChildControls.call(this);

        this.addChildControl(Ext.create({ xtype: 'button', ctCls: 'ux-button-1', text: 'Save', width: 80, id: current.getClientId('btnEducationSave'),
            handler: function () {
                current._educationStaffingStore.submitChanges(function () {
                    fin.bud.modified(false);
                    current._educationStaffingStore.load(current.getHcmHouseCode(), current.getHcmJob(),
                            current.getFscYear(), current._shiftTypeDorpdown.getValue());
                });
            }
        }), 'education-staffing-save-button');

        var toggleWrapper = function () {

            if (Bud.Context.primaryNav.currentBudgetTemplateId == 5) {
                $('#' + current.getClientId('summayTabLink')).hide();
                $('#' + current.getClientId('general-wrapper')).hide();
                $('#' + current.getClientId('education-wrapper')).show();
            }
            else {
                $('#' + current.getClientId('general-wrapper')).show();
                $('#' + current.getClientId('education-wrapper')).hide();
            }
        };

        this.on('render', toggleWrapper);
        this.on('resume', toggleWrapper);
        toggleWrapper();

        $('#' + this.getClientId('staffing-tab-panel')).tabs();
    },

    dataBind: function () {
        var current = this;
        this._shiftTypeDorpdown.on('valuechange', function (v) {
            if (v) {
                current._staffingDetailStore.load(current.getHcmHouseCode(), current.getHcmJob(), current.getFscYear(), v);
            }
        });

        this.on('contextChanged', function () {
            current._staffingDetailStore.load(current.getHcmHouseCode(), current.getHcmJob(), current.getFscYear(), current._shiftTypeDorpdown.getValue());
            current._staffingSummaryStore.load(current.getHcmHouseCode(), current.getHcmJob(), current.getFscYear(), 0);
            current._educationStaffingStore.load(current.getHcmHouseCode(), current.getHcmJob(), current.getFscYear());
        });

        this.on('modechanged', function () {
            current.onModeChanged();
        });

        this.grouping([this, this._staffingDetailStore, this._staffingSummaryStore, this._educationStaffingStore]
        , { 
        });

        this._staffingDetailStore.on('datarefresh', function () {
            current._staffingDetailGrid.getView().refresh();
            //current.refreshSummayValues();
        });

        this._staffingSummaryStore.on('datarefresh', function (store) {
            current.refreshSummayValues();
        });

        this._educationStaffingStore.on('datarefresh', function (store) {
            current._educatioStaffingGrid.getView().refresh();
        });

        Bud.page.StaffingHourPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },

    refreshSummayValues: function () {
        var current = this;

        current._increasePerWeek.setValue(current._staffingSummaryStore.plannedPerWeek);
        current._increaseOnLegalHolidays.setValue(current._staffingSummaryStore.shortStaffingOnLegalHolidays);
    },

    refreshUI: function () {
        var current = this;

        if (Bud.Context.primaryNav.currentBudgetTemplateId == 5) {
            $('#' + current.getClientId('summayTabLink')).hide();
            $('#' + current.getClientId('general-wrapper')).hide();
            $('#' + current.getClientId('education-wrapper')).show();
        }
        else {
            $('#' + current.getClientId('general-wrapper')).show();
            $('#' + current.getClientId('education-wrapper')).hide();
        }

    },

    onModeChanged: function () {
        var me = this;
        var btnSave = Ext.get(me.getClientId('btnSave'));
        if (!btnSave)
            return;

        var btnCancel = Ext.get(me.getClientId('btnCancel'));
        var btnAdd = Ext.get(me.getClientId('btnAdd'));
        var btnEducationSave = Ext.get(me.getClientId('btnEducationSave'));
        if (me.isReadOnlyMode()) {
            btnSave.hide();
            btnCancel.hide();
            btnAdd.hide();
            btnEducationSave.hide();
        } else {
            btnSave.show();
            btnCancel.show();
            btnAdd.show();
            btnEducationSave.show();
        }
    }
});

WebLight.PageMgr.registerType('staffing', Bud.page.StaffingHourPage);


/// <reference path="../../references/jquery-1.4.1.js" />
/// <reference path="../../references/ext-jquery-adapter.js" />
/// <reference path="../../references/ext-all.js" />
/// <reference path="../../references/weblight4extjs.js" />

WebLight.namespace('Bud.page');

Bud.page.StartBudgetPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Start Budget',
    html: _builtInTemplate_6091cb6c[41],

    _annualInformationStore: null,
    _annualBudgetStore: null,
    _startDateLabel: null,
    _startByLabel: null,
    _startBudgetButton: null,

    createChildControls: function () {
        var me = this;
        this._annualBudgetStore = new Bud.data.BudAnnualBudgetStore();
        this._annualInformationStore = new Bud.data.BudAnnualInformationStore();

        this.addChildControl(this._startBudgetButton = new Ext.Button({ hidden: true, ctCls: 'ux-button-1', text: 'Add New Budget',
            width: 120,
            handler: function () {
                var startStore = new Bud.data.BudAnnualBudgetStartStore();
                startStore.add(startStore.newRecord({ hcmHouseCode: me.getHcmHouseCode(), hcmJob: me.getHcmJob(), fscYear: me.getFscYear() }));
                me.getEl().mask('Starting budget...');
                startStore.submitChanges(function () {
                    if (me.getEl && me.getEl() && me.getEl().unmask)
                        me.getEl().unmask();

                    //cannot remove load command, it used to refresh tabs.
                    me._annualBudgetStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
                    WebLight.Router.route('/budget/bgtdetails');
                });
            }
        })
                    , 'add-new-budget-button');
        this.addChildControl(this._startDateLabel = Ext.create({ xtype: 'displayfield' }), 'start-date-label');
        this.addChildControl(this._startByLabel = Ext.create({ xtype: 'displayfield' }), 'start-by-label');

        this._annualBudgetStore.on('load', function (s) {
            if (s.getCount() > 0) {
                me._startDateLabel.setValue(Ext.util.Format.date(s.getAt(0).get('startDate'), 'm/d/Y'));
                me._startByLabel.setValue(s.getAt(0).get('startedBy'));

                var annualBudget = s.getAt(0);
                var primaryNav = Bud.Context.primaryNav;
                primaryNav.currentContractType = annualBudget.get('contractTypeId');
                primaryNav.currentBudgetTemplateId = annualBudget.get('budgetTemplateId');
                primaryNav.currentBudgetLaborCalcMethod = annualBudget.get('budgetLaborCalcMethod');
                primaryNav.currentHouseCodeTypeId = annualBudget.get('houseCodeTypeId');
                primaryNav.currentBillingCycleFrequencyTypeId = annualBudget.get('billingCycleFrequencyTypeId');

                //me._startBudgetButton.hide();
                Bud.Context.primaryNav.currentBudgetStarted = true;
            }
            else {
                //me._startBudgetButton.show();
                me._startByLabel.setValue('');
                me._startDateLabel.setValue('');
                Bud.Context.primaryNav.currentBudgetStarted = false;
            }
            Bud.Context.primaryNav.resetMenuItems();
        });

        this._annualInformationStore.on('load', function (store, records) {
            if (store.getCount() > 0) {
                var record = store.getAt(0);
                if (record && record.get && record.get('id') == me.getFscYear())
                    me.$child('start-budget-comment').html(record.get('announcement'));
            }
        });


        this.grouping([this, this._annualBudgetStore, this._annualInformationStore], {
            load: function () {
                var annualInformation = me._annualInformationStore.getAt(0);
                var startDate = annualInformation.get('startDate');
                var cutOffDate = annualInformation.get('cutOffDate');
                var today = new Date();


                me._startBudgetButton.show();
                // temp approach, for test fscyear 2013
                if ((startDate <= today && today <= cutOffDate || me._fscYear == 4) && me._annualBudgetStore.getCount() == 0)
                    me._startBudgetButton.show();
                else
                    me._startBudgetButton.hide();

            }
        });

        Bud.page.StartBudgetPage.superclass.createChildControls.call(this);
    },

    dataBind: function () {
        var me = this;
        this.on('contextChanged', function () {

            me._annualBudgetStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear());
            me._annualInformationStore.load(me.getFscYear())
        });


        Bud.page.StartBudgetPage.superclass.dataBind.call(this);
    }
});

WebLight.PageMgr.registerType('startbudget', Bud.page.StartBudgetPage);


/// <reference path="../Core.js" />

WebLight.namespace('Bud.page');

Bud.page.SupplyExpendituresPage = WebLight.extend(Bud.page.BudgetPage, {
    title: 'Supply Exp',
    html: _builtInTemplate_6091cb6c[42],
    supplyExpenditureStore: null,
    supplyExpenditureGrid: null,

    fscAccount: 0,
    supplyExpenditureTab: null,

    addTabButtons: function () {
        var me = this;

        var saveButton = new Ext.Button({
            text: 'Save', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnSave'),
            handler: function () {
                me.supplyExpenditureStore.submitChanges(function () {
                    me.supplyExpenditureStore.reload();
                });
            }
        });
        var addRowButton = new Ext.Button({
            text: 'Add Row', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnAdd'),
            handler: function () {
                me.supplyExpenditureStore.addNew();
                me.supplyExpenditureGrid.getView().refresh();
            }
        });
        var cancelButton = new Ext.Button({
            text: 'Cancel', ctCls: 'ux-button-1', width: 90, id: me.getClientId('btnCancel'),
            handler: function () {
                me.supplyExpenditureStore.reload();
            }
        });
        var printButton = new Ext.Button({
            text: 'Print', ctCls: 'ux-button-1', width: 90,
            handler: function () {
                me.printSupplyExpenditure();
            }
        });

        this.addChildControl(saveButton, 'supply-expanditures-tab-save-button');
        this.addChildControl(addRowButton, 'supply-expanditures-tab-add-button');
        this.addChildControl(cancelButton, 'supply-expanditures-tab-cancel-button');
        this.addChildControl(printButton, 'supply-expanditures-tab-print-button');
    },

    addSupplyExpenditureGrid: function () {
        var me = this;

        var group = new Ext.ux.grid.ColumnHeaderGroup({
            rows: [[
                    { header: '', colspan: 3 },
                    { header: 'Actual Avg YTD', colspan: 2, align: 'center' },
                    { header: 'Budget <span id="current-fiscal-year"></span>', colspan: 2, align: 'center' },
                    { header: 'Variance', colspan: 2, align: 'center' },
                    { header: '', colspan: 1}]
            ]
        });

        var customRenderer = function (value, metaData, record, rowIndex, colIndex, store) {
            if (rowIndex == me.supplyExpenditureStore.getCount() - 1)
                metaData.attr = 'style="color:#333;font-weight:bold;"';

            if (typeof value == 'string')
                return value;
            else if (typeof value == 'number') {
                return value ? value : '';
            }
            return '';
        }
        var colModel = new Ext.grid.ColumnModel({
            defaults: { sortable: false },
            columns: [
                    { header: 'Description<br />&nbsp;', width: 250, dataIndex: 'description', css: 'color:#43A643;font-weight:bold;',
                        editor: new Ext.form.TextField(),
                        renderer: customRenderer
                    },
                    { header: 'Unit<br />&nbsp;', dataIndex: 'unit', css: 'color:#43A643;font-weight:bold;',
                        editor: new Ext.form.TextField()
                    },
                    { header: 'Unit Price<br />&nbsp;', dataIndex: 'unitPrice', css: 'color:#43A643;font-weight:bold;',
                        editor: new Ext.form.NumberField(),
                        renderer: customRenderer
                    },
                    { header: 'Usage Per Period<br />&nbsp;', dataIndex: 'usagePerPeriod', css: 'color:#43A643;font-weight:bold;',
                        editor: new Ext.form.NumberField({ allowDecimals: false }),
                        renderer: customRenderer
                    },
                    { header: 'Cost Per Period<br />&nbsp;', dataIndex: 'costPerPeriod',
                        renderer: customRenderer
                    },
                    { header: 'Usage Per Period<br />Override', dataIndex: 'usagePerPeriodOverride', css: 'color:#43A643;font-weight:bold;',
                        editor: new Ext.form.NumberField(),
                        renderer: customRenderer
                    },
                    { header: 'Cost Per Period<br />Override', dataIndex: 'costPerPeriodOverride',
                        renderer: customRenderer
                    },
                    { header: 'Qty Diff.<br />&nbsp;', dataIndex: 'qtyDiff',
                        renderer: customRenderer
                    },
                    { header: 'Price Diff.<br />&nbsp;', dataIndex: 'priceDiff',
                        renderer: customRenderer
                    },
                    { header: 'Remove', width: 60,
                        renderer: function (value, metaData, record, rowIndex, colIndex, store) {
                            if (record.get('_sysStatus') == 1 && rowIndex != me.supplyExpenditureStore.getCount() - 1)
                                return '<a href="javascript:void(0);" xcmd="remove">Remove</a>';
                            return '';
                        }
                    }
                ],
            isCellEditable: function (colIndex, rowIndex) {
                return rowIndex < me.supplyExpenditureStore.getCount() - 1;
            }
        });

        this.supplyExpenditureGrid = new Bud.grid.EditorGridPanel({
            ctCls: 'ux-grid-1', width: 1250,
            enableHdMenu: false, height: 400,
            clicksToEdit: 1,
            viewConfig: { forceFit: true },
            store: this.supplyExpenditureStore,
            cm: colModel,
            plugins: group
        });

        this.supplyExpenditureGrid.on('cellclick', function (grid, rowIndex, colIndex, e) {
            var cmd = $(e.getTarget()).attr('xcmd');
            var record = grid.getStore().getAt(rowIndex);
            switch (cmd) {
                case 'remove':
                    grid.getStore().remove(record);
                    me.supplyExpenditureGrid.getView().refresh();
                    break;
            }
        });

        this.supplyExpenditureGrid.on('beforeedit', function (e) {
            if (me.isReadOnlyMode())
                e.cancel = true;
        });
    },

    printSupplyExpenditure: function () {
        var me = this;

        var title;
        switch (me.fscAccount) {
            case 261: title = "Paper Supplies"; break;
            case 262: title = "Plastic Supplies"; break;
            case 256: title = "Janitorial Supplies"; break;
            case 263: title = "Hand Soap Supplies"; break;
        }
        me.supplyExpenditureGrid.getColumnModel().config[me.supplyExpenditureGrid.getColumnModel().config.length - 1].hidden = true;

        Ext.ux.Printer.print('Supply Expenditure', _builtInTemplate_6091cb6c[43],
         { incomeTypes: me.supplyExpenditureGrid,
             'title': title,
             'hcmHouseCodeTitle': me.getHcmHouseCodeTitle(),
             'hcmJobTitle': me.getHcmJobTitle(),
             'fscYearTitle': me.getFscYearTitle()
         },
         '../../res/css/print-all.css');

        me.supplyExpenditureGrid.getColumnModel().config[me.supplyExpenditureGrid.getColumnModel().config.length - 1].hidden = false;
    },

    createChildControls: function () {
        var me = this;

        this.supplyExpenditureStore = new Bud.data.BudSupplyExpenditureStore();

        //        this.supplyExpenditureStore.on('add', function () {
        //            me.supplyExpenditureGrid.getView().refresh();
        //        });
        //        this.supplyExpenditureStore.on('remove', function () {
        //            me.supplyExpenditureGrid.getView().refresh();
        //        });

        this.addTabButtons();
        this.addSupplyExpenditureGrid();

        this.addChildControl(this.supplyExpenditureGrid, 'supply-expanditures-tab-grid');

        Bud.page.SupplyExpendituresPage.superclass.createChildControls.call(this);

        this.supplyExpenditureTab = $('#' + this.getClientId('supply-expanditures-tab-panel')).tabs({ selected: 0 });

    },
    dataBind: function () {
        var me = this;
        this.on('contextChanged', function () {
            $('#current-fiscal-year').text(me.getFscYearTitle());
            var loadData = function (tabIndex) {
                switch (tabIndex) {
                    case 1:
                        me.fscAccount = 262;
                        break;
                    case 2:
                        me.fscAccount = 256;
                        break;
                    case 3:
                        me.fscAccount = 263;
                        break;
                    case 0:
                    default:
                        me.fscAccount = 261;
                        break;
                }
                me.supplyExpenditureStore.load(me.getHcmHouseCode(), me.getHcmJob(), me.getFscYear(), me.fscAccount);
            };
            loadData(0);
            // tab select event
            me.supplyExpenditureTab.bind('tabsselect', function (event, ui) {
                loadData(ui.index);
            });
        });

        this.on('modechanged', function () {
            me.onModeChanged();
        });

        this.grouping([this, this.supplyExpenditureStore]
        , {
        });

        Bud.page.SupplyExpendituresPage.superclass.dataBind.call(this);
        this.onModeChanged();
    },
    onModeChanged: function () {
        var me = this;
        var btnSave = Ext.get(me.getClientId('btnSave'));
        var btnCancel = Ext.get(me.getClientId('btnCancel'));
        var btnAdd = Ext.get(me.getClientId('btnAdd'));
        if (me.isReadOnlyMode()) {
            btnSave.hide();
            btnCancel.hide();
            btnAdd.hide();
        } else {
            btnSave.show();
            btnCancel.show();
            btnAdd.show();
        }
    }
});

WebLight.PageMgr.registerType('supplyexpenditures', Bud.page.SupplyExpendituresPage);


/// <reference path="../Core.js" />

WebLight.namespace('Bud.data');

Bud.data.BudDetailsStore = WebLight.extend(Bud.data.XmlStore, {

    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budDetails',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,
    includeReadOnly: false,

    _accountStore: null,
    isInitialed: false,

    fields: [
        { name: 'id', mapping: '@id', type: 'float' },
        { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
        { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
        { name: 'fscYear', mapping: '@fscYear', type: 'float' },
        { name: 'fscAccount', mapping: '@fscAccount', type: 'float' },
        { name: 'amount', mapping: '@amount', type: 'float' },
        { name: 'entAt', mapping: '@entAt', type: 'date' },
        { name: 'entBy', mapping: '@entBy', type: 'string' },
        { name: 'isReadOnly', mapping: '@isReadOnly', type: 'bool' },
        { name: 'period0', mapping: '@period0', type: 'float' },       // auto spread column
        {name: 'period1', mapping: '@period1', type: 'float' },
        { name: 'period2', mapping: '@period2', type: 'float' },
        { name: 'period3', mapping: '@period3', type: 'float' },
        { name: 'period4', mapping: '@period4', type: 'float' },
        { name: 'period5', mapping: '@period5', type: 'float' },
        { name: 'period6', mapping: '@period6', type: 'float' },
        { name: 'period7', mapping: '@period7', type: 'float' },
        { name: 'period8', mapping: '@period8', type: 'float' },
        { name: 'period9', mapping: '@period9', type: 'float' },
        { name: 'period10', mapping: '@period10', type: 'float' },
        { name: 'period11', mapping: '@period11', type: 'float' },
        { name: 'period12', mapping: '@period12', type: 'float' },
        { name: 'period13', mapping: '@period13', type: 'float' },
        { name: 'period14', mapping: '@period14', type: 'float' },
        { name: 'period15', mapping: '@period15', type: 'float' },
        { name: 'period16', mapping: '@period16', type: 'float' },
        { name: 'total', type: 'float' },
        { name: 'fscAccCode' },
        { name: 'description' },
        { name: 'accountCategoryId', type: 'float' },
        { name: 'accountCategory' },
        { name: 'percentage', type: 'float' },
        { name: 'isNegative' }
    ],

    constructor: function (config) {

        Bud.data.BudDetailsStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals }

        });

    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob, includeReadOnly: this.includeReadOnly ? "1" : "0" };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    round2: function (d) {
        return Math.round(d * 100) / 100;
    },

    calculate: function (v, total) {
        if (total)
            return v / total;
        if (v)
            return 1;
        return 0;
    },

    calculating: true,

    updateTotals: function () {
        var me = this;
        me.currentUpdatingTick++;
        var updatingTick = me.currentUpdatingTick;

        setTimeout(function () { me.innerUpdateTotals(updatingTick); }, 2000);
    },

    currentUpdatingTick: 0,

    innerUpdateTotals: function (updatingTick) {

        var me = this;
        if (updatingTick != me.currentUpdatingTick)
            return;

        if (me.calculating)
            return;

        this.suspendEvents(false);

        me.calculating = true;

        if (this.isInitialed) {
            var allTotal = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

            this.each(function (record) {
                if (!record.get('fscAccCode')) {
                    var cateId = record.get('id');

                    var recordCollection = me.queryBy(function (r, id) {
                        return r.get('accountCategoryId') == cateId;
                    });

                    var periods = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                    recordCollection.each(function (item, index) {
                        var isNeg = item.get('isNegative');

                        for (var i = 0; i < 16; i++) {
                            var fieldName = 'period' + (i + 1);
                            var value = item.get(fieldName);

                            periods[i] += isNeg ? -value : value;

                            if (item.get('accountCategoryId'))
                                allTotal[i] += isNeg ? -value : value;
                        }
                    });

                    for (var i = 0; i < 16; i++) {
                        var fieldName = 'period' + (i + 1);
                        if (record.get(fieldName) != me.round2(periods[i]))
                            record.set(fieldName, me.round2(periods[i]));
                    }
                }
            });

            // total row
            var totalRow = this.getAt(this.getCount() - 1);
            for (var i = 0; i < 16; i++) {
                var fieldName = 'period' + (i + 1);
                /// is g/l accoount isnegative is true, (which are most revenue related accounts), 
                /// when adding total, flip to negative on those numbers
                ///then flip total one more time. so postive means revenue more than expense means making money
                /// otherwise all reveneu and expense are positve numbers
                totalRow.set(fieldName, me.round2(-allTotal[i]));
            }

            this.each(function (record) {
                var total = 0;
                for (var i = 0; i < 12; i++) {
                    var fieldName = 'period' + (i + 1);
                    total += record.get(fieldName);
                }
                if (record.get('total') != me.round2(total))
                    record.set('total', me.round2(total));
            });

            var r = this.queryBy(function (record, id) {
                return record.get('id') == 45 && record.get('accountCategoryId') == 0;
            });
            if (r && r.getCount() == 1) {
                var total = r.get(0).get('total');
                me.each(function (rec) {
                    var newValue = me.calculate(rec.get('total'), total);
                    if (newValue != rec.get('percentage'))
                        rec.set('percentage', newValue);
                });
            }

        }

        me.calculating = false;
        this.resumeEvents();
        // commit changes for data loaded.
        // mark all data is valid, not dirty.
        if (me.firstCalculating === true) {
            me.commitChanges();
            me.firstCalculating = false;
        }

        this.resumeEvents();

        this.fireEvent('datarefresh', this);
    },

    getChangedRecords: function () {
        var records = [];
        var recs = Bud.data.BudDetailsStore.superclass.getChangedRecords.call(this);
        Ext.each(recs, function (rec, index) {
            if (rec.get('fscAccount') && (rec.get('_sysStatus') == 1 || rec.get('_sysStatus') == 2))
                records.push(rec);
        });

        return records;
    },

    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudDetailsStore.superclass.load.call(this);
    },

    reload: function () {
        var me = this;

        me.isInitialed = false;
        Bud.data.BudDetailsStore.superclass.reload.call(this);
    },

    assign: function (store) {
        if (this.getCount() > 0) {
            this.each(function (record) {
                var rec = store.getById(record.get('fscAccount'));
                if (rec) {
                    record.set('fscAccCode', rec.get('code'));
                    record.set('description', rec.get('name'));
                    record.set('accountCategoryId', rec.get('accountCategoryId'));
                    record.set('accountCategory', rec.get('accountCategory'));
                    record.set('isNegative', rec.get('isNegative'));
                }
            });

            /// changed at 2011/6/17
            this.sort('fscAccCode', 'ASC');
            //this.sort([{ field: 'accountCategoryId', direction: 'ASC' }, { field: 'fscAccCode', direction: 'ASC'}], 'ASC'); 
        }
    },

    relateTo: function (store) {
        var me = this;
        this._accountStore = store;

        var periods = {};
        for (var i = 0; i < 16; i++) {
            var fieldName = String.format('period{0}', i + 1);
            periods[fieldName] = 0;
        }

        if (this.getCount() == 0) {
            this.add(me.newRecord(Ext.apply({ id: 0, description: 'Total' }, periods)));
            return;
        }

        me.calculating = true;
        me.assign(store);

        for (var i = 0; i < this.getCount(); i++) {
            var record = this.getAt(i);
            var cateId = record.get('accountCategoryId');
            var cateName = record.get('accountCategory');

            var collection = me.queryBy(function (r, id) {
                return r.get('accountCategoryId') == cateId;
            });

            var length = collection.getCount();
            me.insert(i + length, me.newRecord(Ext.apply({ id: cateId, description: cateName, accountCategoryId: 0 }, periods)));
            i += length;
        }

        this.add(me.newRecord(Ext.apply({ id: 0, description: 'Total' }, periods)));

        me.calculating = false;
        this.isInitialed = true;

        me.firstCalculating = true;

        me.updateTotals();
    },

    addNewRecord: function (record) {
        var me = this;
        me.calculating = true;

        var accCode = record.get('code');
        var cateId = record.get('accountCategoryId');
        var cateName = record.get('accountCategory');

        var mix = me.queryBy(function (rec) {
            return rec.get('fscAccCode') == accCode;
        });
        if (mix.getCount() > 0) {
            alert('Account already exists.');
            return;
        }

        var periods = {};
        for (var i = 0; i < 16; i++) {
            var fieldName = String.format('period{0}', i + 1);
            periods[fieldName] = 0;
        }

        var insertRecord = function (index) {
            me.insert(index, me.newRecord(Ext.apply({
                description: record.get('name'),
                fscAccCode: accCode,
                fscAccount: record.get('id'),
                accountCategoryId: cateId,
                accountCategory: cateName,
                isReadOnly: 0,
                isNegative: record.get('isNegative')
            }, periods)));
        }

        var c = me.queryBy(function (r, id) {
            return r.get('accountCategoryId') == cateId;
        });

        var sumIndex = me.findBy(function (r) {
            return !r.get('fscAccCode') && r.get('id') == cateId && r.get('accountCategoryId') == 0;
        });

        if (sumIndex < 0) {
            insertRecord(0);
            me.insert(1, me.newRecord(Ext.apply({ id: cateId, description: cateName, accountCategoryId: 0 }, periods)));
        }
        else {
            insertRecord(sumIndex);
        }

        me.isInitialed = true;
        me.calculating = false;

        me.updateTotals();
    }
});


/// <reference path="../Core.js" />

Bud.data.BudProjectedDetailStore = WebLight.extend(Bud.data.XmlStore, {
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',
    storeId: 'budProjectedDetails',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,

    constructor: function (config) {

        Bud.data.BudProjectedDetailStore.superclass.constructor.call(this, config);

        this.on({

            add: { fn: this.updateTotals },

            remove: { fn: this.updateTotals },

            update: { fn: this.updateTotals },

            datachanged: { fn: this.updateTotals }

        });

    },

    updateTotals: function () {
        var me = this;
        this.suspendEvents(false);

        this.resumeEvents();

        this.fireEvent('datarefresh', this);
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    load: function (hcmHouseCode, hcmJob, fscYear) {

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudProjectedDetailStore.superclass.load.call(this);
    },

    getChangedRecords: function () {
        var records = [];
        var me = this;
        var recs = Bud.data.BudProjectedDetailStore.superclass.getChangedRecords.call(this);

        Ext.each(recs, function (rec, index) {
            if (!me.isEmptyRecord(rec))
                records.push(rec);
        });

        return records;
    },

    isEmptyRecord: function (rec) {
        var i;
        var isEmpty = true;
        for (i = 1; i < 14; i++) {
            isEmpty &= !rec.get(String.format('period{0}', i));
        }
        return isEmpty;
    },

    fields: [
        { name: 'id', mapping: '@id', type: 'float' },
        { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
        { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
        { name: 'fscYear', mapping: '@fscYear', type: 'float' },
        { name: 'fscPeriod', mapping: '@fscPeriod', type: 'float' },
        { name: 'fscAccount', mapping: '@fscAccount', type: 'float' },
        { name: 'modAt', mapping: '@modAt', type: 'date' },
        { name: 'modBy', mapping: '@modBy', type: 'string' },
        { name: 'period1', mapping: '@period1', type: 'float' },
        { name: 'period2', mapping: '@period2', type: 'float' },
        { name: 'period3', mapping: '@period3', type: 'float' },
        { name: 'period4', mapping: '@period4', type: 'float' },
        { name: 'period5', mapping: '@period5', type: 'float' },
        { name: 'period6', mapping: '@period6', type: 'float' },
        { name: 'period7', mapping: '@period7', type: 'float' },
        { name: 'period8', mapping: '@period8', type: 'float' },
        { name: 'period9', mapping: '@period9', type: 'float' },
        { name: 'period10', mapping: '@period10', type: 'float' },
        { name: 'period11', mapping: '@period11', type: 'float' },
        { name: 'period12', mapping: '@period12', type: 'float' },
        { name: 'period13', mapping: '@period13', type: 'float' },
        { name: 'period14', mapping: '@period14', type: 'float' },
        { name: 'total', type: 'float' }
    ]
});

/// <reference path="XmlStore.js" />

Bud.data.BudEducationStaffingHourStore = Ext.extend(Bud.data.XmlStore, {
    url: '/net/crothall/chimes/fin/bud/act/Provider.aspx',

    moduleId: 'bud',

    storeId: 'budEducationStaffingHours',

    _hcmHouseCode: 0,
    _fscYear: 0,
    _hcmJob: 0,

    isDataLoaded: false,

    constructor: function (config) {
        var me = this;

        var fields = [{ name: 'id', mapping: '@id', type: 'float' },
                { name: 'hcmHouseCode', mapping: '@hcmHouseCode', type: 'float' },
                { name: 'hcmJob', mapping: '@hcmJob', type: 'float' },
                { name: 'fscYear', mapping: '@fscYear', type: 'float'}];

        for (var i = 1; i <= 12; i++) {
            fields = fields.concat([{ name: 'daysPerMonth' + i, mapping: '@daysPerMonth' + i, type: 'float' },
                { name: 'hoursPerDay' + i, mapping: '@hoursPerDay' + i, type: 'float' },
                { name: 'avgWageRate' + i, mapping: '@avgWageRate' + i, type: 'float' },
                 { name: 'amount' + i, mapping: '@amount' + i, type: 'float'}]);
        }

        fields.push({ name: 'amountFY', mapping: '@amountFY', type: 'float' });

        config = Ext.apply(config || {}, { record: 'item',
            idProperty: '@id',
            fields: fields
        });

        Bud.data.BudEducationStaffingHourStore.superclass.constructor.call(this, config);

        this.on({
            add: { fn: this.updateTotals },
            remove: { fn: this.updateTotals },
            update: { fn: this.updateTotals },
            datachanged: { fn: me.updateTotals }
        });

    },

    round2: function (d) {
        return Math.round(d * 100) / 100;
    },

    updateTotals: function (commitIt) {
        var me = this;

        this.suspendEvents(false);

        if (this.getCount() == 0) {
            var newItem = {};
            for (var i = 1; i <= 12; i++) {
                newItem['hoursPerDay' + i] = 0;
                newItem['daysPerMonth' + i] = 0;
                newItem['avgWageRate' + i] = 0;
            }
            this.add(this.newRecord(newItem));
        }

        var totalAmount = 0;
        this.each(function (record) {
            for (var i = 1; i <= 12; i++) {
                amount = me.round2(record.get('hoursPerDay' + i) * record.get('daysPerMonth' + i) * record.get('avgWageRate' + i)) || 0;
                record.set('amount' + i, amount);
                totalAmount += amount;
            }
            record.set('amountFY', totalAmount);
        });

        this.each(function (record) {
            var total = 0;
            for (var i = 0; i < 16; i++) {
                var fieldName = String.format('period{0}', i + 1);
                total += record.get(fieldName);
            }
            record.set('total', me.round2(total));
        });

        // commit changes for data loaded.
        // mark all data is valid, not dirty.
        if (commitIt === true)
            me.commitChanges();

        this.resumeEvents();

        this.fireEvent('datarefresh', this);
    },

    getCriteria: function () {
        return { hcmHouseCode: this._hcmHouseCode, fscYear: this._fscYear, hcmJob: this._hcmJob };
    },

    addAttributes: function (data) {
        Ext.apply(data, { hcmHouseCode: this._hcmHouseCode, hcmJob: this._hcmJob, fscYear: this._fscYear });
    },

    getChangedRecords: function () {
        return [this.getAt(0)];
    },

    load: function (hcmHouseCode, hcmJob, fscYear) {
        var me = this;

        this._fscYear = fscYear;
        this._hcmHouseCode = hcmHouseCode;
        this._hcmJob = hcmJob;

        Bud.data.BudEducationStaffingHourStore.superclass.load.call(this);
    }
});

