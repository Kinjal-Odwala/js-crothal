<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Upload Sites</title>
    <link rel="stylesheet" type="text/css" href="../helpSkin.css" />
</head>
<body>
  <div class="header">
    <h1>Upload Sites</h1>
    <div class="description"></div>
  </div>
  <h2>Class</h2>
  <table class="elementTable">
    <tr><th colspan="5">Class Name</th></tr>
    <tr><td colspan="5">EpayTask</td></tr>
  </table>
    <h2>UI Elements</h2>
    <table class="elementTable">
      <tr>
        <th style="width:150px;">UI Element</th>
		<th style="width:120px;">Field Type</th>
		<th style="width:50px;">Mandatory</th>
		<th style="width:100px;">Source</th>				
		<th>Validation</th>
      </tr>
      <tr>
         <td colspan="5">There is no UI element.</td>
      </tr>
    </table>
    <h2>Import Process</h2>
		<div class="reference">1. Check Epay schedule per 1 min to get next run time. </div>
		<div class="reference">2. If current time is not scheduled upload time, back to no.1</div>
		<div class="reference">3. Call stored procedure EpaySitesSelect to get sites from database, then generated xml data by site use epay specified format.</div>
		<div class="reference">4. for each site's xml data, call Epay API AddUpdateObjectData method to upload generated xml. then Log it to EpayTaskCallItems table</div>
		<div class="reference">5. Log task executed in EpayTaskCalls table.</div>
    <h2>Configuration Settings</h2> 
    <table class="elementTable">
      <tr>
        <th>Configuration Key</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>ConnectionString</td>
        <td>Connection String used to connect to TeamFin database.</td>
      </tr>
      <tr>
        <td>EpayCorpId</td>
        <td>CropId for Epay API call</td>
      </tr>
	  <tr>
        <td>EpayLoginId</td>
        <td>LoginId for Epay API call</td>
      </tr>
	  <tr>
        <td>EpayPassword</td>
        <td>Password for Epay API call</td>
      </tr>
	  <tr>
        <td>EpayUTCDifference</td>
        <td>UTC Difference with Epay</td>
      </tr>
    </table>
    <h2>Data Mapping</h2>
    <table class="elementTable">
      <tr>
          <th>Field Name</th>
          <th>XML Element Name</th>
          <th>Data Type</th>
          <th>Invalid Action</th>
      </tr>
      <tr>
          <td>JobSiteId</td>
          <td>SITECODE</td>
          <td>int</td>
          <td></td>
      </tr>
      <tr>
          <td>JobSiteNumber</td>
          <td>SITENO</td>
          <td>int</td>
          <td></td>
      </tr>
      <tr>
          <td>JobSiteName</td>
          <td>SITENAME</td>
          <td>string</td>
          <td>Log Exception</td>
      </tr>
      <tr>
          <td>AddressLine1</td>
          <td>ADDRESS1</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>AddressLine2</td>
          <td>ADDRESS2</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>CityName</td>
          <td>CITY</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>State</td>
          <td>STATE</td>
          <td>string</td>
          <td>Log Exception</td>
      </tr>
      <tr>
          <td>ZipCode</td>
          <td>ZIP</td>
          <td>string</td>
          <td>Log Exception</td>
      </tr>
      <tr>
          <td>Country</td>
          <td>COUNTRY</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>Custom1</td>
          <td>CUSTOM1</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>Custom2</td>
          <td>CUSTOM2</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>IsActive</td>
          <td>ISACTIVE</td>
          <td>string</td>
          <td>Log Exception</td>
      </tr>
      <tr>
          <td>TimeZone</td>
          <td>TIMEZONE</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>ObserveDST</td>
          <td>DST</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>Phone</td>
          <td>PHONE</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>Email</td>
          <td>EMAIL</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>DefaultTaskCode</td>
          <td>TASKCODE</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>CallerIds</td>
          <td>CALLERID</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>Category</td>
          <td>CATEGORY</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>DefaultPayGroupId</td>
          <td>PAYGROUP</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>DivisionCode</td>
          <td>DIVISION</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>ReportingPeriodType</td>
          <td>PERIODTYPE</td>
          <td>string</td>
          <td></td>
      </tr>
      <tr>
          <td>ReportingPeriodRefDate</td>
          <td>PPREFDATE</td>
          <td>datetime</td>
          <td></td>
      </tr>
      <tr>
          <td>FirstDayOfWeek</td>
          <td>FDAYWEEK</td>
          <td>int</td>
          <td>Log Exception</td>
      </tr>
    </table>
    <h2>Error Messages and Notifications
</h2>
    <table class="elementTable">
       <tr>
         <th>Error/Event</th>
         <th>Message</th>
       </tr>
       <tr>
         <td>Generate Upload Data Error</td>   
        <td>Check table AppIEExceptions for exception details (AppIECategory = 11).</td>             
       </tr>
       <tr>
        <td>Upload Data Error</td>
        <td>Check table AppIEExceptions for exception details (AppIECategory = 11).</td>
       </tr>
    </table>
    <h2>Dependencies</h2>
	  <div class="reference">1. Windows Services must be restarted for new configuration settings to take effect.</div>
	  <div class="reference">2. Exception and Event logging depends on LogWriter class.</div>
    <h2>Database Objects</h2>		
    <table class="elementTable">
      <tr><th>Object Types</th><th>Object Names</th></tr>
      <tr>
       <td>Tables</td><td>EpayEmployees<br/>EpayTaskQueues<br/>EpayTaskCalls<br/>EpayTaskCallItems<br/>AppSystemVariables</td>
      </tr>
      <tr><td>Stored Procedures</td><td>EPaySitesSelect</td></tr>
    </table>
</body>
</html>
